(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[65],{8820:function(N){"use strict";function O(N){if(N.length>=255)throw TypeError("Alphabet too long");for(var O=new Uint8Array(256),U=0;U<O.length;U++)O[U]=255;for(var $=0;$<N.length;$++){var Y=N.charAt($),X=Y.charCodeAt(0);if(255!==O[X])throw TypeError(Y+" is ambiguous");O[X]=$}var J=N.length,Z=N.charAt(0),en=Math.log(J)/Math.log(256),es=Math.log(256)/Math.log(J);function eo(N){if("string"!=typeof N)throw TypeError("Expected String");if(0===N.length)return new Uint8Array;var U=0;if(" "!==N[0]){for(var $=0,Y=0;N[U]===Z;)$++,U++;for(var X=(N.length-U)*en+1>>>0,es=new Uint8Array(X);N[U];){var eo=O[N.charCodeAt(U)];if(255===eo)return;for(var ea=0,ec=X-1;(0!==eo||ea<Y)&&-1!==ec;ec--,ea++)eo+=J*es[ec]>>>0,es[ec]=eo%256>>>0,eo=eo/256>>>0;if(0!==eo)throw Error("Non-zero carry");Y=ea,U++}if(" "!==N[U]){for(var eu=X-Y;eu!==X&&0===es[eu];)eu++;for(var eh=new Uint8Array($+(X-eu)),ef=$;eu!==X;)eh[ef++]=es[eu++];return eh}}}function ea(N){var O=eo(N);if(O)return O;throw Error("Non-base"+J+" character")}return{encode:function(O){if(O instanceof Uint8Array||(ArrayBuffer.isView(O)?O=new Uint8Array(O.buffer,O.byteOffset,O.byteLength):Array.isArray(O)&&(O=Uint8Array.from(O))),!(O instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===O.length)return"";for(var U=0,$=0,Y=0,X=O.length;Y!==X&&0===O[Y];)Y++,U++;for(var en=(X-Y)*es+1>>>0,eo=new Uint8Array(en);Y!==X;){for(var ea=O[Y],ec=0,eu=en-1;(0!==ea||ec<$)&&-1!==eu;eu--,ec++)ea+=256*eo[eu]>>>0,eo[eu]=ea%J>>>0,ea=ea/J>>>0;if(0!==ea)throw Error("Non-zero carry");$=ec,Y++}for(var eh=en-$;eh!==en&&0===eo[eh];)eh++;for(var ef=Z.repeat(U);eh<en;++eh)ef+=N.charAt(eo[eh]);return ef},decodeUnsafe:eo,decode:ea}}N.exports=O},4537:function(N){"use strict";function O(N,O){for(var U=Array(arguments.length-1),$=0,Y=2,X=!0;Y<arguments.length;)U[$++]=arguments[Y++];return new Promise(function(Y,J){U[$]=function(N){if(X){if(X=!1,N)J(N);else{for(var O=Array(arguments.length-1),U=0;U<O.length;)O[U++]=arguments[U];Y.apply(null,O)}}};try{N.apply(O||null,U)}catch(N){X&&(X=!1,J(N))}})}N.exports=O},7419:function(N,O){"use strict";var U=O;U.length=function(N){var O=N.length;if(!O)return 0;for(var U=0;--O%4>1&&"="===N.charAt(O);)++U;return Math.ceil(3*N.length)/4-U};for(var $=Array(64),Y=Array(123),X=0;X<64;)Y[$[X]=X<26?X+65:X<52?X+71:X<62?X-4:X-59|43]=X++;U.encode=function(N,O,U){for(var Y,X=null,J=[],Z=0,en=0;O<U;){var es=N[O++];switch(en){case 0:J[Z++]=$[es>>2],Y=(3&es)<<4,en=1;break;case 1:J[Z++]=$[Y|es>>4],Y=(15&es)<<2,en=2;break;case 2:J[Z++]=$[Y|es>>6],J[Z++]=$[63&es],en=0}Z>8191&&((X||(X=[])).push(String.fromCharCode.apply(String,J)),Z=0)}return(en&&(J[Z++]=$[Y],J[Z++]=61,1===en&&(J[Z++]=61)),X)?(Z&&X.push(String.fromCharCode.apply(String,J.slice(0,Z))),X.join("")):String.fromCharCode.apply(String,J.slice(0,Z))};var J="invalid encoding";U.decode=function(N,O,U){for(var $,X=U,Z=0,en=0;en<N.length;){var es=N.charCodeAt(en++);if(61===es&&Z>1)break;if(void 0===(es=Y[es]))throw Error(J);switch(Z){case 0:$=es,Z=1;break;case 1:O[U++]=$<<2|(48&es)>>4,$=es,Z=2;break;case 2:O[U++]=(15&$)<<4|(60&es)>>2,$=es,Z=3;break;case 3:O[U++]=(3&$)<<6|es,Z=0}}if(1===Z)throw Error(J);return U-X},U.test=function(N){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(N)}},9211:function(N){"use strict";function O(){this._listeners={}}N.exports=O,O.prototype.on=function(N,O,U){return(this._listeners[N]||(this._listeners[N]=[])).push({fn:O,ctx:U||this}),this},O.prototype.off=function(N,O){if(void 0===N)this._listeners={};else if(void 0===O)this._listeners[N]=[];else for(var U=this._listeners[N],$=0;$<U.length;)U[$].fn===O?U.splice($,1):++$;return this},O.prototype.emit=function(N){var O=this._listeners[N];if(O){for(var U=[],$=1;$<arguments.length;)U.push(arguments[$++]);for($=0;$<O.length;)O[$].fn.apply(O[$++].ctx,U)}return this}},945:function(N){"use strict";function O(N){return"undefined"!=typeof Float32Array?function(){var O=new Float32Array([-0]),U=new Uint8Array(O.buffer),$=128===U[3];function Y(N,$,Y){O[0]=N,$[Y]=U[0],$[Y+1]=U[1],$[Y+2]=U[2],$[Y+3]=U[3]}function X(N,$,Y){O[0]=N,$[Y]=U[3],$[Y+1]=U[2],$[Y+2]=U[1],$[Y+3]=U[0]}function J(N,$){return U[0]=N[$],U[1]=N[$+1],U[2]=N[$+2],U[3]=N[$+3],O[0]}function Z(N,$){return U[3]=N[$],U[2]=N[$+1],U[1]=N[$+2],U[0]=N[$+3],O[0]}N.writeFloatLE=$?Y:X,N.writeFloatBE=$?X:Y,N.readFloatLE=$?J:Z,N.readFloatBE=$?Z:J}():function(){function O(N,O,U,$){var Y=O<0?1:0;if(Y&&(O=-O),0===O)N(1/O>0?0:2147483648,U,$);else if(isNaN(O))N(2143289344,U,$);else if(O>34028234663852886e22)N((Y<<31|2139095040)>>>0,U,$);else if(O<11754943508222875e-54)N((Y<<31|Math.round(O/1401298464324817e-60))>>>0,U,$);else{var X=Math.floor(Math.log(O)/Math.LN2),J=8388607&Math.round(O*Math.pow(2,-X)*8388608);N((Y<<31|X+127<<23|J)>>>0,U,$)}}function J(N,O,U){var $=N(O,U),Y=($>>31)*2+1,X=$>>>23&255,J=8388607&$;return 255===X?J?NaN:Y*(1/0):0===X?1401298464324817e-60*Y*J:Y*Math.pow(2,X-150)*(J+8388608)}N.writeFloatLE=O.bind(null,U),N.writeFloatBE=O.bind(null,$),N.readFloatLE=J.bind(null,Y),N.readFloatBE=J.bind(null,X)}(),"undefined"!=typeof Float64Array?function(){var O=new Float64Array([-0]),U=new Uint8Array(O.buffer),$=128===U[7];function Y(N,$,Y){O[0]=N,$[Y]=U[0],$[Y+1]=U[1],$[Y+2]=U[2],$[Y+3]=U[3],$[Y+4]=U[4],$[Y+5]=U[5],$[Y+6]=U[6],$[Y+7]=U[7]}function X(N,$,Y){O[0]=N,$[Y]=U[7],$[Y+1]=U[6],$[Y+2]=U[5],$[Y+3]=U[4],$[Y+4]=U[3],$[Y+5]=U[2],$[Y+6]=U[1],$[Y+7]=U[0]}function J(N,$){return U[0]=N[$],U[1]=N[$+1],U[2]=N[$+2],U[3]=N[$+3],U[4]=N[$+4],U[5]=N[$+5],U[6]=N[$+6],U[7]=N[$+7],O[0]}function Z(N,$){return U[7]=N[$],U[6]=N[$+1],U[5]=N[$+2],U[4]=N[$+3],U[3]=N[$+4],U[2]=N[$+5],U[1]=N[$+6],U[0]=N[$+7],O[0]}N.writeDoubleLE=$?Y:X,N.writeDoubleBE=$?X:Y,N.readDoubleLE=$?J:Z,N.readDoubleBE=$?Z:J}():function(){function O(N,O,U,$,Y,X){var J,Z=$<0?1:0;if(Z&&($=-$),0===$)N(0,Y,X+O),N(1/$>0?0:2147483648,Y,X+U);else if(isNaN($))N(0,Y,X+O),N(2146959360,Y,X+U);else if($>17976931348623157e292)N(0,Y,X+O),N((Z<<31|2146435072)>>>0,Y,X+U);else if($<22250738585072014e-324)N((J=$/5e-324)>>>0,Y,X+O),N((Z<<31|J/4294967296)>>>0,Y,X+U);else{var en=Math.floor(Math.log($)/Math.LN2);1024===en&&(en=1023),N(4503599627370496*(J=$*Math.pow(2,-en))>>>0,Y,X+O),N((Z<<31|en+1023<<20|1048576*J&1048575)>>>0,Y,X+U)}}function J(N,O,U,$,Y){var X=N($,Y+O),J=N($,Y+U),Z=(J>>31)*2+1,en=J>>>20&2047,es=4294967296*(1048575&J)+X;return 2047===en?es?NaN:Z*(1/0):0===en?5e-324*Z*es:Z*Math.pow(2,en-1075)*(es+4503599627370496)}N.writeDoubleLE=O.bind(null,U,0,4),N.writeDoubleBE=O.bind(null,$,4,0),N.readDoubleLE=J.bind(null,Y,0,4),N.readDoubleBE=J.bind(null,X,4,0)}(),N}function U(N,O,U){O[U]=255&N,O[U+1]=N>>>8&255,O[U+2]=N>>>16&255,O[U+3]=N>>>24}function $(N,O,U){O[U]=N>>>24,O[U+1]=N>>>16&255,O[U+2]=N>>>8&255,O[U+3]=255&N}function Y(N,O){return(N[O]|N[O+1]<<8|N[O+2]<<16|N[O+3]<<24)>>>0}function X(N,O){return(N[O]<<24|N[O+1]<<16|N[O+2]<<8|N[O+3])>>>0}N.exports=O(O)},7199:function(module){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},6662:function(N){"use strict";function O(N,O,U){var $=U||8192,Y=$>>>1,X=null,J=$;return function(U){if(U<1||U>Y)return N(U);J+U>$&&(X=N($),J=0);var Z=O.call(X,J,J+=U);return 7&J&&(J=(7|J)+1),Z}}N.exports=O},4997:function(N,O){"use strict";var U=O;U.length=function(N){for(var O=0,U=0,$=0;$<N.length;++$)(U=N.charCodeAt($))<128?O+=1:U<2048?O+=2:(64512&U)==55296&&(64512&N.charCodeAt($+1))==56320?(++$,O+=4):O+=3;return O},U.read=function(N,O,U){if(U-O<1)return"";for(var $,Y=null,X=[],J=0;O<U;)($=N[O++])<128?X[J++]=$:$>191&&$<224?X[J++]=(31&$)<<6|63&N[O++]:$>239&&$<365?($=((7&$)<<18|(63&N[O++])<<12|(63&N[O++])<<6|63&N[O++])-65536,X[J++]=55296+($>>10),X[J++]=56320+(1023&$)):X[J++]=(15&$)<<12|(63&N[O++])<<6|63&N[O++],J>8191&&((Y||(Y=[])).push(String.fromCharCode.apply(String,X)),J=0);return Y?(J&&Y.push(String.fromCharCode.apply(String,X.slice(0,J))),Y.join("")):String.fromCharCode.apply(String,X.slice(0,J))},U.write=function(N,O,U){for(var $,Y,X=U,J=0;J<N.length;++J)($=N.charCodeAt(J))<128?O[U++]=$:$<2048?(O[U++]=$>>6|192,O[U++]=63&$|128):(64512&$)==55296&&(64512&(Y=N.charCodeAt(J+1)))==56320?($=65536+((1023&$)<<10)+(1023&Y),++J,O[U++]=$>>18|240,O[U++]=$>>12&63|128,O[U++]=$>>6&63|128,O[U++]=63&$|128):(O[U++]=$>>12|224,O[U++]=$>>6&63|128,O[U++]=63&$|128);return U-X}},8099:function(N,O,U){"use strict";Object.defineProperty(O,"__esModule",{value:!0});var $=U(7117);function Y(N,O){return void 0===O&&(O=0),(N[O+0]<<8|N[O+1])<<16>>16}function X(N,O){return void 0===O&&(O=0),(N[O+0]<<8|N[O+1])>>>0}function J(N,O){return void 0===O&&(O=0),(N[O+1]<<8|N[O])<<16>>16}function Z(N,O){return void 0===O&&(O=0),(N[O+1]<<8|N[O])>>>0}function en(N,O,U){return void 0===O&&(O=new Uint8Array(2)),void 0===U&&(U=0),O[U+0]=N>>>8,O[U+1]=N>>>0,O}function es(N,O,U){return void 0===O&&(O=new Uint8Array(2)),void 0===U&&(U=0),O[U+0]=N>>>0,O[U+1]=N>>>8,O}function eo(N,O){return void 0===O&&(O=0),N[O]<<24|N[O+1]<<16|N[O+2]<<8|N[O+3]}function ea(N,O){return void 0===O&&(O=0),(N[O]<<24|N[O+1]<<16|N[O+2]<<8|N[O+3])>>>0}function ec(N,O){return void 0===O&&(O=0),N[O+3]<<24|N[O+2]<<16|N[O+1]<<8|N[O]}function eu(N,O){return void 0===O&&(O=0),(N[O+3]<<24|N[O+2]<<16|N[O+1]<<8|N[O])>>>0}function eh(N,O,U){return void 0===O&&(O=new Uint8Array(4)),void 0===U&&(U=0),O[U+0]=N>>>24,O[U+1]=N>>>16,O[U+2]=N>>>8,O[U+3]=N>>>0,O}function ef(N,O,U){return void 0===O&&(O=new Uint8Array(4)),void 0===U&&(U=0),O[U+0]=N>>>0,O[U+1]=N>>>8,O[U+2]=N>>>16,O[U+3]=N>>>24,O}function eg(N,O){void 0===O&&(O=0);var U=eo(N,O),$=eo(N,O+4);return 4294967296*U+$-($>>31)*4294967296}function ey(N,O){return void 0===O&&(O=0),4294967296*ea(N,O)+ea(N,O+4)}function ew(N,O){void 0===O&&(O=0);var U=ec(N,O);return 4294967296*ec(N,O+4)+U-(U>>31)*4294967296}function ev(N,O){void 0===O&&(O=0);var U=eu(N,O);return 4294967296*eu(N,O+4)+U}function eE(N,O,U){return void 0===O&&(O=new Uint8Array(8)),void 0===U&&(U=0),eh(N/4294967296>>>0,O,U),eh(N>>>0,O,U+4),O}function e_(N,O,U){return void 0===O&&(O=new Uint8Array(8)),void 0===U&&(U=0),ef(N>>>0,O,U),ef(N/4294967296>>>0,O,U+4),O}function eS(N,O,U){if(void 0===U&&(U=0),N%8!=0)throw Error("readUintBE supports only bitLengths divisible by 8");if(N/8>O.length-U)throw Error("readUintBE: array is too short for the given bitLength");for(var $=0,Y=1,X=N/8+U-1;X>=U;X--)$+=O[X]*Y,Y*=256;return $}function eI(N,O,U){if(void 0===U&&(U=0),N%8!=0)throw Error("readUintLE supports only bitLengths divisible by 8");if(N/8>O.length-U)throw Error("readUintLE: array is too short for the given bitLength");for(var $=0,Y=1,X=U;X<U+N/8;X++)$+=O[X]*Y,Y*=256;return $}function eR(N,O,U,Y){if(void 0===U&&(U=new Uint8Array(N/8)),void 0===Y&&(Y=0),N%8!=0)throw Error("writeUintBE supports only bitLengths divisible by 8");if(!$.isSafeInteger(O))throw Error("writeUintBE value must be an integer");for(var X=1,J=N/8+Y-1;J>=Y;J--)U[J]=O/X&255,X*=256;return U}function ek(N,O,U,Y){if(void 0===U&&(U=new Uint8Array(N/8)),void 0===Y&&(Y=0),N%8!=0)throw Error("writeUintLE supports only bitLengths divisible by 8");if(!$.isSafeInteger(O))throw Error("writeUintLE value must be an integer");for(var X=1,J=Y;J<Y+N/8;J++)U[J]=O/X&255,X*=256;return U}function eD(N,O){return void 0===O&&(O=0),new DataView(N.buffer,N.byteOffset,N.byteLength).getFloat32(O)}function eA(N,O){return void 0===O&&(O=0),new DataView(N.buffer,N.byteOffset,N.byteLength).getFloat32(O,!0)}function eT(N,O){return void 0===O&&(O=0),new DataView(N.buffer,N.byteOffset,N.byteLength).getFloat64(O)}function eC(N,O){return void 0===O&&(O=0),new DataView(N.buffer,N.byteOffset,N.byteLength).getFloat64(O,!0)}function eP(N,O,U){return void 0===O&&(O=new Uint8Array(4)),void 0===U&&(U=0),new DataView(O.buffer,O.byteOffset,O.byteLength).setFloat32(U,N),O}function eN(N,O,U){return void 0===O&&(O=new Uint8Array(4)),void 0===U&&(U=0),new DataView(O.buffer,O.byteOffset,O.byteLength).setFloat32(U,N,!0),O}function eB(N,O,U){return void 0===O&&(O=new Uint8Array(8)),void 0===U&&(U=0),new DataView(O.buffer,O.byteOffset,O.byteLength).setFloat64(U,N),O}function eL(N,O,U){return void 0===O&&(O=new Uint8Array(8)),void 0===U&&(U=0),new DataView(O.buffer,O.byteOffset,O.byteLength).setFloat64(U,N,!0),O}O.readInt16BE=Y,O.readUint16BE=X,O.readInt16LE=J,O.readUint16LE=Z,O.writeUint16BE=en,O.writeInt16BE=en,O.writeUint16LE=es,O.writeInt16LE=es,O.readInt32BE=eo,O.readUint32BE=ea,O.readInt32LE=ec,O.readUint32LE=eu,O.writeUint32BE=eh,O.writeInt32BE=eh,O.writeUint32LE=ef,O.writeInt32LE=ef,O.readInt64BE=eg,O.readUint64BE=ey,O.readInt64LE=ew,O.readUint64LE=ev,O.writeUint64BE=eE,O.writeInt64BE=eE,O.writeUint64LE=e_,O.writeInt64LE=e_,O.readUintBE=eS,O.readUintLE=eI,O.writeUintBE=eR,O.writeUintLE=ek,O.readFloat32BE=eD,O.readFloat32LE=eA,O.readFloat64BE=eT,O.readFloat64LE=eC,O.writeFloat32BE=eP,O.writeFloat32LE=eN,O.writeFloat64BE=eB,O.writeFloat64LE=eL},5439:function(N,O,U){"use strict";Object.defineProperty(O,"__esModule",{value:!0});var $=U(8099),Y=U(7309),X=20;function J(N,O,U){for(var Y=1634760805,J=857760878,Z=2036477234,en=1797285236,es=U[3]<<24|U[2]<<16|U[1]<<8|U[0],eo=U[7]<<24|U[6]<<16|U[5]<<8|U[4],ea=U[11]<<24|U[10]<<16|U[9]<<8|U[8],ec=U[15]<<24|U[14]<<16|U[13]<<8|U[12],eu=U[19]<<24|U[18]<<16|U[17]<<8|U[16],eh=U[23]<<24|U[22]<<16|U[21]<<8|U[20],ef=U[27]<<24|U[26]<<16|U[25]<<8|U[24],eg=U[31]<<24|U[30]<<16|U[29]<<8|U[28],ey=O[3]<<24|O[2]<<16|O[1]<<8|O[0],ew=O[7]<<24|O[6]<<16|O[5]<<8|O[4],ev=O[11]<<24|O[10]<<16|O[9]<<8|O[8],eE=O[15]<<24|O[14]<<16|O[13]<<8|O[12],e_=Y,eS=J,eI=Z,eR=en,ek=es,eD=eo,eA=ea,eT=ec,eC=eu,eP=eh,eN=ef,eB=eg,eL=ey,eO=ew,eM=ev,eU=eE,eF=0;eF<X;eF+=2)eL^=e_=e_+ek|0,ek^=eC=eC+(eL=eL>>>16|eL<<16)|0,ek=ek>>>20|ek<<12,eO^=eS=eS+eD|0,eD^=eP=eP+(eO=eO>>>16|eO<<16)|0,eD=eD>>>20|eD<<12,eM^=eI=eI+eA|0,eA^=eN=eN+(eM=eM>>>16|eM<<16)|0,eA=eA>>>20|eA<<12,eU^=eR=eR+eT|0,eT^=eB=eB+(eU=eU>>>16|eU<<16)|0,eT=eT>>>20|eT<<12,eM^=eI=eI+eA|0,eA^=eN=eN+(eM=eM>>>24|eM<<8)|0,eA=eA>>>25|eA<<7,eU^=eR=eR+eT|0,eT^=eB=eB+(eU=eU>>>24|eU<<8)|0,eT=eT>>>25|eT<<7,eO^=eS=eS+eD|0,eD^=eP=eP+(eO=eO>>>24|eO<<8)|0,eD=eD>>>25|eD<<7,eL^=e_=e_+ek|0,ek^=eC=eC+(eL=eL>>>24|eL<<8)|0,ek=ek>>>25|ek<<7,eU^=e_=e_+eD|0,eD^=eN=eN+(eU=eU>>>16|eU<<16)|0,eD=eD>>>20|eD<<12,eL^=eS=eS+eA|0,eA^=eB=eB+(eL=eL>>>16|eL<<16)|0,eA=eA>>>20|eA<<12,eO^=eI=eI+eT|0,eT^=eC=eC+(eO=eO>>>16|eO<<16)|0,eT=eT>>>20|eT<<12,eM^=eR=eR+ek|0,ek^=eP=eP+(eM=eM>>>16|eM<<16)|0,ek=ek>>>20|ek<<12,eO^=eI=eI+eT|0,eT^=eC=eC+(eO=eO>>>24|eO<<8)|0,eT=eT>>>25|eT<<7,eM^=eR=eR+ek|0,ek^=eP=eP+(eM=eM>>>24|eM<<8)|0,ek=ek>>>25|ek<<7,eL^=eS=eS+eA|0,eA^=eB=eB+(eL=eL>>>24|eL<<8)|0,eA=eA>>>25|eA<<7,eU^=e_=e_+eD|0,eD^=eN=eN+(eU=eU>>>24|eU<<8)|0,eD=eD>>>25|eD<<7;$.writeUint32LE(e_+Y|0,N,0),$.writeUint32LE(eS+J|0,N,4),$.writeUint32LE(eI+Z|0,N,8),$.writeUint32LE(eR+en|0,N,12),$.writeUint32LE(ek+es|0,N,16),$.writeUint32LE(eD+eo|0,N,20),$.writeUint32LE(eA+ea|0,N,24),$.writeUint32LE(eT+ec|0,N,28),$.writeUint32LE(eC+eu|0,N,32),$.writeUint32LE(eP+eh|0,N,36),$.writeUint32LE(eN+ef|0,N,40),$.writeUint32LE(eB+eg|0,N,44),$.writeUint32LE(eL+ey|0,N,48),$.writeUint32LE(eO+ew|0,N,52),$.writeUint32LE(eM+ev|0,N,56),$.writeUint32LE(eU+eE|0,N,60)}function Z(N,O,U,$,X){if(void 0===X&&(X=0),32!==N.length)throw Error("ChaCha: key size must be 32 bytes");if($.length<U.length)throw Error("ChaCha: destination is shorter than source");if(0===X){if(8!==O.length&&12!==O.length)throw Error("ChaCha nonce must be 8 or 12 bytes");en=(Z=new Uint8Array(16)).length-O.length,Z.set(O,en)}else{if(16!==O.length)throw Error("ChaCha nonce with counter must be 16 bytes");Z=O,en=X}for(var Z,en,eo=new Uint8Array(64),ea=0;ea<U.length;ea+=64){J(eo,Z,N);for(var ec=ea;ec<ea+64&&ec<U.length;ec++)$[ec]=U[ec]^eo[ec-ea];es(Z,0,en)}return Y.wipe(eo),0===X&&Y.wipe(Z),$}function en(N,O,U,$){return void 0===$&&($=0),Y.wipe(U),Z(N,O,U,U,$)}function es(N,O,U){for(var $=1;U--;)$=$+(255&N[O])|0,N[O]=255&$,$>>>=8,O++;if($>0)throw Error("ChaCha: counter overflow")}O.streamXOR=Z,O.stream=en},5501:function(N,O,U){"use strict";$={value:!0};var $,Y=U(5439),X=U(3027),J=U(7309),Z=U(8099),en=U(4153);O.Cv=32,O.WH=12,O.pg=16;var es=new Uint8Array(16),eo=function(){function N(N){if(this.nonceLength=O.WH,this.tagLength=O.pg,N.length!==O.Cv)throw Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(N)}return N.prototype.seal=function(N,O,U,$){if(N.length>16)throw Error("ChaCha20Poly1305: incorrect nonce length");var X,Z=new Uint8Array(16);Z.set(N,Z.length-N.length);var en=new Uint8Array(32);Y.stream(this._key,Z,en,4);var es=O.length+this.tagLength;if($){if($.length!==es)throw Error("ChaCha20Poly1305: incorrect destination length");X=$}else X=new Uint8Array(es);return Y.streamXOR(this._key,Z,O,X,4),this._authenticate(X.subarray(X.length-this.tagLength,X.length),en,X.subarray(0,X.length-this.tagLength),U),J.wipe(Z),X},N.prototype.open=function(N,O,U,$){if(N.length>16)throw Error("ChaCha20Poly1305: incorrect nonce length");if(O.length<this.tagLength)return null;var X,Z=new Uint8Array(16);Z.set(N,Z.length-N.length);var es=new Uint8Array(32);Y.stream(this._key,Z,es,4);var eo=new Uint8Array(this.tagLength);if(this._authenticate(eo,es,O.subarray(0,O.length-this.tagLength),U),!en.equal(eo,O.subarray(O.length-this.tagLength,O.length)))return null;var ea=O.length-this.tagLength;if($){if($.length!==ea)throw Error("ChaCha20Poly1305: incorrect destination length");X=$}else X=new Uint8Array(ea);return Y.streamXOR(this._key,Z,O.subarray(0,O.length-this.tagLength),X,4),J.wipe(Z),X},N.prototype.clean=function(){return J.wipe(this._key),this},N.prototype._authenticate=function(N,O,U,$){var Y=new X.Poly1305(O);$&&(Y.update($),$.length%16>0&&Y.update(es.subarray($.length%16))),Y.update(U),U.length%16>0&&Y.update(es.subarray(U.length%16));var en=new Uint8Array(8);$&&Z.writeUint64LE($.length,en),Y.update(en),Z.writeUint64LE(U.length,en),Y.update(en);for(var eo=Y.digest(),ea=0;ea<eo.length;ea++)N[ea]=eo[ea];Y.clean(),J.wipe(eo),J.wipe(en)},N}();O.OK=eo},4153:function(N,O){"use strict";function U(N,O,U){return~(N-1)&O|N-1&U}function $(N,O){return(0|N)-(0|O)-1>>>31&1}function Y(N,O){if(N.length!==O.length)return 0;for(var U=0,$=0;$<N.length;$++)U|=N[$]^O[$];return 1&U-1>>>8}function X(N,O){return 0!==N.length&&0!==O.length&&0!==Y(N,O)}Object.defineProperty(O,"__esModule",{value:!0}),O.select=U,O.lessOrEqual=$,O.compare=Y,O.equal=X},7117:function(N,O){"use strict";function U(N,O){var U=N>>>16&65535,$=65535&N,Y=O>>>16&65535,X=65535&O;return $*X+(U*X+$*Y<<16>>>0)|0}function $(N,O){return N+O|0}function Y(N,O){return N-O|0}function X(N,O){return N<<O|N>>>32-O}function J(N,O){return N<<32-O|N>>>O}function Z(N){return"number"==typeof N&&isFinite(N)&&Math.floor(N)===N}Object.defineProperty(O,"__esModule",{value:!0}),O.mul=Math.imul||U,O.add=$,O.sub=Y,O.rotl=X,O.rotr=J,O.isInteger=Number.isInteger||Z,O.MAX_SAFE_INTEGER=9007199254740991,O.isSafeInteger=function(N){return O.isInteger(N)&&N>=-O.MAX_SAFE_INTEGER&&N<=O.MAX_SAFE_INTEGER}},3027:function(N,O,U){"use strict";Object.defineProperty(O,"__esModule",{value:!0});var $=U(4153),Y=U(7309);O.DIGEST_LENGTH=16;var X=function(){function N(N){this.digestLength=O.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var U=N[0]|N[1]<<8;this._r[0]=8191&U;var $=N[2]|N[3]<<8;this._r[1]=(U>>>13|$<<3)&8191;var Y=N[4]|N[5]<<8;this._r[2]=($>>>10|Y<<6)&7939;var X=N[6]|N[7]<<8;this._r[3]=(Y>>>7|X<<9)&8191;var J=N[8]|N[9]<<8;this._r[4]=(X>>>4|J<<12)&255,this._r[5]=J>>>1&8190;var Z=N[10]|N[11]<<8;this._r[6]=(J>>>14|Z<<2)&8191;var en=N[12]|N[13]<<8;this._r[7]=(Z>>>11|en<<5)&8065;var es=N[14]|N[15]<<8;this._r[8]=(en>>>8|es<<8)&8191,this._r[9]=es>>>5&127,this._pad[0]=N[16]|N[17]<<8,this._pad[1]=N[18]|N[19]<<8,this._pad[2]=N[20]|N[21]<<8,this._pad[3]=N[22]|N[23]<<8,this._pad[4]=N[24]|N[25]<<8,this._pad[5]=N[26]|N[27]<<8,this._pad[6]=N[28]|N[29]<<8,this._pad[7]=N[30]|N[31]<<8}return N.prototype._blocks=function(N,O,U){for(var $=this._fin?0:2048,Y=this._h[0],X=this._h[1],J=this._h[2],Z=this._h[3],en=this._h[4],es=this._h[5],eo=this._h[6],ea=this._h[7],ec=this._h[8],eu=this._h[9],eh=this._r[0],ef=this._r[1],eg=this._r[2],ey=this._r[3],ew=this._r[4],ev=this._r[5],eE=this._r[6],e_=this._r[7],eS=this._r[8],eI=this._r[9];U>=16;){var eR,ek=N[O+0]|N[O+1]<<8;Y+=8191&ek;var eD=N[O+2]|N[O+3]<<8;X+=(ek>>>13|eD<<3)&8191;var eA=N[O+4]|N[O+5]<<8;J+=(eD>>>10|eA<<6)&8191;var eT=N[O+6]|N[O+7]<<8;Z+=(eA>>>7|eT<<9)&8191;var eC=N[O+8]|N[O+9]<<8;en+=(eT>>>4|eC<<12)&8191,es+=eC>>>1&8191;var eP=N[O+10]|N[O+11]<<8;eo+=(eC>>>14|eP<<2)&8191;var eN=N[O+12]|N[O+13]<<8;ea+=(eP>>>11|eN<<5)&8191;var eB=N[O+14]|N[O+15]<<8;ec+=(eN>>>8|eB<<8)&8191,eu+=eB>>>5|$;var eL=0;eL=(eR=0+Y*eh+X*(5*eI)+J*(5*eS)+Z*(5*e_)+en*(5*eE))>>>13,eR&=8191,eR+=es*(5*ev)+eo*(5*ew)+ea*(5*ey)+ec*(5*eg)+eu*(5*ef),eL+=eR>>>13,eR&=8191;var eO=eL;eO+=Y*ef+X*eh+J*(5*eI)+Z*(5*eS)+en*(5*e_),eL=eO>>>13,eO&=8191,eO+=es*(5*eE)+eo*(5*ev)+ea*(5*ew)+ec*(5*ey)+eu*(5*eg),eL+=eO>>>13,eO&=8191;var eM=eL;eM+=Y*eg+X*ef+J*eh+Z*(5*eI)+en*(5*eS),eL=eM>>>13,eM&=8191,eM+=es*(5*e_)+eo*(5*eE)+ea*(5*ev)+ec*(5*ew)+eu*(5*ey),eL+=eM>>>13,eM&=8191;var eU=eL;eU+=Y*ey+X*eg+J*ef+Z*eh+en*(5*eI),eL=eU>>>13,eU&=8191,eU+=es*(5*eS)+eo*(5*e_)+ea*(5*eE)+ec*(5*ev)+eu*(5*ew),eL+=eU>>>13,eU&=8191;var eF=eL;eF+=Y*ew+X*ey+J*eg+Z*ef+en*eh,eL=eF>>>13,eF&=8191,eF+=es*(5*eI)+eo*(5*eS)+ea*(5*e_)+ec*(5*eE)+eu*(5*ev),eL+=eF>>>13,eF&=8191;var eV=eL;eV+=Y*ev+X*ew+J*ey+Z*eg+en*ef,eL=eV>>>13,eV&=8191,eV+=es*eh+eo*(5*eI)+ea*(5*eS)+ec*(5*e_)+eu*(5*eE),eL+=eV>>>13,eV&=8191;var ez=eL;ez+=Y*eE+X*ev+J*ew+Z*ey+en*eg,eL=ez>>>13,ez&=8191,ez+=es*ef+eo*eh+ea*(5*eI)+ec*(5*eS)+eu*(5*e_),eL+=ez>>>13,ez&=8191;var e$=eL;e$+=Y*e_+X*eE+J*ev+Z*ew+en*ey,eL=e$>>>13,e$&=8191,e$+=es*eg+eo*ef+ea*eh+ec*(5*eI)+eu*(5*eS),eL+=e$>>>13,e$&=8191;var eK=eL;eK+=Y*eS+X*e_+J*eE+Z*ev+en*ew,eL=eK>>>13,eK&=8191,eK+=es*ey+eo*eg+ea*ef+ec*eh+eu*(5*eI),eL+=eK>>>13,eK&=8191;var eq=eL;eq+=Y*eI+X*eS+J*e_+Z*eE+en*ev,eL=eq>>>13,eq&=8191,eq+=es*ew+eo*ey+ea*eg+ec*ef+eu*eh,eL+=eq>>>13,eq&=8191,eR=8191&(eL=(eL=(eL<<2)+eL|0)+eR|0),eL>>>=13,eO+=eL,Y=eR,X=eO,J=eM,Z=eU,en=eF,es=eV,eo=ez,ea=e$,ec=eK,eu=eq,O+=16,U-=16}this._h[0]=Y,this._h[1]=X,this._h[2]=J,this._h[3]=Z,this._h[4]=en,this._h[5]=es,this._h[6]=eo,this._h[7]=ea,this._h[8]=ec,this._h[9]=eu},N.prototype.finish=function(N,O){void 0===O&&(O=0);var U,$,Y,X,J=new Uint16Array(10);if(this._leftover){for(X=this._leftover,this._buffer[X++]=1;X<16;X++)this._buffer[X]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(U=this._h[1]>>>13,this._h[1]&=8191,X=2;X<10;X++)this._h[X]+=U,U=this._h[X]>>>13,this._h[X]&=8191;for(this._h[0]+=5*U,U=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=U,U=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=U,J[0]=this._h[0]+5,U=J[0]>>>13,J[0]&=8191,X=1;X<10;X++)J[X]=this._h[X]+U,U=J[X]>>>13,J[X]&=8191;for(J[9]-=8192,$=(1^U)-1,X=0;X<10;X++)J[X]&=$;for(X=0,$=~$;X<10;X++)this._h[X]=this._h[X]&$|J[X];for(X=1,this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,Y=this._h[0]+this._pad[0],this._h[0]=65535&Y;X<8;X++)Y=(this._h[X]+this._pad[X]|0)+(Y>>>16)|0,this._h[X]=65535&Y;return N[O+0]=this._h[0]>>>0,N[O+1]=this._h[0]>>>8,N[O+2]=this._h[1]>>>0,N[O+3]=this._h[1]>>>8,N[O+4]=this._h[2]>>>0,N[O+5]=this._h[2]>>>8,N[O+6]=this._h[3]>>>0,N[O+7]=this._h[3]>>>8,N[O+8]=this._h[4]>>>0,N[O+9]=this._h[4]>>>8,N[O+10]=this._h[5]>>>0,N[O+11]=this._h[5]>>>8,N[O+12]=this._h[6]>>>0,N[O+13]=this._h[6]>>>8,N[O+14]=this._h[7]>>>0,N[O+15]=this._h[7]>>>8,this._finished=!0,this},N.prototype.update=function(N){var O,U=0,$=N.length;if(this._leftover){(O=16-this._leftover)>$&&(O=$);for(var Y=0;Y<O;Y++)this._buffer[this._leftover+Y]=N[U+Y];if($-=O,U+=O,this._leftover+=O,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if($>=16&&(O=$-$%16,this._blocks(N,U,O),U+=O,$-=O),$){for(var Y=0;Y<$;Y++)this._buffer[this._leftover+Y]=N[U+Y];this._leftover+=$}return this},N.prototype.digest=function(){if(this._finished)throw Error("Poly1305 was finished");var N=new Uint8Array(16);return this.finish(N),N},N.prototype.clean=function(){return Y.wipe(this._buffer),Y.wipe(this._r),Y.wipe(this._h),Y.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},N}();function J(N,O){var U=new X(N);U.update(O);var $=U.digest();return U.clean(),$}function Z(N,U){return N.length===O.DIGEST_LENGTH&&U.length===O.DIGEST_LENGTH&&$.equal(N,U)}O.Poly1305=X,O.oneTimeAuth=J,O.equal=Z},1416:function(N,O,U){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.randomStringForEntropy=O.randomString=O.randomUint32=O.randomBytes=O.defaultRandomSource=void 0;let $=U(6008),Y=U(8099),X=U(7309);function J(N,U=O.defaultRandomSource){return U.randomBytes(N)}function Z(N=O.defaultRandomSource){let U=J(4,N),$=(0,Y.readUint32LE)(U);return(0,X.wipe)(U),$}O.defaultRandomSource=new $.SystemRandomSource,O.randomBytes=J,O.randomUint32=Z;let en="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function es(N,U=en,$=O.defaultRandomSource){if(U.length<2)throw Error("randomString charset is too short");if(U.length>256)throw Error("randomString charset is too long");let Y="",Z=U.length,es=256-256%Z;for(;N>0;){let O=J(Math.ceil(256*N/es),$);for(let $=0;$<O.length&&N>0;$++){let X=O[$];X<es&&(Y+=U.charAt(X%Z),N--)}(0,X.wipe)(O)}return Y}function eo(N,U=en,$=O.defaultRandomSource){let Y=Math.ceil(N/(Math.log(U.length)/Math.LN2));return es(Y,U,$)}O.randomString=es,O.randomStringForEntropy=eo},5455:function(N,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BrowserRandomSource=void 0;let U=65536;class ${constructor(){this.isAvailable=!1,this.isInstantiated=!1;let N="undefined"!=typeof self?self.crypto||self.msCrypto:null;N&&void 0!==N.getRandomValues&&(this._crypto=N,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(N){if(!this.isAvailable||!this._crypto)throw Error("Browser random byte generator is not available.");let O=new Uint8Array(N);for(let N=0;N<O.length;N+=U)this._crypto.getRandomValues(O.subarray(N,N+Math.min(O.length-N,U)));return O}}O.BrowserRandomSource=$},8871:function(N,O,U){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.NodeRandomSource=void 0;let $=U(7309);class Y{constructor(){this.isAvailable=!1,this.isInstantiated=!1;{let N=U(5883);N&&N.randomBytes&&(this._crypto=N,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(N){if(!this.isAvailable||!this._crypto)throw Error("Node.js random byte generator is not available.");let O=this._crypto.randomBytes(N);if(O.length!==N)throw Error("NodeRandomSource: got fewer bytes than requested");let U=new Uint8Array(N);for(let N=0;N<U.length;N++)U[N]=O[N];return(0,$.wipe)(O),U}}O.NodeRandomSource=Y},6008:function(N,O,U){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.SystemRandomSource=void 0;let $=U(5455),Y=U(8871);class X{constructor(){if(this.isAvailable=!1,this.name="",this._source=new $.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Y.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(N){if(!this.isAvailable)throw Error("System random byte generator is not available.");return this._source.randomBytes(N)}}O.SystemRandomSource=X},7309:function(N,O){"use strict";function U(N){for(var O=0;O<N.length;O++)N[O]=0;return N}Object.defineProperty(O,"__esModule",{value:!0}),O.wipe=U},7664:function(N,O,U){"use strict";var $;$={value:!0},O.gi=O.Au=O._w=$=$=$=O.KS=O.kz=void 0;let Y=U(1416),X=U(7309);function J(N){let O=new Float64Array(16);if(N)for(let U=0;U<N.length;U++)O[U]=N[U];return O}O.kz=32,O.KS=32,$=32;let Z=new Uint8Array(32);Z[0]=9;let en=J([56129,1]);function es(N){let O=1;for(let U=0;U<16;U++){let $=N[U]+O+65535;O=Math.floor($/65536),N[U]=$-65536*O}N[0]+=O-1+37*(O-1)}function eo(N,O,U){let $=~(U-1);for(let U=0;U<16;U++){let Y=$&(N[U]^O[U]);N[U]^=Y,O[U]^=Y}}function ea(N,O){let U=J(),$=J();for(let N=0;N<16;N++)$[N]=O[N];es($),es($),es($);for(let N=0;N<2;N++){U[0]=$[0]-65517;for(let N=1;N<15;N++)U[N]=$[N]-65535-(U[N-1]>>16&1),U[N-1]&=65535;U[15]=$[15]-32767-(U[14]>>16&1);let N=U[15]>>16&1;U[14]&=65535,eo($,U,1-N)}for(let O=0;O<16;O++)N[2*O]=255&$[O],N[2*O+1]=$[O]>>8}function ec(N,O){for(let U=0;U<16;U++)N[U]=O[2*U]+(O[2*U+1]<<8);N[15]&=32767}function eu(N,O,U){for(let $=0;$<16;$++)N[$]=O[$]+U[$]}function eh(N,O,U){for(let $=0;$<16;$++)N[$]=O[$]-U[$]}function ef(N,O,U){let $,Y,X=0,J=0,Z=0,en=0,es=0,eo=0,ea=0,ec=0,eu=0,eh=0,ef=0,eg=0,ey=0,ew=0,ev=0,eE=0,e_=0,eS=0,eI=0,eR=0,ek=0,eD=0,eA=0,eT=0,eC=0,eP=0,eN=0,eB=0,eL=0,eO=0,eM=0,eU=U[0],eF=U[1],eV=U[2],ez=U[3],e$=U[4],eK=U[5],eq=U[6],ej=U[7],eW=U[8],eH=U[9],eG=U[10],eQ=U[11],eY=U[12],eX=U[13],eJ=U[14],eZ=U[15];X+=($=O[0])*eU,J+=$*eF,Z+=$*eV,en+=$*ez,es+=$*e$,eo+=$*eK,ea+=$*eq,ec+=$*ej,eu+=$*eW,eh+=$*eH,ef+=$*eG,eg+=$*eQ,ey+=$*eY,ew+=$*eX,ev+=$*eJ,eE+=$*eZ,J+=($=O[1])*eU,Z+=$*eF,en+=$*eV,es+=$*ez,eo+=$*e$,ea+=$*eK,ec+=$*eq,eu+=$*ej,eh+=$*eW,ef+=$*eH,eg+=$*eG,ey+=$*eQ,ew+=$*eY,ev+=$*eX,eE+=$*eJ,e_+=$*eZ,Z+=($=O[2])*eU,en+=$*eF,es+=$*eV,eo+=$*ez,ea+=$*e$,ec+=$*eK,eu+=$*eq,eh+=$*ej,ef+=$*eW,eg+=$*eH,ey+=$*eG,ew+=$*eQ,ev+=$*eY,eE+=$*eX,e_+=$*eJ,eS+=$*eZ,en+=($=O[3])*eU,es+=$*eF,eo+=$*eV,ea+=$*ez,ec+=$*e$,eu+=$*eK,eh+=$*eq,ef+=$*ej,eg+=$*eW,ey+=$*eH,ew+=$*eG,ev+=$*eQ,eE+=$*eY,e_+=$*eX,eS+=$*eJ,eI+=$*eZ,es+=($=O[4])*eU,eo+=$*eF,ea+=$*eV,ec+=$*ez,eu+=$*e$,eh+=$*eK,ef+=$*eq,eg+=$*ej,ey+=$*eW,ew+=$*eH,ev+=$*eG,eE+=$*eQ,e_+=$*eY,eS+=$*eX,eI+=$*eJ,eR+=$*eZ,eo+=($=O[5])*eU,ea+=$*eF,ec+=$*eV,eu+=$*ez,eh+=$*e$,ef+=$*eK,eg+=$*eq,ey+=$*ej,ew+=$*eW,ev+=$*eH,eE+=$*eG,e_+=$*eQ,eS+=$*eY,eI+=$*eX,eR+=$*eJ,ek+=$*eZ,ea+=($=O[6])*eU,ec+=$*eF,eu+=$*eV,eh+=$*ez,ef+=$*e$,eg+=$*eK,ey+=$*eq,ew+=$*ej,ev+=$*eW,eE+=$*eH,e_+=$*eG,eS+=$*eQ,eI+=$*eY,eR+=$*eX,ek+=$*eJ,eD+=$*eZ,ec+=($=O[7])*eU,eu+=$*eF,eh+=$*eV,ef+=$*ez,eg+=$*e$,ey+=$*eK,ew+=$*eq,ev+=$*ej,eE+=$*eW,e_+=$*eH,eS+=$*eG,eI+=$*eQ,eR+=$*eY,ek+=$*eX,eD+=$*eJ,eA+=$*eZ,eu+=($=O[8])*eU,eh+=$*eF,ef+=$*eV,eg+=$*ez,ey+=$*e$,ew+=$*eK,ev+=$*eq,eE+=$*ej,e_+=$*eW,eS+=$*eH,eI+=$*eG,eR+=$*eQ,ek+=$*eY,eD+=$*eX,eA+=$*eJ,eT+=$*eZ,eh+=($=O[9])*eU,ef+=$*eF,eg+=$*eV,ey+=$*ez,ew+=$*e$,ev+=$*eK,eE+=$*eq,e_+=$*ej,eS+=$*eW,eI+=$*eH,eR+=$*eG,ek+=$*eQ,eD+=$*eY,eA+=$*eX,eT+=$*eJ,eC+=$*eZ,ef+=($=O[10])*eU,eg+=$*eF,ey+=$*eV,ew+=$*ez,ev+=$*e$,eE+=$*eK,e_+=$*eq,eS+=$*ej,eI+=$*eW,eR+=$*eH,ek+=$*eG,eD+=$*eQ,eA+=$*eY,eT+=$*eX,eC+=$*eJ,eP+=$*eZ,eg+=($=O[11])*eU,ey+=$*eF,ew+=$*eV,ev+=$*ez,eE+=$*e$,e_+=$*eK,eS+=$*eq,eI+=$*ej,eR+=$*eW,ek+=$*eH,eD+=$*eG,eA+=$*eQ,eT+=$*eY,eC+=$*eX,eP+=$*eJ,eN+=$*eZ,ey+=($=O[12])*eU,ew+=$*eF,ev+=$*eV,eE+=$*ez,e_+=$*e$,eS+=$*eK,eI+=$*eq,eR+=$*ej,ek+=$*eW,eD+=$*eH,eA+=$*eG,eT+=$*eQ,eC+=$*eY,eP+=$*eX,eN+=$*eJ,eB+=$*eZ,ew+=($=O[13])*eU,ev+=$*eF,eE+=$*eV,e_+=$*ez,eS+=$*e$,eI+=$*eK,eR+=$*eq,ek+=$*ej,eD+=$*eW,eA+=$*eH,eT+=$*eG,eC+=$*eQ,eP+=$*eY,eN+=$*eX,eB+=$*eJ,eL+=$*eZ,ev+=($=O[14])*eU,eE+=$*eF,e_+=$*eV,eS+=$*ez,eI+=$*e$,eR+=$*eK,ek+=$*eq,eD+=$*ej,eA+=$*eW,eT+=$*eH,eC+=$*eG,eP+=$*eQ,eN+=$*eY,eB+=$*eX,eL+=$*eJ,eO+=$*eZ,eE+=($=O[15])*eU,e_+=$*eF,eS+=$*eV,eI+=$*ez,eR+=$*e$,ek+=$*eK,eD+=$*eq,eA+=$*ej,eT+=$*eW,eC+=$*eH,eP+=$*eG,eN+=$*eQ,eB+=$*eY,eL+=$*eX,eO+=$*eJ,eM+=$*eZ,X+=38*e_,J+=38*eS,Z+=38*eI,en+=38*eR,es+=38*ek,eo+=38*eD,ea+=38*eA,ec+=38*eT,eu+=38*eC,eh+=38*eP,ef+=38*eN,eg+=38*eB,ey+=38*eL,ew+=38*eO,ev+=38*eM,Y=Math.floor(($=X+(Y=1)+65535)/65536),X=$-65536*Y,Y=Math.floor(($=J+Y+65535)/65536),J=$-65536*Y,Y=Math.floor(($=Z+Y+65535)/65536),Z=$-65536*Y,Y=Math.floor(($=en+Y+65535)/65536),en=$-65536*Y,Y=Math.floor(($=es+Y+65535)/65536),es=$-65536*Y,Y=Math.floor(($=eo+Y+65535)/65536),eo=$-65536*Y,Y=Math.floor(($=ea+Y+65535)/65536),ea=$-65536*Y,Y=Math.floor(($=ec+Y+65535)/65536),ec=$-65536*Y,Y=Math.floor(($=eu+Y+65535)/65536),eu=$-65536*Y,Y=Math.floor(($=eh+Y+65535)/65536),eh=$-65536*Y,Y=Math.floor(($=ef+Y+65535)/65536),ef=$-65536*Y,Y=Math.floor(($=eg+Y+65535)/65536),eg=$-65536*Y,Y=Math.floor(($=ey+Y+65535)/65536),ey=$-65536*Y,Y=Math.floor(($=ew+Y+65535)/65536),ew=$-65536*Y,Y=Math.floor(($=ev+Y+65535)/65536),ev=$-65536*Y,Y=Math.floor(($=eE+Y+65535)/65536),eE=$-65536*Y,X+=Y-1+37*(Y-1),Y=Math.floor(($=X+(Y=1)+65535)/65536),X=$-65536*Y,Y=Math.floor(($=J+Y+65535)/65536),J=$-65536*Y,Y=Math.floor(($=Z+Y+65535)/65536),Z=$-65536*Y,Y=Math.floor(($=en+Y+65535)/65536),en=$-65536*Y,Y=Math.floor(($=es+Y+65535)/65536),es=$-65536*Y,Y=Math.floor(($=eo+Y+65535)/65536),eo=$-65536*Y,Y=Math.floor(($=ea+Y+65535)/65536),ea=$-65536*Y,Y=Math.floor(($=ec+Y+65535)/65536),ec=$-65536*Y,Y=Math.floor(($=eu+Y+65535)/65536),eu=$-65536*Y,Y=Math.floor(($=eh+Y+65535)/65536),eh=$-65536*Y,Y=Math.floor(($=ef+Y+65535)/65536),ef=$-65536*Y,Y=Math.floor(($=eg+Y+65535)/65536),eg=$-65536*Y,Y=Math.floor(($=ey+Y+65535)/65536),ey=$-65536*Y,Y=Math.floor(($=ew+Y+65535)/65536),ew=$-65536*Y,Y=Math.floor(($=ev+Y+65535)/65536),ev=$-65536*Y,Y=Math.floor(($=eE+Y+65535)/65536),eE=$-65536*Y,X+=Y-1+37*(Y-1),N[0]=X,N[1]=J,N[2]=Z,N[3]=en,N[4]=es,N[5]=eo,N[6]=ea,N[7]=ec,N[8]=eu,N[9]=eh,N[10]=ef,N[11]=eg,N[12]=ey,N[13]=ew,N[14]=ev,N[15]=eE}function eg(N,O){ef(N,O,O)}function ey(N,O){let U=J();for(let N=0;N<16;N++)U[N]=O[N];for(let N=253;N>=0;N--)eg(U,U),2!==N&&4!==N&&ef(U,U,O);for(let O=0;O<16;O++)N[O]=U[O]}function ew(N,O){let U=new Uint8Array(32),$=new Float64Array(80),Y=J(),X=J(),Z=J(),es=J(),ew=J(),ev=J();for(let O=0;O<31;O++)U[O]=N[O];U[31]=127&N[31]|64,U[0]&=248,ec($,O);for(let N=0;N<16;N++)X[N]=$[N];Y[0]=es[0]=1;for(let N=254;N>=0;--N){let O=U[N>>>3]>>>(7&N)&1;eo(Y,X,O),eo(Z,es,O),eu(ew,Y,Z),eh(Y,Y,Z),eu(Z,X,es),eh(X,X,es),eg(es,ew),eg(ev,Y),ef(Y,Z,Y),ef(Z,X,ew),eu(ew,Y,Z),eh(Y,Y,Z),eg(X,Y),eh(Z,es,ev),ef(Y,Z,en),eu(Y,Y,es),ef(Z,Z,Y),ef(Y,es,ev),ef(es,X,$),eg(X,ew),eo(Y,X,O),eo(Z,es,O)}for(let N=0;N<16;N++)$[N+16]=Y[N],$[N+32]=Z[N],$[N+48]=X[N],$[N+64]=es[N];let eE=$.subarray(32),e_=$.subarray(16);ey(eE,eE),ef(e_,e_,eE);let eS=new Uint8Array(32);return ea(eS,e_),eS}function ev(N){return ew(N,Z)}function eE(N){if(N.length!==O.KS)throw Error(`x25519: seed must be ${O.KS} bytes`);let U=new Uint8Array(N),$=ev(U);return{publicKey:$,secretKey:U}}function e_(N){let O=(0,Y.randomBytes)(32,N),U=eE(O);return(0,X.wipe)(O),U}function eS(N,U,$=!1){if(N.length!==O.kz)throw Error("X25519: incorrect secret key length");if(U.length!==O.kz)throw Error("X25519: incorrect public key length");let Y=ew(N,U);if($){let N=0;for(let O=0;O<Y.length;O++)N|=Y[O];if(0===N)throw Error("X25519: invalid shared key")}return Y}$=ew,$=ev,O._w=eE,O.Au=e_,O.gi=eS},3573:function(N,O){"use strict";let U=Math.exp;O=N.exports=function(N){let O,$;if("number"!=typeof N)throw Error("must provide a timespan to the moving average constructor");if(N<=0)throw Error("must provide a timespan > 0 to the moving average constructor");let Y=0,X=0,J=0,Z={};function en(O,$){return 1-U(-(O-$)/N)}return Z.push=function(N,U){if($){let Z=en(N,$),es=U-O,eo=Z*es;O=Z*U+(1-Z)*O,X=Math.sqrt(Y=(1-Z)*(Y+es*eo)),J=O+Z*es}else O=U;$=N},Z.movingAverage=function(){return O},Z.variance=function(){return Y},Z.deviation=function(){return X},Z.forecast=function(){return J},Z}},1227:function(N,O,U){var $=U(3454);function Y(){return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function X(O){if(O[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+O[0]+(this.useColors?"%c ":" ")+"+"+N.exports.humanize(this.diff),!this.useColors)return;let U="color: "+this.color;O.splice(1,0,U,"color: inherit");let $=0,Y=0;O[0].replace(/%[a-zA-Z%]/g,N=>{"%%"!==N&&($++,"%c"===N&&(Y=$))}),O.splice(Y,0,U)}function J(N){try{N?O.storage.setItem("debug",N):O.storage.removeItem("debug")}catch(N){}}function Z(){let N;try{N=O.storage.getItem("debug")}catch(N){}return!N&&void 0!==$&&"env"in $&&(N=$.env.DEBUG),N}function en(){try{return localStorage}catch(N){}}O.formatArgs=X,O.save=J,O.load=Z,O.useColors=Y,O.storage=en(),O.destroy=(()=>{let N=!1;return()=>{N||(N=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),O.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],O.log=console.debug||console.log||(()=>{}),N.exports=U(2447)(O);let{formatters:es}=N.exports;es.j=function(N){try{return JSON.stringify(N)}catch(N){return"[UnexpectedJSONParseError]: "+N.message}}},2447:function(N,O,U){function $(N){function O(N){let O=0;for(let U=0;U<N.length;U++)O=(O<<5)-O+N.charCodeAt(U)|0;return $.colors[Math.abs(O)%$.colors.length]}function $(N){let O,U,X;let J=null;function Z(...N){if(!Z.enabled)return;let U=Z,Y=Number(new Date),X=Y-(O||Y);U.diff=X,U.prev=O,U.curr=Y,O=Y,N[0]=$.coerce(N[0]),"string"!=typeof N[0]&&N.unshift("%O");let J=0;N[0]=N[0].replace(/%([a-zA-Z%])/g,(O,Y)=>{if("%%"===O)return"%";J++;let X=$.formatters[Y];if("function"==typeof X){let $=N[J];O=X.call(U,$),N.splice(J,1),J--}return O}),$.formatArgs.call(U,N);let en=U.log||$.log;en.apply(U,N)}return Z.namespace=N,Z.useColors=$.useColors(),Z.color=$.selectColor(N),Z.extend=Y,Z.destroy=$.destroy,Object.defineProperty(Z,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==J?J:(U!==$.namespaces&&(U=$.namespaces,X=$.enabled(N)),X),set:N=>{J=N}}),"function"==typeof $.init&&$.init(Z),Z}function Y(N,O){let U=$(this.namespace+(void 0===O?":":O)+N);return U.log=this.log,U}function X(N){let O;$.save(N),$.namespaces=N,$.names=[],$.skips=[];let U=("string"==typeof N?N:"").split(/[\s,]+/),Y=U.length;for(O=0;O<Y;O++)U[O]&&("-"===(N=U[O].replace(/\*/g,".*?"))[0]?$.skips.push(RegExp("^"+N.slice(1)+"$")):$.names.push(RegExp("^"+N+"$")))}function J(){let N=[...$.names.map(en),...$.skips.map(en).map(N=>"-"+N)].join(",");return $.enable(""),N}function Z(N){let O,U;if("*"===N[N.length-1])return!0;for(O=0,U=$.skips.length;O<U;O++)if($.skips[O].test(N))return!1;for(O=0,U=$.names.length;O<U;O++)if($.names[O].test(N))return!0;return!1}function en(N){return N.toString().substring(2,N.toString().length-2).replace(/\.\*\?$/,"*")}function es(N){return N instanceof Error?N.stack||N.message:N}function eo(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return $.debug=$,$.default=$,$.coerce=es,$.disable=J,$.enable=X,$.enabled=Z,$.humanize=U(7824),$.destroy=eo,Object.keys(N).forEach(O=>{$[O]=N[O]}),$.names=[],$.skips=[],$.formatters={},$.selectColor=O,$.enable($.load()),$}N.exports=$},5001:function(N){"use strict";function O(N,O){var O=O||{};this._head=0,this._tail=0,this._capacity=O.capacity,this._capacityMask=3,this._list=[,,,,],Array.isArray(N)&&this._fromArray(N)}O.prototype.peekAt=function(N){var O=N;if(O===(0|O)){var U=this.size();if(!(O>=U)&&!(O<-U))return O<0&&(O+=U),O=this._head+O&this._capacityMask,this._list[O]}},O.prototype.get=function(N){return this.peekAt(N)},O.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},O.prototype.peekFront=function(){return this.peek()},O.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(O.prototype,"length",{get:function(){return this.size()}}),O.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},O.prototype.unshift=function(N){if(void 0===N)return this.size();var O=this._list.length;return(this._head=this._head-1+O&this._capacityMask,this._list[this._head]=N,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail)?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},O.prototype.shift=function(){var N=this._head;if(N!==this._tail){var O=this._list[N];return this._list[N]=void 0,this._head=N+1&this._capacityMask,N<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),O}},O.prototype.push=function(N){if(void 0===N)return this.size();var O=this._tail;return(this._list[O]=N,this._tail=O+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail)?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},O.prototype.pop=function(){var N=this._tail;if(N!==this._head){var O=this._list.length;this._tail=N-1+O&this._capacityMask;var U=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&N>1e4&&N<=O>>>2&&this._shrinkArray(),U}},O.prototype.removeOne=function(N){var O,U=N;if(U===(0|U)&&this._head!==this._tail){var $=this.size(),Y=this._list.length;if(!(U>=$)&&!(U<-$)){U<0&&(U+=$),U=this._head+U&this._capacityMask;var X=this._list[U];if(N<$/2){for(O=N;O>0;O--)this._list[U]=this._list[U=U-1+Y&this._capacityMask];this._list[U]=void 0,this._head=this._head+1+Y&this._capacityMask}else{for(O=$-1-N;O>0;O--)this._list[U]=this._list[U=U+1+Y&this._capacityMask];this._list[U]=void 0,this._tail=this._tail-1+Y&this._capacityMask}return X}}},O.prototype.remove=function(N,O){var U,$,Y=N,X=O;if(Y===(0|Y)&&this._head!==this._tail){var J=this.size(),Z=this._list.length;if(!(Y>=J)&&!(Y<-J)&&!(O<1)){if(Y<0&&(Y+=J),1===O||!O)return(U=[,])[0]=this.removeOne(Y),U;if(0===Y&&Y+O>=J)return U=this.toArray(),this.clear(),U;for(Y+O>J&&(O=J-Y),U=Array(O),$=0;$<O;$++)U[$]=this._list[this._head+Y+$&this._capacityMask];if(Y=this._head+Y&this._capacityMask,N+O===J){for(this._tail=this._tail-O+Z&this._capacityMask,$=O;$>0;$--)this._list[Y=Y+1+Z&this._capacityMask]=void 0;return U}if(0===N){for(this._head=this._head+O+Z&this._capacityMask,$=O-1;$>0;$--)this._list[Y=Y+1+Z&this._capacityMask]=void 0;return U}if(Y<J/2){for(this._head=this._head+N+O+Z&this._capacityMask,$=N;$>0;$--)this.unshift(this._list[Y=Y-1+Z&this._capacityMask]);for(Y=this._head-1+Z&this._capacityMask;X>0;)this._list[Y=Y-1+Z&this._capacityMask]=void 0,X--;N<0&&(this._tail=Y)}else{for(this._tail=Y,Y=Y+O+Z&this._capacityMask,$=J-(O+N);$>0;$--)this.push(this._list[Y++]);for(Y=this._tail;X>0;)this._list[Y=Y+1+Z&this._capacityMask]=void 0,X--}return this._head<2&&this._tail>1e4&&this._tail<=Z>>>2&&this._shrinkArray(),U}}},O.prototype.splice=function(N,O){var U=N;if(U===(0|U)){var $=this.size();if(U<0&&(U+=$),!(U>$)){if(!(arguments.length>2))return this.remove(U,O);var Y,X,J,Z=arguments.length,en=this._list.length,es=2;if(!$||U<$/2){for(Y=0,X=Array(U);Y<U;Y++)X[Y]=this._list[this._head+Y&this._capacityMask];for(0===O?(J=[],U>0&&(this._head=this._head+U+en&this._capacityMask)):(J=this.remove(U,O),this._head=this._head+U+en&this._capacityMask);Z>es;)this.unshift(arguments[--Z]);for(Y=U;Y>0;Y--)this.unshift(X[Y-1])}else{var eo=(X=Array($-(U+O))).length;for(Y=0;Y<eo;Y++)X[Y]=this._list[this._head+U+O+Y&this._capacityMask];for(0===O?(J=[],U!=$&&(this._tail=this._head+U+en&this._capacityMask)):(J=this.remove(U,O),this._tail=this._tail-eo+en&this._capacityMask);es<Z;)this.push(arguments[es++]);for(Y=0;Y<eo;Y++)this.push(X[Y])}return J}}},O.prototype.clear=function(){this._head=0,this._tail=0},O.prototype.isEmpty=function(){return this._head===this._tail},O.prototype.toArray=function(){return this._copyArray(!1)},O.prototype._fromArray=function(N){for(var O=0;O<N.length;O++)this.push(N[O])},O.prototype._copyArray=function(N){var O,U=[],$=this._list,Y=$.length;if(N||this._head>this._tail){for(O=this._head;O<Y;O++)U.push($[O]);for(O=0;O<this._tail;O++)U.push($[O])}else for(O=this._head;O<this._tail;O++)U.push($[O]);return U},O.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1},O.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},N.exports=O},2114:function(N){"use strict";function O(N,O){for(let U in O)Object.defineProperty(N,U,{value:O[U],enumerable:!0,configurable:!0});return N}function U(N,U,$){if(!N||"string"==typeof N)throw TypeError("Please pass an Error to err-code");$||($={}),"object"==typeof U&&($=U,U=""),U&&($.code=U);try{return O(N,$)}catch(X){$.message=N.message,$.stack=N.stack;let U=function(){};U.prototype=Object.create(Object.getPrototypeOf(N));let Y=O(new U,$);return Y}}N.exports=U},507:function(N,O,U){"use strict";var $;$={value:!0};let Y=U(8231);O.zN=Y.EventIterator,$=function(N,O,U){return new Y.EventIterator(({push:U})=>(this.addEventListener(N,U,O),()=>this.removeEventListener(N,U,O)),U)},Y.EventIterator},8231:function(N,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0});class U{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(N){if(this.isStopped)return;let O={value:N,done:!1};if(this.pullQueue.length){let N=this.pullQueue.shift();N&&N.resolve(O)}else this.pushQueue.push(Promise.resolve(O)),void 0!==this.highWaterMark&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){for(let N of(this.isStopped=!0,this.remove(),this.pullQueue))N.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(N){if(!this.isStopped){if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(let O of this.pullQueue)O.reject(N);this.pullQueue.length=0}else{let O=Promise.reject(N);O.catch(()=>{}),this.pushQueue.push(O)}}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:N=>{let O=this.pushQueue.shift();return O?(void 0!==this.lowWaterMark&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),O):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((N,O)=>{this.pullQueue.push({resolve:N,reject:O})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class ${constructor(N,{highWaterMark:O=100,lowWaterMark:$=1}={}){let Y=new U;Y.highWaterMark=O,Y.lowWaterMark=$,Y.removeCallback=N({push:N=>Y.push(N),stop:()=>Y.stop(),fail:N=>Y.fail(N),on:(N,O)=>{Y.eventHandlers[N]=O}})||(()=>{}),this[Symbol.asyncIterator]=()=>Y[Symbol.asyncIterator](),Object.freeze(this)}}O.EventIterator=$,O.default=$},6729:function(N){"use strict";var O=Object.prototype.hasOwnProperty,U="~";function $(){}function Y(N,O,U){this.fn=N,this.context=O,this.once=U||!1}function X(N,O,$,X,J){if("function"!=typeof $)throw TypeError("The listener must be a function");var Z=new Y($,X||N,J),en=U?U+O:O;return N._events[en]?N._events[en].fn?N._events[en]=[N._events[en],Z]:N._events[en].push(Z):(N._events[en]=Z,N._eventsCount++),N}function J(N,O){0==--N._eventsCount?N._events=new $:delete N._events[O]}function Z(){this._events=new $,this._eventsCount=0}Object.create&&($.prototype=Object.create(null),new $().__proto__||(U=!1)),Z.prototype.eventNames=function(){var N,$,Y=[];if(0===this._eventsCount)return Y;for($ in N=this._events)O.call(N,$)&&Y.push(U?$.slice(1):$);return Object.getOwnPropertySymbols?Y.concat(Object.getOwnPropertySymbols(N)):Y},Z.prototype.listeners=function(N){var O=U?U+N:N,$=this._events[O];if(!$)return[];if($.fn)return[$.fn];for(var Y=0,X=$.length,J=Array(X);Y<X;Y++)J[Y]=$[Y].fn;return J},Z.prototype.listenerCount=function(N){var O=U?U+N:N,$=this._events[O];return $?$.fn?1:$.length:0},Z.prototype.emit=function(N,O,$,Y,X,J){var Z=U?U+N:N;if(!this._events[Z])return!1;var en,es,eo=this._events[Z],ea=arguments.length;if(eo.fn){switch(eo.once&&this.removeListener(N,eo.fn,void 0,!0),ea){case 1:return eo.fn.call(eo.context),!0;case 2:return eo.fn.call(eo.context,O),!0;case 3:return eo.fn.call(eo.context,O,$),!0;case 4:return eo.fn.call(eo.context,O,$,Y),!0;case 5:return eo.fn.call(eo.context,O,$,Y,X),!0;case 6:return eo.fn.call(eo.context,O,$,Y,X,J),!0}for(es=1,en=Array(ea-1);es<ea;es++)en[es-1]=arguments[es];eo.fn.apply(eo.context,en)}else{var ec,eu=eo.length;for(es=0;es<eu;es++)switch(eo[es].once&&this.removeListener(N,eo[es].fn,void 0,!0),ea){case 1:eo[es].fn.call(eo[es].context);break;case 2:eo[es].fn.call(eo[es].context,O);break;case 3:eo[es].fn.call(eo[es].context,O,$);break;case 4:eo[es].fn.call(eo[es].context,O,$,Y);break;default:if(!en)for(ec=1,en=Array(ea-1);ec<ea;ec++)en[ec-1]=arguments[ec];eo[es].fn.apply(eo[es].context,en)}}return!0},Z.prototype.on=function(N,O,U){return X(this,N,O,U,!1)},Z.prototype.once=function(N,O,U){return X(this,N,O,U,!0)},Z.prototype.removeListener=function(N,O,$,Y){var X=U?U+N:N;if(!this._events[X])return this;if(!O)return J(this,X),this;var Z=this._events[X];if(Z.fn)Z.fn!==O||Y&&!Z.once||$&&Z.context!==$||J(this,X);else{for(var en=0,es=[],eo=Z.length;en<eo;en++)(Z[en].fn!==O||Y&&!Z[en].once||$&&Z[en].context!==$)&&es.push(Z[en]);es.length?this._events[X]=1===es.length?es[0]:es:J(this,X)}return this},Z.prototype.removeAllListeners=function(N){var O;return N?(O=U?U+N:N,this._events[O]&&J(this,O)):(this._events=new $,this._eventsCount=0),this},Z.prototype.off=Z.prototype.removeListener,Z.prototype.addListener=Z.prototype.on,Z.prefixed=U,Z.EventEmitter=Z,N.exports=Z},7187:function(N){"use strict";var O,U="object"==typeof Reflect?Reflect:null,$=U&&"function"==typeof U.apply?U.apply:function(N,O,U){return Function.prototype.apply.call(N,O,U)};function Y(N){console&&console.warn&&console.warn(N)}O=U&&"function"==typeof U.ownKeys?U.ownKeys:Object.getOwnPropertySymbols?function(N){return Object.getOwnPropertyNames(N).concat(Object.getOwnPropertySymbols(N))}:function(N){return Object.getOwnPropertyNames(N)};var X=Number.isNaN||function(N){return N!=N};function J(){J.init.call(this)}N.exports=J,N.exports.once=ew,J.EventEmitter=J,J.prototype._events=void 0,J.prototype._eventsCount=0,J.prototype._maxListeners=void 0;var Z=10;function en(N){if("function"!=typeof N)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof N)}function es(N){return void 0===N._maxListeners?J.defaultMaxListeners:N._maxListeners}function eo(N,O,U,$){if(en(U),void 0===(J=N._events)?(J=N._events=Object.create(null),N._eventsCount=0):(void 0!==J.newListener&&(N.emit("newListener",O,U.listener?U.listener:U),J=N._events),Z=J[O]),void 0===Z)Z=J[O]=U,++N._eventsCount;else if("function"==typeof Z?Z=J[O]=$?[U,Z]:[Z,U]:$?Z.unshift(U):Z.push(U),(X=es(N))>0&&Z.length>X&&!Z.warned){Z.warned=!0;var X,J,Z,eo=Error("Possible EventEmitter memory leak detected. "+Z.length+" "+String(O)+" listeners added. Use emitter.setMaxListeners() to increase limit");eo.name="MaxListenersExceededWarning",eo.emitter=N,eo.type=O,eo.count=Z.length,Y(eo)}return N}function ea(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ec(N,O,U){var $={fired:!1,wrapFn:void 0,target:N,type:O,listener:U},Y=ea.bind($);return Y.listener=U,$.wrapFn=Y,Y}function eu(N,O,U){var $=N._events;if(void 0===$)return[];var Y=$[O];return void 0===Y?[]:"function"==typeof Y?U?[Y.listener||Y]:[Y]:U?ey(Y):ef(Y,Y.length)}function eh(N){var O=this._events;if(void 0!==O){var U=O[N];if("function"==typeof U)return 1;if(void 0!==U)return U.length}return 0}function ef(N,O){for(var U=Array(O),$=0;$<O;++$)U[$]=N[$];return U}function eg(N,O){for(;O+1<N.length;O++)N[O]=N[O+1];N.pop()}function ey(N){for(var O=Array(N.length),U=0;U<O.length;++U)O[U]=N[U].listener||N[U];return O}function ew(N,O){return new Promise(function(U,$){function Y(U){N.removeListener(O,X),$(U)}function X(){"function"==typeof N.removeListener&&N.removeListener("error",Y),U([].slice.call(arguments))}eE(N,O,X,{once:!0}),"error"!==O&&ev(N,Y,{once:!0})})}function ev(N,O,U){"function"==typeof N.on&&eE(N,"error",O,U)}function eE(N,O,U,$){if("function"==typeof N.on)$.once?N.once(O,U):N.on(O,U);else if("function"==typeof N.addEventListener)N.addEventListener(O,function Y(X){$.once&&N.removeEventListener(O,Y),U(X)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof N)}Object.defineProperty(J,"defaultMaxListeners",{enumerable:!0,get:function(){return Z},set:function(N){if("number"!=typeof N||N<0||X(N))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+N+".");Z=N}}),J.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},J.prototype.setMaxListeners=function(N){if("number"!=typeof N||N<0||X(N))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+N+".");return this._maxListeners=N,this},J.prototype.getMaxListeners=function(){return es(this)},J.prototype.emit=function(N){for(var O=[],U=1;U<arguments.length;U++)O.push(arguments[U]);var Y="error"===N,X=this._events;if(void 0!==X)Y=Y&&void 0===X.error;else if(!Y)return!1;if(Y){if(O.length>0&&(J=O[0]),J instanceof Error)throw J;var J,Z=Error("Unhandled error."+(J?" ("+J.message+")":""));throw Z.context=J,Z}var en=X[N];if(void 0===en)return!1;if("function"==typeof en)$(en,this,O);else for(var es=en.length,eo=ef(en,es),U=0;U<es;++U)$(eo[U],this,O);return!0},J.prototype.addListener=function(N,O){return eo(this,N,O,!1)},J.prototype.on=J.prototype.addListener,J.prototype.prependListener=function(N,O){return eo(this,N,O,!0)},J.prototype.once=function(N,O){return en(O),this.on(N,ec(this,N,O)),this},J.prototype.prependOnceListener=function(N,O){return en(O),this.prependListener(N,ec(this,N,O)),this},J.prototype.removeListener=function(N,O){var U,$,Y,X,J;if(en(O),void 0===($=this._events)||void 0===(U=$[N]))return this;if(U===O||U.listener===O)0==--this._eventsCount?this._events=Object.create(null):(delete $[N],$.removeListener&&this.emit("removeListener",N,U.listener||O));else if("function"!=typeof U){for(Y=-1,X=U.length-1;X>=0;X--)if(U[X]===O||U[X].listener===O){J=U[X].listener,Y=X;break}if(Y<0)return this;0===Y?U.shift():eg(U,Y),1===U.length&&($[N]=U[0]),void 0!==$.removeListener&&this.emit("removeListener",N,J||O)}return this},J.prototype.off=J.prototype.removeListener,J.prototype.removeAllListeners=function(N){var O,U,$;if(void 0===(U=this._events))return this;if(void 0===U.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==U[N]&&(0==--this._eventsCount?this._events=Object.create(null):delete U[N]),this;if(0==arguments.length){var Y,X=Object.keys(U);for($=0;$<X.length;++$)"removeListener"!==(Y=X[$])&&this.removeAllListeners(Y);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(O=U[N]))this.removeListener(N,O);else if(void 0!==O)for($=O.length-1;$>=0;$--)this.removeListener(N,O[$]);return this},J.prototype.listeners=function(N){return eu(this,N,!0)},J.prototype.rawListeners=function(N){return eu(this,N,!1)},J.listenerCount=function(N,O){return"function"==typeof N.listenerCount?N.listenerCount(O):eh.call(N,O)},J.prototype.listenerCount=eh,J.prototype.eventNames=function(){return this._eventsCount>0?O(this._events):[]}},248:function(N){N.exports=function(N){if(!N)throw Error("hashlru must have a max value, of type number, greater than 0");var O=0,U=Object.create(null),$=Object.create(null);function Y(Y,X){U[Y]=X,++O>=N&&(O=0,$=U,U=Object.create(null))}return{has:function(N){return void 0!==U[N]||void 0!==$[N]},remove:function(N){void 0!==U[N]&&(U[N]=void 0),void 0!==$[N]&&($[N]=void 0)},get:function(N){var O=U[N];return void 0!==O?O:void 0!==(O=$[N])?(Y(N,O),O):void 0},set:function(N,O){void 0!==U[N]?U[N]=O:Y(N,O)},clear:function(){U=Object.create(null),$=Object.create(null)}}}},6512:function(N){!function(O){"use strict";let U="(0?\\d+|0x[a-f0-9]+)",$={fourOctet:RegExp(`^${U}\\.${U}\\.${U}\\.${U}$`,"i"),threeOctet:RegExp(`^${U}\\.${U}\\.${U}$`,"i"),twoOctet:RegExp(`^${U}\\.${U}$`,"i"),longValue:RegExp(`^${U}$`,"i")},Y=RegExp("^0[0-7]+$","i"),X=RegExp("^0x[a-f0-9]+$","i"),J="%[0-9a-z]{1,}",Z="(?:[0-9a-f]+::?)+",en={zoneIndex:RegExp(J,"i"),native:RegExp(`^(::)?(${Z})?([0-9a-f]+)?(::)?(${J})?$`,"i"),deprecatedTransitional:RegExp(`^(?:::)(${U}\\.${U}\\.${U}\\.${U}(${J})?)$`,"i"),transitional:RegExp(`^((?:${Z})|(?:::)(?:${Z})?)${U}\\.${U}\\.${U}\\.${U}(${J})?$`,"i")};function es(N,O){let U,$;if(N.indexOf("::")!==N.lastIndexOf("::"))return null;let Y=0,X=-1,J=(N.match(en.zoneIndex)||[])[0];for(J&&(J=J.substring(1),N=N.replace(/%.+$/,""));(X=N.indexOf(":",X+1))>=0;)Y++;if("::"===N.substr(0,2)&&Y--,"::"===N.substr(-2,2)&&Y--,Y>O)return null;for($=O-Y,U=":";$--;)U+="0:";return":"===(N=N.replace("::",U))[0]&&(N=N.slice(1)),":"===N[N.length-1]&&(N=N.slice(0,-1)),{parts:O=function(){let O=N.split(":"),U=[];for(let N=0;N<O.length;N++)U.push(parseInt(O[N],16));return U}(),zoneId:J}}function eo(N,O,U,$){let Y;if(N.length!==O.length)throw Error("ipaddr: cannot match CIDR for objects with different lengths");let X=0;for(;$>0;){if((Y=U-$)<0&&(Y=0),N[X]>>Y!=O[X]>>Y)return!1;$-=U,X+=1}return!0}function ea(N){if(X.test(N))return parseInt(N,16);if("0"===N[0]&&!isNaN(parseInt(N[1],10))){if(Y.test(N))return parseInt(N,8);throw Error(`ipaddr: cannot parse ${N} as octal`)}return parseInt(N,10)}function ec(N,O){for(;N.length<O;)N=`0${N}`;return N}let eu={};eu.IPv4=function(){function N(N){let O,U;if(4!==N.length)throw Error("ipaddr: ipv4 octet count should be 4");for(O=0;O<N.length;O++)if(!(0<=(U=N[O])&&U<=255))throw Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=N}return N.prototype.SpecialRanges={unspecified:[[new N([0,0,0,0]),8]],broadcast:[[new N([255,255,255,255]),32]],multicast:[[new N([224,0,0,0]),4]],linkLocal:[[new N([169,254,0,0]),16]],loopback:[[new N([127,0,0,0]),8]],carrierGradeNat:[[new N([100,64,0,0]),10]],private:[[new N([10,0,0,0]),8],[new N([172,16,0,0]),12],[new N([192,168,0,0]),16]],reserved:[[new N([192,0,0,0]),24],[new N([192,0,2,0]),24],[new N([192,88,99,0]),24],[new N([198,18,0,0]),15],[new N([198,51,100,0]),24],[new N([203,0,113,0]),24],[new N([240,0,0,0]),4]]},N.prototype.kind=function(){return"ipv4"},N.prototype.match=function(N,O){let U;if(void 0===O&&(N=(U=N)[0],O=U[1]),"ipv4"!==N.kind())throw Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return eo(this.octets,N.octets,8,O)},N.prototype.prefixLengthFromSubnetMask=function(){let N,O,U,$=0,Y=!1,X={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};for(N=3;N>=0;N-=1){if(!((O=this.octets[N])in X)||(U=X[O],Y&&0!==U))return null;8!==U&&(Y=!0),$+=U}return 32-$},N.prototype.range=function(){return eu.subnetMatch(this,this.SpecialRanges)},N.prototype.toByteArray=function(){return this.octets.slice(0)},N.prototype.toIPv4MappedAddress=function(){return eu.IPv6.parse(`::ffff:${this.toString()}`)},N.prototype.toNormalizedString=function(){return this.toString()},N.prototype.toString=function(){return this.octets.join(".")},N}(),eu.IPv4.broadcastAddressFromCIDR=function(N){try{let O=this.parseCIDR(N),U=O[0].toByteArray(),$=this.subnetMaskFromPrefixLength(O[1]).toByteArray(),Y=[],X=0;for(;X<4;)Y.push(parseInt(U[X],10)|255^parseInt($[X],10)),X++;return new this(Y)}catch(N){throw Error("ipaddr: the address does not have IPv4 CIDR format")}},eu.IPv4.isIPv4=function(N){return null!==this.parser(N)},eu.IPv4.isValid=function(N){try{return new this(this.parser(N)),!0}catch(N){return!1}},eu.IPv4.isValidFourPartDecimal=function(N){return!!(eu.IPv4.isValid(N)&&N.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},eu.IPv4.networkAddressFromCIDR=function(N){let O,U,$,Y,X;try{for($=(O=this.parseCIDR(N))[0].toByteArray(),X=this.subnetMaskFromPrefixLength(O[1]).toByteArray(),Y=[],U=0;U<4;)Y.push(parseInt($[U],10)&parseInt(X[U],10)),U++;return new this(Y)}catch(N){throw Error("ipaddr: the address does not have IPv4 CIDR format")}},eu.IPv4.parse=function(N){let O=this.parser(N);if(null===O)throw Error("ipaddr: string is not formatted like an IPv4 Address");return new this(O)},eu.IPv4.parseCIDR=function(N){let O;if(O=N.match(/^(.+)\/(\d+)$/)){let N=parseInt(O[2]);if(N>=0&&N<=32){let U=[this.parse(O[1]),N];return Object.defineProperty(U,"toString",{value:function(){return this.join("/")}}),U}}throw Error("ipaddr: string is not formatted like an IPv4 CIDR range")},eu.IPv4.parser=function(N){let O,U;if(O=N.match($.fourOctet))return function(){let N=O.slice(1,6),U=[];for(let O=0;O<N.length;O++)U.push(ea(N[O]));return U}();if(O=N.match($.longValue)){if((U=ea(O[1]))>4294967295||U<0)throw Error("ipaddr: address outside defined range");return(function(){let N;let O=[];for(N=0;N<=24;N+=8)O.push(U>>N&255);return O})().reverse()}return(O=N.match($.twoOctet))?function(){let N=O.slice(1,4),$=[];if((U=ea(N[1]))>16777215||U<0)throw Error("ipaddr: address outside defined range");return $.push(ea(N[0])),$.push(U>>16&255),$.push(U>>8&255),$.push(255&U),$}():(O=N.match($.threeOctet))?function(){let N=O.slice(1,5),$=[];if((U=ea(N[2]))>65535||U<0)throw Error("ipaddr: address outside defined range");return $.push(ea(N[0])),$.push(ea(N[1])),$.push(U>>8&255),$.push(255&U),$}():null},eu.IPv4.subnetMaskFromPrefixLength=function(N){if((N=parseInt(N))<0||N>32)throw Error("ipaddr: invalid IPv4 prefix length");let O=[0,0,0,0],U=0,$=Math.floor(N/8);for(;U<$;)O[U]=255,U++;return $<4&&(O[$]=Math.pow(2,N%8)-1<<8-N%8),new this(O)},eu.IPv6=function(){function N(N,O){let U,$;if(16===N.length)for(U=0,this.parts=[];U<=14;U+=2)this.parts.push(N[U]<<8|N[U+1]);else if(8===N.length)this.parts=N;else throw Error("ipaddr: ipv6 part count should be 8 or 16");for(U=0;U<this.parts.length;U++)if(!(0<=($=this.parts[U])&&$<=65535))throw Error("ipaddr: ipv6 part should fit in 16 bits");O&&(this.zoneId=O)}return N.prototype.SpecialRanges={unspecified:[new N([0,0,0,0,0,0,0,0]),128],linkLocal:[new N([65152,0,0,0,0,0,0,0]),10],multicast:[new N([65280,0,0,0,0,0,0,0]),8],loopback:[new N([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new N([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new N([0,0,0,0,0,65535,0,0]),96],rfc6145:[new N([0,0,0,0,65535,0,0,0]),96],rfc6052:[new N([100,65435,0,0,0,0,0,0]),96],"6to4":[new N([8194,0,0,0,0,0,0,0]),16],teredo:[new N([8193,0,0,0,0,0,0,0]),32],reserved:[[new N([8193,3512,0,0,0,0,0,0]),32]],benchmarking:[new N([8193,2,0,0,0,0,0,0]),48],amt:[new N([8193,3,0,0,0,0,0,0]),32],as112v6:[new N([8193,4,274,0,0,0,0,0]),48],deprecated:[new N([8193,16,0,0,0,0,0,0]),28],orchid2:[new N([8193,32,0,0,0,0,0,0]),28]},N.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},N.prototype.kind=function(){return"ipv6"},N.prototype.match=function(N,O){let U;if(void 0===O&&(N=(U=N)[0],O=U[1]),"ipv6"!==N.kind())throw Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return eo(this.parts,N.parts,16,O)},N.prototype.prefixLengthFromSubnetMask=function(){let N,O,U=0,$=!1,Y={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};for(let X=7;X>=0;X-=1){if(!((N=this.parts[X])in Y)||(O=Y[N],$&&0!==O))return null;16!==O&&($=!0),U+=O}return 128-U},N.prototype.range=function(){return eu.subnetMatch(this,this.SpecialRanges)},N.prototype.toByteArray=function(){let N;let O=[],U=this.parts;for(let $=0;$<U.length;$++)O.push((N=U[$])>>8),O.push(255&N);return O},N.prototype.toFixedLengthString=function(){let N=(function(){let N=[];for(let O=0;O<this.parts.length;O++)N.push(ec(this.parts[O].toString(16),4));return N}).call(this).join(":"),O="";return this.zoneId&&(O=`%${this.zoneId}`),N+O},N.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw Error("ipaddr: trying to convert a generic ipv6 address to ipv4");let N=this.parts.slice(-2),O=N[0],U=N[1];return new eu.IPv4([O>>8,255&O,U>>8,255&U])},N.prototype.toNormalizedString=function(){let N=(function(){let N=[];for(let O=0;O<this.parts.length;O++)N.push(this.parts[O].toString(16));return N}).call(this).join(":"),O="";return this.zoneId&&(O=`%${this.zoneId}`),N+O},N.prototype.toRFC5952String=function(){let N;let O=/((^|:)(0(:|$)){2,})/g,U=this.toNormalizedString(),$=0,Y=-1;for(;N=O.exec(U);)N[0].length>Y&&($=N.index,Y=N[0].length);return Y<0?U:`${U.substring(0,$)}::${U.substring($+Y)}`},N.prototype.toString=function(){return this.toRFC5952String()},N}(),eu.IPv6.broadcastAddressFromCIDR=function(N){try{let O=this.parseCIDR(N),U=O[0].toByteArray(),$=this.subnetMaskFromPrefixLength(O[1]).toByteArray(),Y=[],X=0;for(;X<16;)Y.push(parseInt(U[X],10)|255^parseInt($[X],10)),X++;return new this(Y)}catch(N){throw Error(`ipaddr: the address does not have IPv6 CIDR format (${N})`)}},eu.IPv6.isIPv6=function(N){return null!==this.parser(N)},eu.IPv6.isValid=function(N){if("string"==typeof N&&-1===N.indexOf(":"))return!1;try{let O=this.parser(N);return new this(O.parts,O.zoneId),!0}catch(N){return!1}},eu.IPv6.networkAddressFromCIDR=function(N){let O,U,$,Y,X;try{for($=(O=this.parseCIDR(N))[0].toByteArray(),X=this.subnetMaskFromPrefixLength(O[1]).toByteArray(),Y=[],U=0;U<16;)Y.push(parseInt($[U],10)&parseInt(X[U],10)),U++;return new this(Y)}catch(N){throw Error(`ipaddr: the address does not have IPv6 CIDR format (${N})`)}},eu.IPv6.parse=function(N){let O=this.parser(N);if(null===O.parts)throw Error("ipaddr: string is not formatted like an IPv6 Address");return new this(O.parts,O.zoneId)},eu.IPv6.parseCIDR=function(N){let O,U,$;if((U=N.match(/^(.+)\/(\d+)$/))&&(O=parseInt(U[2]))>=0&&O<=128)return Object.defineProperty($=[this.parse(U[1]),O],"toString",{value:function(){return this.join("/")}}),$;throw Error("ipaddr: string is not formatted like an IPv6 CIDR range")},eu.IPv6.parser=function(N){let O,U,$,Y,X,J;if($=N.match(en.deprecatedTransitional))return this.parser(`::ffff:${$[1]}`);if(en.native.test(N))return es(N,8);if(($=N.match(en.transitional))&&(J=$[6]||"",(O=es($[1].slice(0,-1)+J,6)).parts)){for(U=0,X=[parseInt($[2]),parseInt($[3]),parseInt($[4]),parseInt($[5])];U<X.length;U++)if(!(0<=(Y=X[U])&&Y<=255))return null;return O.parts.push(X[0]<<8|X[1]),O.parts.push(X[2]<<8|X[3]),{parts:O.parts,zoneId:O.zoneId}}return null},eu.IPv6.subnetMaskFromPrefixLength=function(N){if((N=parseInt(N))<0||N>128)throw Error("ipaddr: invalid IPv6 prefix length");let O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],U=0,$=Math.floor(N/8);for(;U<$;)O[U]=255,U++;return $<16&&(O[$]=Math.pow(2,N%8)-1<<8-N%8),new this(O)},eu.fromByteArray=function(N){let O=N.length;if(4===O)return new eu.IPv4(N);if(16===O)return new eu.IPv6(N);throw Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},eu.isValid=function(N){return eu.IPv6.isValid(N)||eu.IPv4.isValid(N)},eu.parse=function(N){if(eu.IPv6.isValid(N))return eu.IPv6.parse(N);if(eu.IPv4.isValid(N))return eu.IPv4.parse(N);throw Error("ipaddr: the address has neither IPv6 nor IPv4 format")},eu.parseCIDR=function(N){try{return eu.IPv6.parseCIDR(N)}catch(O){try{return eu.IPv4.parseCIDR(N)}catch(N){throw Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},eu.process=function(N){let O=this.parse(N);return"ipv6"===O.kind()&&O.isIPv4MappedAddress()?O.toIPv4Address():O},eu.subnetMatch=function(N,O,U){let $,Y,X,J;for(Y in null==U&&(U="unicast"),O)if(Object.prototype.hasOwnProperty.call(O,Y)){for(!(X=O[Y])[0]||X[0]instanceof Array||(X=[X]),$=0;$<X.length;$++)if(J=X[$],N.kind()===J[0].kind()&&N.match.apply(N,J))return Y}return U},N.exports?N.exports=eu:O.ipaddr=eu}(this)},9134:function(N,O,U){var $=U(3454);function Y(){return!!("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||void 0!==$&&"object"==typeof $.versions&&$.versions.electron||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0)}N.exports=Y},3310:function(N){"use strict";N.exports=N=>{if("[object Object]"!==Object.prototype.toString.call(N))return!1;let O=Object.getPrototypeOf(N);return null===O||O===Object.prototype}},7745:function(N,O,U){"use strict";let{URLWithLegacySupport:$,format:Y,URLSearchParams:X,defaultBase:J}=U(2049),Z=U(5939);N.exports={URL:$,URLSearchParams:X,format:Y,relative:Z,defaultBase:J}},5939:function(N,O,U){"use strict";let{URLWithLegacySupport:$,format:Y}=U(2049);N.exports=(N,O={},U={},X)=>{let J,Z=O.protocol?O.protocol.replace(":",""):"http";Z=(U[Z]||X||Z)+":";try{J=new $(N)}catch(N){J={}}let en=Object.assign({},O,{protocol:Z||J.protocol,host:O.host||J.host});return new $(N,Y(en)).toString()}},2049:function(N){"use strict";let O="undefined"!=typeof navigator&&"ReactNative"===navigator.product;function U(){return O?"http://localhost":self.location?self.location.protocol+"//"+self.location.host:""}let $=self.URL,Y=U();class X{constructor(N="",O=Y){this.super=new $(N,O),this.path=this.pathname+this.search,this.auth=this.username&&this.password?this.username+":"+this.password:null,this.query=this.search&&this.search.startsWith("?")?this.search.slice(1):null}get hash(){return this.super.hash}get host(){return this.super.host}get hostname(){return this.super.hostname}get href(){return this.super.href}get origin(){return this.super.origin}get password(){return this.super.password}get pathname(){return this.super.pathname}get port(){return this.super.port}get protocol(){return this.super.protocol}get search(){return this.super.search}get searchParams(){return this.super.searchParams}get username(){return this.super.username}set hash(N){this.super.hash=N}set host(N){this.super.host=N}set hostname(N){this.super.hostname=N}set href(N){this.super.href=N}set password(N){this.super.password=N}set pathname(N){this.super.pathname=N}set port(N){this.super.port=N}set protocol(N){this.super.protocol=N}set search(N){this.super.search=N}set username(N){this.super.username=N}static createObjectURL(N){return $.createObjectURL(N)}static revokeObjectURL(N){$.revokeObjectURL(N)}toJSON(){return this.super.toJSON()}toString(){return this.super.toString()}format(){return this.toString()}}function J(N){if("string"==typeof N){let O=new $(N);return O.toString()}if(!(N instanceof $)){let O=N.username&&N.password?`${N.username}:${N.password}@`:"",U=N.auth?N.auth+"@":"",$=N.port?":"+N.port:"",Y=N.protocol?N.protocol+"//":"",X=N.host||"",J=N.hostname||"",Z=N.search||(N.query?"?"+N.query:""),en=N.hash||"",es=N.pathname||"",eo=N.path||es+Z;return`${Y}${O||U}${X||J+$}${eo}${en}`}}N.exports={URLWithLegacySupport:X,URLSearchParams:self.URLSearchParams,defaultBase:Y,format:J}},4094:function(N,O,U){N.exports=U(9065),N.exports.parse=U(9065),N.exports.stringify=U(1876)},9065:function(N){N.exports=N=>(async function*(){let O=/\r?\n/,U=new TextDecoder("utf8"),$="";for await(let Y of N){"string"==typeof Y&&(Y=new TextEncoder().encode(Y)),$+=U.decode(Y,{stream:!0});let N=$.split(O);$=N.pop();for(let O=0;O<N.length;O++)yield JSON.parse(N[O])}($+=U.decode())&&(yield JSON.parse($))})()},1876:function(N){N.exports=N=>(async function*(){for await(let O of N)yield JSON.stringify(O)+"\n"})()},942:function(N,O,U){"use strict";let $=U(3310),{hasOwnProperty:Y}=Object.prototype,{propertyIsEnumerable:X}=Object,J=(N,O,U)=>Object.defineProperty(N,O,{value:U,writable:!0,enumerable:!0,configurable:!0}),Z=this,en={concatArrays:!1,ignoreUndefined:!1},es=N=>{let O=[];for(let U in N)Y.call(N,U)&&O.push(U);if(Object.getOwnPropertySymbols){let U=Object.getOwnPropertySymbols(N);for(let $ of U)X.call(N,$)&&O.push($)}return O};function eo(N){return Array.isArray(N)?ea(N):$(N)?ec(N):N}function ea(N){let O=N.slice(0,0);return es(N).forEach(U=>{J(O,U,eo(N[U]))}),O}function ec(N){let O=null===Object.getPrototypeOf(N)?Object.create(null):{};return es(N).forEach(U=>{J(O,U,eo(N[U]))}),O}let eu=(N,O,U,$)=>(U.forEach(U=>{void 0===O[U]&&$.ignoreUndefined||(U in N&&N[U]!==Object.getPrototypeOf(N)?J(N,U,ef(N[U],O[U],$)):J(N,U,eo(O[U])))}),N),eh=(N,O,U)=>{let $=N.slice(0,0),X=0;return[N,O].forEach(O=>{let Z=[];for(let U=0;U<O.length;U++)Y.call(O,U)&&(Z.push(String(U)),O===N?J($,X++,O[U]):J($,X++,eo(O[U])));$=eu($,O,es(O).filter(N=>!Z.includes(N)),U)}),$};function ef(N,O,U){return U.concatArrays&&Array.isArray(N)&&Array.isArray(O)?eh(N,O,U):$(O)&&$(N)?eu(N,O,es(O),U):eo(O)}N.exports=function(...N){let O=ef(eo(en),this!==Z&&this||{},en),U={_:{}};for(let Y of N)if(void 0!==Y){if(!$(Y))throw TypeError("`"+Y+"` is not an Option Object");U=ef(U,{_:Y},O)}return U._}},7824:function(N){var O=1e3,U=6e4,$=36e5,Y=864e5,X=6048e5,J=315576e5;function Z(N){if(!((N=String(N)).length>100)){var Z=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(N);if(Z){var en=parseFloat(Z[1]);switch((Z[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return en*J;case"weeks":case"week":case"w":return en*X;case"days":case"day":case"d":return en*Y;case"hours":case"hour":case"hrs":case"hr":case"h":return en*$;case"minutes":case"minute":case"mins":case"min":case"m":return en*U;case"seconds":case"second":case"secs":case"sec":case"s":return en*O;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return en;default:return}}}}function en(N){var X=Math.abs(N);return X>=Y?Math.round(N/Y)+"d":X>=$?Math.round(N/$)+"h":X>=U?Math.round(N/U)+"m":X>=O?Math.round(N/O)+"s":N+"ms"}function es(N){var X=Math.abs(N);return X>=Y?eo(N,X,Y,"day"):X>=$?eo(N,X,$,"hour"):X>=U?eo(N,X,U,"minute"):X>=O?eo(N,X,O,"second"):N+" ms"}function eo(N,O,U,$){var Y=O>=1.5*U;return Math.round(N/U)+" "+$+(Y?"s":"")}N.exports=function(N,O){O=O||{};var U=typeof N;if("string"===U&&N.length>0)return Z(N);if("number"===U&&isFinite(N))return O.long?es(N):en(N);throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(N))}},556:function(N,O,U){"use strict";let{encodeText:$}=U(2413);class Y{constructor(N,O,U,Y){this.name=N,this.code=O,this.codeBuf=$(this.code),this.alphabet=Y,this.codec=U(Y)}encode(N){return this.codec.encode(N)}decode(N){for(let O of N)if(this.alphabet&&0>this.alphabet.indexOf(O))throw Error(`invalid character '${O}' in '${N}'`);return this.codec.decode(N)}}N.exports=Y},5077:function(N,O,U){"use strict";let $=U(8820),Y=U(556),{rfc4648:X}=U(6727),{decodeText:J,encodeText:Z}=U(2413),en=()=>({encode:J,decode:Z}),es=[["identity","\x00",en,""],["base2","0",X(1),"01"],["base8","7",X(3),"01234567"],["base10","9",$,"0123456789"],["base16","f",X(4),"0123456789abcdef"],["base16upper","F",X(4),"0123456789ABCDEF"],["base32hex","v",X(5),"0123456789abcdefghijklmnopqrstuv"],["base32hexupper","V",X(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV"],["base32hexpad","t",X(5),"0123456789abcdefghijklmnopqrstuv="],["base32hexpadupper","T",X(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV="],["base32","b",X(5),"abcdefghijklmnopqrstuvwxyz234567"],["base32upper","B",X(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"],["base32pad","c",X(5),"abcdefghijklmnopqrstuvwxyz234567="],["base32padupper","C",X(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567="],["base32z","h",X(5),"ybndrfg8ejkmcpqxot1uwisza345h769"],["base36","k",$,"0123456789abcdefghijklmnopqrstuvwxyz"],["base36upper","K",$,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"],["base58btc","z",$,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"],["base58flickr","Z",$,"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"],["base64","m",X(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"],["base64pad","M",X(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="],["base64url","u",X(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"],["base64urlpad","U",X(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_="]],eo=es.reduce((N,O)=>(N[O[0]]=new Y(O[0],O[1],O[2],O[3]),N),{}),ea=es.reduce((N,O)=>(N[O[1]]=eo[O[0]],N),{});N.exports={names:eo,codes:ea}},6957:function(N,O,U){"use strict";let $=U(5077),{encodeText:Y,decodeText:X,concat:J}=U(2413);function Z(N,O){if(!O)throw Error("requires an encoded Uint8Array");let{name:U,codeBuf:$}=ec(N);return ea(U,O),J([$,O],$.length+O.length)}function en(N,O){let U=ec(N),$=Y(U.encode(O));return J([U.codeBuf,$],U.codeBuf.length+$.length)}function es(N){N instanceof Uint8Array&&(N=X(N));let O=N[0];["f","F","v","V","t","T","b","B","c","C","h","k","K"].includes(O)&&(N=N.toLowerCase());let U=ec(N[0]);return U.decode(N.substring(1))}function eo(N){if(N instanceof Uint8Array&&(N=X(N)),"[object String]"!==Object.prototype.toString.call(N))return!1;try{let O=ec(N[0]);return O.name}catch(N){return!1}}function ea(N,O){let U=ec(N);U.decode(X(O))}function ec(N){if(Object.prototype.hasOwnProperty.call($.names,N))return $.names[N];if(Object.prototype.hasOwnProperty.call($.codes,N))return $.codes[N];throw Error(`Unsupported encoding: ${N}`)}function eu(N){return N instanceof Uint8Array&&(N=X(N)),ec(N[0])}(O=N.exports=Z).encode=en,O.decode=es,O.isEncoded=eo,O.encoding=ec,O.encodingFromData=eu;let eh=Object.freeze($.names),ef=Object.freeze($.codes);O.names=eh,O.codes=ef},6727:function(N){"use strict";let O=(N,O,U)=>{let $={};for(let N=0;N<O.length;++N)$[O[N]]=N;let Y=N.length;for(;"="===N[Y-1];)--Y;let X=new Uint8Array(Y*U/8|0),J=0,Z=0,en=0;for(let O=0;O<Y;++O){let Y=$[N[O]];if(void 0===Y)throw SyntaxError("Invalid character "+N[O]);Z=Z<<U|Y,(J+=U)>=8&&(J-=8,X[en++]=255&Z>>J)}if(J>=U||255&Z<<8-J)throw SyntaxError("Unexpected end of data");return X},U=(N,O,U)=>{let $="="===O[O.length-1],Y=(1<<U)-1,X="",J=0,Z=0;for(let $=0;$<N.length;++$)for(Z=Z<<8|N[$],J+=8;J>U;)J-=U,X+=O[Y&Z>>J];if(J&&(X+=O[Y&Z<<U-J]),$)for(;X.length*U&7;)X+="=";return X},$=N=>$=>({encode:O=>U(O,$,N),decode:U=>O(U,$,N)});N.exports={rfc4648:$}},2413:function(N){"use strict";let O=new TextDecoder,U=N=>O.decode(N),$=new TextEncoder,Y=N=>$.encode(N);function X(N,O){let U=new Uint8Array(O),$=0;for(let O of N)U.set(O,$),$+=O.length;return U}N.exports={decodeText:U,encodeText:Y,concat:X}},2623:function(N){N.exports=$;var O=128,U=127;function $(N,Y){var X,J=0,Y=Y||0,Z=0,en=Y,es=N.length;do{if(en>=es)throw $.bytes=0,RangeError("Could not decode varint");X=N[en++],J+=Z<28?(X&U)<<Z:(X&U)*Math.pow(2,Z),Z+=7}while(X>=O);return $.bytes=en-Y,J}},3657:function(N){N.exports=Y;var O=128,U=-128,$=2147483648;function Y(N,X,J){X=X||[];for(var Z=J=J||0;N>=$;)X[J++]=255&N|O,N/=128;for(;N&U;)X[J++]=255&N|O,N>>>=7;return X[J]=0|N,Y.bytes=J-Z+1,X}},8414:function(N,O,U){N.exports={encode:U(3657),decode:U(2623),encodingLength:U(8078)}},8078:function(N){var O=128,U=16384,$=2097152,Y=268435456,X=34359738368,J=4398046511104,Z=562949953421312,en=72057594037927940,es=0x7fffffffffffffff;N.exports=function(N){return N<O?1:N<U?2:N<$?3:N<Y?4:N<X?5:N<J?6:N<Z?7:N<en?8:N<es?9:10}},1291:function(N){"use strict";let O=Object.freeze({identity:0,sha1:17,"sha2-256":18,"sha2-512":19,"sha3-512":20,"sha3-384":21,"sha3-256":22,"sha3-224":23,"shake-128":24,"shake-256":25,"keccak-224":26,"keccak-256":27,"keccak-384":28,"keccak-512":29,blake3:30,"murmur3-128":34,"murmur3-32":35,"dbl-sha2-256":86,md4:212,md5:213,bmt:214,"sha2-256-trunc254-padded":4114,"ripemd-128":4178,"ripemd-160":4179,"ripemd-256":4180,"ripemd-320":4181,x11:4352,kangarootwelve:7425,"sm3-256":21325,"blake2b-8":45569,"blake2b-16":45570,"blake2b-24":45571,"blake2b-32":45572,"blake2b-40":45573,"blake2b-48":45574,"blake2b-56":45575,"blake2b-64":45576,"blake2b-72":45577,"blake2b-80":45578,"blake2b-88":45579,"blake2b-96":45580,"blake2b-104":45581,"blake2b-112":45582,"blake2b-120":45583,"blake2b-128":45584,"blake2b-136":45585,"blake2b-144":45586,"blake2b-152":45587,"blake2b-160":45588,"blake2b-168":45589,"blake2b-176":45590,"blake2b-184":45591,"blake2b-192":45592,"blake2b-200":45593,"blake2b-208":45594,"blake2b-216":45595,"blake2b-224":45596,"blake2b-232":45597,"blake2b-240":45598,"blake2b-248":45599,"blake2b-256":45600,"blake2b-264":45601,"blake2b-272":45602,"blake2b-280":45603,"blake2b-288":45604,"blake2b-296":45605,"blake2b-304":45606,"blake2b-312":45607,"blake2b-320":45608,"blake2b-328":45609,"blake2b-336":45610,"blake2b-344":45611,"blake2b-352":45612,"blake2b-360":45613,"blake2b-368":45614,"blake2b-376":45615,"blake2b-384":45616,"blake2b-392":45617,"blake2b-400":45618,"blake2b-408":45619,"blake2b-416":45620,"blake2b-424":45621,"blake2b-432":45622,"blake2b-440":45623,"blake2b-448":45624,"blake2b-456":45625,"blake2b-464":45626,"blake2b-472":45627,"blake2b-480":45628,"blake2b-488":45629,"blake2b-496":45630,"blake2b-504":45631,"blake2b-512":45632,"blake2s-8":45633,"blake2s-16":45634,"blake2s-24":45635,"blake2s-32":45636,"blake2s-40":45637,"blake2s-48":45638,"blake2s-56":45639,"blake2s-64":45640,"blake2s-72":45641,"blake2s-80":45642,"blake2s-88":45643,"blake2s-96":45644,"blake2s-104":45645,"blake2s-112":45646,"blake2s-120":45647,"blake2s-128":45648,"blake2s-136":45649,"blake2s-144":45650,"blake2s-152":45651,"blake2s-160":45652,"blake2s-168":45653,"blake2s-176":45654,"blake2s-184":45655,"blake2s-192":45656,"blake2s-200":45657,"blake2s-208":45658,"blake2s-216":45659,"blake2s-224":45660,"blake2s-232":45661,"blake2s-240":45662,"blake2s-248":45663,"blake2s-256":45664,"skein256-8":45825,"skein256-16":45826,"skein256-24":45827,"skein256-32":45828,"skein256-40":45829,"skein256-48":45830,"skein256-56":45831,"skein256-64":45832,"skein256-72":45833,"skein256-80":45834,"skein256-88":45835,"skein256-96":45836,"skein256-104":45837,"skein256-112":45838,"skein256-120":45839,"skein256-128":45840,"skein256-136":45841,"skein256-144":45842,"skein256-152":45843,"skein256-160":45844,"skein256-168":45845,"skein256-176":45846,"skein256-184":45847,"skein256-192":45848,"skein256-200":45849,"skein256-208":45850,"skein256-216":45851,"skein256-224":45852,"skein256-232":45853,"skein256-240":45854,"skein256-248":45855,"skein256-256":45856,"skein512-8":45857,"skein512-16":45858,"skein512-24":45859,"skein512-32":45860,"skein512-40":45861,"skein512-48":45862,"skein512-56":45863,"skein512-64":45864,"skein512-72":45865,"skein512-80":45866,"skein512-88":45867,"skein512-96":45868,"skein512-104":45869,"skein512-112":45870,"skein512-120":45871,"skein512-128":45872,"skein512-136":45873,"skein512-144":45874,"skein512-152":45875,"skein512-160":45876,"skein512-168":45877,"skein512-176":45878,"skein512-184":45879,"skein512-192":45880,"skein512-200":45881,"skein512-208":45882,"skein512-216":45883,"skein512-224":45884,"skein512-232":45885,"skein512-240":45886,"skein512-248":45887,"skein512-256":45888,"skein512-264":45889,"skein512-272":45890,"skein512-280":45891,"skein512-288":45892,"skein512-296":45893,"skein512-304":45894,"skein512-312":45895,"skein512-320":45896,"skein512-328":45897,"skein512-336":45898,"skein512-344":45899,"skein512-352":45900,"skein512-360":45901,"skein512-368":45902,"skein512-376":45903,"skein512-384":45904,"skein512-392":45905,"skein512-400":45906,"skein512-408":45907,"skein512-416":45908,"skein512-424":45909,"skein512-432":45910,"skein512-440":45911,"skein512-448":45912,"skein512-456":45913,"skein512-464":45914,"skein512-472":45915,"skein512-480":45916,"skein512-488":45917,"skein512-496":45918,"skein512-504":45919,"skein512-512":45920,"skein1024-8":45921,"skein1024-16":45922,"skein1024-24":45923,"skein1024-32":45924,"skein1024-40":45925,"skein1024-48":45926,"skein1024-56":45927,"skein1024-64":45928,"skein1024-72":45929,"skein1024-80":45930,"skein1024-88":45931,"skein1024-96":45932,"skein1024-104":45933,"skein1024-112":45934,"skein1024-120":45935,"skein1024-128":45936,"skein1024-136":45937,"skein1024-144":45938,"skein1024-152":45939,"skein1024-160":45940,"skein1024-168":45941,"skein1024-176":45942,"skein1024-184":45943,"skein1024-192":45944,"skein1024-200":45945,"skein1024-208":45946,"skein1024-216":45947,"skein1024-224":45948,"skein1024-232":45949,"skein1024-240":45950,"skein1024-248":45951,"skein1024-256":45952,"skein1024-264":45953,"skein1024-272":45954,"skein1024-280":45955,"skein1024-288":45956,"skein1024-296":45957,"skein1024-304":45958,"skein1024-312":45959,"skein1024-320":45960,"skein1024-328":45961,"skein1024-336":45962,"skein1024-344":45963,"skein1024-352":45964,"skein1024-360":45965,"skein1024-368":45966,"skein1024-376":45967,"skein1024-384":45968,"skein1024-392":45969,"skein1024-400":45970,"skein1024-408":45971,"skein1024-416":45972,"skein1024-424":45973,"skein1024-432":45974,"skein1024-440":45975,"skein1024-448":45976,"skein1024-456":45977,"skein1024-464":45978,"skein1024-472":45979,"skein1024-480":45980,"skein1024-488":45981,"skein1024-496":45982,"skein1024-504":45983,"skein1024-512":45984,"skein1024-520":45985,"skein1024-528":45986,"skein1024-536":45987,"skein1024-544":45988,"skein1024-552":45989,"skein1024-560":45990,"skein1024-568":45991,"skein1024-576":45992,"skein1024-584":45993,"skein1024-592":45994,"skein1024-600":45995,"skein1024-608":45996,"skein1024-616":45997,"skein1024-624":45998,"skein1024-632":45999,"skein1024-640":46e3,"skein1024-648":46001,"skein1024-656":46002,"skein1024-664":46003,"skein1024-672":46004,"skein1024-680":46005,"skein1024-688":46006,"skein1024-696":46007,"skein1024-704":46008,"skein1024-712":46009,"skein1024-720":46010,"skein1024-728":46011,"skein1024-736":46012,"skein1024-744":46013,"skein1024-752":46014,"skein1024-760":46015,"skein1024-768":46016,"skein1024-776":46017,"skein1024-784":46018,"skein1024-792":46019,"skein1024-800":46020,"skein1024-808":46021,"skein1024-816":46022,"skein1024-824":46023,"skein1024-832":46024,"skein1024-840":46025,"skein1024-848":46026,"skein1024-856":46027,"skein1024-864":46028,"skein1024-872":46029,"skein1024-880":46030,"skein1024-888":46031,"skein1024-896":46032,"skein1024-904":46033,"skein1024-912":46034,"skein1024-920":46035,"skein1024-928":46036,"skein1024-936":46037,"skein1024-944":46038,"skein1024-952":46039,"skein1024-960":46040,"skein1024-968":46041,"skein1024-976":46042,"skein1024-984":46043,"skein1024-992":46044,"skein1024-1000":46045,"skein1024-1008":46046,"skein1024-1016":46047,"skein1024-1024":46048,"poseidon-bls12_381-a2-fc1":46081,"poseidon-bls12_381-a2-fc1-sc":46082});N.exports={names:O}},8370:function(N,O,U){"use strict";let $=U(6957),Y=U(8414),{names:X}=U(1291),{toString:J}=U(864),{fromString:Z}=U(7105),{concat:en}=U(9114),es={};for(let N in X){let O=N;es[X[O]]=O}function eo(N){if(!(N instanceof Uint8Array))throw Error("must be passed a Uint8Array");return J(N,"base16")}function ea(N){return Z(N,"base16")}function ec(N){if(!(N instanceof Uint8Array))throw Error("must be passed a Uint8Array");return J($.encode("base58btc",N)).slice(1)}function eu(N){let O=N instanceof Uint8Array?J(N):N;return $.decode("z"+O)}function eh(N){if(!(N instanceof Uint8Array))throw Error("multihash must be a Uint8Array");if(N.length<2)throw Error("multihash too short. must be > 2 bytes.");let O=Y.decode(N);if(!ew(O))throw Error(`multihash unknown function code: 0x${O.toString(16)}`);N=N.slice(Y.decode.bytes);let U=Y.decode(N);if(U<0)throw Error(`multihash invalid length: ${U}`);if((N=N.slice(Y.decode.bytes)).length!==U)throw Error(`multihash length inconsistent: 0x${J(N,"base16")}`);return{code:O,name:es[O],length:U,digest:N}}function ef(N,O,U){if(!N||void 0===O)throw Error("multihash encode requires at least two args: digest, code");let $=eg(O);if(!(N instanceof Uint8Array))throw Error("digest should be a Uint8Array");if(null==U&&(U=N.length),U&&N.length!==U)throw Error("digest length should be equal to specified length.");let X=Y.encode($),J=Y.encode(U);return en([X,J,N],X.length+J.length+N.length)}function eg(N){let O=N;if("string"==typeof N){if(void 0===X[N])throw Error(`Unrecognized hash function named: ${N}`);O=X[N]}if("number"!=typeof O)throw Error(`Hash function code should be a number. Got: ${O}`);if(void 0===es[O]&&!ey(O))throw Error(`Unrecognized function code: ${O}`);return O}function ey(N){return N>0&&N<16}function ew(N){return!!ey(N)||!!es[N]}function ev(N){eh(N)}function eE(N){return ev(N),N.subarray(0,2)}Object.freeze(es),N.exports={names:X,codes:es,toHexString:eo,fromHexString:ea,toB58String:ec,fromB58String:eu,decode:eh,encode:ef,coerceCode:eg,isAppCode:ey,validate:ev,prefix:eE,isValidCode:ew}},8951:function(N,O){(function(){var N,U,$,Y,X,J,Z,en;en=function(N){return[(-16777216&N)>>>24,(16711680&N)>>>16,(65280&N)>>>8,255&N].join(".")},Z=function(N){var O,$,Y,X,J,Z;for(O=[],Y=X=0;X<=3&&0!==N.length;Y=++X){if(Y>0){if("."!==N[0])throw Error("Invalid IP");N=N.substring(1)}J=(Z=U(N))[0],$=Z[1],N=N.substring($),O.push(J)}if(0!==N.length)throw Error("Invalid IP");switch(O.length){case 1:if(O[0]>4294967295)throw Error("Invalid IP");return O[0]>>>0;case 2:if(O[0]>255||O[1]>16777215)throw Error("Invalid IP");return(O[0]<<24|O[1])>>>0;case 3:if(O[0]>255||O[1]>255||O[2]>65535)throw Error("Invalid IP");return(O[0]<<24|O[1]<<16|O[2])>>>0;case 4:if(O[0]>255||O[1]>255||O[2]>255||O[3]>255)throw Error("Invalid IP");return(O[0]<<24|O[1]<<16|O[2]<<8|O[3])>>>0;default:throw Error("Invalid IP")}},Y=($=function(N){return N.charCodeAt(0)})("0"),J=$("a"),X=$("A"),U=function(N){var O,U,Z,en,es;for(en=0,O=10,U="9",Z=0,N.length>1&&"0"===N[Z]&&("x"===N[Z+1]||"X"===N[Z+1]?(Z+=2,O=16):"0"<=N[Z+1]&&N[Z+1]<="9"&&(Z++,O=8,U="7")),es=Z;Z<N.length;){if("0"<=N[Z]&&N[Z]<=U)en=en*O+($(N[Z])-Y)>>>0;else if(16===O){if("a"<=N[Z]&&N[Z]<="f")en=en*O+(10+$(N[Z])-J)>>>0;else if("A"<=N[Z]&&N[Z]<="F")en=en*O+(10+$(N[Z])-X)>>>0;else break}else break;if(en>4294967295)throw Error("too large");Z++}if(Z===es)throw Error("empty octet");return[en,Z]},N=function(){function N(N,O){var U,$,Y;if("string"!=typeof N)throw Error("Missing `net' parameter");if(O||(N=(Y=N.split("/",2))[0],O=Y[1]),O||(O=32),"string"==typeof O&&O.indexOf(".")>-1){try{this.maskLong=Z(O)}catch(N){throw Error("Invalid mask: "+O)}for(U=$=32;$>=0;U=--$)if(this.maskLong===4294967295<<32-U>>>0){this.bitmask=U;break}}else if(O||0===O)this.bitmask=parseInt(O,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw Error("Invalid mask: empty");try{this.netLong=(Z(N)&this.maskLong)>>>0}catch(O){throw Error("Invalid net address: "+N)}if(!(this.bitmask<=32))throw Error("Invalid mask for ip4: "+O);this.size=Math.pow(2,32-this.bitmask),this.base=en(this.netLong),this.mask=en(this.maskLong),this.hostmask=en(~this.maskLong),this.first=this.bitmask<=30?en(this.netLong+1):this.base,this.last=this.bitmask<=30?en(this.netLong+this.size-2):en(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?en(this.netLong+this.size-1):void 0}return N.prototype.contains=function(O){return("string"==typeof O&&(O.indexOf("/")>0||4!==O.split(".").length)&&(O=new N(O)),O instanceof N)?this.contains(O.base)&&this.contains(O.broadcast||O.last):(Z(O)&this.maskLong)>>>0==(this.netLong&this.maskLong)>>>0},N.prototype.next=function(O){return null==O&&(O=1),new N(en(this.netLong+this.size*O),this.mask)},N.prototype.forEach=function(N){var O,U,$;for($=Z(this.first),U=Z(this.last),O=0;$<=U;)N(en($),$,O),O++,$++},N.prototype.toString=function(){return this.base+"/"+this.bitmask},N}(),O.ip2long=Z,O.long2ip=en,O.Netmask=N}).call(this)},3454:function(N,O,U){"use strict";var $,Y;N.exports=(null==($=U.g.process)?void 0:$.env)&&"object"==typeof(null==(Y=U.g.process)?void 0:Y.env)?U.g.process:U(7663)},3740:function(N,O,U){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),Object.defineProperty(O,"default",{enumerable:!0,get:function(){return eS}});let $=U(8754),Y=U(1757),X=Y._(U(7294)),J=$._(U(2636)),Z=U(7757),en=U(3735),es=U(3341);U(4210);let eo=$._(U(7746)),ea={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"https://noop/",loader:"imgix",dangerouslyAllowSVG:!1,unoptimized:!1};function ec(N){return void 0!==N.default}function eu(N){return void 0!==N.src}function eh(N){return"object"==typeof N&&(ec(N)||eu(N))}function ef(N,O,U){let{deviceSizes:$,allSizes:Y}=N;if(U){let N=/(^|\s)(1?\d?\d)vw/g,O=[];for(let $;$=N.exec(U);$)O.push(parseInt($[2]));if(O.length){let N=.01*Math.min(...O);return{widths:Y.filter(O=>O>=$[0]*N),kind:"w"}}return{widths:Y,kind:"w"}}if("number"!=typeof O)return{widths:$,kind:"w"};let X=[...new Set([O,2*O].map(N=>Y.find(O=>O>=N)||Y[Y.length-1]))];return{widths:X,kind:"x"}}function eg(N){let{config:O,src:U,unoptimized:$,width:Y,quality:X,sizes:J,loader:Z}=N;if($)return{src:U,srcSet:void 0,sizes:void 0};let{widths:en,kind:es}=ef(O,Y,J),eo=en.length-1;return{sizes:J||"w"!==es?J:"100vw",srcSet:en.map((N,$)=>Z({config:O,src:U,quality:X,width:N})+" "+("w"===es?N:$+1)+es).join(", "),src:Z({config:O,src:U,quality:X,width:en[eo]})}}function ey(N){return void 0===N?N:"number"==typeof N?Number.isFinite(N)?N:NaN:"string"==typeof N&&/^[0-9]+$/.test(N)?parseInt(N,10):NaN}function ew(N,O,U,$,Y,X,J){if(!N||N["data-loaded-src"]===O)return;N["data-loaded-src"]=O;let Z="decode"in N?N.decode():Promise.resolve();Z.catch(()=>{}).then(()=>{if(N.parentElement&&N.isConnected){if("blur"===U&&X(!0),null==$?void 0:$.current){let O=new Event("load");Object.defineProperty(O,"target",{writable:!1,value:N});let U=!1,Y=!1;$.current({...O,nativeEvent:O,currentTarget:N,target:N,isDefaultPrevented:()=>U,isPropagationStopped:()=>Y,persist:()=>{},preventDefault:()=>{U=!0,O.preventDefault()},stopPropagation:()=>{Y=!0,O.stopPropagation()}})}(null==Y?void 0:Y.current)&&Y.current(N)}})}function ev(N){let[O,U]=X.version.split("."),$=parseInt(O,10),Y=parseInt(U,10);return $>18||18===$&&Y>=3?{fetchPriority:N}:{fetchpriority:N}}let eE=(0,X.forwardRef)((N,O)=>{let{imgAttributes:U,heightInt:$,widthInt:Y,qualityInt:J,className:Z,imgStyle:en,blurStyle:es,isLazy:eo,fetchPriority:ea,fill:ec,placeholder:eu,loading:eh,srcString:ef,config:eg,unoptimized:ey,loader:eE,onLoadRef:e_,onLoadingCompleteRef:eS,setBlurComplete:eI,setShowAltText:eR,onLoad:ek,onError:eD,...eA}=N;return eh=eo?"lazy":eh,X.default.createElement("img",{...eA,...ev(ea),loading:eh,width:Y,height:$,decoding:"async","data-nimg":ec?"fill":"1",className:Z,style:{...en,...es},...U,ref:(0,X.useCallback)(N=>{O&&("function"==typeof O?O(N):"object"==typeof O&&(O.current=N)),N&&(eD&&(N.src=N.src),N.complete&&ew(N,ef,eu,e_,eS,eI,ey))},[ef,eu,e_,eS,eI,eD,ey,O]),onLoad:N=>{let O=N.currentTarget;ew(O,ef,eu,e_,eS,eI,ey)},onError:N=>{eR(!0),"blur"===eu&&eI(!0),eD&&eD(N)}})}),e_=(0,X.forwardRef)((N,O)=>{let U,$,{src:Y,sizes:eu,unoptimized:ef=!1,priority:ew=!1,loading:e_,className:eS,quality:eI,width:eR,height:ek,fill:eD,style:eA,onLoad:eT,onLoadingComplete:eC,placeholder:eP="empty",blurDataURL:eN,fetchPriority:eB,layout:eL,objectFit:eO,objectPosition:eM,lazyBoundary:eU,lazyRoot:eF,...eV}=N,ez=(0,X.useContext)(es.ImageConfigContext),e$=(0,X.useMemo)(()=>{let N=ea||ez||en.imageConfigDefault,O=[...N.deviceSizes,...N.imageSizes].sort((N,O)=>N-O),U=N.deviceSizes.sort((N,O)=>N-O);return{...N,allSizes:O,deviceSizes:U}},[ez]),eK=eV,eq=eK.loader||eo.default;delete eK.loader;let ej="__next_img_default"in eq;if(ej){if("custom"===e$.loader)throw Error('Image with src "'+Y+'" is missing "loader" prop.\nRead more: https://nextjs.org/docs/messages/next-image-missing-loader')}else{let N=eq;eq=O=>{let{config:U,...$}=O;return N($)}}if(eL){"fill"===eL&&(eD=!0);let N={intrinsic:{maxWidth:"100%",height:"auto"},responsive:{width:"100%",height:"auto"}},O={responsive:"100vw",fill:"100vw"},U=N[eL];U&&(eA={...eA,...U});let $=O[eL];$&&!eu&&(eu=$)}let eW="",eH=ey(eR),eG=ey(ek);if(eh(Y)){let N=ec(Y)?Y.default:Y;if(!N.src)throw Error("An object should only be passed to the image component src parameter if it comes from a static image import. It must include src. Received "+JSON.stringify(N));if(!N.height||!N.width)throw Error("An object should only be passed to the image component src parameter if it comes from a static image import. It must include height and width. Received "+JSON.stringify(N));if(U=N.blurWidth,$=N.blurHeight,eN=eN||N.blurDataURL,eW=N.src,!eD){if(eH||eG){if(eH&&!eG){let O=eH/N.width;eG=Math.round(N.height*O)}else if(!eH&&eG){let O=eG/N.height;eH=Math.round(N.width*O)}}else eH=N.width,eG=N.height}}let eQ=!ew&&("lazy"===e_||void 0===e_);(!(Y="string"==typeof Y?Y:eW)||Y.startsWith("data:")||Y.startsWith("blob:"))&&(ef=!0,eQ=!1),e$.unoptimized&&(ef=!0),ej&&Y.endsWith(".svg")&&!e$.dangerouslyAllowSVG&&(ef=!0),ew&&(eB="high");let[eY,eX]=(0,X.useState)(!1),[eJ,eZ]=(0,X.useState)(!1),e0=ey(eI),e3=Object.assign(eD?{position:"absolute",height:"100%",width:"100%",left:0,top:0,right:0,bottom:0,objectFit:eO,objectPosition:eM}:{},eJ?{}:{color:"transparent"},eA),e5="blur"===eP&&eN&&!eY?{backgroundSize:e3.objectFit||"cover",backgroundPosition:e3.objectPosition||"50% 50%",backgroundRepeat:"no-repeat",backgroundImage:'url("data:image/svg+xml;charset=utf-8,'+(0,Z.getImageBlurSvg)({widthInt:eH,heightInt:eG,blurWidth:U,blurHeight:$,blurDataURL:eN,objectFit:e3.objectFit})+'")'}:{},e6=eg({config:e$,src:Y,unoptimized:ef,width:eH,quality:e0,sizes:eu,loader:eq}),e7=Y,e9=(0,X.useRef)(eT);(0,X.useEffect)(()=>{e9.current=eT},[eT]);let te=(0,X.useRef)(eC);(0,X.useEffect)(()=>{te.current=eC},[eC]);let tt={isLazy:eQ,imgAttributes:e6,heightInt:eG,widthInt:eH,qualityInt:e0,className:eS,imgStyle:e3,blurStyle:e5,loading:e_,config:e$,fetchPriority:eB,fill:eD,unoptimized:ef,placeholder:eP,loader:eq,srcString:e7,onLoadRef:e9,onLoadingCompleteRef:te,setBlurComplete:eX,setShowAltText:eZ,...eK};return X.default.createElement(X.default.Fragment,null,X.default.createElement(eE,{...tt,ref:O}),ew?X.default.createElement(J.default,null,X.default.createElement("link",{key:"__nimg-"+e6.src+e6.srcSet+e6.sizes,rel:"preload",as:"image",href:e6.srcSet?void 0:e6.src,imageSrcSet:e6.srcSet,imageSizes:e6.sizes,crossOrigin:eK.crossOrigin,referrerPolicy:eK.referrerPolicy,...ev(eB)})):null)}),eS=e_;("function"==typeof O.default||"object"==typeof O.default&&null!==O.default)&&void 0===O.default.__esModule&&(Object.defineProperty(O.default,"__esModule",{value:!0}),Object.assign(O.default,O),N.exports=O.default)},7757:function(N,O){"use strict";function U(N){let{widthInt:O,heightInt:U,blurWidth:$,blurHeight:Y,blurDataURL:X,objectFit:J}=N,Z=$&&Y?"1":"20",en=$||O,es=Y||U,eo=X.startsWith("data:image/jpeg")?"%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'/%3E%3C/feComponentTransfer%3E%":"";if(en&&es)return"%3Csvg xmlns='http%3A//www.w3.org/2000/svg' viewBox='0 0 "+en+" "+es+"'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='"+Z+"'/%3E"+eo+"%3C/filter%3E%3Cimage preserveAspectRatio='none' filter='url(%23b)' x='0' y='0' height='100%25' width='100%25' href='"+X+"'/%3E%3C/svg%3E";let ea="contain"===J?"xMidYMid":"cover"===J?"xMidYMid slice":"none";return"%3Csvg xmlns='http%3A//www.w3.org/2000/svg'%3E%3Cimage style='filter:blur(20px)' preserveAspectRatio='"+ea+"' x='0' y='0' height='100%25' width='100%25' href='"+X+"'/%3E%3C/svg%3E"}Object.defineProperty(O,"__esModule",{value:!0}),Object.defineProperty(O,"getImageBlurSvg",{enumerable:!0,get:function(){return U}})},7746:function(N,O){"use strict";function U(N){let{config:O,src:U,width:$,quality:Y}=N;return O.path+"?url="+encodeURIComponent(U)+"&w="+$+"&q="+(Y||75)}Object.defineProperty(O,"__esModule",{value:!0}),Object.defineProperty(O,"default",{enumerable:!0,get:function(){return $}}),U.__next_img_default=!0;let $=U},7663:function(N){var O="/";!function(){var U={229:function(N){var O,U,$,Y=N.exports={};function X(){throw Error("setTimeout has not been defined")}function J(){throw Error("clearTimeout has not been defined")}function Z(N){if(O===setTimeout)return setTimeout(N,0);if((O===X||!O)&&setTimeout)return O=setTimeout,setTimeout(N,0);try{return O(N,0)}catch(U){try{return O.call(null,N,0)}catch(U){return O.call(this,N,0)}}}function en(N){if(U===clearTimeout)return clearTimeout(N);if((U===J||!U)&&clearTimeout)return U=clearTimeout,clearTimeout(N);try{return U(N)}catch(O){try{return U.call(null,N)}catch(O){return U.call(this,N)}}}!function(){try{O="function"==typeof setTimeout?setTimeout:X}catch(N){O=X}try{U="function"==typeof clearTimeout?clearTimeout:J}catch(N){U=J}}();var es=[],eo=!1,ea=-1;function ec(){eo&&$&&(eo=!1,$.length?es=$.concat(es):ea=-1,es.length&&eu())}function eu(){if(!eo){var N=Z(ec);eo=!0;for(var O=es.length;O;){for($=es,es=[];++ea<O;)$&&$[ea].run();ea=-1,O=es.length}$=null,eo=!1,en(N)}}function eh(N,O){this.fun=N,this.array=O}function ef(){}Y.nextTick=function(N){var O=Array(arguments.length-1);if(arguments.length>1)for(var U=1;U<arguments.length;U++)O[U-1]=arguments[U];es.push(new eh(N,O)),1!==es.length||eo||Z(eu)},eh.prototype.run=function(){this.fun.apply(null,this.array)},Y.title="browser",Y.browser=!0,Y.env={},Y.argv=[],Y.version="",Y.versions={},Y.on=ef,Y.addListener=ef,Y.once=ef,Y.off=ef,Y.removeListener=ef,Y.removeAllListeners=ef,Y.emit=ef,Y.prependListener=ef,Y.prependOnceListener=ef,Y.listeners=function(N){return[]},Y.binding=function(N){throw Error("process.binding is not supported")},Y.cwd=function(){return"/"},Y.chdir=function(N){throw Error("process.chdir is not supported")},Y.umask=function(){return 0}}},$={};function Y(N){var O=$[N];if(void 0!==O)return O.exports;var X=$[N]={exports:{}},J=!0;try{U[N](X,X.exports,Y),J=!1}finally{J&&delete $[N]}return X.exports}Y.ab=O+"/";var X=Y(229);N.exports=X}()},9008:function(N,O,U){N.exports=U(2636)},5675:function(N,O,U){N.exports=U(3740)},8925:function(N,O,U){var $,Y,X,J,Z,en=U(3832);function es(N,O){var U=function(){return new en.aes.Algorithm(N,O)};en.cipher.registerAlgorithm(N,U)}U(5649),U(1967),U(7116),N.exports=en.aes=en.aes||{},en.aes.startEncrypting=function(N,O,U,$){var Y=ef({key:N,output:U,decrypt:!1,mode:$});return Y.start(O),Y},en.aes.createEncryptionCipher=function(N,O){return ef({key:N,output:null,decrypt:!1,mode:O})},en.aes.startDecrypting=function(N,O,U,$){var Y=ef({key:N,output:U,decrypt:!0,mode:$});return Y.start(O),Y},en.aes.createDecryptionCipher=function(N,O){return ef({key:N,output:null,decrypt:!0,mode:O})},en.aes.Algorithm=function(N,O){eo||ec();var U=this;U.name=N,U.mode=new O({blockSize:16,cipher:{encrypt:function(N,O){return eh(U._w,N,O,!1)},decrypt:function(N,O){return eh(U._w,N,O,!0)}}}),U._init=!1},en.aes.Algorithm.prototype.initialize=function(N){if(!this._init){var O,U=N.key;if("string"==typeof U&&(16===U.length||24===U.length||32===U.length))U=en.util.createBuffer(U);else if(en.util.isArray(U)&&(16===U.length||24===U.length||32===U.length)){O=U,U=en.util.createBuffer();for(var $=0;$<O.length;++$)U.putByte(O[$])}if(!en.util.isArray(U)){O=U,U=[];var Y=O.length();if(16===Y||24===Y||32===Y){Y>>>=2;for(var $=0;$<Y;++$)U.push(O.getInt32())}}if(!en.util.isArray(U)||!(4===U.length||6===U.length||8===U.length))throw Error("Invalid key parameter.");var X=-1!==["CFB","OFB","CTR","GCM"].indexOf(this.mode.name);this._w=eu(U,N.decrypt&&!X),this._init=!0}},en.aes._expandKey=function(N,O){return eo||ec(),eu(N,O)},en.aes._updateBlock=eh,es("AES-ECB",en.cipher.modes.ecb),es("AES-CBC",en.cipher.modes.cbc),es("AES-CFB",en.cipher.modes.cfb),es("AES-OFB",en.cipher.modes.ofb),es("AES-CTR",en.cipher.modes.ctr),es("AES-GCM",en.cipher.modes.gcm);var eo=!1,ea=4;function ec(){eo=!0,X=[0,1,2,4,8,16,32,64,128,27,54];for(var N=Array(256),O=0;O<128;++O)N[O]=O<<1,N[O+128]=O+128<<1^283;$=Array(256),Y=Array(256),J=[,,,,],Z=[,,,,];for(var O=0;O<4;++O)J[O]=Array(256),Z[O]=Array(256);for(var U,en,es,ea,ec,eu,eh,ef=0,eg=0,O=0;O<256;++O){ea=(ea=eg^eg<<1^eg<<2^eg<<3^eg<<4)>>8^255&ea^99,$[ef]=ea,Y[ea]=ef,ec=N[ea],U=N[ef],en=N[U],es=N[en],eu=ec<<24^ea<<16^ea<<8^(ea^ec),eh=(U^en^es)<<24^(ef^es)<<16^(ef^en^es)<<8^(ef^U^es);for(var ey=0;ey<4;++ey)J[ey][ef]=eu,Z[ey][ea]=eh,eu=eu<<24|eu>>>8,eh=eh<<24|eh>>>8;0===ef?ef=eg=1:(ef=U^N[N[N[U^es]]],eg^=N[N[eg]])}}function eu(N,O){for(var U,Y=N.slice(0),J=1,en=Y.length,es=ea*(en+6+1),eo=en;eo<es;++eo)U=Y[eo-1],eo%en==0?(U=$[U>>>16&255]<<24^$[U>>>8&255]<<16^$[255&U]<<8^$[U>>>24]^X[J]<<24,J++):en>6&&eo%en==4&&(U=$[U>>>24]<<24^$[U>>>16&255]<<16^$[U>>>8&255]<<8^$[255&U]),Y[eo]=Y[eo-en]^U;if(O){var ec,eu=Z[0],eh=Z[1],ef=Z[2],eg=Z[3],ey=Y.slice(0);es=Y.length;for(var eo=0,ew=es-ea;eo<es;eo+=ea,ew-=ea)if(0===eo||eo===es-ea)ey[eo]=Y[ew],ey[eo+1]=Y[ew+3],ey[eo+2]=Y[ew+2],ey[eo+3]=Y[ew+1];else for(var ev=0;ev<ea;++ev)ec=Y[ew+ev],ey[eo+(3&-ev)]=eu[$[ec>>>24]]^eh[$[ec>>>16&255]]^ef[$[ec>>>8&255]]^eg[$[255&ec]];Y=ey}return Y}function eh(N,O,U,X){var en,es,eo,ea,ec,eu,eh,ef,eg,ey,ew,ev,eE=N.length/4-1;X?(en=Z[0],es=Z[1],eo=Z[2],ea=Z[3],ec=Y):(en=J[0],es=J[1],eo=J[2],ea=J[3],ec=$),eu=O[0]^N[0],eh=O[X?3:1]^N[1],ef=O[2]^N[2],eg=O[X?1:3]^N[3];for(var e_=3,eS=1;eS<eE;++eS)ey=en[eu>>>24]^es[eh>>>16&255]^eo[ef>>>8&255]^ea[255&eg]^N[++e_],ew=en[eh>>>24]^es[ef>>>16&255]^eo[eg>>>8&255]^ea[255&eu]^N[++e_],ev=en[ef>>>24]^es[eg>>>16&255]^eo[eu>>>8&255]^ea[255&eh]^N[++e_],eg=en[eg>>>24]^es[eu>>>16&255]^eo[eh>>>8&255]^ea[255&ef]^N[++e_],eu=ey,eh=ew,ef=ev;U[0]=ec[eu>>>24]<<24^ec[eh>>>16&255]<<16^ec[ef>>>8&255]<<8^ec[255&eg]^N[++e_],U[X?3:1]=ec[eh>>>24]<<24^ec[ef>>>16&255]<<16^ec[eg>>>8&255]<<8^ec[255&eu]^N[++e_],U[2]=ec[ef>>>24]<<24^ec[eg>>>16&255]<<16^ec[eu>>>8&255]<<8^ec[255&eh]^N[++e_],U[X?1:3]=ec[eg>>>24]<<24^ec[eu>>>16&255]<<16^ec[eh>>>8&255]<<8^ec[255&ef]^N[++e_]}function ef(N){var O,U="AES-"+((N=N||{}).mode||"CBC").toUpperCase(),$=(O=N.decrypt?en.cipher.createDecipher(U,N.key):en.cipher.createCipher(U,N.key)).start;return O.start=function(N,U){var Y=null;U instanceof en.util.ByteBuffer&&(Y=U,U={}),(U=U||{}).output=Y,U.iv=N,$.call(O,U)},O}},3068:function(N,O,U){var $=U(3832);U(7116),U(6270);var Y=N.exports=$.asn1=$.asn1||{};function X(N,O,U){if(U>O){var $=Error("Too few bytes to parse DER.");throw $.available=N.length(),$.remaining=O,$.requested=U,$}}Y.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},Y.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},Y.create=function(N,O,U,X,J){if($.util.isArray(X)){for(var Z=[],en=0;en<X.length;++en)void 0!==X[en]&&Z.push(X[en]);X=Z}var es={tagClass:N,type:O,constructed:U,composed:U||$.util.isArray(X),value:X};return J&&"bitStringContents"in J&&(es.bitStringContents=J.bitStringContents,es.original=Y.copy(es)),es},Y.copy=function(N,O){var U;if($.util.isArray(N)){U=[];for(var X=0;X<N.length;++X)U.push(Y.copy(N[X],O));return U}return"string"==typeof N?N:(U={tagClass:N.tagClass,type:N.type,constructed:N.constructed,composed:N.composed,value:Y.copy(N.value,O)},O&&!O.excludeBitStringContents&&(U.bitStringContents=N.bitStringContents),U)},Y.equals=function(N,O,U){if($.util.isArray(N)){if(!$.util.isArray(O)||N.length!==O.length)return!1;for(var X=0;X<N.length;++X)if(!Y.equals(N[X],O[X]))return!1;return!0}if(typeof N!=typeof O)return!1;if("string"==typeof N)return N===O;var J=N.tagClass===O.tagClass&&N.type===O.type&&N.constructed===O.constructed&&N.composed===O.composed&&Y.equals(N.value,O.value);return U&&U.includeBitStringContents&&(J=J&&N.bitStringContents===O.bitStringContents),J},Y.getBerValueLength=function(N){var O=N.getByte();if(128!==O)return 128&O?N.getInt((127&O)<<3):O};var J=function(N,O){var U,$=N.getByte();if(O--,128!==$){if(128&$){var Y=127&$;X(N,O,Y),U=N.getInt(Y<<3)}else U=$;if(U<0)throw Error("Negative length: "+U);return U}};function Z(N,O,U,$){X(N,O,2);var en,es,eo,ea=N.getByte();O--;var ec=192&ea,eu=31&ea;en=N.length();var eh=J(N,O);if(O-=en-N.length(),void 0!==eh&&eh>O){if($.strict){var ef=Error("Too few bytes to read ASN.1 value.");throw ef.available=N.length(),ef.remaining=O,ef.requested=eh,ef}eh=O}var eg=(32&ea)==32;if(eg){if(es=[],void 0===eh)for(;;){if(X(N,O,2),N.bytes(2)===String.fromCharCode(0,0)){N.getBytes(2),O-=2;break}en=N.length(),es.push(Z(N,O,U+1,$)),O-=en-N.length()}else for(;eh>0;)en=N.length(),es.push(Z(N,eh,U+1,$)),O-=en-N.length(),eh-=en-N.length()}if(void 0===es&&ec===Y.Class.UNIVERSAL&&eu===Y.Type.BITSTRING&&(eo=N.bytes(eh)),void 0===es&&$.decodeBitStrings&&ec===Y.Class.UNIVERSAL&&eu===Y.Type.BITSTRING&&eh>1){var ey=N.read,ew=O,ev=0;if(eu===Y.Type.BITSTRING&&(X(N,O,1),ev=N.getByte(),O--),0===ev)try{en=N.length();var eE={strict:!0,decodeBitStrings:!0},e_=Z(N,O,U+1,eE),eS=en-N.length();O-=eS,eu==Y.Type.BITSTRING&&eS++;var eI=e_.tagClass;eS===eh&&(eI===Y.Class.UNIVERSAL||eI===Y.Class.CONTEXT_SPECIFIC)&&(es=[e_])}catch(N){}void 0===es&&(N.read=ey,O=ew)}if(void 0===es){if(void 0===eh){if($.strict)throw Error("Non-constructed ASN.1 object of indefinite length.");eh=O}if(eu===Y.Type.BMPSTRING)for(es="";eh>0;eh-=2)X(N,O,2),es+=String.fromCharCode(N.getInt16()),O-=2;else es=N.getBytes(eh),O-=eh}var eR=void 0===eo?null:{bitStringContents:eo};return Y.create(ec,eu,eg,es,eR)}Y.fromDer=function(N,O){void 0===O&&(O={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),"boolean"==typeof O&&(O={strict:O,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in O||(O.strict=!0),"parseAllBytes"in O||(O.parseAllBytes=!0),"decodeBitStrings"in O||(O.decodeBitStrings=!0),"string"==typeof N&&(N=$.util.createBuffer(N));var U=N.length(),Y=Z(N,N.length(),0,O);if(O.parseAllBytes&&0!==N.length()){var X=Error("Unparsed DER bytes remain after ASN.1 parsing.");throw X.byteCount=U,X.remaining=N.length(),X}return Y},Y.toDer=function(N){var O=$.util.createBuffer(),U=N.tagClass|N.type,X=$.util.createBuffer(),J=!1;if("bitStringContents"in N&&(J=!0,N.original&&(J=Y.equals(N,N.original))),J)X.putBytes(N.bitStringContents);else if(N.composed){N.constructed?U|=32:X.putByte(0);for(var Z=0;Z<N.value.length;++Z)void 0!==N.value[Z]&&X.putBuffer(Y.toDer(N.value[Z]))}else if(N.type===Y.Type.BMPSTRING)for(var Z=0;Z<N.value.length;++Z)X.putInt16(N.value.charCodeAt(Z));else N.type===Y.Type.INTEGER&&N.value.length>1&&(0===N.value.charCodeAt(0)&&(128&N.value.charCodeAt(1))==0||255===N.value.charCodeAt(0)&&(128&N.value.charCodeAt(1))==128)?X.putBytes(N.value.substr(1)):X.putBytes(N.value);if(O.putByte(U),127>=X.length())O.putByte(127&X.length());else{var en=X.length(),es="";do es+=String.fromCharCode(255&en),en>>>=8;while(en>0);O.putByte(128|es.length);for(var Z=es.length-1;Z>=0;--Z)O.putByte(es.charCodeAt(Z))}return O.putBuffer(X),O},Y.oidToDer=function(N){var O,U,Y,X,J=N.split("."),Z=$.util.createBuffer();Z.putByte(40*parseInt(J[0],10)+parseInt(J[1],10));for(var en=2;en<J.length;++en){O=!0,U=[],Y=parseInt(J[en],10);do X=127&Y,Y>>>=7,O||(X|=128),U.push(X),O=!1;while(Y>0);for(var es=U.length-1;es>=0;--es)Z.putByte(U[es])}return Z},Y.derToOid=function(N){"string"==typeof N&&(N=$.util.createBuffer(N));var O,U=N.getByte();O=Math.floor(U/40)+"."+U%40;for(var Y=0;N.length()>0;)U=N.getByte(),Y<<=7,128&U?Y+=127&U:(O+="."+(Y+U),Y=0);return O},Y.utcTimeToDate=function(N){var O=new Date,U=parseInt(N.substr(0,2),10);U=U>=50?1900+U:2e3+U;var $=parseInt(N.substr(2,2),10)-1,Y=parseInt(N.substr(4,2),10),X=parseInt(N.substr(6,2),10),J=parseInt(N.substr(8,2),10),Z=0;if(N.length>11){var en=N.charAt(10),es=10;"+"!==en&&"-"!==en&&(Z=parseInt(N.substr(10,2),10),es+=2)}if(O.setUTCFullYear(U,$,Y),O.setUTCHours(X,J,Z,0),es&&("+"===(en=N.charAt(es))||"-"===en)){var eo=60*parseInt(N.substr(es+1,2),10)+parseInt(N.substr(es+4,2),10);eo*=6e4,"+"===en?O.setTime(+O-eo):O.setTime(+O+eo)}return O},Y.generalizedTimeToDate=function(N){var O=new Date,U=parseInt(N.substr(0,4),10),$=parseInt(N.substr(4,2),10)-1,Y=parseInt(N.substr(6,2),10),X=parseInt(N.substr(8,2),10),J=parseInt(N.substr(10,2),10),Z=parseInt(N.substr(12,2),10),en=0,es=0,eo=!1;"Z"===N.charAt(N.length-1)&&(eo=!0);var ea=N.length-5,ec=N.charAt(ea);return("+"===ec||"-"===ec)&&(es=(60*parseInt(N.substr(ea+1,2),10)+parseInt(N.substr(ea+4,2),10))*6e4,"+"===ec&&(es*=-1),eo=!0),"."===N.charAt(14)&&(en=1e3*parseFloat(N.substr(14),10)),eo?(O.setUTCFullYear(U,$,Y),O.setUTCHours(X,J,Z,en),O.setTime(+O+es)):(O.setFullYear(U,$,Y),O.setHours(X,J,Z,en)),O},Y.dateToUtcTime=function(N){if("string"==typeof N)return N;var O="",U=[];U.push((""+N.getUTCFullYear()).substr(2)),U.push(""+(N.getUTCMonth()+1)),U.push(""+N.getUTCDate()),U.push(""+N.getUTCHours()),U.push(""+N.getUTCMinutes()),U.push(""+N.getUTCSeconds());for(var $=0;$<U.length;++$)U[$].length<2&&(O+="0"),O+=U[$];return O+"Z"},Y.dateToGeneralizedTime=function(N){if("string"==typeof N)return N;var O="",U=[];U.push(""+N.getUTCFullYear()),U.push(""+(N.getUTCMonth()+1)),U.push(""+N.getUTCDate()),U.push(""+N.getUTCHours()),U.push(""+N.getUTCMinutes()),U.push(""+N.getUTCSeconds());for(var $=0;$<U.length;++$)U[$].length<2&&(O+="0"),O+=U[$];return O+"Z"},Y.integerToDer=function(N){var O=$.util.createBuffer();if(N>=-128&&N<128)return O.putSignedInt(N,8);if(N>=-32768&&N<32768)return O.putSignedInt(N,16);if(N>=-8388608&&N<8388608)return O.putSignedInt(N,24);if(N>=-2147483648&&N<2147483648)return O.putSignedInt(N,32);var U=Error("Integer too large; max is 32-bits.");throw U.integer=N,U},Y.derToInteger=function(N){"string"==typeof N&&(N=$.util.createBuffer(N));var O=8*N.length();if(O>32)throw Error("Integer too large; max is 32-bits.");return N.getSignedInt(O)},Y.validate=function(N,O,U,X){var J=!1;if((N.tagClass===O.tagClass||void 0===O.tagClass)&&(N.type===O.type||void 0===O.type)){if(N.constructed===O.constructed||void 0===O.constructed){if(J=!0,O.value&&$.util.isArray(O.value))for(var Z=0,en=0;J&&en<O.value.length;++en)J=O.value[en].optional||!1,N.value[Z]&&((J=Y.validate(N.value[Z],O.value[en],U,X))?++Z:O.value[en].optional&&(J=!0)),!J&&X&&X.push("["+O.name+'] Tag class "'+O.tagClass+'", type "'+O.type+'" expected value length "'+O.value.length+'", got "'+N.value.length+'"');if(J&&U&&(O.capture&&(U[O.capture]=N.value),O.captureAsn1&&(U[O.captureAsn1]=N),O.captureBitStringContents&&"bitStringContents"in N&&(U[O.captureBitStringContents]=N.bitStringContents),O.captureBitStringValue&&"bitStringContents"in N)){if(N.bitStringContents.length<2)U[O.captureBitStringValue]="";else{if(0!==N.bitStringContents.charCodeAt(0))throw Error("captureBitStringValue only supported for zero unused bits");U[O.captureBitStringValue]=N.bitStringContents.slice(1)}}}else X&&X.push("["+O.name+'] Expected constructed "'+O.constructed+'", got "'+N.constructed+'"')}else X&&(N.tagClass!==O.tagClass&&X.push("["+O.name+'] Expected tag class "'+O.tagClass+'", got "'+N.tagClass+'"'),N.type!==O.type&&X.push("["+O.name+'] Expected type "'+O.type+'", got "'+N.type+'"'));return J};var en=/[^\\u0000-\\u00ff]/;Y.prettyPrint=function(N,O,U){var X="";U=U||2,(O=O||0)>0&&(X+="\n");for(var J="",Z=0;Z<O*U;++Z)J+=" ";switch(X+=J+"Tag: ",N.tagClass){case Y.Class.UNIVERSAL:X+="Universal:";break;case Y.Class.APPLICATION:X+="Application:";break;case Y.Class.CONTEXT_SPECIFIC:X+="Context-Specific:";break;case Y.Class.PRIVATE:X+="Private:"}if(N.tagClass===Y.Class.UNIVERSAL)switch(X+=N.type,N.type){case Y.Type.NONE:X+=" (None)";break;case Y.Type.BOOLEAN:X+=" (Boolean)";break;case Y.Type.INTEGER:X+=" (Integer)";break;case Y.Type.BITSTRING:X+=" (Bit string)";break;case Y.Type.OCTETSTRING:X+=" (Octet string)";break;case Y.Type.NULL:X+=" (Null)";break;case Y.Type.OID:X+=" (Object Identifier)";break;case Y.Type.ODESC:X+=" (Object Descriptor)";break;case Y.Type.EXTERNAL:X+=" (External or Instance of)";break;case Y.Type.REAL:X+=" (Real)";break;case Y.Type.ENUMERATED:X+=" (Enumerated)";break;case Y.Type.EMBEDDED:X+=" (Embedded PDV)";break;case Y.Type.UTF8:X+=" (UTF8)";break;case Y.Type.ROID:X+=" (Relative Object Identifier)";break;case Y.Type.SEQUENCE:X+=" (Sequence)";break;case Y.Type.SET:X+=" (Set)";break;case Y.Type.PRINTABLESTRING:X+=" (Printable String)";break;case Y.Type.IA5String:X+=" (IA5String (ASCII))";break;case Y.Type.UTCTIME:X+=" (UTC time)";break;case Y.Type.GENERALIZEDTIME:X+=" (Generalized time)";break;case Y.Type.BMPSTRING:X+=" (BMP String)"}else X+=N.type;if(X+="\n"+(J+"Constructed: ")+N.constructed+"\n",N.composed){for(var es=0,eo="",Z=0;Z<N.value.length;++Z)void 0!==N.value[Z]&&(es+=1,eo+=Y.prettyPrint(N.value[Z],O+1,U),Z+1<N.value.length&&(eo+=","));X+=J+"Sub values: "+es+eo}else{if(X+=J+"Value: ",N.type===Y.Type.OID){var ea=Y.derToOid(N.value);X+=ea,$.pki&&$.pki.oids&&ea in $.pki.oids&&(X+=" ("+$.pki.oids[ea]+") ")}if(N.type===Y.Type.INTEGER)try{X+=Y.derToInteger(N.value)}catch(O){X+="0x"+$.util.bytesToHex(N.value)}else if(N.type===Y.Type.BITSTRING){if(N.value.length>1?X+="0x"+$.util.bytesToHex(N.value.slice(1)):X+="(none)",N.value.length>0){var ec=N.value.charCodeAt(0);1==ec?X+=" (1 unused bit shown)":ec>1&&(X+=" ("+ec+" unused bits shown)")}}else if(N.type===Y.Type.OCTETSTRING)en.test(N.value)||(X+="("+N.value+") "),X+="0x"+$.util.bytesToHex(N.value);else if(N.type===Y.Type.UTF8)try{X+=$.util.decodeUtf8(N.value)}catch(O){if("URI malformed"===O.message)X+="0x"+$.util.bytesToHex(N.value)+" (malformed UTF8)";else throw O}else N.type===Y.Type.PRINTABLESTRING||N.type===Y.Type.IA5String?X+=N.value:en.test(N.value)?X+="0x"+$.util.bytesToHex(N.value):0===N.value.length?X+="[null]":X+=N.value}return X}},8807:function(N,O,U){var $=U(2678).Buffer,Y={};N.exports=Y;var X={};function J(N,O){var U=0,$=O.length,Y=O.charAt(0),X=[0];for(U=0;U<N.length();++U){for(var J=0,Z=N.at(U);J<X.length;++J)Z+=X[J]<<8,X[J]=Z%$,Z=Z/$|0;for(;Z>0;)X.push(Z%$),Z=Z/$|0}var en="";for(U=0;0===N.at(U)&&U<N.length()-1;++U)en+=Y;for(U=X.length-1;U>=0;--U)en+=O[X[U]];return en}Y.encode=function(N,O,U){if("string"!=typeof O)throw TypeError('"alphabet" must be a string.');if(void 0!==U&&"number"!=typeof U)throw TypeError('"maxline" must be a number.');var $="";if(N instanceof Uint8Array){var Y=0,X=O.length,Z=O.charAt(0),en=[0];for(Y=0;Y<N.length;++Y){for(var es=0,eo=N[Y];es<en.length;++es)eo+=en[es]<<8,en[es]=eo%X,eo=eo/X|0;for(;eo>0;)en.push(eo%X),eo=eo/X|0}for(Y=0;0===N[Y]&&Y<N.length-1;++Y)$+=Z;for(Y=en.length-1;Y>=0;--Y)$+=O[en[Y]]}else $=J(N,O);if(U){var ea=RegExp(".{1,"+U+"}","g");$=$.match(ea).join("\r\n")}return $},Y.decode=function(N,O){if("string"!=typeof N)throw TypeError('"input" must be a string.');if("string"!=typeof O)throw TypeError('"alphabet" must be a string.');var U=X[O];if(!U){U=X[O]=[];for(var Y=0;Y<O.length;++Y)U[O.charCodeAt(Y)]=Y}N=N.replace(/\s/g,"");for(var J=O.length,Z=O.charAt(0),en=[0],Y=0;Y<N.length;Y++){var es=U[N.charCodeAt(Y)];if(void 0===es)return;for(var eo=0,ea=es;eo<en.length;++eo)ea+=en[eo]*J,en[eo]=255&ea,ea>>=8;for(;ea>0;)en.push(255&ea),ea>>=8}for(var ec=0;N[ec]===Z&&ec<N.length-1;++ec)en.push(0);return void 0!==$?$.from(en.reverse()):new Uint8Array(en.reverse())}},5649:function(N,O,U){var $=U(3832);U(7116),N.exports=$.cipher=$.cipher||{},$.cipher.algorithms=$.cipher.algorithms||{},$.cipher.createCipher=function(N,O){var U=N;if("string"==typeof U&&(U=$.cipher.getAlgorithm(U))&&(U=U()),!U)throw Error("Unsupported algorithm: "+N);return new $.cipher.BlockCipher({algorithm:U,key:O,decrypt:!1})},$.cipher.createDecipher=function(N,O){var U=N;if("string"==typeof U&&(U=$.cipher.getAlgorithm(U))&&(U=U()),!U)throw Error("Unsupported algorithm: "+N);return new $.cipher.BlockCipher({algorithm:U,key:O,decrypt:!0})},$.cipher.registerAlgorithm=function(N,O){N=N.toUpperCase(),$.cipher.algorithms[N]=O},$.cipher.getAlgorithm=function(N){return(N=N.toUpperCase())in $.cipher.algorithms?$.cipher.algorithms[N]:null};var Y=$.cipher.BlockCipher=function(N){this.algorithm=N.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=N.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=N.decrypt,this.algorithm.initialize(N)};Y.prototype.start=function(N){var O={};for(var U in N=N||{})O[U]=N[U];O.decrypt=this._decrypt,this._finish=!1,this._input=$.util.createBuffer(),this.output=N.output||$.util.createBuffer(),this.mode.start(O)},Y.prototype.update=function(N){for(N&&this._input.putBuffer(N);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},Y.prototype.finish=function(N){N&&("ECB"===this.mode.name||"CBC"===this.mode.name)&&(this.mode.pad=function(O){return N(this.blockSize,O,!1)},this.mode.unpad=function(O){return N(this.blockSize,O,!0)});var O={};return O.decrypt=this._decrypt,O.overflow=this._input.length()%this.blockSize,!!(this._decrypt||!this.mode.pad||this.mode.pad(this._input,O))&&(this._finish=!0,this.update(),(!this._decrypt||!this.mode.unpad||!!this.mode.unpad(this.output,O))&&(!this.mode.afterFinish||!!this.mode.afterFinish(this.output,O)))}},1967:function(N,O,U){var $=U(3832);U(7116),$.cipher=$.cipher||{};var Y=N.exports=$.cipher.modes=$.cipher.modes||{};function X(N,O){if("string"==typeof N&&(N=$.util.createBuffer(N)),$.util.isArray(N)&&N.length>4){var U=N;N=$.util.createBuffer();for(var Y=0;Y<U.length;++Y)N.putByte(U[Y])}if(N.length()<O)throw Error("Invalid IV length; got "+N.length()+" bytes and expected "+O+" bytes.");if(!$.util.isArray(N)){for(var X=[],J=O/4,Y=0;Y<J;++Y)X.push(N.getInt32());N=X}return N}function J(N){N[N.length-1]=N[N.length-1]+1&4294967295}function Z(N){return[N/4294967296|0,4294967295&N]}Y.ecb=function(N){N=N||{},this.name="ECB",this.cipher=N.cipher,this.blockSize=N.blockSize||16,this._ints=this.blockSize/4,this._inBlock=Array(this._ints),this._outBlock=Array(this._ints)},Y.ecb.prototype.start=function(N){},Y.ecb.prototype.encrypt=function(N,O,U){if(N.length()<this.blockSize&&!(U&&N.length()>0))return!0;for(var $=0;$<this._ints;++$)this._inBlock[$]=N.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var $=0;$<this._ints;++$)O.putInt32(this._outBlock[$])},Y.ecb.prototype.decrypt=function(N,O,U){if(N.length()<this.blockSize&&!(U&&N.length()>0))return!0;for(var $=0;$<this._ints;++$)this._inBlock[$]=N.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var $=0;$<this._ints;++$)O.putInt32(this._outBlock[$])},Y.ecb.prototype.pad=function(N,O){var U=N.length()===this.blockSize?this.blockSize:this.blockSize-N.length();return N.fillWithByte(U,U),!0},Y.ecb.prototype.unpad=function(N,O){if(O.overflow>0)return!1;var U=N.length(),$=N.at(U-1);return!($>this.blockSize<<2)&&(N.truncate($),!0)},Y.cbc=function(N){N=N||{},this.name="CBC",this.cipher=N.cipher,this.blockSize=N.blockSize||16,this._ints=this.blockSize/4,this._inBlock=Array(this._ints),this._outBlock=Array(this._ints)},Y.cbc.prototype.start=function(N){if(null===N.iv){if(!this._prev)throw Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in N)this._iv=X(N.iv,this.blockSize),this._prev=this._iv.slice(0);else throw Error("Invalid IV parameter.")},Y.cbc.prototype.encrypt=function(N,O,U){if(N.length()<this.blockSize&&!(U&&N.length()>0))return!0;for(var $=0;$<this._ints;++$)this._inBlock[$]=this._prev[$]^N.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var $=0;$<this._ints;++$)O.putInt32(this._outBlock[$]);this._prev=this._outBlock},Y.cbc.prototype.decrypt=function(N,O,U){if(N.length()<this.blockSize&&!(U&&N.length()>0))return!0;for(var $=0;$<this._ints;++$)this._inBlock[$]=N.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var $=0;$<this._ints;++$)O.putInt32(this._prev[$]^this._outBlock[$]);this._prev=this._inBlock.slice(0)},Y.cbc.prototype.pad=function(N,O){var U=N.length()===this.blockSize?this.blockSize:this.blockSize-N.length();return N.fillWithByte(U,U),!0},Y.cbc.prototype.unpad=function(N,O){if(O.overflow>0)return!1;var U=N.length(),$=N.at(U-1);return!($>this.blockSize<<2)&&(N.truncate($),!0)},Y.cfb=function(N){N=N||{},this.name="CFB",this.cipher=N.cipher,this.blockSize=N.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=Array(this._ints),this._partialBlock=Array(this._ints),this._partialOutput=$.util.createBuffer(),this._partialBytes=0},Y.cfb.prototype.start=function(N){if(!("iv"in N))throw Error("Invalid IV parameter.");this._iv=X(N.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},Y.cfb.prototype.encrypt=function(N,O,U){var $=N.length();if(0===$)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&$>=this.blockSize){for(var Y=0;Y<this._ints;++Y)this._inBlock[Y]=N.getInt32()^this._outBlock[Y],O.putInt32(this._inBlock[Y]);return}var X=(this.blockSize-$)%this.blockSize;X>0&&(X=this.blockSize-X),this._partialOutput.clear();for(var Y=0;Y<this._ints;++Y)this._partialBlock[Y]=N.getInt32()^this._outBlock[Y],this._partialOutput.putInt32(this._partialBlock[Y]);if(X>0)N.read-=this.blockSize;else for(var Y=0;Y<this._ints;++Y)this._inBlock[Y]=this._partialBlock[Y];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),X>0&&!U)return O.putBytes(this._partialOutput.getBytes(X-this._partialBytes)),this._partialBytes=X,!0;O.putBytes(this._partialOutput.getBytes($-this._partialBytes)),this._partialBytes=0},Y.cfb.prototype.decrypt=function(N,O,U){var $=N.length();if(0===$)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&$>=this.blockSize){for(var Y=0;Y<this._ints;++Y)this._inBlock[Y]=N.getInt32(),O.putInt32(this._inBlock[Y]^this._outBlock[Y]);return}var X=(this.blockSize-$)%this.blockSize;X>0&&(X=this.blockSize-X),this._partialOutput.clear();for(var Y=0;Y<this._ints;++Y)this._partialBlock[Y]=N.getInt32(),this._partialOutput.putInt32(this._partialBlock[Y]^this._outBlock[Y]);if(X>0)N.read-=this.blockSize;else for(var Y=0;Y<this._ints;++Y)this._inBlock[Y]=this._partialBlock[Y];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),X>0&&!U)return O.putBytes(this._partialOutput.getBytes(X-this._partialBytes)),this._partialBytes=X,!0;O.putBytes(this._partialOutput.getBytes($-this._partialBytes)),this._partialBytes=0},Y.ofb=function(N){N=N||{},this.name="OFB",this.cipher=N.cipher,this.blockSize=N.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=Array(this._ints),this._partialOutput=$.util.createBuffer(),this._partialBytes=0},Y.ofb.prototype.start=function(N){if(!("iv"in N))throw Error("Invalid IV parameter.");this._iv=X(N.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},Y.ofb.prototype.encrypt=function(N,O,U){var $=N.length();if(0===N.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&$>=this.blockSize){for(var Y=0;Y<this._ints;++Y)O.putInt32(N.getInt32()^this._outBlock[Y]),this._inBlock[Y]=this._outBlock[Y];return}var X=(this.blockSize-$)%this.blockSize;X>0&&(X=this.blockSize-X),this._partialOutput.clear();for(var Y=0;Y<this._ints;++Y)this._partialOutput.putInt32(N.getInt32()^this._outBlock[Y]);if(X>0)N.read-=this.blockSize;else for(var Y=0;Y<this._ints;++Y)this._inBlock[Y]=this._outBlock[Y];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),X>0&&!U)return O.putBytes(this._partialOutput.getBytes(X-this._partialBytes)),this._partialBytes=X,!0;O.putBytes(this._partialOutput.getBytes($-this._partialBytes)),this._partialBytes=0},Y.ofb.prototype.decrypt=Y.ofb.prototype.encrypt,Y.ctr=function(N){N=N||{},this.name="CTR",this.cipher=N.cipher,this.blockSize=N.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=Array(this._ints),this._partialOutput=$.util.createBuffer(),this._partialBytes=0},Y.ctr.prototype.start=function(N){if(!("iv"in N))throw Error("Invalid IV parameter.");this._iv=X(N.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},Y.ctr.prototype.encrypt=function(N,O,U){var $=N.length();if(0===$)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&$>=this.blockSize)for(var Y=0;Y<this._ints;++Y)O.putInt32(N.getInt32()^this._outBlock[Y]);else{var X=(this.blockSize-$)%this.blockSize;X>0&&(X=this.blockSize-X),this._partialOutput.clear();for(var Y=0;Y<this._ints;++Y)this._partialOutput.putInt32(N.getInt32()^this._outBlock[Y]);if(X>0&&(N.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),X>0&&!U)return O.putBytes(this._partialOutput.getBytes(X-this._partialBytes)),this._partialBytes=X,!0;O.putBytes(this._partialOutput.getBytes($-this._partialBytes)),this._partialBytes=0}J(this._inBlock)},Y.ctr.prototype.decrypt=Y.ctr.prototype.encrypt,Y.gcm=function(N){N=N||{},this.name="GCM",this.cipher=N.cipher,this.blockSize=N.blockSize||16,this._ints=this.blockSize/4,this._inBlock=Array(this._ints),this._outBlock=Array(this._ints),this._partialOutput=$.util.createBuffer(),this._partialBytes=0,this._R=3774873600},Y.gcm.prototype.start=function(N){if(!("iv"in N))throw Error("Invalid IV parameter.");var O,U=$.util.createBuffer(N.iv);if(this._cipherLength=0,O="additionalData"in N?$.util.createBuffer(N.additionalData):$.util.createBuffer(),"tagLength"in N?this._tagLength=N.tagLength:this._tagLength=128,this._tag=null,N.decrypt&&(this._tag=$.util.createBuffer(N.tag).getBytes(),this._tag.length!==this._tagLength/8))throw Error("Authentication tag does not match tag length.");this._hashBlock=Array(this._ints),this.tag=null,this._hashSubkey=Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var Y=U.length();if(12===Y)this._j0=[U.getInt32(),U.getInt32(),U.getInt32(),1];else{for(this._j0=[0,0,0,0];U.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[U.getInt32(),U.getInt32(),U.getInt32(),U.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(Z(8*Y)))}this._inBlock=this._j0.slice(0),J(this._inBlock),this._partialBytes=0,O=$.util.createBuffer(O),this._aDataLength=Z(8*O.length());var X=O.length()%this.blockSize;for(X&&O.fillWithByte(0,this.blockSize-X),this._s=[0,0,0,0];O.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[O.getInt32(),O.getInt32(),O.getInt32(),O.getInt32()])},Y.gcm.prototype.encrypt=function(N,O,U){var $=N.length();if(0===$)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&$>=this.blockSize){for(var Y=0;Y<this._ints;++Y)O.putInt32(this._outBlock[Y]^=N.getInt32());this._cipherLength+=this.blockSize}else{var X=(this.blockSize-$)%this.blockSize;X>0&&(X=this.blockSize-X),this._partialOutput.clear();for(var Y=0;Y<this._ints;++Y)this._partialOutput.putInt32(N.getInt32()^this._outBlock[Y]);if(X<=0||U){if(U){var Z=$%this.blockSize;this._cipherLength+=Z,this._partialOutput.truncate(this.blockSize-Z)}else this._cipherLength+=this.blockSize;for(var Y=0;Y<this._ints;++Y)this._outBlock[Y]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),X>0&&!U)return N.read-=this.blockSize,O.putBytes(this._partialOutput.getBytes(X-this._partialBytes)),this._partialBytes=X,!0;O.putBytes(this._partialOutput.getBytes($-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),J(this._inBlock)},Y.gcm.prototype.decrypt=function(N,O,U){var $=N.length();if($<this.blockSize&&!(U&&$>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),J(this._inBlock),this._hashBlock[0]=N.getInt32(),this._hashBlock[1]=N.getInt32(),this._hashBlock[2]=N.getInt32(),this._hashBlock[3]=N.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var Y=0;Y<this._ints;++Y)O.putInt32(this._outBlock[Y]^this._hashBlock[Y]);$<this.blockSize?this._cipherLength+=$%this.blockSize:this._cipherLength+=this.blockSize},Y.gcm.prototype.afterFinish=function(N,O){var U=!0;O.decrypt&&O.overflow&&N.truncate(this.blockSize-O.overflow),this.tag=$.util.createBuffer();var Y=this._aDataLength.concat(Z(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,Y);var X=[];this.cipher.encrypt(this._j0,X);for(var J=0;J<this._ints;++J)this.tag.putInt32(this._s[J]^X[J]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),O.decrypt&&this.tag.bytes()!==this._tag&&(U=!1),U},Y.gcm.prototype.multiply=function(N,O){for(var U=[0,0,0,0],$=O.slice(0),Y=0;Y<128;++Y)N[Y/32|0]&1<<31-Y%32&&(U[0]^=$[0],U[1]^=$[1],U[2]^=$[2],U[3]^=$[3]),this.pow($,$);return U},Y.gcm.prototype.pow=function(N,O){for(var U=1&N[3],$=3;$>0;--$)O[$]=N[$]>>>1|(1&N[$-1])<<31;O[0]=N[0]>>>1,U&&(O[0]^=this._R)},Y.gcm.prototype.tableMultiply=function(N){for(var O=[0,0,0,0],U=0;U<32;++U){var $=N[U/8|0]>>>(7-U%8)*4&15,Y=this._m[U][$];O[0]^=Y[0],O[1]^=Y[1],O[2]^=Y[2],O[3]^=Y[3]}return O},Y.gcm.prototype.ghash=function(N,O,U){return O[0]^=U[0],O[1]^=U[1],O[2]^=U[2],O[3]^=U[3],this.tableMultiply(O)},Y.gcm.prototype.generateHashTable=function(N,O){for(var U=8/O,$=4*U,Y=16*U,X=Array(Y),J=0;J<Y;++J){var Z=[0,0,0,0],en=J/$|0,es=($-1-J%$)*O;Z[en]=1<<O-1<<es,X[J]=this.generateSubHashTable(this.multiply(Z,N),O)}return X},Y.gcm.prototype.generateSubHashTable=function(N,O){var U=1<<O,$=U>>>1,Y=Array(U);Y[$]=N.slice(0);for(var X=$>>>1;X>0;)this.pow(Y[2*X],Y[X]=[]),X>>=1;for(X=2;X<$;){for(var J=1;J<X;++J){var Z=Y[X],en=Y[J];Y[X+J]=[Z[0]^en[0],Z[1]^en[1],Z[2]^en[2],Z[3]^en[3]]}X*=2}for(Y[0]=[0,0,0,0],X=$+1;X<U;++X){var es=Y[X^$];Y[X]=[N[0]^es[0],N[1]^es[1],N[2]^es[2],N[3]^es[3]]}return Y}},3480:function(N,O,U){var $=U(3832);function Y(N,O){var U=function(){return new $.des.Algorithm(N,O)};$.cipher.registerAlgorithm(N,U)}U(5649),U(1967),U(7116),N.exports=$.des=$.des||{},$.des.startEncrypting=function(N,O,U,$){var Y=ef({key:N,output:U,decrypt:!1,mode:$||(null===O?"ECB":"CBC")});return Y.start(O),Y},$.des.createEncryptionCipher=function(N,O){return ef({key:N,output:null,decrypt:!1,mode:O})},$.des.startDecrypting=function(N,O,U,$){var Y=ef({key:N,output:U,decrypt:!0,mode:$||(null===O?"ECB":"CBC")});return Y.start(O),Y},$.des.createDecryptionCipher=function(N,O){return ef({key:N,output:null,decrypt:!0,mode:O})},$.des.Algorithm=function(N,O){var U=this;U.name=N,U.mode=new O({blockSize:8,cipher:{encrypt:function(N,O){return eh(U._keys,N,O,!1)},decrypt:function(N,O){return eh(U._keys,N,O,!0)}}}),U._init=!1},$.des.Algorithm.prototype.initialize=function(N){if(!this._init){var O=$.util.createBuffer(N.key);if(0===this.name.indexOf("3DES")&&24!==O.length())throw Error("Invalid Triple-DES key size: "+8*O.length());this._keys=eu(O),this._init=!0}},Y("DES-ECB",$.cipher.modes.ecb),Y("DES-CBC",$.cipher.modes.cbc),Y("DES-CFB",$.cipher.modes.cfb),Y("DES-OFB",$.cipher.modes.ofb),Y("DES-CTR",$.cipher.modes.ctr),Y("3DES-ECB",$.cipher.modes.ecb),Y("3DES-CBC",$.cipher.modes.cbc),Y("3DES-CFB",$.cipher.modes.cfb),Y("3DES-OFB",$.cipher.modes.ofb),Y("3DES-CTR",$.cipher.modes.ctr);var X=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],J=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],Z=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],en=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],es=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],eo=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],ea=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],ec=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function eu(N){for(var O,U=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],$=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],Y=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],X=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],J=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],Z=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],en=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],es=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],eo=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],ea=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],ec=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],eu=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],eh=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],ef=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],eg=N.length()>8?3:1,ey=[],ew=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],ev=0,eE=0;eE<eg;eE++){var e_=N.getInt32(),eS=N.getInt32();O=(e_>>>4^eS)&252645135,eS^=O,e_^=O<<4,O=(eS>>>-16^e_)&65535,e_^=O,eS^=O<<-16,O=(e_>>>2^eS)&858993459,eS^=O,e_^=O<<2,O=(eS>>>-16^e_)&65535,e_^=O,eS^=O<<-16,O=(e_>>>1^eS)&1431655765,eS^=O,e_^=O<<1,O=(eS>>>8^e_)&16711935,e_^=O,eS^=O<<8,O=(e_>>>1^eS)&1431655765,eS^=O,e_^=O<<1,O=e_<<8|eS>>>20&240,e_=eS<<24|eS<<8&16711680|eS>>>8&65280|eS>>>24&240,eS=O;for(var eI=0;eI<ew.length;++eI){ew[eI]?(e_=e_<<2|e_>>>26,eS=eS<<2|eS>>>26):(e_=e_<<1|e_>>>27,eS=eS<<1|eS>>>27),eS&=-15;var eR=U[(e_&=-15)>>>28]|$[e_>>>24&15]|Y[e_>>>20&15]|X[e_>>>16&15]|J[e_>>>12&15]|Z[e_>>>8&15]|en[e_>>>4&15],ek=es[eS>>>28]|eo[eS>>>24&15]|ea[eS>>>20&15]|ec[eS>>>16&15]|eu[eS>>>12&15]|eh[eS>>>8&15]|ef[eS>>>4&15];O=(ek>>>16^eR)&65535,ey[ev++]=eR^O,ey[ev++]=ek^O<<16}}return ey}function eh(N,O,U,$){var Y,eu,eh=32===N.length?3:9;Y=3===eh?$?[30,-2,-2]:[0,32,2]:$?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var ef=O[0],eg=O[1];eu=(ef>>>4^eg)&252645135,eg^=eu,ef^=eu<<4,eu=(ef>>>16^eg)&65535,eg^=eu,ef^=eu<<16,eu=(eg>>>2^ef)&858993459,ef^=eu,eg^=eu<<2,eu=(eg>>>8^ef)&16711935,ef^=eu,eg^=eu<<8,eu=(ef>>>1^eg)&1431655765,eg^=eu,ef^=eu<<1,ef=ef<<1|ef>>>31,eg=eg<<1|eg>>>31;for(var ey=0;ey<eh;ey+=3){for(var ew=Y[ey+1],ev=Y[ey+2],eE=Y[ey];eE!=ew;eE+=ev){var e_=eg^N[eE],eS=(eg>>>4|eg<<28)^N[eE+1];eu=ef,ef=eg,eg=eu^(J[e_>>>24&63]|en[e_>>>16&63]|eo[e_>>>8&63]|ec[63&e_]|X[eS>>>24&63]|Z[eS>>>16&63]|es[eS>>>8&63]|ea[63&eS])}eu=ef,ef=eg,eg=eu}eu=((ef=ef>>>1|ef<<31)>>>1^(eg=eg>>>1|eg<<31))&1431655765,eg^=eu,ef^=eu<<1,eu=(eg>>>8^ef)&16711935,ef^=eu,eg^=eu<<8,eu=(eg>>>2^ef)&858993459,ef^=eu,eg^=eu<<2,eu=(ef>>>16^eg)&65535,eg^=eu,ef^=eu<<16,eu=(ef>>>4^eg)&252645135,eg^=eu,ef^=eu<<4,U[0]=ef,U[1]=eg}function ef(N){var O,U="DES-"+((N=N||{}).mode||"CBC").toUpperCase(),Y=(O=N.decrypt?$.cipher.createDecipher(U,N.key):$.cipher.createCipher(U,N.key)).start;return O.start=function(N,U){var X=null;U instanceof $.util.ByteBuffer&&(X=U,U={}),(U=U||{}).output=X,U.iv=N,Y.call(O,U)},O}},3832:function(N){N.exports={options:{usePureJavaScript:!1}}},6607:function(N,O,U){var $=U(3832);U(8991),U(7116),(N.exports=$.hmac=$.hmac||{}).create=function(){var N=null,O=null,U=null,Y=null,X={};return X.start=function(X,J){if(null!==X){if("string"==typeof X){if((X=X.toLowerCase())in $.md.algorithms)O=$.md.algorithms[X].create();else throw Error('Unknown hash algorithm "'+X+'"')}else O=X}if(null===J)J=N;else{if("string"==typeof J)J=$.util.createBuffer(J);else if($.util.isArray(J)){var Z=J;J=$.util.createBuffer();for(var en=0;en<Z.length;++en)J.putByte(Z[en])}var es=J.length();es>O.blockLength&&(O.start(),O.update(J.bytes()),J=O.digest()),U=$.util.createBuffer(),Y=$.util.createBuffer(),es=J.length();for(var en=0;en<es;++en){var Z=J.at(en);U.putByte(54^Z),Y.putByte(92^Z)}if(es<O.blockLength)for(var Z=O.blockLength-es,en=0;en<Z;++en)U.putByte(54),Y.putByte(92);N=J,U=U.bytes(),Y=Y.bytes()}O.start(),O.update(U)},X.update=function(N){O.update(N)},X.getMac=function(){var N=O.digest().bytes();return O.start(),O.update(Y),O.update(N),O.digest()},X.digest=X.getMac,X}},5764:function(N,O,U){var $,Y,X,J=U(3832);N.exports=J.jsbn=J.jsbn||{};var Z=!0;function en(N,O,U){this.data=[],null!=N&&("number"==typeof N?this.fromNumber(N,O,U):null==O&&"string"!=typeof N?this.fromString(N,256):this.fromString(N,O))}function es(){return new en(null)}function eo(N,O,U,$,Y,X){for(;--X>=0;){var J=O*this.data[N++]+U.data[$]+Y;Y=Math.floor(J/67108864),U.data[$++]=67108863&J}return Y}function ea(N,O,U,$,Y,X){for(var J=32767&O,Z=O>>15;--X>=0;){var en=32767&this.data[N],es=this.data[N++]>>15,eo=Z*en+es*J;Y=((en=J*en+((32767&eo)<<15)+U.data[$]+(1073741823&Y))>>>30)+(eo>>>15)+Z*es+(Y>>>30),U.data[$++]=1073741823&en}return Y}function ec(N,O,U,$,Y,X){for(var J=16383&O,Z=O>>14;--X>=0;){var en=16383&this.data[N],es=this.data[N++]>>14,eo=Z*en+es*J;Y=((en=J*en+((16383&eo)<<14)+U.data[$]+Y)>>28)+(eo>>14)+Z*es,U.data[$++]=268435455&en}return Y}J.jsbn.BigInteger=en,"undefined"==typeof navigator?(en.prototype.am=ec,$=28):Z&&"Microsoft Internet Explorer"==navigator.appName?(en.prototype.am=ea,$=30):Z&&"Netscape"!=navigator.appName?(en.prototype.am=eo,$=26):(en.prototype.am=ec,$=28),en.prototype.DB=$,en.prototype.DM=(1<<$)-1,en.prototype.DV=1<<$;var eu=52;en.prototype.FV=Math.pow(2,eu),en.prototype.F1=eu-$,en.prototype.F2=2*$-eu;var eh="0123456789abcdefghijklmnopqrstuvwxyz",ef=[];for(X=0,Y=48;X<=9;++X)ef[Y++]=X;for(X=10,Y=97;X<36;++X)ef[Y++]=X;for(X=10,Y=65;X<36;++X)ef[Y++]=X;function eg(N){return eh.charAt(N)}function ey(N,O){var U=ef[N.charCodeAt(O)];return null==U?-1:U}function ew(N){for(var O=this.t-1;O>=0;--O)N.data[O]=this.data[O];N.t=this.t,N.s=this.s}function ev(N){this.t=1,this.s=N<0?-1:0,N>0?this.data[0]=N:N<-1?this.data[0]=N+this.DV:this.t=0}function eE(N){var O=es();return O.fromInt(N),O}function e_(N,O){if(16==O)U=4;else if(8==O)U=3;else if(256==O)U=8;else if(2==O)U=1;else if(32==O)U=5;else if(4==O)U=2;else{this.fromRadix(N,O);return}this.t=0,this.s=0;for(var U,$=N.length,Y=!1,X=0;--$>=0;){var J=8==U?255&N[$]:ey(N,$);if(J<0){"-"==N.charAt($)&&(Y=!0);continue}Y=!1,0==X?this.data[this.t++]=J:X+U>this.DB?(this.data[this.t-1]|=(J&(1<<this.DB-X)-1)<<X,this.data[this.t++]=J>>this.DB-X):this.data[this.t-1]|=J<<X,(X+=U)>=this.DB&&(X-=this.DB)}8==U&&(128&N[0])!=0&&(this.s=-1,X>0&&(this.data[this.t-1]|=(1<<this.DB-X)-1<<X)),this.clamp(),Y&&en.ZERO.subTo(this,this)}function eS(){for(var N=this.s&this.DM;this.t>0&&this.data[this.t-1]==N;)--this.t}function eI(N){if(this.s<0)return"-"+this.negate().toString(N);if(16==N)O=4;else if(8==N)O=3;else if(2==N)O=1;else if(32==N)O=5;else{if(4!=N)return this.toRadix(N);O=2}var O,U,$=(1<<O)-1,Y=!1,X="",J=this.t,Z=this.DB-J*this.DB%O;if(J-- >0)for(Z<this.DB&&(U=this.data[J]>>Z)>0&&(Y=!0,X=eg(U));J>=0;)Z<O?U=(this.data[J]&(1<<Z)-1)<<O-Z|this.data[--J]>>(Z+=this.DB-O):(U=this.data[J]>>(Z-=O)&$,Z<=0&&(Z+=this.DB,--J)),U>0&&(Y=!0),Y&&(X+=eg(U));return Y?X:"0"}function eR(){var N=es();return en.ZERO.subTo(this,N),N}function ek(){return this.s<0?this.negate():this}function eD(N){var O=this.s-N.s;if(0!=O)return O;var U=this.t;if(0!=(O=U-N.t))return this.s<0?-O:O;for(;--U>=0;)if(0!=(O=this.data[U]-N.data[U]))return O;return 0}function eA(N){var O,U=1;return 0!=(O=N>>>16)&&(N=O,U+=16),0!=(O=N>>8)&&(N=O,U+=8),0!=(O=N>>4)&&(N=O,U+=4),0!=(O=N>>2)&&(N=O,U+=2),0!=(O=N>>1)&&(N=O,U+=1),U}function eT(){return this.t<=0?0:this.DB*(this.t-1)+eA(this.data[this.t-1]^this.s&this.DM)}function eC(N,O){var U;for(U=this.t-1;U>=0;--U)O.data[U+N]=this.data[U];for(U=N-1;U>=0;--U)O.data[U]=0;O.t=this.t+N,O.s=this.s}function eP(N,O){for(var U=N;U<this.t;++U)O.data[U-N]=this.data[U];O.t=Math.max(this.t-N,0),O.s=this.s}function eN(N,O){var U,$=N%this.DB,Y=this.DB-$,X=(1<<Y)-1,J=Math.floor(N/this.DB),Z=this.s<<$&this.DM;for(U=this.t-1;U>=0;--U)O.data[U+J+1]=this.data[U]>>Y|Z,Z=(this.data[U]&X)<<$;for(U=J-1;U>=0;--U)O.data[U]=0;O.data[J]=Z,O.t=this.t+J+1,O.s=this.s,O.clamp()}function eB(N,O){O.s=this.s;var U=Math.floor(N/this.DB);if(U>=this.t){O.t=0;return}var $=N%this.DB,Y=this.DB-$,X=(1<<$)-1;O.data[0]=this.data[U]>>$;for(var J=U+1;J<this.t;++J)O.data[J-U-1]|=(this.data[J]&X)<<Y,O.data[J-U]=this.data[J]>>$;$>0&&(O.data[this.t-U-1]|=(this.s&X)<<Y),O.t=this.t-U,O.clamp()}function eL(N,O){for(var U=0,$=0,Y=Math.min(N.t,this.t);U<Y;)$+=this.data[U]-N.data[U],O.data[U++]=$&this.DM,$>>=this.DB;if(N.t<this.t){for($-=N.s;U<this.t;)$+=this.data[U],O.data[U++]=$&this.DM,$>>=this.DB;$+=this.s}else{for($+=this.s;U<N.t;)$-=N.data[U],O.data[U++]=$&this.DM,$>>=this.DB;$-=N.s}O.s=$<0?-1:0,$<-1?O.data[U++]=this.DV+$:$>0&&(O.data[U++]=$),O.t=U,O.clamp()}function eO(N,O){var U=this.abs(),$=N.abs(),Y=U.t;for(O.t=Y+$.t;--Y>=0;)O.data[Y]=0;for(Y=0;Y<$.t;++Y)O.data[Y+U.t]=U.am(0,$.data[Y],O,Y,0,U.t);O.s=0,O.clamp(),this.s!=N.s&&en.ZERO.subTo(O,O)}function eM(N){for(var O=this.abs(),U=N.t=2*O.t;--U>=0;)N.data[U]=0;for(U=0;U<O.t-1;++U){var $=O.am(U,O.data[U],N,2*U,0,1);(N.data[U+O.t]+=O.am(U+1,2*O.data[U],N,2*U+1,$,O.t-U-1))>=O.DV&&(N.data[U+O.t]-=O.DV,N.data[U+O.t+1]=1)}N.t>0&&(N.data[N.t-1]+=O.am(U,O.data[U],N,2*U,0,1)),N.s=0,N.clamp()}function eU(N,O,U){var $=N.abs();if(!($.t<=0)){var Y=this.abs();if(Y.t<$.t){null!=O&&O.fromInt(0),null!=U&&this.copyTo(U);return}null==U&&(U=es());var X=es(),J=this.s,Z=N.s,eo=this.DB-eA($.data[$.t-1]);eo>0?($.lShiftTo(eo,X),Y.lShiftTo(eo,U)):($.copyTo(X),Y.copyTo(U));var ea=X.t,ec=X.data[ea-1];if(0!=ec){var eu=ec*(1<<this.F1)+(ea>1?X.data[ea-2]>>this.F2:0),eh=this.FV/eu,ef=(1<<this.F1)/eu,eg=1<<this.F2,ey=U.t,ew=ey-ea,ev=null==O?es():O;for(X.dlShiftTo(ew,ev),U.compareTo(ev)>=0&&(U.data[U.t++]=1,U.subTo(ev,U)),en.ONE.dlShiftTo(ea,ev),ev.subTo(X,X);X.t<ea;)X.data[X.t++]=0;for(;--ew>=0;){var eE=U.data[--ey]==ec?this.DM:Math.floor(U.data[ey]*eh+(U.data[ey-1]+eg)*ef);if((U.data[ey]+=X.am(0,eE,U,ew,0,ea))<eE)for(X.dlShiftTo(ew,ev),U.subTo(ev,U);U.data[ey]<--eE;)U.subTo(ev,U)}null!=O&&(U.drShiftTo(ea,O),J!=Z&&en.ZERO.subTo(O,O)),U.t=ea,U.clamp(),eo>0&&U.rShiftTo(eo,U),J<0&&en.ZERO.subTo(U,U)}}}function eF(N){var O=es();return this.abs().divRemTo(N,null,O),this.s<0&&O.compareTo(en.ZERO)>0&&N.subTo(O,O),O}function eV(N){this.m=N}function ez(N){return N.s<0||N.compareTo(this.m)>=0?N.mod(this.m):N}function e$(N){return N}function eK(N){N.divRemTo(this.m,null,N)}function eq(N,O,U){N.multiplyTo(O,U),this.reduce(U)}function ej(N,O){N.squareTo(O),this.reduce(O)}function eW(){if(this.t<1)return 0;var N=this.data[0];if((1&N)==0)return 0;var O=3&N;return(O=(O=(O=(O=O*(2-(15&N)*O)&15)*(2-(255&N)*O)&255)*(2-((65535&N)*O&65535))&65535)*(2-N*O%this.DV)%this.DV)>0?this.DV-O:-O}function eH(N){this.m=N,this.mp=N.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<N.DB-15)-1,this.mt2=2*N.t}function eG(N){var O=es();return N.abs().dlShiftTo(this.m.t,O),O.divRemTo(this.m,null,O),N.s<0&&O.compareTo(en.ZERO)>0&&this.m.subTo(O,O),O}function eQ(N){var O=es();return N.copyTo(O),this.reduce(O),O}function eY(N){for(;N.t<=this.mt2;)N.data[N.t++]=0;for(var O=0;O<this.m.t;++O){var U=32767&N.data[O],$=U*this.mpl+((U*this.mph+(N.data[O]>>15)*this.mpl&this.um)<<15)&N.DM;for(U=O+this.m.t,N.data[U]+=this.m.am(0,$,N,O,0,this.m.t);N.data[U]>=N.DV;)N.data[U]-=N.DV,N.data[++U]++}N.clamp(),N.drShiftTo(this.m.t,N),N.compareTo(this.m)>=0&&N.subTo(this.m,N)}function eX(N,O){N.squareTo(O),this.reduce(O)}function eJ(N,O,U){N.multiplyTo(O,U),this.reduce(U)}function eZ(){return(this.t>0?1&this.data[0]:this.s)==0}function e0(N,O){if(N>4294967295||N<1)return en.ONE;var U=es(),$=es(),Y=O.convert(this),X=eA(N)-1;for(Y.copyTo(U);--X>=0;)if(O.sqrTo(U,$),(N&1<<X)>0)O.mulTo($,Y,U);else{var J=U;U=$,$=J}return O.revert(U)}function e3(N,O){var U;return U=N<256||O.isEven()?new eV(O):new eH(O),this.exp(N,U)}function e5(){var N=es();return this.copyTo(N),N}function e6(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return -1}else if(1==this.t)return this.data[0];else if(0==this.t)return 0;return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function e7(){return 0==this.t?this.s:this.data[0]<<24>>24}function e9(){return 0==this.t?this.s:this.data[0]<<16>>16}function te(N){return Math.floor(Math.LN2*this.DB/Math.log(N))}function tt(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1}function tr(N){if(null==N&&(N=10),0==this.signum()||N<2||N>36)return"0";var O=this.chunkSize(N),U=Math.pow(N,O),$=eE(U),Y=es(),X=es(),J="";for(this.divRemTo($,Y,X);Y.signum()>0;)J=(U+X.intValue()).toString(N).substr(1)+J,Y.divRemTo($,Y,X);return X.intValue().toString(N)+J}function ti(N,O){this.fromInt(0),null==O&&(O=10);for(var U=this.chunkSize(O),$=Math.pow(O,U),Y=!1,X=0,J=0,Z=0;Z<N.length;++Z){var es=ey(N,Z);if(es<0){"-"==N.charAt(Z)&&0==this.signum()&&(Y=!0);continue}J=O*J+es,++X>=U&&(this.dMultiply($),this.dAddOffset(J,0),X=0,J=0)}X>0&&(this.dMultiply(Math.pow(O,X)),this.dAddOffset(J,0)),Y&&en.ZERO.subTo(this,this)}function tn(N,O,U){if("number"==typeof O){if(N<2)this.fromInt(1);else for(this.fromNumber(N,U),this.testBit(N-1)||this.bitwiseTo(en.ONE.shiftLeft(N-1),tg,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(O);)this.dAddOffset(2,0),this.bitLength()>N&&this.subTo(en.ONE.shiftLeft(N-1),this)}else{var $=[],Y=7&N;$.length=(N>>3)+1,O.nextBytes($),Y>0?$[0]&=(1<<Y)-1:$[0]=0,this.fromString($,256)}}function ta(){var N=this.t,O=[];O[0]=this.s;var U,$=this.DB-N*this.DB%8,Y=0;if(N-- >0)for($<this.DB&&(U=this.data[N]>>$)!=(this.s&this.DM)>>$&&(O[Y++]=U|this.s<<this.DB-$);N>=0;)$<8?U=(this.data[N]&(1<<$)-1)<<8-$|this.data[--N]>>($+=this.DB-8):(U=this.data[N]>>($-=8)&255,$<=0&&($+=this.DB,--N)),(128&U)!=0&&(U|=-256),0==Y&&(128&this.s)!=(128&U)&&++Y,(Y>0||U!=this.s)&&(O[Y++]=U);return O}function tl(N){return 0==this.compareTo(N)}function tu(N){return 0>this.compareTo(N)?this:N}function th(N){return this.compareTo(N)>0?this:N}function td(N,O,U){var $,Y,X=Math.min(N.t,this.t);for($=0;$<X;++$)U.data[$]=O(this.data[$],N.data[$]);if(N.t<this.t){for(Y=N.s&this.DM,$=X;$<this.t;++$)U.data[$]=O(this.data[$],Y);U.t=this.t}else{for(Y=this.s&this.DM,$=X;$<N.t;++$)U.data[$]=O(Y,N.data[$]);U.t=N.t}U.s=O(this.s,N.s),U.clamp()}function tp(N,O){return N&O}function tf(N){var O=es();return this.bitwiseTo(N,tp,O),O}function tg(N,O){return N|O}function ty(N){var O=es();return this.bitwiseTo(N,tg,O),O}function tm(N,O){return N^O}function tb(N){var O=es();return this.bitwiseTo(N,tm,O),O}function tw(N,O){return N&~O}function tv(N){var O=es();return this.bitwiseTo(N,tw,O),O}function tE(){for(var N=es(),O=0;O<this.t;++O)N.data[O]=this.DM&~this.data[O];return N.t=this.t,N.s=~this.s,N}function t_(N){var O=es();return N<0?this.rShiftTo(-N,O):this.lShiftTo(N,O),O}function tS(N){var O=es();return N<0?this.lShiftTo(-N,O):this.rShiftTo(N,O),O}function tI(N){if(0==N)return -1;var O=0;return(65535&N)==0&&(N>>=16,O+=16),(255&N)==0&&(N>>=8,O+=8),(15&N)==0&&(N>>=4,O+=4),(3&N)==0&&(N>>=2,O+=2),(1&N)==0&&++O,O}function tR(){for(var N=0;N<this.t;++N)if(0!=this.data[N])return N*this.DB+tI(this.data[N]);return this.s<0?this.t*this.DB:-1}function tk(N){for(var O=0;0!=N;)N&=N-1,++O;return O}function tD(){for(var N=0,O=this.s&this.DM,U=0;U<this.t;++U)N+=tk(this.data[U]^O);return N}function tA(N){var O=Math.floor(N/this.DB);return O>=this.t?0!=this.s:(this.data[O]&1<<N%this.DB)!=0}function tT(N,O){var U=en.ONE.shiftLeft(N);return this.bitwiseTo(U,O,U),U}function tC(N){return this.changeBit(N,tg)}function tP(N){return this.changeBit(N,tw)}function tx(N){return this.changeBit(N,tm)}function tN(N,O){for(var U=0,$=0,Y=Math.min(N.t,this.t);U<Y;)$+=this.data[U]+N.data[U],O.data[U++]=$&this.DM,$>>=this.DB;if(N.t<this.t){for($+=N.s;U<this.t;)$+=this.data[U],O.data[U++]=$&this.DM,$>>=this.DB;$+=this.s}else{for($+=this.s;U<N.t;)$+=N.data[U],O.data[U++]=$&this.DM,$>>=this.DB;$+=N.s}O.s=$<0?-1:0,$>0?O.data[U++]=$:$<-1&&(O.data[U++]=this.DV+$),O.t=U,O.clamp()}function tB(N){var O=es();return this.addTo(N,O),O}function tL(N){var O=es();return this.subTo(N,O),O}function tO(N){var O=es();return this.multiplyTo(N,O),O}function tM(N){var O=es();return this.divRemTo(N,O,null),O}function tU(N){var O=es();return this.divRemTo(N,null,O),O}function tF(N){var O=es(),U=es();return this.divRemTo(N,O,U),[O,U]}function tV(N){this.data[this.t]=this.am(0,N-1,this,0,0,this.t),++this.t,this.clamp()}function tz(N,O){if(0!=N){for(;this.t<=O;)this.data[this.t++]=0;for(this.data[O]+=N;this.data[O]>=this.DV;)this.data[O]-=this.DV,++O>=this.t&&(this.data[this.t++]=0),++this.data[O]}}function t$(){}function tK(N){return N}function tq(N,O,U){N.multiplyTo(O,U)}function tj(N,O){N.squareTo(O)}function tW(N){return this.exp(N,new t$)}function tH(N,O,U){var $,Y=Math.min(this.t+N.t,O);for(U.s=0,U.t=Y;Y>0;)U.data[--Y]=0;for($=U.t-this.t;Y<$;++Y)U.data[Y+this.t]=this.am(0,N.data[Y],U,Y,0,this.t);for($=Math.min(N.t,O);Y<$;++Y)this.am(0,N.data[Y],U,Y,0,O-Y);U.clamp()}function tG(N,O,U){--O;var $=U.t=this.t+N.t-O;for(U.s=0;--$>=0;)U.data[$]=0;for($=Math.max(O-this.t,0);$<N.t;++$)U.data[this.t+$-O]=this.am(O-$,N.data[$],U,0,0,this.t+$-O);U.clamp(),U.drShiftTo(1,U)}function tQ(N){this.r2=es(),this.q3=es(),en.ONE.dlShiftTo(2*N.t,this.r2),this.mu=this.r2.divide(N),this.m=N}function tY(N){if(N.s<0||N.t>2*this.m.t)return N.mod(this.m);if(0>N.compareTo(this.m))return N;var O=es();return N.copyTo(O),this.reduce(O),O}function tX(N){return N}function tJ(N){for(N.drShiftTo(this.m.t-1,this.r2),N.t>this.m.t+1&&(N.t=this.m.t+1,N.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>N.compareTo(this.r2);)N.dAddOffset(1,this.m.t+1);for(N.subTo(this.r2,N);N.compareTo(this.m)>=0;)N.subTo(this.m,N)}function tZ(N,O){N.squareTo(O),this.reduce(O)}function ri(N,O,U){N.multiplyTo(O,U),this.reduce(U)}function rn(N,O){var U,$,Y=N.bitLength(),X=eE(1);if(Y<=0)return X;U=Y<18?1:Y<48?3:Y<144?4:Y<768?5:6,$=Y<8?new eV(O):O.isEven()?new tQ(O):new eH(O);var J=[],Z=3,en=U-1,eo=(1<<U)-1;if(J[1]=$.convert(this),U>1){var ea=es();for($.sqrTo(J[1],ea);Z<=eo;)J[Z]=es(),$.mulTo(ea,J[Z-2],J[Z]),Z+=2}var ec,eu,eh=N.t-1,ef=!0,eg=es();for(Y=eA(N.data[eh])-1;eh>=0;){for(Y>=en?ec=N.data[eh]>>Y-en&eo:(ec=(N.data[eh]&(1<<Y+1)-1)<<en-Y,eh>0&&(ec|=N.data[eh-1]>>this.DB+Y-en)),Z=U;(1&ec)==0;)ec>>=1,--Z;if((Y-=Z)<0&&(Y+=this.DB,--eh),ef)J[ec].copyTo(X),ef=!1;else{for(;Z>1;)$.sqrTo(X,eg),$.sqrTo(eg,X),Z-=2;Z>0?$.sqrTo(X,eg):(eu=X,X=eg,eg=eu),$.mulTo(eg,J[ec],X)}for(;eh>=0&&(N.data[eh]&1<<Y)==0;)$.sqrTo(X,eg),eu=X,X=eg,eg=eu,--Y<0&&(Y=this.DB-1,--eh)}return $.revert(X)}function ro(N){var O=this.s<0?this.negate():this.clone(),U=N.s<0?N.negate():N.clone();if(0>O.compareTo(U)){var $=O;O=U,U=$}var Y=O.getLowestSetBit(),X=U.getLowestSetBit();if(X<0)return O;for(Y<X&&(X=Y),X>0&&(O.rShiftTo(X,O),U.rShiftTo(X,U));O.signum()>0;)(Y=O.getLowestSetBit())>0&&O.rShiftTo(Y,O),(Y=U.getLowestSetBit())>0&&U.rShiftTo(Y,U),O.compareTo(U)>=0?(O.subTo(U,O),O.rShiftTo(1,O)):(U.subTo(O,U),U.rShiftTo(1,U));return X>0&&U.lShiftTo(X,U),U}function ra(N){if(N<=0)return 0;var O=this.DV%N,U=this.s<0?N-1:0;if(this.t>0){if(0==O)U=this.data[0]%N;else for(var $=this.t-1;$>=0;--$)U=(O*U+this.data[$])%N}return U}function rl(N){var O=N.isEven();if(this.isEven()&&O||0==N.signum())return en.ZERO;for(var U=N.clone(),$=this.clone(),Y=eE(1),X=eE(0),J=eE(0),Z=eE(1);0!=U.signum();){for(;U.isEven();)U.rShiftTo(1,U),O?(Y.isEven()&&X.isEven()||(Y.addTo(this,Y),X.subTo(N,X)),Y.rShiftTo(1,Y)):X.isEven()||X.subTo(N,X),X.rShiftTo(1,X);for(;$.isEven();)$.rShiftTo(1,$),O?(J.isEven()&&Z.isEven()||(J.addTo(this,J),Z.subTo(N,Z)),J.rShiftTo(1,J)):Z.isEven()||Z.subTo(N,Z),Z.rShiftTo(1,Z);U.compareTo($)>=0?(U.subTo($,U),O&&Y.subTo(J,Y),X.subTo(Z,X)):($.subTo(U,$),O&&J.subTo(Y,J),Z.subTo(X,Z))}return 0!=$.compareTo(en.ONE)?en.ZERO:Z.compareTo(N)>=0?Z.subtract(N):0>Z.signum()&&(Z.addTo(N,Z),0>Z.signum())?Z.add(N):Z}eV.prototype.convert=ez,eV.prototype.revert=e$,eV.prototype.reduce=eK,eV.prototype.mulTo=eq,eV.prototype.sqrTo=ej,eH.prototype.convert=eG,eH.prototype.revert=eQ,eH.prototype.reduce=eY,eH.prototype.mulTo=eJ,eH.prototype.sqrTo=eX,en.prototype.copyTo=ew,en.prototype.fromInt=ev,en.prototype.fromString=e_,en.prototype.clamp=eS,en.prototype.dlShiftTo=eC,en.prototype.drShiftTo=eP,en.prototype.lShiftTo=eN,en.prototype.rShiftTo=eB,en.prototype.subTo=eL,en.prototype.multiplyTo=eO,en.prototype.squareTo=eM,en.prototype.divRemTo=eU,en.prototype.invDigit=eW,en.prototype.isEven=eZ,en.prototype.exp=e0,en.prototype.toString=eI,en.prototype.negate=eR,en.prototype.abs=ek,en.prototype.compareTo=eD,en.prototype.bitLength=eT,en.prototype.mod=eF,en.prototype.modPowInt=e3,en.ZERO=eE(0),en.ONE=eE(1),t$.prototype.convert=tK,t$.prototype.revert=tK,t$.prototype.mulTo=tq,t$.prototype.sqrTo=tj,tQ.prototype.convert=tY,tQ.prototype.revert=tX,tQ.prototype.reduce=tJ,tQ.prototype.mulTo=ri,tQ.prototype.sqrTo=tZ;var rc=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],ru=67108864/rc[rc.length-1];function rh(N){var O,U=this.abs();if(1==U.t&&U.data[0]<=rc[rc.length-1]){for(O=0;O<rc.length;++O)if(U.data[0]==rc[O])return!0;return!1}if(U.isEven())return!1;for(O=1;O<rc.length;){for(var $=rc[O],Y=O+1;Y<rc.length&&$<ru;)$*=rc[Y++];for($=U.modInt($);O<Y;)if($%rc[O++]==0)return!1}return U.millerRabin(N)}function rd(N){var O,U=this.subtract(en.ONE),$=U.getLowestSetBit();if($<=0)return!1;for(var Y=U.shiftRight($),X=rp(),J=0;J<N;++J){do O=new en(this.bitLength(),X);while(0>=O.compareTo(en.ONE)||O.compareTo(U)>=0);var Z=O.modPow(Y,this);if(0!=Z.compareTo(en.ONE)&&0!=Z.compareTo(U)){for(var es=1;es++<$&&0!=Z.compareTo(U);)if(0==(Z=Z.modPowInt(2,this)).compareTo(en.ONE))return!1;if(0!=Z.compareTo(U))return!1}}return!0}function rp(){return{nextBytes:function(N){for(var O=0;O<N.length;++O)N[O]=Math.floor(256*Math.random())}}}en.prototype.chunkSize=te,en.prototype.toRadix=tr,en.prototype.fromRadix=ti,en.prototype.fromNumber=tn,en.prototype.bitwiseTo=td,en.prototype.changeBit=tT,en.prototype.addTo=tN,en.prototype.dMultiply=tV,en.prototype.dAddOffset=tz,en.prototype.multiplyLowerTo=tH,en.prototype.multiplyUpperTo=tG,en.prototype.modInt=ra,en.prototype.millerRabin=rd,en.prototype.clone=e5,en.prototype.intValue=e6,en.prototype.byteValue=e7,en.prototype.shortValue=e9,en.prototype.signum=tt,en.prototype.toByteArray=ta,en.prototype.equals=tl,en.prototype.min=tu,en.prototype.max=th,en.prototype.and=tf,en.prototype.or=ty,en.prototype.xor=tb,en.prototype.andNot=tv,en.prototype.not=tE,en.prototype.shiftLeft=t_,en.prototype.shiftRight=tS,en.prototype.getLowestSetBit=tR,en.prototype.bitCount=tD,en.prototype.testBit=tA,en.prototype.setBit=tC,en.prototype.clearBit=tP,en.prototype.flipBit=tx,en.prototype.add=tB,en.prototype.subtract=tL,en.prototype.multiply=tO,en.prototype.divide=tM,en.prototype.remainder=tU,en.prototype.divideAndRemainder=tF,en.prototype.modPow=rn,en.prototype.modInverse=rl,en.prototype.pow=tW,en.prototype.gcd=ro,en.prototype.isProbablePrime=rh},8991:function(N,O,U){var $=U(3832);N.exports=$.md=$.md||{},$.md.algorithms=$.md.algorithms||{}},6270:function(N,O,U){var $=U(3832);$.pki=$.pki||{};var Y=N.exports=$.pki.oids=$.oids=$.oids||{};function X(N,O){Y[N]=O,Y[O]=N}function J(N,O){Y[N]=O}X("1.2.840.113549.1.1.1","rsaEncryption"),X("1.2.840.113549.1.1.4","md5WithRSAEncryption"),X("1.2.840.113549.1.1.5","sha1WithRSAEncryption"),X("1.2.840.113549.1.1.7","RSAES-OAEP"),X("1.2.840.113549.1.1.8","mgf1"),X("1.2.840.113549.1.1.9","pSpecified"),X("1.2.840.113549.1.1.10","RSASSA-PSS"),X("1.2.840.113549.1.1.11","sha256WithRSAEncryption"),X("1.2.840.113549.1.1.12","sha384WithRSAEncryption"),X("1.2.840.113549.1.1.13","sha512WithRSAEncryption"),X("1.3.101.112","EdDSA25519"),X("1.2.840.10040.4.3","dsa-with-sha1"),X("1.3.14.3.2.7","desCBC"),X("1.3.14.3.2.26","sha1"),X("1.3.14.3.2.29","sha1WithRSASignature"),X("2.16.840.1.101.3.4.2.1","sha256"),X("2.16.840.1.101.3.4.2.2","sha384"),X("2.16.840.1.101.3.4.2.3","sha512"),X("2.16.840.1.101.3.4.2.4","sha224"),X("2.16.840.1.101.3.4.2.5","sha512-224"),X("2.16.840.1.101.3.4.2.6","sha512-256"),X("1.2.840.113549.2.2","md2"),X("1.2.840.113549.2.5","md5"),X("1.2.840.113549.1.7.1","data"),X("1.2.840.113549.1.7.2","signedData"),X("1.2.840.113549.1.7.3","envelopedData"),X("1.2.840.113549.1.7.4","signedAndEnvelopedData"),X("1.2.840.113549.1.7.5","digestedData"),X("1.2.840.113549.1.7.6","encryptedData"),X("1.2.840.113549.1.9.1","emailAddress"),X("1.2.840.113549.1.9.2","unstructuredName"),X("1.2.840.113549.1.9.3","contentType"),X("1.2.840.113549.1.9.4","messageDigest"),X("1.2.840.113549.1.9.5","signingTime"),X("1.2.840.113549.1.9.6","counterSignature"),X("1.2.840.113549.1.9.7","challengePassword"),X("1.2.840.113549.1.9.8","unstructuredAddress"),X("1.2.840.113549.1.9.14","extensionRequest"),X("1.2.840.113549.1.9.20","friendlyName"),X("1.2.840.113549.1.9.21","localKeyId"),X("1.2.840.113549.1.9.22.1","x509Certificate"),X("1.2.840.113549.1.12.10.1.1","keyBag"),X("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),X("1.2.840.113549.1.12.10.1.3","certBag"),X("1.2.840.113549.1.12.10.1.4","crlBag"),X("1.2.840.113549.1.12.10.1.5","secretBag"),X("1.2.840.113549.1.12.10.1.6","safeContentsBag"),X("1.2.840.113549.1.5.13","pkcs5PBES2"),X("1.2.840.113549.1.5.12","pkcs5PBKDF2"),X("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4"),X("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4"),X("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC"),X("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC"),X("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC"),X("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC"),X("1.2.840.113549.2.7","hmacWithSHA1"),X("1.2.840.113549.2.8","hmacWithSHA224"),X("1.2.840.113549.2.9","hmacWithSHA256"),X("1.2.840.113549.2.10","hmacWithSHA384"),X("1.2.840.113549.2.11","hmacWithSHA512"),X("1.2.840.113549.3.7","des-EDE3-CBC"),X("2.16.840.1.101.3.4.1.2","aes128-CBC"),X("2.16.840.1.101.3.4.1.22","aes192-CBC"),X("2.16.840.1.101.3.4.1.42","aes256-CBC"),X("2.5.4.3","commonName"),X("2.5.4.4","surname"),X("2.5.4.5","serialNumber"),X("2.5.4.6","countryName"),X("2.5.4.7","localityName"),X("2.5.4.8","stateOrProvinceName"),X("2.5.4.9","streetAddress"),X("2.5.4.10","organizationName"),X("2.5.4.11","organizationalUnitName"),X("2.5.4.12","title"),X("2.5.4.13","description"),X("2.5.4.15","businessCategory"),X("2.5.4.17","postalCode"),X("2.5.4.42","givenName"),X("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName"),X("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName"),X("2.16.840.1.113730.1.1","nsCertType"),X("2.16.840.1.113730.1.13","nsComment"),J("2.5.29.1","authorityKeyIdentifier"),J("2.5.29.2","keyAttributes"),J("2.5.29.3","certificatePolicies"),J("2.5.29.4","keyUsageRestriction"),J("2.5.29.5","policyMapping"),J("2.5.29.6","subtreesConstraint"),J("2.5.29.7","subjectAltName"),J("2.5.29.8","issuerAltName"),J("2.5.29.9","subjectDirectoryAttributes"),J("2.5.29.10","basicConstraints"),J("2.5.29.11","nameConstraints"),J("2.5.29.12","policyConstraints"),J("2.5.29.13","basicConstraints"),X("2.5.29.14","subjectKeyIdentifier"),X("2.5.29.15","keyUsage"),J("2.5.29.16","privateKeyUsagePeriod"),X("2.5.29.17","subjectAltName"),X("2.5.29.18","issuerAltName"),X("2.5.29.19","basicConstraints"),J("2.5.29.20","cRLNumber"),J("2.5.29.21","cRLReason"),J("2.5.29.22","expirationDate"),J("2.5.29.23","instructionCode"),J("2.5.29.24","invalidityDate"),J("2.5.29.25","cRLDistributionPoints"),J("2.5.29.26","issuingDistributionPoint"),J("2.5.29.27","deltaCRLIndicator"),J("2.5.29.28","issuingDistributionPoint"),J("2.5.29.29","certificateIssuer"),J("2.5.29.30","nameConstraints"),X("2.5.29.31","cRLDistributionPoints"),X("2.5.29.32","certificatePolicies"),J("2.5.29.33","policyMappings"),J("2.5.29.34","policyConstraints"),X("2.5.29.35","authorityKeyIdentifier"),J("2.5.29.36","policyConstraints"),X("2.5.29.37","extKeyUsage"),J("2.5.29.46","freshestCRL"),J("2.5.29.54","inhibitAnyPolicy"),X("1.3.6.1.4.1.11129.2.4.2","timestampList"),X("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),X("1.3.6.1.5.5.7.3.1","serverAuth"),X("1.3.6.1.5.5.7.3.2","clientAuth"),X("1.3.6.1.5.5.7.3.3","codeSigning"),X("1.3.6.1.5.5.7.3.4","emailProtection"),X("1.3.6.1.5.5.7.3.8","timeStamping")},7450:function(N,O,U){var $=U(3832);if(U(8925),U(3068),U(3480),U(8991),U(6270),U(8960),U(6953),U(9563),U(9372),U(8095),U(7116),void 0===Y)var Y=$.jsbn.BigInteger;var X=$.asn1,J=$.pki=$.pki||{};N.exports=J.pbe=$.pbe=$.pbe||{};var Z=J.oids,en={name:"EncryptedPrivateKeyInfo",tagClass:X.Class.UNIVERSAL,type:X.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:X.Class.UNIVERSAL,type:X.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:X.Class.UNIVERSAL,type:X.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:X.Class.UNIVERSAL,type:X.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:X.Class.UNIVERSAL,type:X.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},es={name:"PBES2Algorithms",tagClass:X.Class.UNIVERSAL,type:X.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:X.Class.UNIVERSAL,type:X.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:X.Class.UNIVERSAL,type:X.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:X.Class.UNIVERSAL,type:X.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:X.Class.UNIVERSAL,type:X.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:X.Class.UNIVERSAL,type:X.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:X.Class.UNIVERSAL,type:X.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:X.Class.UNIVERSAL,type:X.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:X.Class.UNIVERSAL,type:X.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:X.Class.UNIVERSAL,type:X.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:X.Class.UNIVERSAL,type:X.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:X.Class.UNIVERSAL,type:X.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},eo={name:"pkcs-12PbeParams",tagClass:X.Class.UNIVERSAL,type:X.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:X.Class.UNIVERSAL,type:X.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:X.Class.UNIVERSAL,type:X.Type.INTEGER,constructed:!1,capture:"iterations"}]};function ea(N,O){return N.start().update(O).digest().getBytes()}function ec(N){var O;if(N){if(!(O=J.oids[X.derToOid(N)])){var U=Error("Unsupported PRF OID.");throw U.oid=N,U.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],U}}else O="hmacWithSHA1";return eu(O)}function eu(N){var O=$.md;switch(N){case"hmacWithSHA224":O=$.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":N=N.substr(8).toLowerCase();break;default:var U=Error("Unsupported PRF algorithm.");throw U.algorithm=N,U.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],U}if(!O||!(N in O))throw Error("Unknown hash algorithm: "+N);return O[N].create()}function eh(N,O,U,Y){var Z=X.create(X.Class.UNIVERSAL,X.Type.SEQUENCE,!0,[X.create(X.Class.UNIVERSAL,X.Type.OCTETSTRING,!1,N),X.create(X.Class.UNIVERSAL,X.Type.INTEGER,!1,O.getBytes())]);return"hmacWithSHA1"!==Y&&Z.value.push(X.create(X.Class.UNIVERSAL,X.Type.INTEGER,!1,$.util.hexToBytes(U.toString(16))),X.create(X.Class.UNIVERSAL,X.Type.SEQUENCE,!0,[X.create(X.Class.UNIVERSAL,X.Type.OID,!1,X.oidToDer(J.oids[Y]).getBytes()),X.create(X.Class.UNIVERSAL,X.Type.NULL,!1,"")])),Z}J.encryptPrivateKeyInfo=function(N,O,U){(U=U||{}).saltSize=U.saltSize||8,U.count=U.count||2048,U.algorithm=U.algorithm||"aes128",U.prfAlgorithm=U.prfAlgorithm||"sha1";var Y=$.random.getBytesSync(U.saltSize),en=U.count,es=X.integerToDer(en);if(0===U.algorithm.indexOf("aes")||"des"===U.algorithm){switch(U.algorithm){case"aes128":eo=16,ef=16,eg=Z["aes128-CBC"],ey=$.aes.createEncryptionCipher;break;case"aes192":eo=24,ef=16,eg=Z["aes192-CBC"],ey=$.aes.createEncryptionCipher;break;case"aes256":eo=32,ef=16,eg=Z["aes256-CBC"],ey=$.aes.createEncryptionCipher;break;case"des":eo=8,ef=8,eg=Z.desCBC,ey=$.des.createEncryptionCipher;break;default:var eo,ea,ec,ef,eg,ey,ew=Error("Cannot encrypt private key. Unknown encryption algorithm.");throw ew.algorithm=U.algorithm,ew}var ev="hmacWith"+U.prfAlgorithm.toUpperCase(),eE=eu(ev),e_=$.pkcs5.pbkdf2(O,Y,en,eo,eE),eS=$.random.getBytesSync(ef),eI=ey(e_);eI.start(eS),eI.update(X.toDer(N)),eI.finish(),ec=eI.output.getBytes();var eR=eh(Y,es,eo,ev);ea=X.create(X.Class.UNIVERSAL,X.Type.SEQUENCE,!0,[X.create(X.Class.UNIVERSAL,X.Type.OID,!1,X.oidToDer(Z.pkcs5PBES2).getBytes()),X.create(X.Class.UNIVERSAL,X.Type.SEQUENCE,!0,[X.create(X.Class.UNIVERSAL,X.Type.SEQUENCE,!0,[X.create(X.Class.UNIVERSAL,X.Type.OID,!1,X.oidToDer(Z.pkcs5PBKDF2).getBytes()),eR]),X.create(X.Class.UNIVERSAL,X.Type.SEQUENCE,!0,[X.create(X.Class.UNIVERSAL,X.Type.OID,!1,X.oidToDer(eg).getBytes()),X.create(X.Class.UNIVERSAL,X.Type.OCTETSTRING,!1,eS)])])])}else if("3des"===U.algorithm){eo=24;var ek=new $.util.ByteBuffer(Y),e_=J.pbe.generatePkcs12Key(O,ek,1,en,eo),eS=J.pbe.generatePkcs12Key(O,ek,2,en,eo),eI=$.des.createEncryptionCipher(e_);eI.start(eS),eI.update(X.toDer(N)),eI.finish(),ec=eI.output.getBytes(),ea=X.create(X.Class.UNIVERSAL,X.Type.SEQUENCE,!0,[X.create(X.Class.UNIVERSAL,X.Type.OID,!1,X.oidToDer(Z["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),X.create(X.Class.UNIVERSAL,X.Type.SEQUENCE,!0,[X.create(X.Class.UNIVERSAL,X.Type.OCTETSTRING,!1,Y),X.create(X.Class.UNIVERSAL,X.Type.INTEGER,!1,es.getBytes())])])}else{var ew=Error("Cannot encrypt private key. Unknown encryption algorithm.");throw ew.algorithm=U.algorithm,ew}return X.create(X.Class.UNIVERSAL,X.Type.SEQUENCE,!0,[ea,X.create(X.Class.UNIVERSAL,X.Type.OCTETSTRING,!1,ec)])},J.decryptPrivateKeyInfo=function(N,O){var U=null,Y={},Z=[];if(!X.validate(N,en,Y,Z)){var es=Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw es.errors=Z,es}var eo=X.derToOid(Y.encryptionOid),ea=J.pbe.getCipher(eo,Y.encryptionParams,O),ec=$.util.createBuffer(Y.encryptedData);return ea.update(ec),ea.finish()&&(U=X.fromDer(ea.output)),U},J.encryptedPrivateKeyToPem=function(N,O){var U={type:"ENCRYPTED PRIVATE KEY",body:X.toDer(N).getBytes()};return $.pem.encode(U,{maxline:O})},J.encryptedPrivateKeyFromPem=function(N){var O=$.pem.decode(N)[0];if("ENCRYPTED PRIVATE KEY"!==O.type){var U=Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw U.headerType=O.type,U}if(O.procType&&"ENCRYPTED"===O.procType.type)throw Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return X.fromDer(O.body)},J.encryptRsaPrivateKey=function(N,O,U){if(!(U=U||{}).legacy){var Y,Z,en,es,eo=J.wrapRsaPrivateKey(J.privateKeyToAsn1(N));return eo=J.encryptPrivateKeyInfo(eo,O,U),J.encryptedPrivateKeyToPem(eo)}switch(U.algorithm){case"aes128":Y="AES-128-CBC",en=16,Z=$.random.getBytesSync(16),es=$.aes.createEncryptionCipher;break;case"aes192":Y="AES-192-CBC",en=24,Z=$.random.getBytesSync(16),es=$.aes.createEncryptionCipher;break;case"aes256":Y="AES-256-CBC",en=32,Z=$.random.getBytesSync(16),es=$.aes.createEncryptionCipher;break;case"3des":Y="DES-EDE3-CBC",en=24,Z=$.random.getBytesSync(8),es=$.des.createEncryptionCipher;break;case"des":Y="DES-CBC",en=8,Z=$.random.getBytesSync(8),es=$.des.createEncryptionCipher;break;default:var ea=Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+U.algorithm+'".');throw ea.algorithm=U.algorithm,ea}var ec=es($.pbe.opensslDeriveBytes(O,Z.substr(0,8),en));ec.start(Z),ec.update(X.toDer(J.privateKeyToAsn1(N))),ec.finish();var eu={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:Y,parameters:$.util.bytesToHex(Z).toUpperCase()},body:ec.output.getBytes()};return $.pem.encode(eu)},J.decryptRsaPrivateKey=function(N,O){var U=null,Y=$.pem.decode(N)[0];if("ENCRYPTED PRIVATE KEY"!==Y.type&&"PRIVATE KEY"!==Y.type&&"RSA PRIVATE KEY"!==Y.type){var Z=Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw Z.headerType=Z,Z}if(Y.procType&&"ENCRYPTED"===Y.procType.type){switch(Y.dekInfo.algorithm){case"DES-CBC":en=8,es=$.des.createDecryptionCipher;break;case"DES-EDE3-CBC":en=24,es=$.des.createDecryptionCipher;break;case"AES-128-CBC":en=16,es=$.aes.createDecryptionCipher;break;case"AES-192-CBC":en=24,es=$.aes.createDecryptionCipher;break;case"AES-256-CBC":en=32,es=$.aes.createDecryptionCipher;break;case"RC2-40-CBC":en=5,es=function(N){return $.rc2.createDecryptionCipher(N,40)};break;case"RC2-64-CBC":en=8,es=function(N){return $.rc2.createDecryptionCipher(N,64)};break;case"RC2-128-CBC":en=16,es=function(N){return $.rc2.createDecryptionCipher(N,128)};break;default:var en,es,Z=Error('Could not decrypt private key; unsupported encryption algorithm "'+Y.dekInfo.algorithm+'".');throw Z.algorithm=Y.dekInfo.algorithm,Z}var eo=$.util.hexToBytes(Y.dekInfo.parameters),ea=es($.pbe.opensslDeriveBytes(O,eo.substr(0,8),en));if(ea.start(eo),ea.update($.util.createBuffer(Y.body)),!ea.finish())return U;U=ea.output.getBytes()}else U=Y.body;return null!==(U="ENCRYPTED PRIVATE KEY"===Y.type?J.decryptPrivateKeyInfo(X.fromDer(U),O):X.fromDer(U))&&(U=J.privateKeyFromAsn1(U)),U},J.pbe.generatePkcs12Key=function(N,O,U,Y,X,J){if(null==J){if(!("sha1"in $.md))throw Error('"sha1" hash algorithm unavailable.');J=$.md.sha1.create()}var Z,en,es=J.digestLength,eo=J.blockLength,ea=new $.util.ByteBuffer,ec=new $.util.ByteBuffer;if(null!=N){for(en=0;en<N.length;en++)ec.putInt16(N.charCodeAt(en));ec.putInt16(0)}var eu=ec.length(),eh=O.length(),ef=new $.util.ByteBuffer;ef.fillWithByte(U,eo);var eg=eo*Math.ceil(eh/eo),ey=new $.util.ByteBuffer;for(en=0;en<eg;en++)ey.putByte(O.at(en%eh));var ew=eo*Math.ceil(eu/eo),ev=new $.util.ByteBuffer;for(en=0;en<ew;en++)ev.putByte(ec.at(en%eu));var eE=ey;eE.putBuffer(ev);for(var e_=Math.ceil(X/es),eS=1;eS<=e_;eS++){var eI=new $.util.ByteBuffer;eI.putBytes(ef.bytes()),eI.putBytes(eE.bytes());for(var eR=0;eR<Y;eR++)J.start(),J.update(eI.getBytes()),eI=J.digest();var ek=new $.util.ByteBuffer;for(en=0;en<eo;en++)ek.putByte(eI.at(en%es));var eD=Math.ceil(eh/eo)+Math.ceil(eu/eo),eA=new $.util.ByteBuffer;for(Z=0;Z<eD;Z++){var eT=new $.util.ByteBuffer(eE.getBytes(eo)),eC=511;for(en=ek.length()-1;en>=0;en--)eC>>=8,eC+=ek.at(en)+eT.at(en),eT.setAt(en,255&eC);eA.putBuffer(eT)}eE=eA,ea.putBuffer(eI)}return ea.truncate(ea.length()-X),ea},J.pbe.getCipher=function(N,O,U){switch(N){case J.oids.pkcs5PBES2:return J.pbe.getCipherForPBES2(N,O,U);case J.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case J.oids["pbewithSHAAnd40BitRC2-CBC"]:return J.pbe.getCipherForPKCS12PBE(N,O,U);default:var $=Error("Cannot read encrypted PBE data block. Unsupported OID.");throw $.oid=N,$.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],$}},J.pbe.getCipherForPBES2=function(N,O,U){var Y,Z,en={},eo=[];if(!X.validate(O,es,en,eo)){var ea=Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw ea.errors=eo,ea}if((N=X.derToOid(en.kdfOid))!==J.oids.pkcs5PBKDF2){var ea=Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw ea.oid=N,ea.supportedOids=["pkcs5PBKDF2"],ea}if((N=X.derToOid(en.encOid))!==J.oids["aes128-CBC"]&&N!==J.oids["aes192-CBC"]&&N!==J.oids["aes256-CBC"]&&N!==J.oids["des-EDE3-CBC"]&&N!==J.oids.desCBC){var ea=Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw ea.oid=N,ea.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],ea}var eu=en.kdfSalt,eh=$.util.createBuffer(en.kdfIterationCount);switch(eh=eh.getInt(eh.length()<<3),J.oids[N]){case"aes128-CBC":Y=16,Z=$.aes.createDecryptionCipher;break;case"aes192-CBC":Y=24,Z=$.aes.createDecryptionCipher;break;case"aes256-CBC":Y=32,Z=$.aes.createDecryptionCipher;break;case"des-EDE3-CBC":Y=24,Z=$.des.createDecryptionCipher;break;case"desCBC":Y=8,Z=$.des.createDecryptionCipher}var ef=ec(en.prfOid),eg=$.pkcs5.pbkdf2(U,eu,eh,Y,ef),ey=en.encIv,ew=Z(eg);return ew.start(ey),ew},J.pbe.getCipherForPKCS12PBE=function(N,O,U){var Y,Z,en,es={},ea=[];if(!X.validate(O,eo,es,ea)){var eu=Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw eu.errors=ea,eu}var eh=$.util.createBuffer(es.salt),ef=$.util.createBuffer(es.iterations);switch(ef=ef.getInt(ef.length()<<3),N){case J.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:Y=24,Z=8,en=$.des.startDecrypting;break;case J.oids["pbewithSHAAnd40BitRC2-CBC"]:Y=5,Z=8,en=function(N,O){var U=$.rc2.createDecryptionCipher(N,40);return U.start(O,null),U};break;default:var eu=Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw eu.oid=N,eu}var eg=ec(es.prfOid),ey=J.pbe.generatePkcs12Key(U,eh,1,ef,Y,eg);return eg.start(),en(ey,J.pbe.generatePkcs12Key(U,eh,2,ef,Z,eg))},J.pbe.opensslDeriveBytes=function(N,O,U,Y){if(null==Y){if(!("md5"in $.md))throw Error('"md5" hash algorithm unavailable.');Y=$.md.md5.create()}null===O&&(O="");for(var X=[ea(Y,N+O)],J=16,Z=1;J<U;++Z,J+=16)X.push(ea(Y,X[Z-1]+N+O));return X.join("").substr(0,U)}},8960:function(N,O,U){var $,Y=U(2678).Buffer,X=U(3832);U(6607),U(8991),U(7116);var J=X.pkcs5=X.pkcs5||{};X.util.isNodejs&&!X.options.usePureJavaScript&&($=U(5819)),N.exports=X.pbkdf2=J.pbkdf2=function(N,O,U,J,Z,en){if("function"==typeof Z&&(en=Z,Z=null),X.util.isNodejs&&!X.options.usePureJavaScript&&$.pbkdf2&&(null===Z||"object"!=typeof Z)&&($.pbkdf2Sync.length>4||!Z||"sha1"===Z))return("string"!=typeof Z&&(Z="sha1"),N=Y.from(N,"binary"),O=Y.from(O,"binary"),en)?4===$.pbkdf2Sync.length?$.pbkdf2(N,O,U,J,function(N,O){if(N)return en(N);en(null,O.toString("binary"))}):$.pbkdf2(N,O,U,J,Z,function(N,O){if(N)return en(N);en(null,O.toString("binary"))}):4===$.pbkdf2Sync.length?$.pbkdf2Sync(N,O,U,J).toString("binary"):$.pbkdf2Sync(N,O,U,J,Z).toString("binary");if(null==Z&&(Z="sha1"),"string"==typeof Z){if(!(Z in X.md.algorithms))throw Error("Unknown hash algorithm: "+Z);Z=X.md[Z].create()}var es=Z.digestLength;if(J>4294967295*es){var eo=Error("Derived key is too long.");if(en)return en(eo);throw eo}var ea=Math.ceil(J/es),ec=J-(ea-1)*es,eu=X.hmac.create();eu.start(Z,N);var eh="";if(!en){for(var ef=1;ef<=ea;++ef){eu.start(null,null),eu.update(O),eu.update(X.util.int32ToBytes(ef)),ey=ev=eu.digest().getBytes();for(var eg=2;eg<=U;++eg)eu.start(null,null),eu.update(ev),ew=eu.digest().getBytes(),ey=X.util.xorBytes(ey,ew,es),ev=ew;eh+=ef<ea?ey:ey.substr(0,ec)}return eh}var ey,ew,ev,eg,ef=1;function eE(){if(ef>ea)return en(null,eh);eu.start(null,null),eu.update(O),eu.update(X.util.int32ToBytes(ef)),ey=ev=eu.digest().getBytes(),eg=2,e_()}function e_(){if(eg<=U)return eu.start(null,null),eu.update(ev),ew=eu.digest().getBytes(),ey=X.util.xorBytes(ey,ew,es),ev=ew,++eg,X.util.setImmediate(e_);eh+=ef<ea?ey:ey.substr(0,ec),++ef,eE()}eE()}},6953:function(N,O,U){var $=U(3832);U(7116);var Y=N.exports=$.pem=$.pem||{};function X(N){for(var O=N.name+": ",U=[],$=function(N,O){return" "+O},Y=0;Y<N.values.length;++Y)U.push(N.values[Y].replace(/^(\S+\r\n)/,$));O+=U.join(",")+"\r\n";for(var X=0,J=-1,Y=0;Y<O.length;++Y,++X)if(X>65&&-1!==J){var Z=O[J];","===Z?(++J,O=O.substr(0,J)+"\r\n "+O.substr(J)):O=O.substr(0,J)+"\r\n"+Z+O.substr(J+1),X=Y-J-1,J=-1,++Y}else(" "===O[Y]||"	"===O[Y]||","===O[Y])&&(J=Y);return O}function J(N){return N.replace(/^\s+/,"")}Y.encode=function(N,O){O=O||{};var U,Y="-----BEGIN "+N.type+"-----\r\n";if(N.procType&&(Y+=X(U={name:"Proc-Type",values:[String(N.procType.version),N.procType.type]})),N.contentDomain&&(Y+=X(U={name:"Content-Domain",values:[N.contentDomain]})),N.dekInfo&&(U={name:"DEK-Info",values:[N.dekInfo.algorithm]},N.dekInfo.parameters&&U.values.push(N.dekInfo.parameters),Y+=X(U)),N.headers)for(var J=0;J<N.headers.length;++J)Y+=X(N.headers[J]);return N.procType&&(Y+="\r\n"),Y+=$.util.encode64(N.body,O.maxline||64)+"\r\n-----END "+N.type+"-----\r\n"},Y.decode=function(N){for(var O,U=[],Y=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,X=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,Z=/\r?\n/;O=Y.exec(N);){var en=O[1];"NEW CERTIFICATE REQUEST"===en&&(en="CERTIFICATE REQUEST");var es={type:en,procType:null,contentDomain:null,dekInfo:null,headers:[],body:$.util.decode64(O[3])};if(U.push(es),O[2]){for(var eo=O[2].split(Z),ea=0;O&&ea<eo.length;){for(var ec=eo[ea].replace(/\s+$/,""),eu=ea+1;eu<eo.length;++eu){var eh=eo[eu];if(!/\s/.test(eh[0]))break;ec+=eh,ea=eu}if(O=ec.match(X)){for(var ef={name:O[1],values:[]},eg=O[2].split(","),ey=0;ey<eg.length;++ey)ef.values.push(J(eg[ey]));if(es.procType){if(es.contentDomain||"Content-Domain"!==ef.name){if(es.dekInfo||"DEK-Info"!==ef.name)es.headers.push(ef);else{if(0===ef.values.length)throw Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');es.dekInfo={algorithm:eg[0],parameters:eg[1]||null}}}else es.contentDomain=eg[0]||""}else{if("Proc-Type"!==ef.name)throw Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==ef.values.length)throw Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');es.procType={version:eg[0],type:eg[1]}}}++ea}if("ENCRYPTED"===es.procType&&!es.dekInfo)throw Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===U.length)throw Error("Invalid PEM formatted message.");return U}},8936:function(N,O,U){var $=U(3832);U(7116),U(9563),U(137);var Y=N.exports=$.pkcs1=$.pkcs1||{};function X(N,O,U){U||(U=$.md.sha1.create());for(var Y="",X=Math.ceil(O/U.digestLength),J=0;J<X;++J){var Z=String.fromCharCode(J>>24&255,J>>16&255,J>>8&255,255&J);U.start(),U.update(N+Z),Y+=U.digest().getBytes()}return Y.substring(0,O)}Y.encode_rsa_oaep=function(N,O,U){"string"==typeof U?(Y=U,J=arguments[3]||void 0,Z=arguments[4]||void 0):U&&(Y=U.label||void 0,J=U.seed||void 0,Z=U.md||void 0,U.mgf1&&U.mgf1.md&&(en=U.mgf1.md)),Z?Z.start():Z=$.md.sha1.create(),en||(en=Z);var Y,J,Z,en,es=Math.ceil(N.n.bitLength()/8),eo=es-2*Z.digestLength-2;if(O.length>eo){var ea=Error("RSAES-OAEP input message length is too long.");throw ea.length=O.length,ea.maxLength=eo,ea}Y||(Y=""),Z.update(Y,"raw");for(var ec=Z.digest(),eu="",eh=eo-O.length,ef=0;ef<eh;ef++)eu+="\x00";var eg=ec.getBytes()+eu+"\x01"+O;if(J){if(J.length!==Z.digestLength){var ea=Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw ea.seedLength=J.length,ea.digestLength=Z.digestLength,ea}}else J=$.random.getBytes(Z.digestLength);var ey=X(J,es-Z.digestLength-1,en),ew=$.util.xorBytes(eg,ey,eg.length),ev=X(ew,Z.digestLength,en);return"\x00"+$.util.xorBytes(J,ev,J.length)+ew},Y.decode_rsa_oaep=function(N,O,U){"string"==typeof U?(Y=U,J=arguments[3]||void 0):U&&(Y=U.label||void 0,J=U.md||void 0,U.mgf1&&U.mgf1.md&&(Z=U.mgf1.md));var Y,J,Z,en=Math.ceil(N.n.bitLength()/8);if(O.length!==en){var es=Error("RSAES-OAEP encoded message length is invalid.");throw es.length=O.length,es.expectedLength=en,es}if(void 0===J?J=$.md.sha1.create():J.start(),Z||(Z=J),en<2*J.digestLength+2)throw Error("RSAES-OAEP key is too short for the hash function.");Y||(Y=""),J.update(Y,"raw");for(var eo=J.digest().getBytes(),ea=O.charAt(0),ec=O.substring(1,J.digestLength+1),eu=O.substring(1+J.digestLength),eh=X(eu,J.digestLength,Z),ef=X($.util.xorBytes(ec,eh,ec.length),en-J.digestLength-1,Z),eg=$.util.xorBytes(eu,ef,eu.length),ey=eg.substring(0,J.digestLength),es="\x00"!==ea,ew=0;ew<J.digestLength;++ew)es|=eo.charAt(ew)!==ey.charAt(ew);for(var ev=1,eE=J.digestLength,e_=J.digestLength;e_<eg.length;e_++){var eS=eg.charCodeAt(e_),eI=1&eS^1;es|=eS&(ev?65534:0),ev&=eI,eE+=ev}if(es||1!==eg.charCodeAt(eE))throw Error("Invalid RSAES-OAEP padding.");return eg.substring(eE+1)}},9654:function(N,O,U){var $=U(3832);U(7116),U(5764),U(9563),function(){if($.prime){N.exports=$.prime;return}var O=N.exports=$.prime=$.prime||{},U=$.jsbn.BigInteger,Y=[6,4,2,4,2,4,6,2],X=new U(null);X.fromInt(30);var J=function(N,O){return N|O};function Z(N,O,U,$){return"workers"in U?eo(N,O,U,$):en(N,O,U,$)}function en(N,O,U,$){var Y=ea(N,O),X=0,J=ec(Y.bitLength());"millerRabinTests"in U&&(J=U.millerRabinTests);var Z=10;"maxBlockTime"in U&&(Z=U.maxBlockTime),es(Y,N,O,X,J,Z,$)}function es(N,O,U,X,J,Z,en){var eo=+new Date;do{if(N.bitLength()>O&&(N=ea(O,U)),N.isProbablePrime(J))return en(null,N);N.dAddOffset(Y[X++%8],0)}while(Z<0||+new Date-eo<Z);$.util.setImmediate(function(){es(N,O,U,X,J,Z,en)})}function eo(N,O,Y,X){if("undefined"==typeof Worker)return en(N,O,Y,X);var J=ea(N,O),Z=Y.workers,es=Y.workLoad||100,eo=30*es/8,ec=Y.workerScript||"forge/prime.worker.js";if(-1===Z)return $.util.estimateCores(function(N,O){N&&(O=2),Z=O-1,eu()});function eu(){Z=Math.max(1,Z);for(var $=[],Y=0;Y<Z;++Y)$[Y]=new Worker(ec);for(var en=Z,Y=0;Y<Z;++Y)$[Y].addEventListener("message",eh);var eu=!1;function eh(Y){if(!eu){--en;var Z=Y.data;if(Z.found){for(var ec=0;ec<$.length;++ec)$[ec].terminate();return eu=!0,X(null,new U(Z.prime,16))}J.bitLength()>N&&(J=ea(N,O));var eh=J.toString(16);Y.target.postMessage({hex:eh,workLoad:es}),J.dAddOffset(eo,0)}}}eu()}function ea(N,O){var $=new U(N,O),Y=N-1;return $.testBit(Y)||$.bitwiseTo(U.ONE.shiftLeft(Y),J,$),$.dAddOffset(31-$.mod(X).byteValue(),0),$}function ec(N){return N<=100?27:N<=150?18:N<=200?15:N<=250?12:N<=300?9:N<=350?8:N<=400?7:N<=500?6:N<=600?5:N<=800?4:N<=1250?3:2}O.generateProbablePrime=function(N,O,U){"function"==typeof O&&(U=O,O={});var Y=(O=O||{}).algorithm||"PRIMEINC";"string"==typeof Y&&(Y={name:Y}),Y.options=Y.options||{};var X=O.prng||$.random,J={nextBytes:function(N){for(var O=X.getBytesSync(N.length),U=0;U<N.length;++U)N[U]=O.charCodeAt(U)}};if("PRIMEINC"===Y.name)return Z(N,J,Y.options,U);throw Error("Invalid prime generation algorithm: "+Y.name)}}()},4933:function(N,O,U){var $=U(4112),Y=U(3832);U(7116);var X=null;!Y.util.isNodejs||Y.options.usePureJavaScript||$.versions["node-webkit"]||(X=U(5819)),(N.exports=Y.prng=Y.prng||{}).create=function(N){for(var O={plugin:N,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},U=N.md,$=Array(32),J=0;J<32;++J)$[J]=U.create();function Z(N){if(O.pools[0].messageLength>=32)return es(),N();var U=32-O.pools[0].messageLength<<5;O.seedFile(U,function(U,$){if(U)return N(U);O.collect($),es(),N()})}function en(){if(O.pools[0].messageLength>=32)return es();var N=32-O.pools[0].messageLength<<5;O.collect(O.seedFileSync(N)),es()}function es(){O.reseeds=4294967295===O.reseeds?0:O.reseeds+1;var N=O.plugin.md.create();N.update(O.keyBytes);for(var U=1,$=0;$<32;++$)O.reseeds%U==0&&(N.update(O.pools[$].digest().getBytes()),O.pools[$].start()),U<<=1;O.keyBytes=N.digest().getBytes(),N.start(),N.update(O.keyBytes);var Y=N.digest().getBytes();O.key=O.plugin.formatKey(O.keyBytes),O.seed=O.plugin.formatSeed(Y),O.generated=0}function eo(N){var O=null,U=Y.util.globalScope,$=U.crypto||U.msCrypto;$&&$.getRandomValues&&(O=function(N){return $.getRandomValues(N)});var X=Y.util.createBuffer();if(O)for(;X.length()<N;){var J=Math.max(1,Math.min(N-X.length(),65536)/4),Z=new Uint32Array(Math.floor(J));try{O(Z);for(var en=0;en<Z.length;++en)X.putInt32(Z[en])}catch(N){if(!("undefined"!=typeof QuotaExceededError&&N instanceof QuotaExceededError))throw N}}if(X.length()<N)for(var es,eo,ea,ec=Math.floor(65536*Math.random());X.length()<N;){ec=4294967295&(eo=(2147483647&(eo=16807*(65535&ec)+(((32767&(es=16807*(ec>>16)))<<16)+(es>>15))))+(eo>>31));for(var en=0;en<3;++en)ea=ec>>>(en<<3)^Math.floor(256*Math.random()),X.putByte(255&ea)}return X.getBytes(N)}return O.pools=$,O.pool=0,O.generate=function(N,U){if(!U)return O.generateSync(N);var $=O.plugin.cipher,X=O.plugin.increment,J=O.plugin.formatKey,en=O.plugin.formatSeed,es=Y.util.createBuffer();function eo(ea){if(ea)return U(ea);if(es.length()>=N)return U(null,es.getBytes(N));if(O.generated>1048575&&(O.key=null),null===O.key)return Y.util.nextTick(function(){Z(eo)});var ec=$(O.key,O.seed);O.generated+=ec.length,es.putBytes(ec),O.key=J($(O.key,X(O.seed))),O.seed=en($(O.key,O.seed)),Y.util.setImmediate(eo)}O.key=null,eo()},O.generateSync=function(N){var U=O.plugin.cipher,$=O.plugin.increment,X=O.plugin.formatKey,J=O.plugin.formatSeed;O.key=null;for(var Z=Y.util.createBuffer();Z.length()<N;){O.generated>1048575&&(O.key=null),null===O.key&&en();var es=U(O.key,O.seed);O.generated+=es.length,Z.putBytes(es),O.key=X(U(O.key,$(O.seed))),O.seed=J(U(O.key,O.seed))}return Z.getBytes(N)},X?(O.seedFile=function(N,O){X.randomBytes(N,function(N,U){if(N)return O(N);O(null,U.toString())})},O.seedFileSync=function(N){return X.randomBytes(N).toString()}):(O.seedFile=function(N,O){try{O(null,eo(N))}catch(N){O(N)}},O.seedFileSync=eo),O.collect=function(N){for(var U=N.length,$=0;$<U;++$)O.pools[O.pool].update(N.substr($,1)),O.pool=31===O.pool?0:O.pool+1},O.collectInt=function(N,U){for(var $="",Y=0;Y<U;Y+=8)$+=String.fromCharCode(N>>Y&255);O.collect($)},O.registerWorker=function(N){if(N===self)O.seedFile=function(N,O){function U(N){var $=N.data;$.forge&&$.forge.prng&&(self.removeEventListener("message",U),O($.forge.prng.err,$.forge.prng.bytes))}self.addEventListener("message",U),self.postMessage({forge:{prng:{needed:N}}})};else{var U=function(U){var $=U.data;$.forge&&$.forge.prng&&O.seedFile($.forge.prng.needed,function(O,U){N.postMessage({forge:{prng:{err:O,bytes:U}}})})};N.addEventListener("message",U)}},O}},9563:function(N,O,U){var $=U(3832);U(8925),U(1668),U(4933),U(7116),function(){if($.random&&$.random.getBytes){N.exports=$.random;return}!function(O){var U={},Y=[,,,,],X=$.util.createBuffer();function J(){var N=$.prng.create(U);return N.getBytes=function(O,U){return N.generate(O,U)},N.getBytesSync=function(O){return N.generate(O)},N}U.formatKey=function(N){var O=$.util.createBuffer(N);return(N=[,,,,])[0]=O.getInt32(),N[1]=O.getInt32(),N[2]=O.getInt32(),N[3]=O.getInt32(),$.aes._expandKey(N,!1)},U.formatSeed=function(N){var O=$.util.createBuffer(N);return(N=[,,,,])[0]=O.getInt32(),N[1]=O.getInt32(),N[2]=O.getInt32(),N[3]=O.getInt32(),N},U.cipher=function(N,O){return $.aes._updateBlock(N,O,Y,!1),X.putInt32(Y[0]),X.putInt32(Y[1]),X.putInt32(Y[2]),X.putInt32(Y[3]),X.getBytes()},U.increment=function(N){return++N[3],N},U.md=$.md.sha256;var Z=J(),en=null,es=$.util.globalScope,eo=es.crypto||es.msCrypto;if(eo&&eo.getRandomValues&&(en=function(N){return eo.getRandomValues(N)}),$.options.usePureJavaScript||!$.util.isNodejs&&!en){if("undefined"==typeof window||window.document,Z.collectInt(+new Date,32),"undefined"!=typeof navigator){var ea="";for(var ec in navigator)try{"string"==typeof navigator[ec]&&(ea+=navigator[ec])}catch(N){}Z.collect(ea),ea=null}O&&(O().mousemove(function(N){Z.collectInt(N.clientX,16),Z.collectInt(N.clientY,16)}),O().keypress(function(N){Z.collectInt(N.charCode,8)}))}if($.random)for(var ec in Z)$.random[ec]=Z[ec];else $.random=Z;$.random.createInstance=J,N.exports=$.random}("undefined"!=typeof jQuery?jQuery:null)}()},9372:function(N,O,U){var $=U(3832);U(7116);var Y=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],X=[1,2,3,5],J=function(N,O){return N<<O&65535|(65535&N)>>16-O},Z=function(N,O){return(65535&N)>>O|N<<16-O&65535};N.exports=$.rc2=$.rc2||{},$.rc2.expandKey=function(N,O){"string"==typeof N&&(N=$.util.createBuffer(N)),O=O||128;var U,X=N,J=N.length(),Z=O,en=Math.ceil(Z/8),es=255>>(7&Z);for(U=J;U<128;U++)X.putByte(Y[X.at(U-1)+X.at(U-J)&255]);for(X.setAt(128-en,Y[X.at(128-en)&es]),U=127-en;U>=0;U--)X.setAt(U,Y[X.at(U+1)^X.at(U+en)]);return X};var en=function(N,O,U){var Y,en,es,eo,ea=!1,ec=null,eu=null,eh=null,ef=[];for(es=0,N=$.rc2.expandKey(N,O);es<64;es++)ef.push(N.getInt16Le());U?(Y=function(N){for(es=0;es<4;es++)N[es]+=ef[eo]+(N[(es+3)%4]&N[(es+2)%4])+(~N[(es+3)%4]&N[(es+1)%4]),N[es]=J(N[es],X[es]),eo++},en=function(N){for(es=0;es<4;es++)N[es]+=ef[63&N[(es+3)%4]]}):(Y=function(N){for(es=3;es>=0;es--)N[es]=Z(N[es],X[es]),N[es]-=ef[eo]+(N[(es+3)%4]&N[(es+2)%4])+(~N[(es+3)%4]&N[(es+1)%4]),eo--},en=function(N){for(es=3;es>=0;es--)N[es]-=ef[63&N[(es+3)%4]]});var eg=function(N){var O=[];for(es=0;es<4;es++){var $=ec.getInt16Le();null!==eh&&(U?$^=eh.getInt16Le():eh.putInt16Le($)),O.push(65535&$)}eo=U?0:63;for(var Y=0;Y<N.length;Y++)for(var X=0;X<N[Y][0];X++)N[Y][1](O);for(es=0;es<4;es++)null!==eh&&(U?eh.putInt16Le(O[es]):O[es]^=eh.getInt16Le()),eu.putInt16Le(O[es])},ey=null;return ey={start:function(N,O){N&&"string"==typeof N&&(N=$.util.createBuffer(N)),ea=!1,ec=$.util.createBuffer(),eu=O||new $.util.createBuffer,eh=N,ey.output=eu},update:function(N){for(ea||ec.putBuffer(N);ec.length()>=8;)eg([[5,Y],[1,en],[6,Y],[1,en],[5,Y]])},finish:function(N){var O=!0;if(U){if(N)O=N(8,ec,!U);else{var $=8===ec.length()?8:8-ec.length();ec.fillWithByte($,$)}}if(O&&(ea=!0,ey.update()),!U&&(O=0===ec.length())){if(N)O=N(8,eu,!U);else{var Y=eu.length(),X=eu.at(Y-1);X>Y?O=!1:eu.truncate(X)}}return O}}};$.rc2.startEncrypting=function(N,O,U){var Y=$.rc2.createEncryptionCipher(N,128);return Y.start(O,U),Y},$.rc2.createEncryptionCipher=function(N,O){return en(N,O,!0)},$.rc2.startDecrypting=function(N,O,U){var Y=$.rc2.createDecryptionCipher(N,128);return Y.start(O,U),Y},$.rc2.createDecryptionCipher=function(N,O){return en(N,O,!1)}},8095:function(N,O,U){var $=U(3832);if(U(3068),U(5764),U(6270),U(8936),U(9654),U(9563),U(7116),void 0===Y)var Y=$.jsbn.BigInteger;var X=$.util.isNodejs?U(5819):null,J=$.asn1,Z=$.util;$.pki=$.pki||{},N.exports=$.pki.rsa=$.rsa=$.rsa||{};var en=$.pki,es=[6,4,2,4,2,4,6,2],eo={name:"PrivateKeyInfo",tagClass:J.Class.UNIVERSAL,type:J.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:J.Class.UNIVERSAL,type:J.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:J.Class.UNIVERSAL,type:J.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:J.Class.UNIVERSAL,type:J.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:J.Class.UNIVERSAL,type:J.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},ea={name:"RSAPrivateKey",tagClass:J.Class.UNIVERSAL,type:J.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:J.Class.UNIVERSAL,type:J.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:J.Class.UNIVERSAL,type:J.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:J.Class.UNIVERSAL,type:J.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:J.Class.UNIVERSAL,type:J.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:J.Class.UNIVERSAL,type:J.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:J.Class.UNIVERSAL,type:J.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:J.Class.UNIVERSAL,type:J.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:J.Class.UNIVERSAL,type:J.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:J.Class.UNIVERSAL,type:J.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},ec={name:"RSAPublicKey",tagClass:J.Class.UNIVERSAL,type:J.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:J.Class.UNIVERSAL,type:J.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:J.Class.UNIVERSAL,type:J.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},eu=$.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:J.Class.UNIVERSAL,type:J.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:J.Class.UNIVERSAL,type:J.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:J.Class.UNIVERSAL,type:J.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:J.Class.UNIVERSAL,type:J.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:J.Class.UNIVERSAL,type:J.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},eh={name:"DigestInfo",tagClass:J.Class.UNIVERSAL,type:J.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:J.Class.UNIVERSAL,type:J.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:J.Class.UNIVERSAL,type:J.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:J.Class.UNIVERSAL,type:J.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:J.Class.UNIVERSAL,type:J.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},ef=function(N){if(N.algorithm in en.oids)O=en.oids[N.algorithm];else{var O,U=Error("Unknown message digest algorithm.");throw U.algorithm=N.algorithm,U}var $=J.oidToDer(O).getBytes(),Y=J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[]),X=J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[]);X.value.push(J.create(J.Class.UNIVERSAL,J.Type.OID,!1,$)),X.value.push(J.create(J.Class.UNIVERSAL,J.Type.NULL,!1,""));var Z=J.create(J.Class.UNIVERSAL,J.Type.OCTETSTRING,!1,N.digest().getBytes());return Y.value.push(X),Y.value.push(Z),J.toDer(Y).getBytes()},eg=function(N,O,U){if(U)return N.modPow(O.e,O.n);if(!O.p||!O.q)return N.modPow(O.d,O.n);O.dP||(O.dP=O.d.mod(O.p.subtract(Y.ONE))),O.dQ||(O.dQ=O.d.mod(O.q.subtract(Y.ONE))),O.qInv||(O.qInv=O.q.modInverse(O.p));do X=new Y($.util.bytesToHex($.random.getBytes(O.n.bitLength()/8)),16);while(X.compareTo(O.n)>=0||!X.gcd(O.n).equals(Y.ONE));for(var X,J=(N=N.multiply(X.modPow(O.e,O.n)).mod(O.n)).mod(O.p).modPow(O.dP,O.p),Z=N.mod(O.q).modPow(O.dQ,O.q);0>J.compareTo(Z);)J=J.add(O.p);return J.subtract(Z).multiply(O.qInv).mod(O.p).multiply(O.q).add(Z).multiply(X.modInverse(O.n)).mod(O.n)};function ey(N,O,U){var Y,X=$.util.createBuffer(),J=Math.ceil(O.n.bitLength()/8);if(N.length>J-11){var Z=Error("Message is too long for PKCS#1 v1.5 padding.");throw Z.length=N.length,Z.max=J-11,Z}X.putByte(0),X.putByte(U);var en=J-3-N.length;if(0===U||1===U){Y=0===U?0:255;for(var es=0;es<en;++es)X.putByte(Y)}else for(;en>0;){for(var eo=0,ea=$.random.getBytes(en),es=0;es<en;++es)0===(Y=ea.charCodeAt(es))?++eo:X.putByte(Y);en=eo}return X.putByte(0),X.putBytes(N),X}function ew(N,O,U,Y){var X=Math.ceil(O.n.bitLength()/8),J=$.util.createBuffer(N),Z=J.getByte(),en=J.getByte();if(0!==Z||U&&0!==en&&1!==en||!U&&2!=en||U&&0===en&&void 0===Y)throw Error("Encryption block is invalid.");var es=0;if(0===en){es=X-3-Y;for(var eo=0;eo<es;++eo)if(0!==J.getByte())throw Error("Encryption block is invalid.")}else if(1===en)for(es=0;J.length()>1;){if(255!==J.getByte()){--J.read;break}++es}else if(2===en)for(es=0;J.length()>1;){if(0===J.getByte()){--J.read;break}++es}if(0!==J.getByte()||es!==X-3-J.length())throw Error("Encryption block is invalid.");return J.getBytes()}function ev(N,O,U){"function"==typeof O&&(U=O,O={});var X={algorithm:{name:(O=O||{}).algorithm||"PRIMEINC",options:{workers:O.workers||2,workLoad:O.workLoad||100,workerScript:O.workerScript}}};function J(){Z(N.pBits,function(O,$){return O?U(O):(N.p=$,null!==N.q)?es(O,N.q):void Z(N.qBits,es)})}function Z(N,O){$.prime.generateProbablePrime(N,X,O)}function es(O,$){if(O)return U(O);if(N.q=$,0>N.p.compareTo(N.q)){var X=N.p;N.p=N.q,N.q=X}if(0!==N.p.subtract(Y.ONE).gcd(N.e).compareTo(Y.ONE)){N.p=null,J();return}if(0!==N.q.subtract(Y.ONE).gcd(N.e).compareTo(Y.ONE)){N.q=null,Z(N.qBits,es);return}if(N.p1=N.p.subtract(Y.ONE),N.q1=N.q.subtract(Y.ONE),N.phi=N.p1.multiply(N.q1),0!==N.phi.gcd(N.e).compareTo(Y.ONE)){N.p=N.q=null,J();return}if(N.n=N.p.multiply(N.q),N.n.bitLength()!==N.bits){N.q=null,Z(N.qBits,es);return}var eo=N.e.modInverse(N.phi);N.keys={privateKey:en.rsa.setPrivateKey(N.n,N.e,eo,N.p,N.q,eo.mod(N.p1),eo.mod(N.q1),N.q.modInverse(N.p)),publicKey:en.rsa.setPublicKey(N.n,N.e)},U(null,N.keys)}"prng"in O&&(X.prng=O.prng),J()}function eE(N){var O=N.toString(16);O[0]>="8"&&(O="00"+O);var U=$.util.hexToBytes(O);return U.length>1&&(0===U.charCodeAt(0)&&(128&U.charCodeAt(1))==0||255===U.charCodeAt(0)&&(128&U.charCodeAt(1))==128)?U.substr(1):U}function e_(N){return N<=100?27:N<=150?18:N<=200?15:N<=250?12:N<=300?9:N<=350?8:N<=400?7:N<=500?6:N<=600?5:N<=800?4:N<=1250?3:2}function eS(N){return $.util.isNodejs&&"function"==typeof X[N]}function eI(N){return void 0!==Z.globalScope&&"object"==typeof Z.globalScope.crypto&&"object"==typeof Z.globalScope.crypto.subtle&&"function"==typeof Z.globalScope.crypto.subtle[N]}function eR(N){return void 0!==Z.globalScope&&"object"==typeof Z.globalScope.msCrypto&&"object"==typeof Z.globalScope.msCrypto.subtle&&"function"==typeof Z.globalScope.msCrypto.subtle[N]}function ek(N){for(var O=$.util.hexToBytes(N.toString(16)),U=new Uint8Array(O.length),Y=0;Y<O.length;++Y)U[Y]=O.charCodeAt(Y);return U}en.rsa.encrypt=function(N,O,U){var X,J=U,Z=Math.ceil(O.n.bitLength()/8);!1!==U&&!0!==U?(J=2===U,X=ey(N,O,U)):(X=$.util.createBuffer()).putBytes(N);for(var en=eg(new Y(X.toHex(),16),O,J).toString(16),es=$.util.createBuffer(),eo=Z-Math.ceil(en.length/2);eo>0;)es.putByte(0),--eo;return es.putBytes($.util.hexToBytes(en)),es.getBytes()},en.rsa.decrypt=function(N,O,U,X){var J=Math.ceil(O.n.bitLength()/8);if(N.length!==J){var Z=Error("Encrypted message length is invalid.");throw Z.length=N.length,Z.expected=J,Z}var en=new Y($.util.createBuffer(N).toHex(),16);if(en.compareTo(O.n)>=0)throw Error("Encrypted message is invalid.");for(var es=eg(en,O,U).toString(16),eo=$.util.createBuffer(),ea=J-Math.ceil(es.length/2);ea>0;)eo.putByte(0),--ea;return(eo.putBytes($.util.hexToBytes(es)),!1!==X)?ew(eo.getBytes(),O,U):eo.getBytes()},en.rsa.createKeyPairGenerationState=function(N,O,U){"string"==typeof N&&(N=parseInt(N,10)),N=N||2048;var X,J=(U=U||{}).prng||$.random,Z={nextBytes:function(N){for(var O=J.getBytesSync(N.length),U=0;U<N.length;++U)N[U]=O.charCodeAt(U)}},en=U.algorithm||"PRIMEINC";if("PRIMEINC"===en)(X={algorithm:en,state:0,bits:N,rng:Z,eInt:O||65537,e:new Y(null),p:null,q:null,qBits:N>>1,pBits:N-(N>>1),pqState:0,num:null,keys:null}).e.fromInt(X.eInt);else throw Error("Invalid key generation algorithm: "+en);return X},en.rsa.stepKeyPairGenerationState=function(N,O){"algorithm"in N||(N.algorithm="PRIMEINC");var U,$=new Y(null);$.fromInt(30);for(var X=0,J=function(N,O){return N|O},Z=+new Date,eo=0;null===N.keys&&(O<=0||eo<O);){if(0===N.state){var ea=null===N.p?N.pBits:N.qBits,ec=ea-1;0===N.pqState?(N.num=new Y(ea,N.rng),N.num.testBit(ec)||N.num.bitwiseTo(Y.ONE.shiftLeft(ec),J,N.num),N.num.dAddOffset(31-N.num.mod($).byteValue(),0),X=0,++N.pqState):1===N.pqState?N.num.bitLength()>ea?N.pqState=0:N.num.isProbablePrime(e_(N.num.bitLength()))?++N.pqState:N.num.dAddOffset(es[X++%8],0):2===N.pqState?N.pqState=0===N.num.subtract(Y.ONE).gcd(N.e).compareTo(Y.ONE)?3:0:3===N.pqState&&(N.pqState=0,null===N.p?N.p=N.num:N.q=N.num,null!==N.p&&null!==N.q&&++N.state,N.num=null)}else if(1===N.state)0>N.p.compareTo(N.q)&&(N.num=N.p,N.p=N.q,N.q=N.num),++N.state;else if(2===N.state)N.p1=N.p.subtract(Y.ONE),N.q1=N.q.subtract(Y.ONE),N.phi=N.p1.multiply(N.q1),++N.state;else if(3===N.state)0===N.phi.gcd(N.e).compareTo(Y.ONE)?++N.state:(N.p=null,N.q=null,N.state=0);else if(4===N.state)N.n=N.p.multiply(N.q),N.n.bitLength()===N.bits?++N.state:(N.q=null,N.state=0);else if(5===N.state){var eu=N.e.modInverse(N.phi);N.keys={privateKey:en.rsa.setPrivateKey(N.n,N.e,eu,N.p,N.q,eu.mod(N.p1),eu.mod(N.q1),N.q.modInverse(N.p)),publicKey:en.rsa.setPublicKey(N.n,N.e)}}eo+=(U=+new Date)-Z,Z=U}return null!==N.keys},en.rsa.generateKeyPair=function(N,O,U,Y){if(1==arguments.length?"object"==typeof N?(U=N,N=void 0):"function"==typeof N&&(Y=N,N=void 0):2==arguments.length?"number"==typeof N?"function"==typeof O?(Y=O,O=void 0):"number"!=typeof O&&(U=O,O=void 0):(U=N,Y=O,N=void 0,O=void 0):3==arguments.length&&("number"==typeof O?"function"==typeof U&&(Y=U,U=void 0):(Y=U,U=O,O=void 0)),U=U||{},void 0===N&&(N=U.bits||2048),void 0===O&&(O=U.e||65537),!$.options.usePureJavaScript&&!U.prng&&N>=256&&N<=16384&&(65537===O||3===O)){if(Y){if(eS("generateKeyPair"))return X.generateKeyPair("rsa",{modulusLength:N,publicExponent:O,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(N,O,U){if(N)return Y(N);Y(null,{privateKey:en.privateKeyFromPem(U),publicKey:en.publicKeyFromPem(O)})});if(eI("generateKey")&&eI("exportKey"))return Z.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:N,publicExponent:ek(O),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(N){return Z.globalScope.crypto.subtle.exportKey("pkcs8",N.privateKey)}).then(void 0,function(N){Y(N)}).then(function(N){if(N){var O=en.privateKeyFromAsn1(J.fromDer($.util.createBuffer(N)));Y(null,{privateKey:O,publicKey:en.setRsaPublicKey(O.n,O.e)})}});if(eR("generateKey")&&eR("exportKey")){var es=Z.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:N,publicExponent:ek(O),hash:{name:"SHA-256"}},!0,["sign","verify"]);es.oncomplete=function(N){var O=N.target.result,U=Z.globalScope.msCrypto.subtle.exportKey("pkcs8",O.privateKey);U.oncomplete=function(N){var O=N.target.result,U=en.privateKeyFromAsn1(J.fromDer($.util.createBuffer(O)));Y(null,{privateKey:U,publicKey:en.setRsaPublicKey(U.n,U.e)})},U.onerror=function(N){Y(N)}},es.onerror=function(N){Y(N)};return}}else if(eS("generateKeyPairSync")){var eo=X.generateKeyPairSync("rsa",{modulusLength:N,publicExponent:O,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:en.privateKeyFromPem(eo.privateKey),publicKey:en.publicKeyFromPem(eo.publicKey)}}}var ea=en.rsa.createKeyPairGenerationState(N,O,U);if(!Y)return en.rsa.stepKeyPairGenerationState(ea,0),ea.keys;ev(ea,U,Y)},en.setRsaPublicKey=en.rsa.setPublicKey=function(N,O){var U={n:N,e:O};return U.encrypt=function(N,O,Y){if("string"==typeof O?O=O.toUpperCase():void 0===O&&(O="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===O)O={encode:function(N,O,U){return ey(N,O,2).getBytes()}};else if("RSA-OAEP"===O||"RSAES-OAEP"===O)O={encode:function(N,O){return $.pkcs1.encode_rsa_oaep(O,N,Y)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(O))O={encode:function(N){return N}};else if("string"==typeof O)throw Error('Unsupported encryption scheme: "'+O+'".');var X=O.encode(N,U,!0);return en.rsa.encrypt(X,U,!0)},U.verify=function(N,O,Y,X){"string"==typeof Y?Y=Y.toUpperCase():void 0===Y&&(Y="RSASSA-PKCS1-V1_5"),void 0===X&&(X={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in X||(X._parseAllDigestBytes=!0),"RSASSA-PKCS1-V1_5"===Y?Y={verify:function(N,O){O=ew(O,U,!0);var Y=J.fromDer(O,{parseAllBytes:X._parseAllDigestBytes}),Z={},en=[];if(!J.validate(Y,eh,Z,en)){var es=Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw es.errors=en,es}var eo=J.derToOid(Z.algorithmIdentifier);if(!(eo===$.oids.md2||eo===$.oids.md5||eo===$.oids.sha1||eo===$.oids.sha224||eo===$.oids.sha256||eo===$.oids.sha384||eo===$.oids.sha512||eo===$.oids["sha512-224"]||eo===$.oids["sha512-256"])){var es=Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw es.oid=eo,es}if((eo===$.oids.md2||eo===$.oids.md5)&&!("parameters"in Z))throw Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return N===Z.digest}}:("NONE"===Y||"NULL"===Y||null===Y)&&(Y={verify:function(N,O){return N===(O=ew(O,U,!0))}});var Z=en.rsa.decrypt(O,U,!0,!1);return Y.verify(N,Z,U.n.bitLength())},U},en.setRsaPrivateKey=en.rsa.setPrivateKey=function(N,O,U,Y,X,J,Z,es){var eo={n:N,e:O,d:U,p:Y,q:X,dP:J,dQ:Z,qInv:es};return eo.decrypt=function(N,O,U){"string"==typeof O?O=O.toUpperCase():void 0===O&&(O="RSAES-PKCS1-V1_5");var Y=en.rsa.decrypt(N,eo,!1,!1);if("RSAES-PKCS1-V1_5"===O)O={decode:ew};else if("RSA-OAEP"===O||"RSAES-OAEP"===O)O={decode:function(N,O){return $.pkcs1.decode_rsa_oaep(O,N,U)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(O))O={decode:function(N){return N}};else throw Error('Unsupported encryption scheme: "'+O+'".');return O.decode(Y,eo,!1)},eo.sign=function(N,O){var U=!1;"string"==typeof O&&(O=O.toUpperCase()),void 0===O||"RSASSA-PKCS1-V1_5"===O?(O={encode:ef},U=1):("NONE"===O||"NULL"===O||null===O)&&(O={encode:function(){return N}},U=1);var $=O.encode(N,eo.n.bitLength());return en.rsa.encrypt($,eo,U)},eo},en.wrapRsaPrivateKey=function(N){return J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,J.integerToDer(0).getBytes()),J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.OID,!1,J.oidToDer(en.oids.rsaEncryption).getBytes()),J.create(J.Class.UNIVERSAL,J.Type.NULL,!1,"")]),J.create(J.Class.UNIVERSAL,J.Type.OCTETSTRING,!1,J.toDer(N).getBytes())])},en.privateKeyFromAsn1=function(N){var O,U,X,Z,es,ec,eu,eh,ef={},eg=[];if(J.validate(N,eo,ef,eg)&&(N=J.fromDer($.util.createBuffer(ef.privateKey))),ef={},eg=[],!J.validate(N,ea,ef,eg)){var ey=Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw ey.errors=eg,ey}return O=$.util.createBuffer(ef.privateKeyModulus).toHex(),U=$.util.createBuffer(ef.privateKeyPublicExponent).toHex(),X=$.util.createBuffer(ef.privateKeyPrivateExponent).toHex(),Z=$.util.createBuffer(ef.privateKeyPrime1).toHex(),es=$.util.createBuffer(ef.privateKeyPrime2).toHex(),ec=$.util.createBuffer(ef.privateKeyExponent1).toHex(),eu=$.util.createBuffer(ef.privateKeyExponent2).toHex(),eh=$.util.createBuffer(ef.privateKeyCoefficient).toHex(),en.setRsaPrivateKey(new Y(O,16),new Y(U,16),new Y(X,16),new Y(Z,16),new Y(es,16),new Y(ec,16),new Y(eu,16),new Y(eh,16))},en.privateKeyToAsn1=en.privateKeyToRSAPrivateKey=function(N){return J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,J.integerToDer(0).getBytes()),J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,eE(N.n)),J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,eE(N.e)),J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,eE(N.d)),J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,eE(N.p)),J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,eE(N.q)),J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,eE(N.dP)),J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,eE(N.dQ)),J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,eE(N.qInv))])},en.publicKeyFromAsn1=function(N){var O={},U=[];if(J.validate(N,eu,O,U)){var X=J.derToOid(O.publicKeyOid);if(X!==en.oids.rsaEncryption){var Z=Error("Cannot read public key. Unknown OID.");throw Z.oid=X,Z}N=O.rsaPublicKey}if(U=[],!J.validate(N,ec,O,U)){var Z=Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw Z.errors=U,Z}var es=$.util.createBuffer(O.publicKeyModulus).toHex(),eo=$.util.createBuffer(O.publicKeyExponent).toHex();return en.setRsaPublicKey(new Y(es,16),new Y(eo,16))},en.publicKeyToAsn1=en.publicKeyToSubjectPublicKeyInfo=function(N){return J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.OID,!1,J.oidToDer(en.oids.rsaEncryption).getBytes()),J.create(J.Class.UNIVERSAL,J.Type.NULL,!1,"")]),J.create(J.Class.UNIVERSAL,J.Type.BITSTRING,!1,[en.publicKeyToRSAPublicKey(N)])])},en.publicKeyToRSAPublicKey=function(N){return J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,eE(N.n)),J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,eE(N.e))])}},137:function(N,O,U){var $=U(3832);U(8991),U(7116);var Y=N.exports=$.sha1=$.sha1||{};$.md.sha1=$.md.algorithms.sha1=Y,Y.create=function(){J||Z();var N=null,O=$.util.createBuffer(),U=Array(80),Y={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return Y.start=function(){Y.messageLength=0,Y.fullMessageLength=Y.messageLength64=[];for(var U=Y.messageLengthSize/4,X=0;X<U;++X)Y.fullMessageLength.push(0);return O=$.util.createBuffer(),N={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},Y},Y.start(),Y.update=function(X,J){"utf8"===J&&(X=$.util.encodeUtf8(X));var Z=X.length;Y.messageLength+=Z,Z=[Z/4294967296>>>0,Z>>>0];for(var es=Y.fullMessageLength.length-1;es>=0;--es)Y.fullMessageLength[es]+=Z[1],Z[1]=Z[0]+(Y.fullMessageLength[es]/4294967296>>>0),Y.fullMessageLength[es]=Y.fullMessageLength[es]>>>0,Z[0]=Z[1]/4294967296>>>0;return O.putBytes(X),en(N,U,O),(O.read>2048||0===O.length())&&O.compact(),Y},Y.digest=function(){var J,Z=$.util.createBuffer();Z.putBytes(O.bytes());var es=Y.fullMessageLength[Y.fullMessageLength.length-1]+Y.messageLengthSize&Y.blockLength-1;Z.putBytes(X.substr(0,Y.blockLength-es));for(var eo=8*Y.fullMessageLength[0],ea=0;ea<Y.fullMessageLength.length-1;++ea)eo+=(J=8*Y.fullMessageLength[ea+1])/4294967296>>>0,Z.putInt32(eo>>>0),eo=J>>>0;Z.putInt32(eo);var ec={h0:N.h0,h1:N.h1,h2:N.h2,h3:N.h3,h4:N.h4};en(ec,U,Z);var eu=$.util.createBuffer();return eu.putInt32(ec.h0),eu.putInt32(ec.h1),eu.putInt32(ec.h2),eu.putInt32(ec.h3),eu.putInt32(ec.h4),eu},Y};var X=null,J=!1;function Z(){X=String.fromCharCode(128)+$.util.fillString("\x00",64),J=!0}function en(N,O,U){for(var $,Y,X,J,Z,en,es,eo,ea=U.length();ea>=64;){for(eo=0,Y=N.h0,X=N.h1,J=N.h2,Z=N.h3,en=N.h4;eo<16;++eo)$=U.getInt32(),O[eo]=$,$=(Y<<5|Y>>>27)+(es=Z^X&(J^Z))+en+1518500249+$,en=Z,Z=J,J=(X<<30|X>>>2)>>>0,X=Y,Y=$;for(;eo<20;++eo)$=($=O[eo-3]^O[eo-8]^O[eo-14]^O[eo-16])<<1|$>>>31,O[eo]=$,$=(Y<<5|Y>>>27)+(es=Z^X&(J^Z))+en+1518500249+$,en=Z,Z=J,J=(X<<30|X>>>2)>>>0,X=Y,Y=$;for(;eo<32;++eo)$=($=O[eo-3]^O[eo-8]^O[eo-14]^O[eo-16])<<1|$>>>31,O[eo]=$,$=(Y<<5|Y>>>27)+(es=X^J^Z)+en+1859775393+$,en=Z,Z=J,J=(X<<30|X>>>2)>>>0,X=Y,Y=$;for(;eo<40;++eo)$=($=O[eo-6]^O[eo-16]^O[eo-28]^O[eo-32])<<2|$>>>30,O[eo]=$,$=(Y<<5|Y>>>27)+(es=X^J^Z)+en+1859775393+$,en=Z,Z=J,J=(X<<30|X>>>2)>>>0,X=Y,Y=$;for(;eo<60;++eo)$=($=O[eo-6]^O[eo-16]^O[eo-28]^O[eo-32])<<2|$>>>30,O[eo]=$,$=(Y<<5|Y>>>27)+(es=X&J|Z&(X^J))+en+2400959708+$,en=Z,Z=J,J=(X<<30|X>>>2)>>>0,X=Y,Y=$;for(;eo<80;++eo)$=($=O[eo-6]^O[eo-16]^O[eo-28]^O[eo-32])<<2|$>>>30,O[eo]=$,$=(Y<<5|Y>>>27)+(es=X^J^Z)+en+3395469782+$,en=Z,Z=J,J=(X<<30|X>>>2)>>>0,X=Y,Y=$;N.h0=N.h0+Y|0,N.h1=N.h1+X|0,N.h2=N.h2+J|0,N.h3=N.h3+Z|0,N.h4=N.h4+en|0,ea-=64}}},1668:function(N,O,U){var $=U(3832);U(8991),U(7116);var Y=N.exports=$.sha256=$.sha256||{};$.md.sha256=$.md.algorithms.sha256=Y,Y.create=function(){J||en();var N=null,O=$.util.createBuffer(),U=Array(64),Y={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return Y.start=function(){Y.messageLength=0,Y.fullMessageLength=Y.messageLength64=[];for(var U=Y.messageLengthSize/4,X=0;X<U;++X)Y.fullMessageLength.push(0);return O=$.util.createBuffer(),N={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},Y},Y.start(),Y.update=function(X,J){"utf8"===J&&(X=$.util.encodeUtf8(X));var Z=X.length;Y.messageLength+=Z,Z=[Z/4294967296>>>0,Z>>>0];for(var en=Y.fullMessageLength.length-1;en>=0;--en)Y.fullMessageLength[en]+=Z[1],Z[1]=Z[0]+(Y.fullMessageLength[en]/4294967296>>>0),Y.fullMessageLength[en]=Y.fullMessageLength[en]>>>0,Z[0]=Z[1]/4294967296>>>0;return O.putBytes(X),es(N,U,O),(O.read>2048||0===O.length())&&O.compact(),Y},Y.digest=function(){var J,Z=$.util.createBuffer();Z.putBytes(O.bytes());var en=Y.fullMessageLength[Y.fullMessageLength.length-1]+Y.messageLengthSize&Y.blockLength-1;Z.putBytes(X.substr(0,Y.blockLength-en));for(var eo=8*Y.fullMessageLength[0],ea=0;ea<Y.fullMessageLength.length-1;++ea)eo+=(J=8*Y.fullMessageLength[ea+1])/4294967296>>>0,Z.putInt32(eo>>>0),eo=J>>>0;Z.putInt32(eo);var ec={h0:N.h0,h1:N.h1,h2:N.h2,h3:N.h3,h4:N.h4,h5:N.h5,h6:N.h6,h7:N.h7};es(ec,U,Z);var eu=$.util.createBuffer();return eu.putInt32(ec.h0),eu.putInt32(ec.h1),eu.putInt32(ec.h2),eu.putInt32(ec.h3),eu.putInt32(ec.h4),eu.putInt32(ec.h5),eu.putInt32(ec.h6),eu.putInt32(ec.h7),eu},Y};var X=null,J=!1,Z=null;function en(){X=String.fromCharCode(128)+$.util.fillString("\x00",64),Z=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],J=!0}function es(N,O,U){for(var $,Y,X,J,en,es,eo,ea,ec,eu,eh,ef,eg,ey,ew,ev=U.length();ev>=64;){for(eo=0;eo<16;++eo)O[eo]=U.getInt32();for(;eo<64;++eo)$=(($=O[eo-2])>>>17|$<<15)^($>>>19|$<<13)^$>>>10,Y=((Y=O[eo-15])>>>7|Y<<25)^(Y>>>18|Y<<14)^Y>>>3,O[eo]=$+O[eo-7]+Y+O[eo-16]|0;for(eo=0,ea=N.h0,ec=N.h1,eu=N.h2,eh=N.h3,ef=N.h4,eg=N.h5,ey=N.h6,ew=N.h7;eo<64;++eo)J=(ef>>>6|ef<<26)^(ef>>>11|ef<<21)^(ef>>>25|ef<<7),en=ey^ef&(eg^ey),X=(ea>>>2|ea<<30)^(ea>>>13|ea<<19)^(ea>>>22|ea<<10),es=ea&ec|eu&(ea^ec),$=ew+J+en+Z[eo]+O[eo],Y=X+es,ew=ey,ey=eg,eg=ef,ef=eh+$>>>0,eh=eu,eu=ec,ec=ea,ea=$+Y>>>0;N.h0=N.h0+ea|0,N.h1=N.h1+ec|0,N.h2=N.h2+eu|0,N.h3=N.h3+eh|0,N.h4=N.h4+ef|0,N.h5=N.h5+eg|0,N.h6=N.h6+ey|0,N.h7=N.h7+ew|0,ev-=64}}},3219:function(N,O,U){var $=U(3832);U(8991),U(7116);var Y=N.exports=$.sha512=$.sha512||{};$.md.sha512=$.md.algorithms.sha512=Y;var X=$.sha384=$.sha512.sha384=$.sha512.sha384||{};X.create=function(){return Y.create("SHA-384")},$.md.sha384=$.md.algorithms.sha384=X,$.sha512.sha256=$.sha512.sha256||{create:function(){return Y.create("SHA-512/256")}},$.md["sha512/256"]=$.md.algorithms["sha512/256"]=$.sha512.sha256,$.sha512.sha224=$.sha512.sha224||{create:function(){return Y.create("SHA-512/224")}},$.md["sha512/224"]=$.md.algorithms["sha512/224"]=$.sha512.sha224,Y.create=function(N){if(Z||eo(),void 0===N&&(N="SHA-512"),!(N in es))throw Error("Invalid SHA-512 algorithm: "+N);for(var O=es[N],U=null,Y=$.util.createBuffer(),X=Array(80),en=0;en<80;++en)X[en]=[,,];var ec=64;switch(N){case"SHA-384":ec=48;break;case"SHA-512/256":ec=32;break;case"SHA-512/224":ec=28}var eu={algorithm:N.replace("-","").toLowerCase(),blockLength:128,digestLength:ec,messageLength:0,fullMessageLength:null,messageLengthSize:16};return eu.start=function(){eu.messageLength=0,eu.fullMessageLength=eu.messageLength128=[];for(var N=eu.messageLengthSize/4,X=0;X<N;++X)eu.fullMessageLength.push(0);Y=$.util.createBuffer(),U=Array(O.length);for(var X=0;X<O.length;++X)U[X]=O[X].slice(0);return eu},eu.start(),eu.update=function(N,O){"utf8"===O&&(N=$.util.encodeUtf8(N));var J=N.length;eu.messageLength+=J,J=[J/4294967296>>>0,J>>>0];for(var Z=eu.fullMessageLength.length-1;Z>=0;--Z)eu.fullMessageLength[Z]+=J[1],J[1]=J[0]+(eu.fullMessageLength[Z]/4294967296>>>0),eu.fullMessageLength[Z]=eu.fullMessageLength[Z]>>>0,J[0]=J[1]/4294967296>>>0;return Y.putBytes(N),ea(U,X,Y),(Y.read>2048||0===Y.length())&&Y.compact(),eu},eu.digest=function(){var O,Z,en=$.util.createBuffer();en.putBytes(Y.bytes());var es=eu.fullMessageLength[eu.fullMessageLength.length-1]+eu.messageLengthSize&eu.blockLength-1;en.putBytes(J.substr(0,eu.blockLength-es));for(var eo=8*eu.fullMessageLength[0],ec=0;ec<eu.fullMessageLength.length-1;++ec)eo+=(O=8*eu.fullMessageLength[ec+1])/4294967296>>>0,en.putInt32(eo>>>0),eo=O>>>0;en.putInt32(eo);for(var eh=Array(U.length),ec=0;ec<U.length;++ec)eh[ec]=U[ec].slice(0);ea(eh,X,en);var ef=$.util.createBuffer();Z="SHA-512"===N?eh.length:"SHA-384"===N?eh.length-2:eh.length-4;for(var ec=0;ec<Z;++ec)ef.putInt32(eh[ec][0]),(ec!==Z-1||"SHA-512/224"!==N)&&ef.putInt32(eh[ec][1]);return ef},eu};var J=null,Z=!1,en=null,es=null;function eo(){J=String.fromCharCode(128)+$.util.fillString("\x00",128),en=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],(es={})["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],es["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],es["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],es["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],Z=!0}function ea(N,O,U){for(var $,Y,X,J,Z,es,eo,ea,ec,eu,eh,ef,eg,ey,ew,ev,eE,e_,eS,eI,eR,ek,eD,eA,eT,eC,eP,eN,eB,eL,eO,eM,eU,eF,eV,ez=U.length();ez>=128;){for(eB=0;eB<16;++eB)O[eB][0]=U.getInt32()>>>0,O[eB][1]=U.getInt32()>>>0;for(;eB<80;++eB)$=(((eL=(eM=O[eB-2])[0])>>>19|(eO=eM[1])<<13)^(eO>>>29|eL<<3)^eL>>>6)>>>0,Y=((eL<<13|eO>>>19)^(eO<<3|eL>>>29)^(eL<<26|eO>>>6))>>>0,X=(((eL=(eF=O[eB-15])[0])>>>1|(eO=eF[1])<<31)^(eL>>>8|eO<<24)^eL>>>7)>>>0,J=((eL<<31|eO>>>1)^(eL<<24|eO>>>8)^(eL<<25|eO>>>7))>>>0,eU=O[eB-7],eV=O[eB-16],eO=Y+eU[1]+J+eV[1],O[eB][0]=$+eU[0]+X+eV[0]+(eO/4294967296>>>0)>>>0,O[eB][1]=eO>>>0;for(eB=0,eg=N[0][0],ey=N[0][1],ew=N[1][0],ev=N[1][1],eE=N[2][0],e_=N[2][1],eS=N[3][0],eI=N[3][1],eR=N[4][0],ek=N[4][1],eD=N[5][0],eA=N[5][1],eT=N[6][0],eC=N[6][1],eP=N[7][0],eN=N[7][1];eB<80;++eB)eo=((eR>>>14|ek<<18)^(eR>>>18|ek<<14)^(ek>>>9|eR<<23))>>>0,ea=((eR<<18|ek>>>14)^(eR<<14|ek>>>18)^(ek<<23|eR>>>9))>>>0,ec=(eT^eR&(eD^eT))>>>0,eu=(eC^ek&(eA^eC))>>>0,Z=((eg>>>28|ey<<4)^(ey>>>2|eg<<30)^(ey>>>7|eg<<25))>>>0,es=((eg<<4|ey>>>28)^(ey<<30|eg>>>2)^(ey<<25|eg>>>7))>>>0,eh=(eg&ew|eE&(eg^ew))>>>0,ef=(ey&ev|e_&(ey^ev))>>>0,eO=eN+ea+eu+en[eB][1]+O[eB][1],$=eP+eo+ec+en[eB][0]+O[eB][0]+(eO/4294967296>>>0)>>>0,Y=eO>>>0,X=Z+eh+((eO=es+ef)/4294967296>>>0)>>>0,J=eO>>>0,eP=eT,eN=eC,eT=eD,eC=eA,eD=eR,eA=ek,eR=eS+$+((eO=eI+Y)/4294967296>>>0)>>>0,ek=eO>>>0,eS=eE,eI=e_,eE=ew,e_=ev,ew=eg,ev=ey,eg=$+X+((eO=Y+J)/4294967296>>>0)>>>0,ey=eO>>>0;eO=N[0][1]+ey,N[0][0]=N[0][0]+eg+(eO/4294967296>>>0)>>>0,N[0][1]=eO>>>0,eO=N[1][1]+ev,N[1][0]=N[1][0]+ew+(eO/4294967296>>>0)>>>0,N[1][1]=eO>>>0,eO=N[2][1]+e_,N[2][0]=N[2][0]+eE+(eO/4294967296>>>0)>>>0,N[2][1]=eO>>>0,eO=N[3][1]+eI,N[3][0]=N[3][0]+eS+(eO/4294967296>>>0)>>>0,N[3][1]=eO>>>0,eO=N[4][1]+ek,N[4][0]=N[4][0]+eR+(eO/4294967296>>>0)>>>0,N[4][1]=eO>>>0,eO=N[5][1]+eA,N[5][0]=N[5][0]+eD+(eO/4294967296>>>0)>>>0,N[5][1]=eO>>>0,eO=N[6][1]+eC,N[6][0]=N[6][0]+eT+(eO/4294967296>>>0)>>>0,N[6][1]=eO>>>0,eO=N[7][1]+eN,N[7][0]=N[7][0]+eP+(eO/4294967296>>>0)>>>0,N[7][1]=eO>>>0,ez-=128}}},7116:function(N,O,U){var $=U(4112),Y=U(2678).Buffer,X=U(3832),J=U(8807),Z=N.exports=X.util=X.util||{};function en(N){if(!(8===N||16===N||24===N||32===N))throw Error("Only 8, 16, 24, or 32 bits supported: "+N)}function es(N){if(this.data="",this.read=0,"string"==typeof N)this.data=N;else if(Z.isArrayBuffer(N)||Z.isArrayBufferView(N)){if(void 0!==Y&&N instanceof Y)this.data=N.toString("binary");else{var O=new Uint8Array(N);try{this.data=String.fromCharCode.apply(null,O)}catch(N){for(var U=0;U<O.length;++U)this.putByte(O[U])}}}else(N instanceof es||"object"==typeof N&&"string"==typeof N.data&&"number"==typeof N.read)&&(this.data=N.data,this.read=N.read);this._constructedStringLength=0}!function(){if(void 0!==$&&$.nextTick,"function"==typeof setImmediate){Z.setImmediate=function(){return setImmediate.apply(void 0,arguments)},Z.nextTick=function(N){return setImmediate(N)};return}if(Z.setImmediate=function(N){setTimeout(N,0)},"undefined"!=typeof window&&"function"==typeof window.postMessage){var N="forge.setImmediate",O=[];function U(U){if(U.source===window&&U.data===N){U.stopPropagation();var $=O.slice();O.length=0,$.forEach(function(N){N()})}}Z.setImmediate=function(U){O.push(U),1===O.length&&window.postMessage(N,"*")},window.addEventListener("message",U,!0)}if("undefined"!=typeof MutationObserver){var Y=Date.now(),X=!0,J=document.createElement("div"),O=[];new MutationObserver(function(){var N=O.slice();O.length=0,N.forEach(function(N){N()})}).observe(J,{attributes:!0});var en=Z.setImmediate;Z.setImmediate=function(N){Date.now()-Y>15?(Y=Date.now(),en(N)):(O.push(N),1===O.length&&J.setAttribute("a",X=!X))}}Z.nextTick=Z.setImmediate}(),Z.isNodejs=void 0!==$&&$.versions&&$.versions.node,Z.globalScope=function(){return Z.isNodejs?U.g:"undefined"==typeof self?window:self}(),Z.isArray=Array.isArray||function(N){return"[object Array]"===Object.prototype.toString.call(N)},Z.isArrayBuffer=function(N){return"undefined"!=typeof ArrayBuffer&&N instanceof ArrayBuffer},Z.isArrayBufferView=function(N){return N&&Z.isArrayBuffer(N.buffer)&&void 0!==N.byteLength},Z.ByteBuffer=es,Z.ByteStringBuffer=es;var eo=4096;function ea(N,O){O=O||{},this.read=O.readOffset||0,this.growSize=O.growSize||1024;var U=Z.isArrayBuffer(N),$=Z.isArrayBufferView(N);if(U||$){U?this.data=new DataView(N):this.data=new DataView(N.buffer,N.byteOffset,N.byteLength),this.write="writeOffset"in O?O.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!=N&&this.putBytes(N),"writeOffset"in O&&(this.write=O.writeOffset)}Z.ByteStringBuffer.prototype._optimizeConstructedString=function(N){this._constructedStringLength+=N,this._constructedStringLength>eo&&(this.data.substr(0,1),this._constructedStringLength=0)},Z.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},Z.ByteStringBuffer.prototype.isEmpty=function(){return 0>=this.length()},Z.ByteStringBuffer.prototype.putByte=function(N){return this.putBytes(String.fromCharCode(N))},Z.ByteStringBuffer.prototype.fillWithByte=function(N,O){N=String.fromCharCode(N);for(var U=this.data;O>0;)1&O&&(U+=N),(O>>>=1)>0&&(N+=N);return this.data=U,this._optimizeConstructedString(O),this},Z.ByteStringBuffer.prototype.putBytes=function(N){return this.data+=N,this._optimizeConstructedString(N.length),this},Z.ByteStringBuffer.prototype.putString=function(N){return this.putBytes(Z.encodeUtf8(N))},Z.ByteStringBuffer.prototype.putInt16=function(N){return this.putBytes(String.fromCharCode(N>>8&255)+String.fromCharCode(255&N))},Z.ByteStringBuffer.prototype.putInt24=function(N){return this.putBytes(String.fromCharCode(N>>16&255)+String.fromCharCode(N>>8&255)+String.fromCharCode(255&N))},Z.ByteStringBuffer.prototype.putInt32=function(N){return this.putBytes(String.fromCharCode(N>>24&255)+String.fromCharCode(N>>16&255)+String.fromCharCode(N>>8&255)+String.fromCharCode(255&N))},Z.ByteStringBuffer.prototype.putInt16Le=function(N){return this.putBytes(String.fromCharCode(255&N)+String.fromCharCode(N>>8&255))},Z.ByteStringBuffer.prototype.putInt24Le=function(N){return this.putBytes(String.fromCharCode(255&N)+String.fromCharCode(N>>8&255)+String.fromCharCode(N>>16&255))},Z.ByteStringBuffer.prototype.putInt32Le=function(N){return this.putBytes(String.fromCharCode(255&N)+String.fromCharCode(N>>8&255)+String.fromCharCode(N>>16&255)+String.fromCharCode(N>>24&255))},Z.ByteStringBuffer.prototype.putInt=function(N,O){en(O);var U="";do O-=8,U+=String.fromCharCode(N>>O&255);while(O>0);return this.putBytes(U)},Z.ByteStringBuffer.prototype.putSignedInt=function(N,O){return N<0&&(N+=2<<O-1),this.putInt(N,O)},Z.ByteStringBuffer.prototype.putBuffer=function(N){return this.putBytes(N.getBytes())},Z.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},Z.ByteStringBuffer.prototype.getInt16=function(){var N=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,N},Z.ByteStringBuffer.prototype.getInt24=function(){var N=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,N},Z.ByteStringBuffer.prototype.getInt32=function(){var N=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,N},Z.ByteStringBuffer.prototype.getInt16Le=function(){var N=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,N},Z.ByteStringBuffer.prototype.getInt24Le=function(){var N=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,N},Z.ByteStringBuffer.prototype.getInt32Le=function(){var N=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,N},Z.ByteStringBuffer.prototype.getInt=function(N){en(N);var O=0;do O=(O<<8)+this.data.charCodeAt(this.read++),N-=8;while(N>0);return O},Z.ByteStringBuffer.prototype.getSignedInt=function(N){var O=this.getInt(N),U=2<<N-2;return O>=U&&(O-=U<<1),O},Z.ByteStringBuffer.prototype.getBytes=function(N){var O;return N?(N=Math.min(this.length(),N),O=this.data.slice(this.read,this.read+N),this.read+=N):0===N?O="":(O=0===this.read?this.data:this.data.slice(this.read),this.clear()),O},Z.ByteStringBuffer.prototype.bytes=function(N){return void 0===N?this.data.slice(this.read):this.data.slice(this.read,this.read+N)},Z.ByteStringBuffer.prototype.at=function(N){return this.data.charCodeAt(this.read+N)},Z.ByteStringBuffer.prototype.setAt=function(N,O){return this.data=this.data.substr(0,this.read+N)+String.fromCharCode(O)+this.data.substr(this.read+N+1),this},Z.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},Z.ByteStringBuffer.prototype.copy=function(){var N=Z.createBuffer(this.data);return N.read=this.read,N},Z.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},Z.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},Z.ByteStringBuffer.prototype.truncate=function(N){var O=Math.max(0,this.length()-N);return this.data=this.data.substr(this.read,O),this.read=0,this},Z.ByteStringBuffer.prototype.toHex=function(){for(var N="",O=this.read;O<this.data.length;++O){var U=this.data.charCodeAt(O);U<16&&(N+="0"),N+=U.toString(16)}return N},Z.ByteStringBuffer.prototype.toString=function(){return Z.decodeUtf8(this.bytes())},Z.DataBuffer=ea,Z.DataBuffer.prototype.length=function(){return this.write-this.read},Z.DataBuffer.prototype.isEmpty=function(){return 0>=this.length()},Z.DataBuffer.prototype.accommodate=function(N,O){if(this.length()>=N)return this;O=Math.max(O||this.growSize,N);var U=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),$=new Uint8Array(this.length()+O);return $.set(U),this.data=new DataView($.buffer),this},Z.DataBuffer.prototype.putByte=function(N){return this.accommodate(1),this.data.setUint8(this.write++,N),this},Z.DataBuffer.prototype.fillWithByte=function(N,O){this.accommodate(O);for(var U=0;U<O;++U)this.data.setUint8(N);return this},Z.DataBuffer.prototype.putBytes=function(N,O){if(Z.isArrayBufferView(N)){var U,$=new Uint8Array(N.buffer,N.byteOffset,N.byteLength),Y=$.byteLength-$.byteOffset;this.accommodate(Y);var X=new Uint8Array(this.data.buffer,this.write);return X.set($),this.write+=Y,this}if(Z.isArrayBuffer(N)){var $=new Uint8Array(N);this.accommodate($.byteLength);var X=new Uint8Array(this.data.buffer);return X.set($,this.write),this.write+=$.byteLength,this}if(N instanceof Z.DataBuffer||"object"==typeof N&&"number"==typeof N.read&&"number"==typeof N.write&&Z.isArrayBufferView(N.data)){var $=new Uint8Array(N.data.byteLength,N.read,N.length());this.accommodate($.byteLength);var X=new Uint8Array(N.data.byteLength,this.write);return X.set($),this.write+=$.byteLength,this}if(N instanceof Z.ByteStringBuffer&&(N=N.data,O="binary"),O=O||"binary","string"==typeof N){if("hex"===O)return this.accommodate(Math.ceil(N.length/2)),U=new Uint8Array(this.data.buffer,this.write),this.write+=Z.binary.hex.decode(N,U,this.write),this;if("base64"===O)return this.accommodate(3*Math.ceil(N.length/4)),U=new Uint8Array(this.data.buffer,this.write),this.write+=Z.binary.base64.decode(N,U,this.write),this;if("utf8"===O&&(N=Z.encodeUtf8(N),O="binary"),"binary"===O||"raw"===O)return this.accommodate(N.length),U=new Uint8Array(this.data.buffer,this.write),this.write+=Z.binary.raw.decode(U),this;if("utf16"===O)return this.accommodate(2*N.length),U=new Uint16Array(this.data.buffer,this.write),this.write+=Z.text.utf16.encode(U),this;throw Error("Invalid encoding: "+O)}throw Error("Invalid parameter: "+N)},Z.DataBuffer.prototype.putBuffer=function(N){return this.putBytes(N),N.clear(),this},Z.DataBuffer.prototype.putString=function(N){return this.putBytes(N,"utf16")},Z.DataBuffer.prototype.putInt16=function(N){return this.accommodate(2),this.data.setInt16(this.write,N),this.write+=2,this},Z.DataBuffer.prototype.putInt24=function(N){return this.accommodate(3),this.data.setInt16(this.write,N>>8&65535),this.data.setInt8(this.write,N>>16&255),this.write+=3,this},Z.DataBuffer.prototype.putInt32=function(N){return this.accommodate(4),this.data.setInt32(this.write,N),this.write+=4,this},Z.DataBuffer.prototype.putInt16Le=function(N){return this.accommodate(2),this.data.setInt16(this.write,N,!0),this.write+=2,this},Z.DataBuffer.prototype.putInt24Le=function(N){return this.accommodate(3),this.data.setInt8(this.write,N>>16&255),this.data.setInt16(this.write,N>>8&65535,!0),this.write+=3,this},Z.DataBuffer.prototype.putInt32Le=function(N){return this.accommodate(4),this.data.setInt32(this.write,N,!0),this.write+=4,this},Z.DataBuffer.prototype.putInt=function(N,O){en(O),this.accommodate(O/8);do O-=8,this.data.setInt8(this.write++,N>>O&255);while(O>0);return this},Z.DataBuffer.prototype.putSignedInt=function(N,O){return en(O),this.accommodate(O/8),N<0&&(N+=2<<O-1),this.putInt(N,O)},Z.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},Z.DataBuffer.prototype.getInt16=function(){var N=this.data.getInt16(this.read);return this.read+=2,N},Z.DataBuffer.prototype.getInt24=function(){var N=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,N},Z.DataBuffer.prototype.getInt32=function(){var N=this.data.getInt32(this.read);return this.read+=4,N},Z.DataBuffer.prototype.getInt16Le=function(){var N=this.data.getInt16(this.read,!0);return this.read+=2,N},Z.DataBuffer.prototype.getInt24Le=function(){var N=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,N},Z.DataBuffer.prototype.getInt32Le=function(){var N=this.data.getInt32(this.read,!0);return this.read+=4,N},Z.DataBuffer.prototype.getInt=function(N){en(N);var O=0;do O=(O<<8)+this.data.getInt8(this.read++),N-=8;while(N>0);return O},Z.DataBuffer.prototype.getSignedInt=function(N){var O=this.getInt(N),U=2<<N-2;return O>=U&&(O-=U<<1),O},Z.DataBuffer.prototype.getBytes=function(N){var O;return N?(N=Math.min(this.length(),N),O=this.data.slice(this.read,this.read+N),this.read+=N):0===N?O="":(O=0===this.read?this.data:this.data.slice(this.read),this.clear()),O},Z.DataBuffer.prototype.bytes=function(N){return void 0===N?this.data.slice(this.read):this.data.slice(this.read,this.read+N)},Z.DataBuffer.prototype.at=function(N){return this.data.getUint8(this.read+N)},Z.DataBuffer.prototype.setAt=function(N,O){return this.data.setUint8(N,O),this},Z.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},Z.DataBuffer.prototype.copy=function(){return new Z.DataBuffer(this)},Z.DataBuffer.prototype.compact=function(){if(this.read>0){var N=new Uint8Array(this.data.buffer,this.read),O=new Uint8Array(N.byteLength);O.set(N),this.data=new DataView(O),this.write-=this.read,this.read=0}return this},Z.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},Z.DataBuffer.prototype.truncate=function(N){return this.write=Math.max(0,this.length()-N),this.read=Math.min(this.read,this.write),this},Z.DataBuffer.prototype.toHex=function(){for(var N="",O=this.read;O<this.data.byteLength;++O){var U=this.data.getUint8(O);U<16&&(N+="0"),N+=U.toString(16)}return N},Z.DataBuffer.prototype.toString=function(N){var O=new Uint8Array(this.data,this.read,this.length());if("binary"===(N=N||"utf8")||"raw"===N)return Z.binary.raw.encode(O);if("hex"===N)return Z.binary.hex.encode(O);if("base64"===N)return Z.binary.base64.encode(O);if("utf8"===N)return Z.text.utf8.decode(O);if("utf16"===N)return Z.text.utf16.decode(O);throw Error("Invalid encoding: "+N)},Z.createBuffer=function(N,O){return O=O||"raw",void 0!==N&&"utf8"===O&&(N=Z.encodeUtf8(N)),new Z.ByteBuffer(N)},Z.fillString=function(N,O){for(var U="";O>0;)1&O&&(U+=N),(O>>>=1)>0&&(N+=N);return U},Z.xorBytes=function(N,O,U){for(var $="",Y="",X="",J=0,Z=0;U>0;--U,++J)Y=N.charCodeAt(J)^O.charCodeAt(J),Z>=10&&($+=X,X="",Z=0),X+=String.fromCharCode(Y),++Z;return $+X},Z.hexToBytes=function(N){var O="",U=0;for(!0&N.length&&(U=1,O+=String.fromCharCode(parseInt(N[0],16)));U<N.length;U+=2)O+=String.fromCharCode(parseInt(N.substr(U,2),16));return O},Z.bytesToHex=function(N){return Z.createBuffer(N).toHex()},Z.int32ToBytes=function(N){return String.fromCharCode(N>>24&255)+String.fromCharCode(N>>16&255)+String.fromCharCode(N>>8&255)+String.fromCharCode(255&N)};var ec="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",eu=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],eh="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";Z.encode64=function(N,O){for(var U,$,Y,X="",J="",Z=0;Z<N.length;)U=N.charCodeAt(Z++),$=N.charCodeAt(Z++),Y=N.charCodeAt(Z++),X+=ec.charAt(U>>2)+ec.charAt((3&U)<<4|$>>4),isNaN($)?X+="==":X+=ec.charAt((15&$)<<2|Y>>6)+(isNaN(Y)?"=":ec.charAt(63&Y)),O&&X.length>O&&(J+=X.substr(0,O)+"\r\n",X=X.substr(O));return J+X},Z.decode64=function(N){N=N.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var O,U,$,Y,X="",J=0;J<N.length;)O=eu[N.charCodeAt(J++)-43],U=eu[N.charCodeAt(J++)-43],$=eu[N.charCodeAt(J++)-43],Y=eu[N.charCodeAt(J++)-43],X+=String.fromCharCode(O<<2|U>>4),64!==$&&(X+=String.fromCharCode((15&U)<<4|$>>2),64!==Y&&(X+=String.fromCharCode((3&$)<<6|Y)));return X},Z.encodeUtf8=function(N){return unescape(encodeURIComponent(N))},Z.decodeUtf8=function(N){return decodeURIComponent(escape(N))},Z.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:J.encode,decode:J.decode}},Z.binary.raw.encode=function(N){return String.fromCharCode.apply(null,N)},Z.binary.raw.decode=function(N,O,U){var $=O;$||($=new Uint8Array(N.length));for(var Y=U=U||0,X=0;X<N.length;++X)$[Y++]=N.charCodeAt(X);return O?Y-U:$},Z.binary.hex.encode=Z.bytesToHex,Z.binary.hex.decode=function(N,O,U){var $=O;$||($=new Uint8Array(Math.ceil(N.length/2)));var Y=0,X=U=U||0;for(1&N.length&&(Y=1,$[X++]=parseInt(N[0],16));Y<N.length;Y+=2)$[X++]=parseInt(N.substr(Y,2),16);return O?X-U:$},Z.binary.base64.encode=function(N,O){for(var U,$,Y,X="",J="",Z=0;Z<N.byteLength;)U=N[Z++],$=N[Z++],Y=N[Z++],X+=ec.charAt(U>>2)+ec.charAt((3&U)<<4|$>>4),isNaN($)?X+="==":X+=ec.charAt((15&$)<<2|Y>>6)+(isNaN(Y)?"=":ec.charAt(63&Y)),O&&X.length>O&&(J+=X.substr(0,O)+"\r\n",X=X.substr(O));return J+X},Z.binary.base64.decode=function(N,O,U){var $,Y,X,J,Z=O;Z||(Z=new Uint8Array(3*Math.ceil(N.length/4))),N=N.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var en=0,es=U=U||0;en<N.length;)$=eu[N.charCodeAt(en++)-43],Y=eu[N.charCodeAt(en++)-43],X=eu[N.charCodeAt(en++)-43],J=eu[N.charCodeAt(en++)-43],Z[es++]=$<<2|Y>>4,64!==X&&(Z[es++]=(15&Y)<<4|X>>2,64!==J&&(Z[es++]=(3&X)<<6|J));return O?es-U:Z.subarray(0,es)},Z.binary.base58.encode=function(N,O){return Z.binary.baseN.encode(N,eh,O)},Z.binary.base58.decode=function(N,O){return Z.binary.baseN.decode(N,eh,O)},Z.text={utf8:{},utf16:{}},Z.text.utf8.encode=function(N,O,U){N=Z.encodeUtf8(N);var $=O;$||($=new Uint8Array(N.length));for(var Y=U=U||0,X=0;X<N.length;++X)$[Y++]=N.charCodeAt(X);return O?Y-U:$},Z.text.utf8.decode=function(N){return Z.decodeUtf8(String.fromCharCode.apply(null,N))},Z.text.utf16.encode=function(N,O,U){var $=O;$||($=new Uint8Array(2*N.length));for(var Y=new Uint16Array($.buffer),X=U=U||0,J=U,Z=0;Z<N.length;++Z)Y[J++]=N.charCodeAt(Z),X+=2;return O?X-U:$},Z.text.utf16.decode=function(N){return String.fromCharCode.apply(null,new Uint16Array(N.buffer))},Z.deflate=function(N,O,U){if(O=Z.decode64(N.deflate(Z.encode64(O)).rval),U){var $=2;32&O.charCodeAt(1)&&($=6),O=O.substring($,O.length-4)}return O},Z.inflate=function(N,O,U){var $=N.inflate(Z.encode64(O)).rval;return null===$?null:Z.decode64($)};var ef=function(N,O,U){if(!N)throw Error("WebStorage not available.");if(null===U?$=N.removeItem(O):(U=Z.encode64(JSON.stringify(U)),$=N.setItem(O,U)),void 0!==$&&!0!==$.rval){var $,Y=Error($.error.message);throw Y.id=$.error.id,Y.name=$.error.name,Y}},eg=function(N,O){if(!N)throw Error("WebStorage not available.");var U=N.getItem(O);if(N.init){if(null===U.rval){if(U.error){var $=Error(U.error.message);throw $.id=U.error.id,$.name=U.error.name,$}U=null}else U=U.rval}return null!==U&&(U=JSON.parse(Z.decode64(U))),U},ey=function(N,O,U,$){var Y=eg(N,O);null===Y&&(Y={}),Y[U]=$,ef(N,O,Y)},ew=function(N,O,U){var $=eg(N,O);return null!==$&&($=U in $?$[U]:null),$},ev=function(N,O,U){var $=eg(N,O);if(null!==$&&U in $){delete $[U];var Y=!0;for(var X in $){Y=!1;break}Y&&($=null),ef(N,O,$)}},eE=function(N,O){ef(N,O,null)},e_=function(N,O,U){var $,Y=null;void 0===U&&(U=["web","flash"]);var X=!1,J=null;for(var Z in U){$=U[Z];try{if("flash"===$||"both"===$){if(null===O[0])throw Error("Flash local storage not available.");Y=N.apply(this,O),X="flash"===$}("web"===$||"both"===$)&&(O[0]=localStorage,Y=N.apply(this,O),X=!0)}catch(N){J=N}if(X)break}if(!X)throw J;return Y};Z.setItem=function(N,O,U,$,Y){e_(ey,arguments,Y)},Z.getItem=function(N,O,U,$){return e_(ew,arguments,$)},Z.removeItem=function(N,O,U,$){e_(ev,arguments,$)},Z.clearItems=function(N,O,U){e_(eE,arguments,U)},Z.isEmpty=function(N){for(var O in N)if(N.hasOwnProperty(O))return!1;return!0},Z.format=function(N){for(var O,U,$=/%./g,Y=0,X=[],J=0;O=$.exec(N);){(U=N.substring(J,$.lastIndex-2)).length>0&&X.push(U),J=$.lastIndex;var Z=O[0][1];switch(Z){case"s":case"o":Y<arguments.length?X.push(arguments[Y+++1]):X.push("<?>");break;case"%":X.push("%");break;default:X.push("<%"+Z+"?>")}}return X.push(N.substring(J)),X.join("")},Z.formatNumber=function(N,O,U,$){var Y=N,X=isNaN(O=Math.abs(O))?2:O,J=void 0===U?",":U,Z=void 0===$?".":$,en=Y<0?"-":"",es=parseInt(Y=Math.abs(+Y||0).toFixed(X),10)+"",eo=es.length>3?es.length%3:0;return en+(eo?es.substr(0,eo)+Z:"")+es.substr(eo).replace(/(\d{3})(?=\d)/g,"$1"+Z)+(X?J+Math.abs(Y-es).toFixed(X).slice(2):"")},Z.formatSize=function(N){return N=N>=1073741824?Z.formatNumber(N/1073741824,2,".","")+" GiB":N>=1048576?Z.formatNumber(N/1048576,2,".","")+" MiB":N>=1024?Z.formatNumber(N/1024,0)+" KiB":Z.formatNumber(N,0)+" bytes"},Z.bytesFromIP=function(N){return -1!==N.indexOf(".")?Z.bytesFromIPv4(N):-1!==N.indexOf(":")?Z.bytesFromIPv6(N):null},Z.bytesFromIPv4=function(N){if(4!==(N=N.split(".")).length)return null;for(var O=Z.createBuffer(),U=0;U<N.length;++U){var $=parseInt(N[U],10);if(isNaN($))return null;O.putByte($)}return O.getBytes()},Z.bytesFromIPv6=function(N){for(var O=0,U=(8-(N=N.split(":").filter(function(N){return 0===N.length&&++O,!0})).length+O)*2,$=Z.createBuffer(),Y=0;Y<8;++Y){if(!N[Y]||0===N[Y].length){$.fillWithByte(0,U),U=0;continue}var X=Z.hexToBytes(N[Y]);X.length<2&&$.putByte(0),$.putBytes(X)}return $.getBytes()},Z.bytesToIP=function(N){return 4===N.length?Z.bytesToIPv4(N):16===N.length?Z.bytesToIPv6(N):null},Z.bytesToIPv4=function(N){if(4!==N.length)return null;for(var O=[],U=0;U<N.length;++U)O.push(N.charCodeAt(U));return O.join(".")},Z.bytesToIPv6=function(N){if(16!==N.length)return null;for(var O=[],U=[],$=0,Y=0;Y<N.length;Y+=2){for(var X=Z.bytesToHex(N[Y]+N[Y+1]);"0"===X[0]&&"0"!==X;)X=X.substr(1);if("0"===X){var J=U[U.length-1],en=O.length;J&&en===J.end+1?(J.end=en,J.end-J.start>U[$].end-U[$].start&&($=U.length-1)):U.push({start:en,end:en})}O.push(X)}if(U.length>0){var es=U[$];es.end-es.start>0&&(O.splice(es.start,es.end-es.start+1,""),0===es.start&&O.unshift(""),7===es.end&&O.push(""))}return O.join(":")},Z.estimateCores=function(N,O){if("function"==typeof N&&(O=N,N={}),N=N||{},"cores"in Z&&!N.update)return O(null,Z.cores);if("undefined"!=typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return Z.cores=navigator.hardwareConcurrency,O(null,Z.cores);if("undefined"==typeof Worker)return Z.cores=1,O(null,Z.cores);if("undefined"==typeof Blob)return Z.cores=2,O(null,Z.cores);var U=URL.createObjectURL(new Blob(["(",(function(){self.addEventListener("message",function(N){for(var O=Date.now(),U=O+4;Date.now()<U;);self.postMessage({st:O,et:U})})}).toString(),")()"],{type:"application/javascript"}));function $(N,J,en){if(0===J){var es=Math.floor(N.reduce(function(N,O){return N+O},0)/N.length);return Z.cores=Math.max(1,es),URL.revokeObjectURL(U),O(null,Z.cores)}Y(en,function(O,U){N.push(X(en,U)),$(N,J-1,en)})}function Y(N,O){for(var $=[],Y=[],X=0;X<N;++X){var J=new Worker(U);J.addEventListener("message",function(U){if(Y.push(U.data),Y.length===N){for(var X=0;X<N;++X)$[X].terminate();O(null,Y)}}),$.push(J)}for(var X=0;X<N;++X)$[X].postMessage(X)}function X(N,O){for(var U=[],$=0;$<N;++$)for(var Y=O[$],X=U[$]=[],J=0;J<N;++J)if($!==J){var Z=O[J];(Y.st>Z.st&&Y.st<Z.et||Z.st>Y.st&&Z.st<Y.et)&&X.push(J)}return U.reduce(function(N,O){return Math.max(N,O.length)},0)}$([],5,16)}},2100:function(N,O,U){"use strict";N.exports=U(9482)},9482:function(N,O,U){"use strict";var $=O;function Y(){$.util._configure(),$.Writer._configure($.BufferWriter),$.Reader._configure($.BufferReader)}$.build="minimal",$.Writer=U(1173),$.BufferWriter=U(3155),$.Reader=U(1408),$.BufferReader=U(593),$.util=U(9693),$.rpc=U(5994),$.roots=U(5054),$.configure=Y,Y()},1408:function(N,O,U){"use strict";N.exports=en;var $,Y=U(9693),X=Y.LongBits,J=Y.utf8;function Z(N,O){return RangeError("index out of range: "+N.pos+" + "+(O||1)+" > "+N.len)}function en(N){this.buf=N,this.pos=0,this.len=N.length}var es="undefined"!=typeof Uint8Array?function(N){if(N instanceof Uint8Array||Array.isArray(N))return new en(N);throw Error("illegal buffer")}:function(N){if(Array.isArray(N))return new en(N);throw Error("illegal buffer")},eo=function(){return Y.Buffer?function(N){return(en.create=function(N){return Y.Buffer.isBuffer(N)?new $(N):es(N)})(N)}:es};function ea(){var N=new X(0,0),O=0;if(this.len-this.pos>4){for(;O<4;++O)if(N.lo=(N.lo|(127&this.buf[this.pos])<<7*O)>>>0,this.buf[this.pos++]<128)return N;if(N.lo=(N.lo|(127&this.buf[this.pos])<<28)>>>0,N.hi=(N.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return N;O=0}else{for(;O<3;++O){if(this.pos>=this.len)throw Z(this);if(N.lo=(N.lo|(127&this.buf[this.pos])<<7*O)>>>0,this.buf[this.pos++]<128)return N}return N.lo=(N.lo|(127&this.buf[this.pos++])<<7*O)>>>0,N}if(this.len-this.pos>4){for(;O<5;++O)if(N.hi=(N.hi|(127&this.buf[this.pos])<<7*O+3)>>>0,this.buf[this.pos++]<128)return N}else for(;O<5;++O){if(this.pos>=this.len)throw Z(this);if(N.hi=(N.hi|(127&this.buf[this.pos])<<7*O+3)>>>0,this.buf[this.pos++]<128)return N}throw Error("invalid varint encoding")}function ec(N,O){return(N[O-4]|N[O-3]<<8|N[O-2]<<16|N[O-1]<<24)>>>0}function eu(){if(this.pos+8>this.len)throw Z(this,8);return new X(ec(this.buf,this.pos+=4),ec(this.buf,this.pos+=4))}en.create=eo(),en.prototype._slice=Y.Array.prototype.subarray||Y.Array.prototype.slice,en.prototype.uint32=function(){var N=4294967295;return function(){if(N=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(N=(N|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(N=(N|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(N=(N|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(N=(N|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return N;if((this.pos+=5)>this.len)throw this.pos=this.len,Z(this,10);return N}}(),en.prototype.int32=function(){return 0|this.uint32()},en.prototype.sint32=function(){var N=this.uint32();return N>>>1^-(1&N)|0},en.prototype.bool=function(){return 0!==this.uint32()},en.prototype.fixed32=function(){if(this.pos+4>this.len)throw Z(this,4);return ec(this.buf,this.pos+=4)},en.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Z(this,4);return 0|ec(this.buf,this.pos+=4)},en.prototype.float=function(){if(this.pos+4>this.len)throw Z(this,4);var N=Y.float.readFloatLE(this.buf,this.pos);return this.pos+=4,N},en.prototype.double=function(){if(this.pos+8>this.len)throw Z(this,4);var N=Y.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,N},en.prototype.bytes=function(){var N=this.uint32(),O=this.pos,U=this.pos+N;if(U>this.len)throw Z(this,N);return(this.pos+=N,Array.isArray(this.buf))?this.buf.slice(O,U):O===U?new this.buf.constructor(0):this._slice.call(this.buf,O,U)},en.prototype.string=function(){var N=this.bytes();return J.read(N,0,N.length)},en.prototype.skip=function(N){if("number"==typeof N){if(this.pos+N>this.len)throw Z(this,N);this.pos+=N}else do if(this.pos>=this.len)throw Z(this);while(128&this.buf[this.pos++]);return this},en.prototype.skipType=function(N){switch(N){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(N=7&this.uint32());)this.skipType(N);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+N+" at offset "+this.pos)}return this},en._configure=function(N){$=N,en.create=eo(),$._configure();var O=Y.Long?"toLong":"toNumber";Y.merge(en.prototype,{int64:function(){return ea.call(this)[O](!1)},uint64:function(){return ea.call(this)[O](!0)},sint64:function(){return ea.call(this).zzDecode()[O](!1)},fixed64:function(){return eu.call(this)[O](!0)},sfixed64:function(){return eu.call(this)[O](!1)}})}},593:function(N,O,U){"use strict";N.exports=X;var $=U(1408);(X.prototype=Object.create($.prototype)).constructor=X;var Y=U(9693);function X(N){$.call(this,N)}X._configure=function(){Y.Buffer&&(X.prototype._slice=Y.Buffer.prototype.slice)},X.prototype.string=function(){var N=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+N,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+N,this.len))},X._configure()},5054:function(N){"use strict";N.exports={}},5994:function(N,O,U){"use strict";O.Service=U(7948)},7948:function(N,O,U){"use strict";N.exports=Y;var $=U(9693);function Y(N,O,U){if("function"!=typeof N)throw TypeError("rpcImpl must be a function");$.EventEmitter.call(this),this.rpcImpl=N,this.requestDelimited=!!O,this.responseDelimited=!!U}(Y.prototype=Object.create($.EventEmitter.prototype)).constructor=Y,Y.prototype.rpcCall=function N(O,U,Y,X,J){if(!X)throw TypeError("request must be specified");var Z=this;if(!J)return $.asPromise(N,Z,O,U,Y,X);if(!Z.rpcImpl){setTimeout(function(){J(Error("already ended"))},0);return}try{return Z.rpcImpl(O,U[Z.requestDelimited?"encodeDelimited":"encode"](X).finish(),function(N,U){if(N)return Z.emit("error",N,O),J(N);if(null===U){Z.end(!0);return}if(!(U instanceof Y))try{U=Y[Z.responseDelimited?"decodeDelimited":"decode"](U)}catch(N){return Z.emit("error",N,O),J(N)}return Z.emit("data",U,O),J(null,U)})}catch(N){Z.emit("error",N,O),setTimeout(function(){J(N)},0);return}},Y.prototype.end=function(N){return this.rpcImpl&&(N||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},1945:function(N,O,U){"use strict";N.exports=Y;var $=U(9693);function Y(N,O){this.lo=N>>>0,this.hi=O>>>0}var X=Y.zero=new Y(0,0);X.toNumber=function(){return 0},X.zzEncode=X.zzDecode=function(){return this},X.length=function(){return 1};var J=Y.zeroHash="\x00\x00\x00\x00\x00\x00\x00\x00";Y.fromNumber=function(N){if(0===N)return X;var O=N<0;O&&(N=-N);var U=N>>>0,$=(N-U)/4294967296>>>0;return O&&($=~$>>>0,U=~U>>>0,++U>4294967295&&(U=0,++$>4294967295&&($=0))),new Y(U,$)},Y.from=function(N){if("number"==typeof N)return Y.fromNumber(N);if($.isString(N)){if(!$.Long)return Y.fromNumber(parseInt(N,10));N=$.Long.fromString(N)}return N.low||N.high?new Y(N.low>>>0,N.high>>>0):X},Y.prototype.toNumber=function(N){if(!N&&this.hi>>>31){var O=~this.lo+1>>>0,U=~this.hi>>>0;return O||(U=U+1>>>0),-(O+4294967296*U)}return this.lo+4294967296*this.hi},Y.prototype.toLong=function(N){return $.Long?new $.Long(0|this.lo,0|this.hi,!!N):{low:0|this.lo,high:0|this.hi,unsigned:!!N}};var Z=String.prototype.charCodeAt;Y.fromHash=function(N){return N===J?X:new Y((Z.call(N,0)|Z.call(N,1)<<8|Z.call(N,2)<<16|Z.call(N,3)<<24)>>>0,(Z.call(N,4)|Z.call(N,5)<<8|Z.call(N,6)<<16|Z.call(N,7)<<24)>>>0)},Y.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Y.prototype.zzEncode=function(){var N=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^N)>>>0,this.lo=(this.lo<<1^N)>>>0,this},Y.prototype.zzDecode=function(){var N=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^N)>>>0,this.hi=(this.hi>>>1^N)>>>0,this},Y.prototype.length=function(){var N=this.lo,O=(this.lo>>>28|this.hi<<4)>>>0,U=this.hi>>>24;return 0===U?0===O?N<16384?N<128?1:2:N<2097152?3:4:O<16384?O<128?5:6:O<2097152?7:8:U<128?9:10}},9693:function(N,O,U){"use strict";var $=O;function Y(N,O,U){for(var $=Object.keys(O),Y=0;Y<$.length;++Y)void 0!==N[$[Y]]&&U||(N[$[Y]]=O[$[Y]]);return N}function X(N){function O(N,U){if(!(this instanceof O))return new O(N,U);Object.defineProperty(this,"message",{get:function(){return N}}),Error.captureStackTrace?Error.captureStackTrace(this,O):Object.defineProperty(this,"stack",{value:Error().stack||""}),U&&Y(this,U)}return(O.prototype=Object.create(Error.prototype)).constructor=O,Object.defineProperty(O.prototype,"name",{get:function(){return N}}),O.prototype.toString=function(){return this.name+": "+this.message},O}$.asPromise=U(4537),$.base64=U(7419),$.EventEmitter=U(9211),$.float=U(945),$.inquire=U(7199),$.utf8=U(4997),$.pool=U(6662),$.LongBits=U(1945),$.isNode=!!(void 0!==U.g&&U.g&&U.g.process&&U.g.process.versions&&U.g.process.versions.node),$.global=$.isNode&&U.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,$.emptyArray=Object.freeze?Object.freeze([]):[],$.emptyObject=Object.freeze?Object.freeze({}):{},$.isInteger=Number.isInteger||function(N){return"number"==typeof N&&isFinite(N)&&Math.floor(N)===N},$.isString=function(N){return"string"==typeof N||N instanceof String},$.isObject=function(N){return N&&"object"==typeof N},$.isset=$.isSet=function(N,O){var U=N[O];return!!(null!=U&&N.hasOwnProperty(O))&&("object"!=typeof U||(Array.isArray(U)?U.length:Object.keys(U).length)>0)},$.Buffer=function(){try{var N=$.inquire("buffer").Buffer;return N.prototype.utf8Write?N:null}catch(N){return null}}(),$._Buffer_from=null,$._Buffer_allocUnsafe=null,$.newBuffer=function(N){return"number"==typeof N?$.Buffer?$._Buffer_allocUnsafe(N):new $.Array(N):$.Buffer?$._Buffer_from(N):"undefined"==typeof Uint8Array?N:new Uint8Array(N)},$.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,$.Long=$.global.dcodeIO&&$.global.dcodeIO.Long||$.global.Long||$.inquire("long"),$.key2Re=/^true|false|0|1$/,$.key32Re=/^-?(?:0|[1-9][0-9]*)$/,$.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,$.longToHash=function(N){return N?$.LongBits.from(N).toHash():$.LongBits.zeroHash},$.longFromHash=function(N,O){var U=$.LongBits.fromHash(N);return $.Long?$.Long.fromBits(U.lo,U.hi,O):U.toNumber(!!O)},$.merge=Y,$.lcFirst=function(N){return N.charAt(0).toLowerCase()+N.substring(1)},$.newError=X,$.ProtocolError=X("ProtocolError"),$.oneOfGetter=function(N){for(var O={},U=0;U<N.length;++U)O[N[U]]=1;return function(){for(var N=Object.keys(this),U=N.length-1;U>-1;--U)if(1===O[N[U]]&&void 0!==this[N[U]]&&null!==this[N[U]])return N[U]}},$.oneOfSetter=function(N){return function(O){for(var U=0;U<N.length;++U)N[U]!==O&&delete this[N[U]]}},$.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},$._configure=function(){var N=$.Buffer;if(!N){$._Buffer_from=$._Buffer_allocUnsafe=null;return}$._Buffer_from=N.from!==Uint8Array.from&&N.from||function(O,U){return new N(O,U)},$._Buffer_allocUnsafe=N.allocUnsafe||function(O){return new N(O)}}},1173:function(N,O,U){"use strict";N.exports=ea;var $,Y=U(9693),X=Y.LongBits,J=Y.base64,Z=Y.utf8;function en(N,O,U){this.fn=N,this.len=O,this.next=void 0,this.val=U}function es(){}function eo(N){this.head=N.head,this.tail=N.tail,this.len=N.len,this.next=N.states}function ea(){this.len=0,this.head=new en(es,0,0),this.tail=this.head,this.states=null}var ec=function(){return Y.Buffer?function(){return(ea.create=function(){return new $})()}:function(){return new ea}};function eu(N,O,U){O[U]=255&N}function eh(N,O,U){for(;N>127;)O[U++]=127&N|128,N>>>=7;O[U]=N}function ef(N,O){this.len=N,this.next=void 0,this.val=O}function eg(N,O,U){for(;N.hi;)O[U++]=127&N.lo|128,N.lo=(N.lo>>>7|N.hi<<25)>>>0,N.hi>>>=7;for(;N.lo>127;)O[U++]=127&N.lo|128,N.lo=N.lo>>>7;O[U++]=N.lo}function ey(N,O,U){O[U]=255&N,O[U+1]=N>>>8&255,O[U+2]=N>>>16&255,O[U+3]=N>>>24}ea.create=ec(),ea.alloc=function(N){return new Y.Array(N)},Y.Array!==Array&&(ea.alloc=Y.pool(ea.alloc,Y.Array.prototype.subarray)),ea.prototype._push=function(N,O,U){return this.tail=this.tail.next=new en(N,O,U),this.len+=O,this},ef.prototype=Object.create(en.prototype),ef.prototype.fn=eh,ea.prototype.uint32=function(N){return this.len+=(this.tail=this.tail.next=new ef((N>>>=0)<128?1:N<16384?2:N<2097152?3:N<268435456?4:5,N)).len,this},ea.prototype.int32=function(N){return N<0?this._push(eg,10,X.fromNumber(N)):this.uint32(N)},ea.prototype.sint32=function(N){return this.uint32((N<<1^N>>31)>>>0)},ea.prototype.uint64=function(N){var O=X.from(N);return this._push(eg,O.length(),O)},ea.prototype.int64=ea.prototype.uint64,ea.prototype.sint64=function(N){var O=X.from(N).zzEncode();return this._push(eg,O.length(),O)},ea.prototype.bool=function(N){return this._push(eu,1,N?1:0)},ea.prototype.fixed32=function(N){return this._push(ey,4,N>>>0)},ea.prototype.sfixed32=ea.prototype.fixed32,ea.prototype.fixed64=function(N){var O=X.from(N);return this._push(ey,4,O.lo)._push(ey,4,O.hi)},ea.prototype.sfixed64=ea.prototype.fixed64,ea.prototype.float=function(N){return this._push(Y.float.writeFloatLE,4,N)},ea.prototype.double=function(N){return this._push(Y.float.writeDoubleLE,8,N)};var ew=Y.Array.prototype.set?function(N,O,U){O.set(N,U)}:function(N,O,U){for(var $=0;$<N.length;++$)O[U+$]=N[$]};ea.prototype.bytes=function(N){var O=N.length>>>0;if(!O)return this._push(eu,1,0);if(Y.isString(N)){var U=ea.alloc(O=J.length(N));J.decode(N,U,0),N=U}return this.uint32(O)._push(ew,O,N)},ea.prototype.string=function(N){var O=Z.length(N);return O?this.uint32(O)._push(Z.write,O,N):this._push(eu,1,0)},ea.prototype.fork=function(){return this.states=new eo(this),this.head=this.tail=new en(es,0,0),this.len=0,this},ea.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new en(es,0,0),this.len=0),this},ea.prototype.ldelim=function(){var N=this.head,O=this.tail,U=this.len;return this.reset().uint32(U),U&&(this.tail.next=N.next,this.tail=O,this.len+=U),this},ea.prototype.finish=function(){for(var N=this.head.next,O=this.constructor.alloc(this.len),U=0;N;)N.fn(N.val,O,U),U+=N.len,N=N.next;return O},ea._configure=function(N){$=N,ea.create=ec(),$._configure()}},3155:function(N,O,U){"use strict";N.exports=X;var $=U(1173);(X.prototype=Object.create($.prototype)).constructor=X;var Y=U(9693);function X(){$.call(this)}function J(N,O,U){N.length<40?Y.utf8.write(N,O,U):O.utf8Write?O.utf8Write(N,U):O.write(N,U)}X._configure=function(){X.alloc=Y._Buffer_allocUnsafe,X.writeBytesBuffer=Y.Buffer&&Y.Buffer.prototype instanceof Uint8Array&&"set"===Y.Buffer.prototype.set.name?function(N,O,U){O.set(N,U)}:function(N,O,U){if(N.copy)N.copy(O,U,0,N.length);else for(var $=0;$<N.length;)O[U++]=N[$++]}},X.prototype.bytes=function(N){Y.isString(N)&&(N=Y._Buffer_from(N,"base64"));var O=N.length>>>0;return this.uint32(O),O&&this._push(X.writeBytesBuffer,O,N),this},X.prototype.string=function(N){var O=Y.Buffer.byteLength(N);return this.uint32(O),O&&this._push(J,O,N),this},X._configure()},7364:function(N,O,U){"use strict";N.exports=en;var $,Y=U(8360),X=Y.LongBits,J=Y.utf8;function Z(N,O){return RangeError("index out of range: "+N.pos+" + "+(O||1)+" > "+N.len)}function en(N){this.buf=N,this.pos=0,this.len=N.length}var es="undefined"!=typeof Uint8Array?function(N){if(N instanceof Uint8Array||Array.isArray(N))return new en(N);throw Error("illegal buffer")}:function(N){if(Array.isArray(N))return new en(N);throw Error("illegal buffer")},eo=function(){return Y.Buffer?function(N){return(en.create=function(N){return Y.Buffer.isBuffer(N)?new $(N):es(N)})(N)}:es};function ea(){var N=new X(0,0),O=0;if(this.len-this.pos>4){for(;O<4;++O)if(N.lo=(N.lo|(127&this.buf[this.pos])<<7*O)>>>0,this.buf[this.pos++]<128)return N;if(N.lo=(N.lo|(127&this.buf[this.pos])<<28)>>>0,N.hi=(N.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return N;O=0}else{for(;O<3;++O){if(this.pos>=this.len)throw Z(this);if(N.lo=(N.lo|(127&this.buf[this.pos])<<7*O)>>>0,this.buf[this.pos++]<128)return N}return N.lo=(N.lo|(127&this.buf[this.pos++])<<7*O)>>>0,N}if(this.len-this.pos>4){for(;O<5;++O)if(N.hi=(N.hi|(127&this.buf[this.pos])<<7*O+3)>>>0,this.buf[this.pos++]<128)return N}else for(;O<5;++O){if(this.pos>=this.len)throw Z(this);if(N.hi=(N.hi|(127&this.buf[this.pos])<<7*O+3)>>>0,this.buf[this.pos++]<128)return N}throw Error("invalid varint encoding")}function ec(N,O){return(N[O-4]|N[O-3]<<8|N[O-2]<<16|N[O-1]<<24)>>>0}function eu(){if(this.pos+8>this.len)throw Z(this,8);return new X(ec(this.buf,this.pos+=4),ec(this.buf,this.pos+=4))}en.create=eo(),en.prototype._slice=Y.Array.prototype.subarray||Y.Array.prototype.slice,en.prototype.uint32=function(){var N=4294967295;return function(){if(N=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(N=(N|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(N=(N|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(N=(N|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(N=(N|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return N;if((this.pos+=5)>this.len)throw this.pos=this.len,Z(this,10);return N}}(),en.prototype.int32=function(){return 0|this.uint32()},en.prototype.sint32=function(){var N=this.uint32();return N>>>1^-(1&N)|0},en.prototype.bool=function(){return 0!==this.uint32()},en.prototype.fixed32=function(){if(this.pos+4>this.len)throw Z(this,4);return ec(this.buf,this.pos+=4)},en.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Z(this,4);return 0|ec(this.buf,this.pos+=4)},en.prototype.float=function(){if(this.pos+4>this.len)throw Z(this,4);var N=Y.float.readFloatLE(this.buf,this.pos);return this.pos+=4,N},en.prototype.double=function(){if(this.pos+8>this.len)throw Z(this,4);var N=Y.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,N},en.prototype.bytes=function(){var N=this.uint32(),O=this.pos,U=this.pos+N;if(U>this.len)throw Z(this,N);return(this.pos+=N,Array.isArray(this.buf))?this.buf.slice(O,U):O===U?new this.buf.constructor(0):this._slice.call(this.buf,O,U)},en.prototype.string=function(){var N=this.bytes();return J.read(N,0,N.length)},en.prototype.skip=function(N){if("number"==typeof N){if(this.pos+N>this.len)throw Z(this,N);this.pos+=N}else do if(this.pos>=this.len)throw Z(this);while(128&this.buf[this.pos++]);return this},en.prototype.skipType=function(N){switch(N){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(N=7&this.uint32());)this.skipType(N);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+N+" at offset "+this.pos)}return this},en._configure=function(N){$=N,en.create=eo(),$._configure();var O=Y.Long?"toLong":"toNumber";Y.merge(en.prototype,{int64:function(){return ea.call(this)[O](!1)},uint64:function(){return ea.call(this)[O](!0)},sint64:function(){return ea.call(this).zzDecode()[O](!1)},fixed64:function(){return eu.call(this)[O](!0)},sfixed64:function(){return eu.call(this)[O](!1)}})}},922:function(N,O,U){"use strict";N.exports=X;var $=U(7364);(X.prototype=Object.create($.prototype)).constructor=X;var Y=U(8360);function X(N){$.call(this,N)}X._configure=function(){Y.Buffer&&(X.prototype._slice=Y.Buffer.prototype.slice)},X.prototype.string=function(){var N=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+N,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+N,this.len))},X._configure()},1969:function(N,O,U){"use strict";N.exports=Y;var $=U(8360);function Y(N,O){this.lo=N>>>0,this.hi=O>>>0}var X=Y.zero=new Y(0,0);X.toNumber=function(){return 0},X.zzEncode=X.zzDecode=function(){return this},X.length=function(){return 1};var J=Y.zeroHash="\x00\x00\x00\x00\x00\x00\x00\x00";Y.fromNumber=function(N){if(0===N)return X;var O=N<0;O&&(N=-N);var U=N>>>0,$=(N-U)/4294967296>>>0;return O&&($=~$>>>0,U=~U>>>0,++U>4294967295&&(U=0,++$>4294967295&&($=0))),new Y(U,$)},Y.from=function(N){if("number"==typeof N)return Y.fromNumber(N);if($.isString(N)){if(!$.Long)return Y.fromNumber(parseInt(N,10));N=$.Long.fromString(N)}return N.low||N.high?new Y(N.low>>>0,N.high>>>0):X},Y.prototype.toNumber=function(N){if(!N&&this.hi>>>31){var O=~this.lo+1>>>0,U=~this.hi>>>0;return O||(U=U+1>>>0),-(O+4294967296*U)}return this.lo+4294967296*this.hi},Y.prototype.toLong=function(N){return $.Long?new $.Long(0|this.lo,0|this.hi,!!N):{low:0|this.lo,high:0|this.hi,unsigned:!!N}};var Z=String.prototype.charCodeAt;Y.fromHash=function(N){return N===J?X:new Y((Z.call(N,0)|Z.call(N,1)<<8|Z.call(N,2)<<16|Z.call(N,3)<<24)>>>0,(Z.call(N,4)|Z.call(N,5)<<8|Z.call(N,6)<<16|Z.call(N,7)<<24)>>>0)},Y.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Y.prototype.zzEncode=function(){var N=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^N)>>>0,this.lo=(this.lo<<1^N)>>>0,this},Y.prototype.zzDecode=function(){var N=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^N)>>>0,this.hi=(this.hi>>>1^N)>>>0,this},Y.prototype.length=function(){var N=this.lo,O=(this.lo>>>28|this.hi<<4)>>>0,U=this.hi>>>24;return 0===U?0===O?N<16384?N<128?1:2:N<2097152?3:4:O<16384?O<128?5:6:O<2097152?7:8:U<128?9:10}},8360:function(N,O,U){"use strict";var $=O;function Y(N,O,U){for(var $=Object.keys(O),Y=0;Y<$.length;++Y)void 0!==N[$[Y]]&&U||(N[$[Y]]=O[$[Y]]);return N}function X(N){function O(N,U){if(!(this instanceof O))return new O(N,U);Object.defineProperty(this,"message",{get:function(){return N}}),Error.captureStackTrace?Error.captureStackTrace(this,O):Object.defineProperty(this,"stack",{value:Error().stack||""}),U&&Y(this,U)}return O.prototype=Object.create(Error.prototype,{constructor:{value:O,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return N},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),O}$.asPromise=U(4537),$.base64=U(7419),$.EventEmitter=U(9211),$.float=U(945),$.inquire=U(7199),$.utf8=U(4997),$.pool=U(6662),$.LongBits=U(1969),$.isNode=!!(void 0!==U.g&&U.g&&U.g.process&&U.g.process.versions&&U.g.process.versions.node),$.global=$.isNode&&U.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,$.emptyArray=Object.freeze?Object.freeze([]):[],$.emptyObject=Object.freeze?Object.freeze({}):{},$.isInteger=Number.isInteger||function(N){return"number"==typeof N&&isFinite(N)&&Math.floor(N)===N},$.isString=function(N){return"string"==typeof N||N instanceof String},$.isObject=function(N){return N&&"object"==typeof N},$.isset=$.isSet=function(N,O){var U=N[O];return!!(null!=U&&N.hasOwnProperty(O))&&("object"!=typeof U||(Array.isArray(U)?U.length:Object.keys(U).length)>0)},$.Buffer=function(){try{var N=$.inquire("buffer").Buffer;return N.prototype.utf8Write?N:null}catch(N){return null}}(),$._Buffer_from=null,$._Buffer_allocUnsafe=null,$.newBuffer=function(N){return"number"==typeof N?$.Buffer?$._Buffer_allocUnsafe(N):new $.Array(N):$.Buffer?$._Buffer_from(N):"undefined"==typeof Uint8Array?N:new Uint8Array(N)},$.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,$.Long=$.global.dcodeIO&&$.global.dcodeIO.Long||$.global.Long||$.inquire("long"),$.key2Re=/^true|false|0|1$/,$.key32Re=/^-?(?:0|[1-9][0-9]*)$/,$.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,$.longToHash=function(N){return N?$.LongBits.from(N).toHash():$.LongBits.zeroHash},$.longFromHash=function(N,O){var U=$.LongBits.fromHash(N);return $.Long?$.Long.fromBits(U.lo,U.hi,O):U.toNumber(!!O)},$.merge=Y,$.lcFirst=function(N){return N.charAt(0).toLowerCase()+N.substring(1)},$.newError=X,$.ProtocolError=X("ProtocolError"),$.oneOfGetter=function(N){for(var O={},U=0;U<N.length;++U)O[N[U]]=1;return function(){for(var N=Object.keys(this),U=N.length-1;U>-1;--U)if(1===O[N[U]]&&void 0!==this[N[U]]&&null!==this[N[U]])return N[U]}},$.oneOfSetter=function(N){return function(O){for(var U=0;U<N.length;++U)N[U]!==O&&delete this[N[U]]}},$.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},$._configure=function(){var N=$.Buffer;if(!N){$._Buffer_from=$._Buffer_allocUnsafe=null;return}$._Buffer_from=N.from!==Uint8Array.from&&N.from||function(O,U){return new N(O,U)},$._Buffer_allocUnsafe=N.allocUnsafe||function(O){return new N(O)}}},62:function(N,O,U){"use strict";N.exports=ea;var $,Y=U(8360),X=Y.LongBits,J=Y.base64,Z=Y.utf8;function en(N,O,U){this.fn=N,this.len=O,this.next=void 0,this.val=U}function es(){}function eo(N){this.head=N.head,this.tail=N.tail,this.len=N.len,this.next=N.states}function ea(){this.len=0,this.head=new en(es,0,0),this.tail=this.head,this.states=null}var ec=function(){return Y.Buffer?function(){return(ea.create=function(){return new $})()}:function(){return new ea}};function eu(N,O,U){O[U]=255&N}function eh(N,O,U){for(;N>127;)O[U++]=127&N|128,N>>>=7;O[U]=N}function ef(N,O){this.len=N,this.next=void 0,this.val=O}function eg(N,O,U){for(;N.hi;)O[U++]=127&N.lo|128,N.lo=(N.lo>>>7|N.hi<<25)>>>0,N.hi>>>=7;for(;N.lo>127;)O[U++]=127&N.lo|128,N.lo=N.lo>>>7;O[U++]=N.lo}function ey(N,O,U){O[U]=255&N,O[U+1]=N>>>8&255,O[U+2]=N>>>16&255,O[U+3]=N>>>24}ea.create=ec(),ea.alloc=function(N){return new Y.Array(N)},Y.Array!==Array&&(ea.alloc=Y.pool(ea.alloc,Y.Array.prototype.subarray)),ea.prototype._push=function(N,O,U){return this.tail=this.tail.next=new en(N,O,U),this.len+=O,this},ef.prototype=Object.create(en.prototype),ef.prototype.fn=eh,ea.prototype.uint32=function(N){return this.len+=(this.tail=this.tail.next=new ef((N>>>=0)<128?1:N<16384?2:N<2097152?3:N<268435456?4:5,N)).len,this},ea.prototype.int32=function(N){return N<0?this._push(eg,10,X.fromNumber(N)):this.uint32(N)},ea.prototype.sint32=function(N){return this.uint32((N<<1^N>>31)>>>0)},ea.prototype.uint64=function(N){var O=X.from(N);return this._push(eg,O.length(),O)},ea.prototype.int64=ea.prototype.uint64,ea.prototype.sint64=function(N){var O=X.from(N).zzEncode();return this._push(eg,O.length(),O)},ea.prototype.bool=function(N){return this._push(eu,1,N?1:0)},ea.prototype.fixed32=function(N){return this._push(ey,4,N>>>0)},ea.prototype.sfixed32=ea.prototype.fixed32,ea.prototype.fixed64=function(N){var O=X.from(N);return this._push(ey,4,O.lo)._push(ey,4,O.hi)},ea.prototype.sfixed64=ea.prototype.fixed64,ea.prototype.float=function(N){return this._push(Y.float.writeFloatLE,4,N)},ea.prototype.double=function(N){return this._push(Y.float.writeDoubleLE,8,N)};var ew=Y.Array.prototype.set?function(N,O,U){O.set(N,U)}:function(N,O,U){for(var $=0;$<N.length;++$)O[U+$]=N[$]};ea.prototype.bytes=function(N){var O=N.length>>>0;if(!O)return this._push(eu,1,0);if(Y.isString(N)){var U=ea.alloc(O=J.length(N));J.decode(N,U,0),N=U}return this.uint32(O)._push(ew,O,N)},ea.prototype.string=function(N){var O=Z.length(N);return O?this.uint32(O)._push(Z.write,O,N):this._push(eu,1,0)},ea.prototype.fork=function(){return this.states=new eo(this),this.head=this.tail=new en(es,0,0),this.len=0,this},ea.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new en(es,0,0),this.len=0),this},ea.prototype.ldelim=function(){var N=this.head,O=this.tail,U=this.len;return this.reset().uint32(U),U&&(this.tail.next=N.next,this.tail=O,this.len+=U),this},ea.prototype.finish=function(){for(var N=this.head.next,O=this.constructor.alloc(this.len),U=0;N;)N.fn(N.val,O,U),U+=N.len,N=N.next;return O},ea._configure=function(N){$=N,ea.create=ec(),$._configure()}},9157:function(N,O,U){"use strict";N.exports=X;var $=U(62);(X.prototype=Object.create($.prototype)).constructor=X;var Y=U(8360);function X(){$.call(this)}function J(N,O,U){N.length<40?Y.utf8.write(N,O,U):O.utf8Write?O.utf8Write(N,U):O.write(N,U)}X._configure=function(){X.alloc=Y._Buffer_allocUnsafe,X.writeBytesBuffer=Y.Buffer&&Y.Buffer.prototype instanceof Uint8Array&&"set"===Y.Buffer.prototype.set.name?function(N,O,U){O.set(N,U)}:function(N,O,U){if(N.copy)N.copy(O,U,0,N.length);else for(var $=0;$<N.length;)O[U++]=N[$++]}},X.prototype.bytes=function(N){Y.isString(N)&&(N=Y._Buffer_from(N,"base64"));var O=N.length>>>0;return this.uint32(O),O&&this._push(X.writeBytesBuffer,O,N),this},X.prototype.string=function(N){var O=Y.Buffer.byteLength(N);return this.uint32(O),O&&this._push(J,O,N),this},X._configure()},8558:function(N,O,U){let $=U(4636),Y=U(1391),X=U(4156),J=U(4832),{RateLimiterClusterMaster:Z,RateLimiterClusterMasterPM2:en,RateLimiterCluster:es}=U(1713),eo=U(2288),ea=U(5105),ec=U(911),eu=U(3766),eh=U(8686),ef=U(3328),eg=U(5155);N.exports={RateLimiterRedis:$,RateLimiterMongo:Y,RateLimiterMySQL:X,RateLimiterPostgres:J,RateLimiterMemory:eo,RateLimiterMemcache:ea,RateLimiterClusterMaster:Z,RateLimiterClusterMasterPM2:en,RateLimiterCluster:es,RLWrapperBlackAndWhite:ec,RateLimiterUnion:eu,RateLimiterQueue:eh,BurstyRateLimiter:ef,RateLimiterRes:eg}},3328:function(N,O,U){let $=U(5155);N.exports=class{constructor(N,O){this._rateLimiter=N,this._burstLimiter=O}_combineRes(N,O){return new $(N.remainingPoints,Math.min(N.msBeforeNext,O.msBeforeNext),N.consumedPoints,N.isFirstInDuration)}consume(N,O=1,U={}){return this._rateLimiter.consume(N,O,U).catch(Y=>Y instanceof $?this._burstLimiter.consume(N,O,U).then(N=>Promise.resolve(this._combineRes(Y,N))).catch(N=>N instanceof $?Promise.reject(this._combineRes(Y,N)):Promise.reject(N)):Promise.reject(Y))}get(N){return Promise.all([this._rateLimiter.get(N),this._burstLimiter.get(N)]).then(([N,O])=>this._combineRes(N,O))}get points(){return this._rateLimiter.points}}},911:function(N,O,U){let $=U(5155);N.exports=class{constructor(N={}){this.limiter=N.limiter,this.blackList=N.blackList,this.whiteList=N.whiteList,this.isBlackListed=N.isBlackListed,this.isWhiteListed=N.isWhiteListed,this.runActionAnyway=N.runActionAnyway}get limiter(){return this._limiter}set limiter(N){if(void 0===N)throw Error("limiter is not set");this._limiter=N}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(N){this._runActionAnyway=void 0!==N&&N}get blackList(){return this._blackList}set blackList(N){this._blackList=Array.isArray(N)?N:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(N){if(void 0===N&&(N=()=>!1),"function"!=typeof N)throw Error("isBlackListed must be function");this._isBlackListed=N}get whiteList(){return this._whiteList}set whiteList(N){this._whiteList=Array.isArray(N)?N:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(N){if(void 0===N&&(N=()=>!1),"function"!=typeof N)throw Error("isWhiteListed must be function");this._isWhiteListed=N}isBlackListedSomewhere(N){return this.blackList.indexOf(N)>=0||this.isBlackListed(N)}isWhiteListedSomewhere(N){return this.whiteList.indexOf(N)>=0||this.isWhiteListed(N)}getBlackRes(){return new $(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new $(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(N,O=1){let U;return(this.isWhiteListedSomewhere(N)?U=this.resolveWhite():this.isBlackListedSomewhere(N)&&(U=this.rejectBlack()),void 0===U)?this.limiter.consume(N,O):(this.runActionAnyway&&this.limiter.consume(N,O).catch(()=>{}),U)}block(N,O){let U;return(this.isWhiteListedSomewhere(N)?U=this.resolveWhite():this.isBlackListedSomewhere(N)&&(U=this.resolveBlack()),void 0===U)?this.limiter.block(N,O):(this.runActionAnyway&&this.limiter.block(N,O).catch(()=>{}),U)}penalty(N,O){let U;return(this.isWhiteListedSomewhere(N)?U=this.resolveWhite():this.isBlackListedSomewhere(N)&&(U=this.resolveBlack()),void 0===U)?this.limiter.penalty(N,O):(this.runActionAnyway&&this.limiter.penalty(N,O).catch(()=>{}),U)}reward(N,O){let U;return(this.isWhiteListedSomewhere(N)?U=this.resolveWhite():this.isBlackListedSomewhere(N)&&(U=this.resolveBlack()),void 0===U)?this.limiter.reward(N,O):(this.runActionAnyway&&this.limiter.reward(N,O).catch(()=>{}),U)}get(N){let O;return(this.isWhiteListedSomewhere(N)?O=this.resolveWhite():this.isBlackListedSomewhere(N)&&(O=this.resolveBlack()),void 0===O||this.runActionAnyway)?this.limiter.get(N):O}delete(N){return this.limiter.delete(N)}}},1352:function(N){N.exports=class{constructor(N={}){this.points=N.points,this.duration=N.duration,this.blockDuration=N.blockDuration,this.execEvenly=N.execEvenly,this.execEvenlyMinDelayMs=N.execEvenlyMinDelayMs,this.keyPrefix=N.keyPrefix}get points(){return this._points}set points(N){this._points=N>=0?N:4}get duration(){return this._duration}set duration(N){this._duration=void 0===N?1:N}get msDuration(){return 1e3*this.duration}get blockDuration(){return this._blockDuration}set blockDuration(N){this._blockDuration=void 0===N?0:N}get msBlockDuration(){return 1e3*this.blockDuration}get execEvenly(){return this._execEvenly}set execEvenly(N){this._execEvenly=void 0!==N&&!!N}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(N){this._execEvenlyMinDelayMs=void 0===N?Math.ceil(this.msDuration/this.points):N}get keyPrefix(){return this._keyPrefix}set keyPrefix(N){if(void 0===N&&(N="rlflx"),"string"!=typeof N)throw Error("keyPrefix must be string");this._keyPrefix=N}_getKeySecDuration(N={}){return N&&N.customDuration>=0?N.customDuration:this.duration}getKey(N){return this.keyPrefix.length>0?`${this.keyPrefix}:${N}`:N}parseKey(N){return N.substring(this.keyPrefix.length)}consume(){throw Error("You have to implement the method 'consume'!")}penalty(){throw Error("You have to implement the method 'penalty'!")}reward(){throw Error("You have to implement the method 'reward'!")}get(){throw Error("You have to implement the method 'get'!")}set(){throw Error("You have to implement the method 'set'!")}block(){throw Error("You have to implement the method 'block'!")}delete(){throw Error("You have to implement the method 'delete'!")}}},1713:function(N,O,U){var $=U(3454);let Y=U(1265),X=U(5539),J=U(1352),Z=U(2288),en=U(5155),es="rate_limiter_flexible",eo=null,ea=function(N,O,U,$){let Y;Y=null===$||!0===$||!1===$?$:{remainingPoints:$.remainingPoints,msBeforeNext:$.msBeforeNext,consumedPoints:$.consumedPoints,isFirstInDuration:$.isFirstInDuration},N.send({channel:es,keyPrefix:O.keyPrefix,promiseId:O.promiseId,type:U,data:Y})},ec=function(N){setTimeout(()=>{this._initiated?$.send(N):void 0!==this._promises[N.promiseId]&&ec.call(this,N)},30)},eu=function(N,O,U,Y,X){let J={channel:es,keyPrefix:this.keyPrefix,func:N,promiseId:O,data:{key:U,arg:Y,opts:X}};this._initiated?$.send(J):ec.call(this,J)},eh=function(N,O){let U;if(!O||O.channel!==es||void 0===this._rateLimiters[O.keyPrefix])return!1;switch(O.func){case"consume":U=this._rateLimiters[O.keyPrefix].consume(O.data.key,O.data.arg,O.data.opts);break;case"penalty":U=this._rateLimiters[O.keyPrefix].penalty(O.data.key,O.data.arg,O.data.opts);break;case"reward":U=this._rateLimiters[O.keyPrefix].reward(O.data.key,O.data.arg,O.data.opts);break;case"block":U=this._rateLimiters[O.keyPrefix].block(O.data.key,O.data.arg,O.data.opts);break;case"get":U=this._rateLimiters[O.keyPrefix].get(O.data.key,O.data.opts);break;case"delete":U=this._rateLimiters[O.keyPrefix].delete(O.data.key,O.data.opts);break;default:return!1}U&&U.then(U=>{ea(N,O,"resolve",U)}).catch(U=>{ea(N,O,"reject",U)})},ef=function(N){if(!N||N.channel!==es||N.keyPrefix!==this.keyPrefix)return!1;if(this._promises[N.promiseId]){let O;switch(clearTimeout(this._promises[N.promiseId].timeoutId),O=null===N.data||!0===N.data||!1===N.data?N.data:new en(N.data.remainingPoints,N.data.msBeforeNext,N.data.consumedPoints,N.data.isFirstInDuration),N.type){case"resolve":this._promises[N.promiseId].resolve(O);break;case"reject":this._promises[N.promiseId].reject(O);break;default:throw Error(`RateLimiterCluster: no such message type '${N.type}'`)}delete this._promises[N.promiseId]}},eg=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},ey=function(N,O){let U=$.hrtime(),Y=U[0].toString()+U[1].toString();return void 0!==this._promises[Y]&&(Y+=X.randomBytes(12).toString("base64")),this._promises[Y]={resolve:N,reject:O,timeoutId:setTimeout(()=>{delete this._promises[Y],O(Error("RateLimiterCluster timeout: no answer from master in time"))},this.timeoutMs)},Y};class ew{constructor(){if(eo)return eo;this._rateLimiters={},Y.setMaxListeners(0),Y.on("message",(N,O)=>{O&&O.channel===es&&"init"===O.type?(void 0===this._rateLimiters[O.opts.keyPrefix]&&(this._rateLimiters[O.opts.keyPrefix]=new Z(O.opts)),N.send({channel:es,type:"init",keyPrefix:O.opts.keyPrefix})):eh.call(this,N,O)}),eo=this}}class ev{constructor(N){if(eo)return eo;this._rateLimiters={},N.launchBus((O,U)=>{U.on("process:msg",O=>{let U=O.raw;if(U&&U.channel===es&&"init"===U.type)void 0===this._rateLimiters[U.opts.keyPrefix]&&(this._rateLimiters[U.opts.keyPrefix]=new Z(U.opts)),N.sendDataToProcessId(O.process.pm_id,{data:{},topic:es,channel:es,type:"init",keyPrefix:U.opts.keyPrefix},(N,O)=>{N&&console.log(N,O)});else{let $={send:U=>{let $=U;$.topic=es,void 0===$.data&&($.data={}),N.sendDataToProcessId(O.process.pm_id,$,(N,O)=>{N&&console.log(N,O)})}};eh.call(this,$,U)}})}),eo=this}}class eE extends J{get timeoutMs(){return this._timeoutMs}set timeoutMs(N){this._timeoutMs=void 0===N?5e3:Math.abs(parseInt(N))}constructor(N={}){super(N),$.setMaxListeners(0),this.timeoutMs=N.timeoutMs,this._initiated=!1,$.on("message",N=>{N&&N.channel===es&&"init"===N.type&&N.keyPrefix===this.keyPrefix?this._initiated=!0:ef.call(this,N)}),$.send({channel:es,type:"init",opts:eg.call(this)}),this._promises={}}consume(N,O=1,U={}){return new Promise(($,Y)=>{let X=ey.call(this,$,Y);eu.call(this,"consume",X,N,O,U)})}penalty(N,O=1,U={}){return new Promise(($,Y)=>{let X=ey.call(this,$,Y);eu.call(this,"penalty",X,N,O,U)})}reward(N,O=1,U={}){return new Promise(($,Y)=>{let X=ey.call(this,$,Y);eu.call(this,"reward",X,N,O,U)})}block(N,O,U={}){return new Promise(($,Y)=>{let X=ey.call(this,$,Y);eu.call(this,"block",X,N,O,U)})}get(N,O={}){return new Promise((U,$)=>{let Y=ey.call(this,U,$);eu.call(this,"get",Y,N,O)})}delete(N,O={}){return new Promise((U,$)=>{let Y=ey.call(this,U,$);eu.call(this,"delete",Y,N,O)})}}N.exports={RateLimiterClusterMaster:ew,RateLimiterClusterMasterPM2:ev,RateLimiterCluster:eE}},5105:function(N,O,U){let $=U(1090),Y=U(5155);class X extends ${constructor(N){super(N),this.client=N.storeClient}_getRateLimiterRes(N,O,U){let $=new Y;return $.consumedPoints=parseInt(U.consumedPoints),$.isFirstInDuration=U.consumedPoints===O,$.remainingPoints=Math.max(this.points-$.consumedPoints,0),$.msBeforeNext=U.msBeforeNext,$}_upsert(N,O,U,$=!1,Y={}){return new Promise((X,J)=>{let Z=Date.now(),en=Math.floor(U/1e3);$?this.client.set(N,O,en,U=>{U?J(U):this.client.set(`${N}_expire`,en>0?Z+1e3*en:-1,en,()=>{let N={consumedPoints:O,msBeforeNext:en>0?1e3*en:-1};X(N)})}):this.client.incr(N,O,(es,eo)=>{es||!1===eo?this.client.add(N,O,en,(es,eo)=>{if(es||!eo){if(void 0===Y.attemptNumber||Y.attemptNumber<3){let Z=Object.assign({},Y);Z.attemptNumber=Z.attemptNumber?Z.attemptNumber+1:1,this._upsert(N,O,U,$,Z).then(N=>X(N)).catch(N=>J(N))}else J(Error("Can not add key"))}else this.client.add(`${N}_expire`,en>0?Z+1e3*en:-1,en,()=>{let N={consumedPoints:O,msBeforeNext:en>0?1e3*en:-1};X(N)})}):this.client.get(`${N}_expire`,(N,O)=>{if(N)J(N);else{let N=!1===O?0:O,U={consumedPoints:eo,msBeforeNext:N>=0?Math.max(N-Z,0):-1};X(U)}})})})}_get(N){return new Promise((O,U)=>{let $=Date.now();this.client.get(N,(Y,X)=>{X?this.client.get(`${N}_expire`,(N,Y)=>{if(N)U(N);else{let N=!1===Y?0:Y,U={consumedPoints:X,msBeforeNext:N>=0?Math.max(N-$,0):-1};O(U)}}):O(null)})})}_delete(N){return new Promise((O,U)=>{this.client.del(N,($,Y)=>{$?U($):!1===Y?O(Y):this.client.del(`${N}_expire`,N=>{N?U(N):O(Y)})})})}}N.exports=X},2288:function(N,O,U){let $=U(1352),Y=U(8425),X=U(5155);class J extends ${constructor(N={}){super(N),this._memoryStorage=new Y}consume(N,O=1,U={}){return new Promise(($,Y)=>{let X=this.getKey(N),J=this._getKeySecDuration(U),Z=this._memoryStorage.incrby(X,O,J);if(Z.remainingPoints=Math.max(this.points-Z.consumedPoints,0),Z.consumedPoints>this.points)this.blockDuration>0&&Z.consumedPoints<=this.points+O&&(Z=this._memoryStorage.set(X,Z.consumedPoints,this.blockDuration)),Y(Z);else if(this.execEvenly&&Z.msBeforeNext>0&&!Z.isFirstInDuration){let N=Math.ceil(Z.msBeforeNext/(Z.remainingPoints+2));N<this.execEvenlyMinDelayMs&&(N=Z.consumedPoints*this.execEvenlyMinDelayMs),setTimeout($,N,Z)}else $(Z)})}penalty(N,O=1,U={}){let $=this.getKey(N);return new Promise(N=>{let Y=this._getKeySecDuration(U),X=this._memoryStorage.incrby($,O,Y);X.remainingPoints=Math.max(this.points-X.consumedPoints,0),N(X)})}reward(N,O=1,U={}){let $=this.getKey(N);return new Promise(N=>{let Y=this._getKeySecDuration(U),X=this._memoryStorage.incrby($,-O,Y);X.remainingPoints=Math.max(this.points-X.consumedPoints,0),N(X)})}block(N,O){let U=1e3*O,$=this.points+1;return this._memoryStorage.set(this.getKey(N),$,O),Promise.resolve(new X(0,0===U?-1:U,$))}set(N,O,U){let $=(U>=0?U:this.duration)*1e3;return this._memoryStorage.set(this.getKey(N),O,U),Promise.resolve(new X(0,0===$?-1:$,O))}get(N){let O=this._memoryStorage.get(this.getKey(N));return null!==O&&(O.remainingPoints=Math.max(this.points-O.consumedPoints,0)),Promise.resolve(O)}delete(N){return Promise.resolve(this._memoryStorage.delete(this.getKey(N)))}}N.exports=J},1391:function(N,O,U){let $=U(1090),Y=U(5155);function X(N){try{let O=N.client?N.client:N,{version:U}=O.topology.s.options.metadata.driver,$=U.split(".").map(N=>parseInt(N));return{major:$[0],feature:$[1],patch:$[2]}}catch(N){return{major:0,feature:0,patch:0}}}class J extends ${constructor(N){super(N),this.dbName=N.dbName,this.tableName=N.tableName,this.indexKeyPrefix=N.indexKeyPrefix,N.mongo?this.client=N.mongo:this.client=N.storeClient,"function"==typeof this.client.then?this.client.then(N=>{this.client=N,this._initCollection(),this._driverVersion=X(this.client)}):(this._initCollection(),this._driverVersion=X(this.client))}get dbName(){return this._dbName}set dbName(N){this._dbName=void 0===N?J.getDbName():N}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(N){this._tableName=void 0===N?this.keyPrefix:N}get client(){return this._client}set client(N){if(void 0===N)throw Error("mongo is not set");this._client=N}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(N){this._indexKeyPrefix=N||{}}_initCollection(){let N="function"==typeof this.client.db?this.client.db(this.dbName):this.client,O=N.collection(this.tableName);O.createIndex({expire:-1},{expireAfterSeconds:0}),O.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=O}_getRateLimiterRes(N,O,U){let $;let X=new Y;return $=void 0===U.value?U:U.value,X.isFirstInDuration=$.points===O,X.consumedPoints=$.points,X.remainingPoints=Math.max(this.points-X.consumedPoints,0),X.msBeforeNext=null!==$.expire?Math.max(new Date($.expire).getTime()-Date.now(),0):-1,X}_upsert(N,O,U,$=!1,Y={}){let X,J;if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let Z=Y.attrs||{};$?(X=Object.assign(X={key:N},Z),(J={$set:{key:N,points:O,expire:U>0?new Date(Date.now()+U):null}}).$set=Object.assign(J.$set,Z)):(X=Object.assign(X={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:N},Z),(J={$setOnInsert:{key:N,expire:U>0?new Date(Date.now()+U):null},$inc:{points:O}}).$setOnInsert=Object.assign(J.$setOnInsert,Z));let en={upsert:!0};return this._driverVersion.major>=4||3===this._driverVersion.major&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?en.returnDocument="after":en.returnOriginal=!1,new Promise((Y,es)=>{this._collection.findOneAndUpdate(X,J,en).then(N=>{Y(N)}).catch(X=>{if(X&&11e3===X.code){let X=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:N},Z),J={$set:Object.assign({key:N,points:O,expire:U>0?new Date(Date.now()+U):null},Z)};this._collection.findOneAndUpdate(X,J,en).then(N=>{Y(N)}).catch(X=>{X&&11e3===X.code?this._upsert(N,O,U,$).then(N=>Y(N)).catch(N=>es(N)):es(X)})}else es(X)})})}_get(N,O={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let U=O.attrs||{},$=Object.assign({key:N,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},U);return this._collection.findOne($)}_delete(N,O={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let U=O.attrs||{},$=Object.assign({key:N},U);return this._collection.deleteOne($).then(N=>N.deletedCount>0)}}N.exports=J},4156:function(N,O,U){let $=U(1090),Y=U(5155);class X extends ${constructor(N,O=null){super(N),this.client=N.storeClient,this.clientType=N.storeType,this.dbName=N.dbName,this.tableName=N.tableName,this.clearExpiredByTimeout=N.clearExpiredByTimeout,this.tableCreated=N.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof O&&O()):this._createDbAndTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof O&&O()}).catch(N=>{if("function"==typeof O)O(N);else throw N})}clearExpired(N){return new Promise(O=>{this._getConnection().then(U=>{U.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,N],()=>{this._releaseConnection(U),O()})}).catch(()=>{O()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise((N,O)=>{this.client.getConnection((U,$)=>{if(U)return O(U);N($)})});case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(N){switch(this.clientType){case"pool":return N.release();case"sequelize":return this.client.connectionManager.releaseConnection(N);case"knex":return this.client.client.releaseConnection(N);default:return!0}}_createDbAndTable(){return new Promise((N,O)=>{this._getConnection().then(U=>{U.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,$=>{if($)return this._releaseConnection(U),O($);U.query(this._getCreateTableStmt(),$=>{if($)return this._releaseConnection(U),O($);this._releaseConnection(U),N()})})}).catch(N=>{O(N)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(N){if(void 0===N){if("Connection"===this.client.constructor.name)N="connection";else if("Pool"===this.client.constructor.name)N="pool";else if("Sequelize"===this.client.constructor.name)N="sequelize";else throw Error("storeType is not defined")}this._clientType=N.toLowerCase()}get dbName(){return this._dbName}set dbName(N){this._dbName=void 0===N?"rtlmtrflx":N}get tableName(){return this._tableName}set tableName(N){this._tableName=void 0===N?this.keyPrefix:N}get tableCreated(){return this._tableCreated}set tableCreated(N){this._tableCreated=void 0!==N&&!!N}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(N){this._clearExpiredByTimeout=void 0===N||!!N}_getRateLimiterRes(N,O,U){let $=new Y,[X]=U;return $.isFirstInDuration=O===X.points,$.consumedPoints=$.isFirstInDuration?O:X.points,$.remainingPoints=Math.max(this.points-$.consumedPoints,0),$.msBeforeNext=X.expire?Math.max(X.expire-Date.now(),0):-1,$}_upsertTransaction(N,O,U,$,Y){return new Promise((X,J)=>{N.query("BEGIN",Z=>{let en,es;if(Z)return N.rollback(),J(Z);let eo=Date.now(),ea=$>0?eo+$:null;Y?(en=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = ?, 
            expire = ?;`,es=[this.dbName,this.tableName,O,U,ea,U,ea]):(en=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = IF(expire <= ?, ?, points + (?)), 
            expire = IF(expire <= ?, ?, expire);`,es=[this.dbName,this.tableName,O,U,ea,eo,U,U,eo,ea]),N.query(en,es,U=>{if(U)return N.rollback(),J(U);N.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,O],(O,U)=>{if(O)return N.rollback(),J(O);N.query("COMMIT",O=>{if(O)return N.rollback(),J(O);X(U)})})})})})}_upsert(N,O,U,$=!1){return this.tableCreated?new Promise((Y,X)=>{this._getConnection().then(J=>{this._upsertTransaction(J,N,O,U,$).then(N=>{Y(N),this._releaseConnection(J)}).catch(N=>{X(N),this._releaseConnection(J)})}).catch(N=>{X(N)})}):Promise.reject(Error("Table is not created yet"))}_get(N){return this.tableCreated?new Promise((O,U)=>{this._getConnection().then($=>{$.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,N,Date.now()],(N,Y)=>{N?U(N):0===Y.length?O(null):O(Y),this._releaseConnection($)})}).catch(N=>{U(N)})}):Promise.reject(Error("Table is not created yet"))}_delete(N){return this.tableCreated?new Promise((O,U)=>{this._getConnection().then($=>{$.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,N],(N,Y)=>{N?U(N):O(Y.affectedRows>0),this._releaseConnection($)})}).catch(N=>{U(N)})}):Promise.reject(Error("Table is not created yet"))}}N.exports=X},4832:function(N,O,U){let $=U(1090),Y=U(5155);class X extends ${constructor(N,O=null){super(N),this.client=N.storeClient,this.clientType=N.storeType,this.tableName=N.tableName,this.clearExpiredByTimeout=N.clearExpiredByTimeout,this.tableCreated=N.tableCreated,this.tableCreated?"function"==typeof O&&O():this._createTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"==typeof O&&O()}).catch(N=>{if("function"==typeof O)O(N);else throw N})}clearExpired(N){return new Promise(O=>{let U={name:"rlflx-clear-expired",text:`DELETE FROM ${this.tableName} WHERE expire < $1`,values:[N]};this._query(U).then(()=>{O()}).catch(()=>{O()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":default:return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master)}}_releaseConnection(N){switch(this.clientType){case"pool":case"typeorm":default:return!0;case"sequelize":return this.client.connectionManager.releaseConnection(N);case"knex":return this.client.client.releaseConnection(N)}}_createTable(){return new Promise((N,O)=>{this._query({text:this._getCreateTableStmt()}).then(()=>{N()}).catch(U=>{"23505"===U.code?N():O(U)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this.tableName} ( 
      key varchar(255) PRIMARY KEY,
      points integer NOT NULL DEFAULT 0,
      expire bigint
    );`}get clientType(){return this._clientType}set clientType(N){let O=this.client.constructor.name;if(void 0===N){if("Client"===O)N="client";else if("Pool"===O||"BoundPool"===O)N="pool";else if("Sequelize"===O)N="sequelize";else throw Error("storeType is not defined")}this._clientType=N.toLowerCase()}get tableName(){return this._tableName}set tableName(N){this._tableName=void 0===N?this.keyPrefix:N}get tableCreated(){return this._tableCreated}set tableCreated(N){this._tableCreated=void 0!==N&&!!N}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(N){this._clearExpiredByTimeout=void 0===N||!!N}_getRateLimiterRes(N,O,U){let $=new Y,X=U.rows[0];return $.isFirstInDuration=O===X.points,$.consumedPoints=$.isFirstInDuration?O:X.points,$.remainingPoints=Math.max(this.points-$.consumedPoints,0),$.msBeforeNext=X.expire?Math.max(X.expire-Date.now(),0):-1,$}_query(N){let O=this.tableName.toLowerCase(),U={name:`${O}:${N.name}`,text:N.text,values:N.values};return new Promise((N,O)=>{this._getConnection().then($=>{$.query(U).then(O=>{N(O),this._releaseConnection($)}).catch(N=>{O(N),this._releaseConnection($)})}).catch(N=>{O(N)})})}_upsert(N,O,U,$=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));let Y=U>0?Date.now()+U:null,X=$?" $3 ":` CASE
             WHEN ${this.tableName}.expire <= $4 THEN $3
             ELSE ${this.tableName}.expire
            END `;return this._query({name:$?"rlflx-upsert-force":"rlflx-upsert",text:`
            INSERT INTO ${this.tableName} VALUES ($1, $2, $3)
              ON CONFLICT(key) DO UPDATE SET
                points = CASE
                          WHEN (${this.tableName}.expire <= $4 OR 1=${$?1:0}) THEN $2
                          ELSE ${this.tableName}.points + ($2)
                         END,
                expire = ${X}
            RETURNING points, expire;`,values:[N,O,Y,Date.now()]})}_get(N){return this.tableCreated?new Promise((O,U)=>{this._query({name:"rlflx-get",text:`
            SELECT points, expire FROM ${this.tableName} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[N,Date.now()]}).then(N=>{0===N.rowCount&&(N=null),O(N)}).catch(N=>{U(N)})}):Promise.reject(Error("Table is not created yet"))}_delete(N){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this.tableName} WHERE key = $1`,values:[N]}).then(N=>N.rowCount>0):Promise.reject(Error("Table is not created yet"))}}N.exports=X},8686:function(N,O,U){let $=U(5255),Y=4294967295,X="limiter";N.exports=class{constructor(N,O={maxQueueSize:Y}){this._queueLimiters={KEY_DEFAULT:new J(N,O)},this._limiterFlexible=N,this._maxQueueSize=O.maxQueueSize}getTokensRemaining(N=X){return this._queueLimiters[N]?this._queueLimiters[N].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(N,O=X){return this._queueLimiters[O]||(this._queueLimiters[O]=new J(this._limiterFlexible,{key:O,maxQueueSize:this._maxQueueSize})),this._queueLimiters[O].removeTokens(N)}};class J{constructor(N,O={maxQueueSize:Y,key:X}){this._key=O.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=N,this._maxQueueSize=O.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then(N=>null!==N?N.remainingPoints:this._limiterFlexible.points)}removeTokens(N){let O=this;return new Promise((U,Y)=>{if(N>O._limiterFlexible.points){Y(new $(`Requested tokens ${N} exceeds maximum ${O._limiterFlexible.points} tokens per interval`));return}O._queue.length>0?O._queueRequest.call(O,U,Y,N):O._limiterFlexible.consume(O._key,N).then(N=>{U(N.remainingPoints)}).catch($=>{$ instanceof Error?Y($):(O._queueRequest.call(O,U,Y,N),null===O._waitTimeout&&(O._waitTimeout=setTimeout(O._processFIFO.bind(O),$.msBeforeNext)))})})}_queueRequest(N,O,U){let Y=this;Y._queue.length<Y._maxQueueSize?Y._queue.push({resolve:N,reject:O,tokens:U}):O(new $(`Number of requests reached it's maximum ${Y._maxQueueSize}`))}_processFIFO(){let N=this;if(null!==N._waitTimeout&&(clearTimeout(N._waitTimeout),N._waitTimeout=null),0===N._queue.length)return;let O=N._queue.shift();N._limiterFlexible.consume(N._key,O.tokens).then(U=>{O.resolve(U.remainingPoints),N._processFIFO.call(N)}).catch(U=>{U instanceof Error?(O.reject(U),N._processFIFO.call(N)):(N._queue.unshift(O),null===N._waitTimeout&&(N._waitTimeout=setTimeout(N._processFIFO.bind(N),U.msBeforeNext)))})}}},4636:function(N,O,U){let $=U(1090),Y=U(5155),X=`redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') \
local consumed = redis.call('incrby', KEYS[1], ARGV[1]) \
local ttl = redis.call('pttl', KEYS[1]) \
if ttl == -1 then \
  redis.call('expire', KEYS[1], ARGV[2]) \
  ttl = 1000 * ARGV[2] \
end \
return {consumed, ttl} \
`;class J extends ${constructor(N){super(N),N.redis?this.client=N.redis:this.client=N.storeClient,this._rejectIfRedisNotReady=!!N.rejectIfRedisNotReady,"function"==typeof this.client.defineCommand&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:X})}_isRedisReady(){return!this._rejectIfRedisNotReady||(!this.client.status||"ready"===this.client.status)&&("function"!=typeof this.client.isReady||!!this.client.isReady())}_getRateLimiterRes(N,O,U){let[$,X]=U;Array.isArray($)&&([,$]=$,[,X]=X);let J=new Y;return J.consumedPoints=parseInt($),J.isFirstInDuration=J.consumedPoints===O,J.remainingPoints=Math.max(this.points-J.consumedPoints,0),J.msBeforeNext=X,J}_upsert(N,O,U,$=!1){return new Promise((Y,J)=>{if(!this._isRedisReady())return J(Error("Redis connection is not ready"));let Z=Math.floor(U/1e3),en=this.client.multi();if($)Z>0?en.set(N,O,"EX",Z):en.set(N,O),en.pttl(N).exec((N,O)=>N?J(N):Y(O));else if(Z>0){let U=function(N,O){return N?J(N):Y(O)};"function"==typeof this.client.rlflxIncr?this.client.rlflxIncr(N,O,Z,U):this.client.eval(X,1,N,O,Z,U)}else en.incrby(N,O).pttl(N).exec((N,O)=>N?J(N):Y(O))})}_get(N){return new Promise((O,U)=>{if(!this._isRedisReady())return U(Error("Redis connection is not ready"));this.client.multi().get(N).pttl(N).exec((N,$)=>{if(N)U(N);else{let[N]=$;if(null===N)return O(null);O($)}})})}_delete(N){return new Promise((O,U)=>{this.client.del(N,(N,$)=>{N?U(N):O($>0)})})}}N.exports=J},5155:function(N){N.exports=class{constructor(N,O,U,$){this.remainingPoints=void 0===N?0:N,this.msBeforeNext=void 0===O?0:O,this.consumedPoints=void 0===U?0:U,this.isFirstInDuration=void 0!==$&&$}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(N){return this._msBeforeNext=N,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(N){return this._remainingPoints=N,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(N){return this._consumedPoints=N,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(N){this._isFirstInDuration=!!N}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}}},1090:function(N,O,U){let $=U(1352),Y=U(2423),X=U(5155);N.exports=class extends ${constructor(N={}){super(N),this.inMemoryBlockOnConsumed=N.inMemoryBlockOnConsumed||N.inmemoryBlockOnConsumed,this.inMemoryBlockDuration=N.inMemoryBlockDuration||N.inmemoryBlockDuration,this.insuranceLimiter=N.insuranceLimiter,this._inMemoryBlockedKeys=new Y}get client(){return this._client}set client(N){if(void 0===N)throw Error("storeClient is not set");this._client=N}_afterConsume(N,O,U,$,Y,X={}){let J=this._getRateLimiterRes(U,$,Y);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&J.consumedPoints>=this.inMemoryBlockOnConsumed)return(this._inMemoryBlockedKeys.addMs(U,J.msBeforeNext),J.consumedPoints>this.points)?O(J):N(J);if(J.consumedPoints>this.points){let N=Promise.resolve();this.blockDuration>0&&J.consumedPoints<=this.points+$&&(J.msBeforeNext=this.msBlockDuration,N=this._block(U,J.consumedPoints,this.msBlockDuration,X)),this.inMemoryBlockOnConsumed>0&&J.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(U,this.inMemoryBlockDuration),J.msBeforeNext=this.msInMemoryBlockDuration),N.then(()=>{O(J)}).catch(N=>{O(N)})}else if(this.execEvenly&&J.msBeforeNext>0&&!J.isFirstInDuration){let O=Math.ceil(J.msBeforeNext/(J.remainingPoints+2));O<this.execEvenlyMinDelayMs&&(O=J.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(N,O,J)}else N(J)}_handleError(N,O,U,Y,X,J=!1,Z={}){this.insuranceLimiter instanceof $?this.insuranceLimiter[O](X,J,Z).then(N=>{U(N)}).catch(N=>{Y(N)}):Y(N)}get _inmemoryBlockedKeys(){return this._inMemoryBlockedKeys}getInmemoryBlockMsBeforeExpire(N){return this.getInMemoryBlockMsBeforeExpire(N)}get inmemoryBlockOnConsumed(){return this.inMemoryBlockOnConsumed}set inmemoryBlockOnConsumed(N){this.inMemoryBlockOnConsumed=N}get inmemoryBlockDuration(){return this.inMemoryBlockDuration}set inmemoryBlockDuration(N){this.inMemoryBlockDuration=N}get msInmemoryBlockDuration(){return 1e3*this.inMemoryBlockDuration}getInMemoryBlockMsBeforeExpire(N){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(N):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(N){if(this._inMemoryBlockOnConsumed=N?parseInt(N):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(N){if(this._inMemoryBlockDuration=N?parseInt(N):0,this.inMemoryBlockDuration>0&&0===this.inMemoryBlockOnConsumed)throw Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return 1e3*this._inMemoryBlockDuration}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(N){if(void 0!==N&&!(N instanceof $))throw Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=N,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(N,O,U={}){let $=1e3*O;return this._block(this.getKey(N),this.points+1,$,U)}set(N,O,U,$={}){let Y=(U>=0?U:this.duration)*1e3;return this._block(this.getKey(N),O,Y,$)}consume(N,O=1,U={}){return new Promise(($,Y)=>{let J=this.getKey(N),Z=this.getInMemoryBlockMsBeforeExpire(J);if(Z>0)return Y(new X(0,Z));this._upsert(J,O,1e3*this._getKeySecDuration(U),!1,U).then(N=>{this._afterConsume($,Y,J,O,N)}).catch(X=>{this._handleError(X,"consume",$,Y,N,O,U)})})}penalty(N,O=1,U={}){let $=this.getKey(N);return new Promise((Y,X)=>{this._upsert($,O,1e3*this._getKeySecDuration(U),!1,U).then(N=>{Y(this._getRateLimiterRes($,O,N))}).catch($=>{this._handleError($,"penalty",Y,X,N,O,U)})})}reward(N,O=1,U={}){let $=this.getKey(N);return new Promise((Y,X)=>{this._upsert($,-O,1e3*this._getKeySecDuration(U),!1,U).then(N=>{Y(this._getRateLimiterRes($,-O,N))}).catch($=>{this._handleError($,"reward",Y,X,N,O,U)})})}get(N,O={}){let U=this.getKey(N);return new Promise(($,Y)=>{this._get(U,O).then(N=>{null==N?$(null):$(this._getRateLimiterRes(U,0,N))}).catch(U=>{this._handleError(U,"get",$,Y,N,O)})})}delete(N,O={}){let U=this.getKey(N);return new Promise(($,Y)=>{this._delete(U,O).then(N=>{this._inMemoryBlockedKeys.delete(U),$(N)}).catch(U=>{this._handleError(U,"delete",$,Y,N,O)})})}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(N,O,U){throw Error("You have to implement the method '_getRateLimiterRes'!")}_block(N,O,U,$={}){return new Promise((Y,J)=>{this._upsert(N,O,U,!0,$).then(()=>{Y(new X(0,U>0?U:-1,O))}).catch(O=>{this._handleError(O,"block",Y,J,this.parseKey(N),U/1e3,$)})})}_get(N,O={}){throw Error("You have to implement the method '_get'!")}_delete(N,O={}){throw Error("You have to implement the method '_delete'!")}_upsert(N,O,U,$=!1,Y={}){throw Error("You have to implement the method '_upsert'!")}}},3766:function(N,O,U){let $=U(1352);N.exports=class{constructor(...N){if(N.length<1)throw Error("RateLimiterUnion: at least one limiter have to be passed");N.forEach(N=>{if(!(N instanceof $))throw Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")}),this._limiters=N}consume(N,O=1){return new Promise((U,$)=>{let Y=[];this._limiters.forEach(U=>{Y.push(U.consume(N,O).catch(N=>({rejected:!0,rej:N})))}),Promise.all(Y).then(N=>{let O={},Y=!1;N.forEach(N=>{!0===N.rejected&&(Y=!0)});for(let U=0;U<N.length;U++)Y&&!0===N[U].rejected?O[this._limiters[U].keyPrefix]=N[U].rej:Y||(O[this._limiters[U].keyPrefix]=N[U]);Y?$(O):U(O)})})}}},8894:function(N){N.exports=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){let N=Date.now();Object.keys(this._keys).forEach(O=>{this._keys[O]<=N&&delete this._keys[O]}),this._addedKeysAmount=Object.keys(this._keys).length}add(N,O){this.addMs(N,1e3*O)}addMs(N,O){this._keys[N]=Date.now()+O,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(N){let O=this._keys[N];if(O&&O>=Date.now()){this.collectExpired();let N=Date.now();return O>=N?O-N:0}return 0}delete(N){N?delete this._keys[N]:Object.keys(this._keys).forEach(N=>{delete this._keys[N]})}}},2423:function(N,O,U){let $=U(8894);N.exports=$},8425:function(N,O,U){let $=U(9250),Y=U(5155);N.exports=class{constructor(){this._storage={}}incrby(N,O,U){if(this._storage[N]){let U=this._storage[N].expiresAt?this._storage[N].expiresAt.getTime()-new Date().getTime():-1;if(0!==U)return this._storage[N].value=this._storage[N].value+O,new Y(0,U,this._storage[N].value,!1)}return this.set(N,O,U)}set(N,O,U){let X=1e3*U;return this._storage[N]&&this._storage[N].timeoutId&&clearTimeout(this._storage[N].timeoutId),this._storage[N]=new $(O,X>0?new Date(Date.now()+X):null),X>0&&(this._storage[N].timeoutId=setTimeout(()=>{delete this._storage[N]},X),this._storage[N].timeoutId.unref&&this._storage[N].timeoutId.unref()),new Y(0,0===X?-1:X,this._storage[N].value,!0)}get(N){if(this._storage[N]){let O=this._storage[N].expiresAt?this._storage[N].expiresAt.getTime()-new Date().getTime():-1;return new Y(0,O,this._storage[N].value,!1)}return null}delete(N){return!!this._storage[N]&&(this._storage[N].timeoutId&&clearTimeout(this._storage[N].timeoutId),delete this._storage[N],!0)}}},9250:function(N){N.exports=class{constructor(N,O,U=null){this.value=N,this.expiresAt=O,this.timeoutId=U}get value(){return this._value}set value(N){this._value=parseInt(N)}get expiresAt(){return this._expiresAt}set expiresAt(N){!(N instanceof Date)&&Number.isInteger(N)&&(N=new Date(N)),this._expiresAt=N}get timeoutId(){return this._timeoutId}set timeoutId(N){this._timeoutId=N}}},5255:function(N){N.exports=class extends Error{constructor(N,O){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=N,O&&(this.extra=O)}}},3692:function(N,O,U){"use strict";N.exports=Z;var $=U(7824),Y=Z.prototype,X=new Date%1e9;function J(){return(1e9*Math.random()>>>0)+X++}function Z(N){N=N||{},this.id=N.id||J(),this.max=N.max||1/0,this.items=N.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(N.lastModified||new Date);for(var O,U,$=this.items.length;$--;)O=this.items[$],U=new Date(O.expires)-new Date,this._lookup[O.key]=O,U>0?this.expire(O.key,U):U<=0&&this.delete(O.key)}Y.has=function(N){return N in this._lookup},Y.get=function(N){if(!this.has(N))return null;var O=this._lookup[N];return O.refresh&&this.expire(N,O.refresh),this.items.splice(this.items.indexOf(O),1),this.items.push(O),O.value},Y.meta=function(N){if(!this.has(N))return null;var O=this._lookup[N];return"meta"in O?O.meta:null},Y.set=function(N,O,U){var $=this._lookup[N],Y=this._lookup[N]={key:N,value:O};return this.lastModified=new Date,$?(clearTimeout($.timeout),this.items.splice(this.items.indexOf($),1,Y)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(Y),this.size++),U&&("ttl"in U&&this.expire(N,U.ttl),"meta"in U&&(Y.meta=U.meta),U.refresh&&(Y.refresh=U.ttl)),this},Y.delete=function(N){var O=this._lookup[N];return!!O&&(this.lastModified=new Date,this.items.splice(this.items.indexOf(O),1),clearTimeout(O.timeout),delete this._lookup[N],this.size--,this)},Y.expire=function(N,O){var U=O||0,Y=this._lookup[N];if(!Y)return this;if("string"==typeof U&&(U=$(O)),"number"!=typeof U)throw TypeError("Expiration time must be a string or number.");return clearTimeout(Y.timeout),Y.timeout=setTimeout(this.delete.bind(this,Y.key),U),Y.expires=Number(new Date)+U,this},Y.clear=function(){for(var N=this.items.length;N--;)this.delete(this.items[N].key);return this},Y.toJSON=function(){for(var N,O=Array(this.items.length),U=O.length;U--;)N=this.items[U],O[U]={key:N.key,meta:N.meta,value:N.value,expires:N.expires,refresh:N.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:O}}},2916:function(N,O,U){"use strict";let $=U(1807);class Y{constructor(N,O,U){let Y=this;this._started=$(),this._rescheduled=0,this._scheduled=O,this._args=U,this._triggered=!1,this._timerWrapper=()=>{Y._rescheduled>0?(Y._scheduled=Y._rescheduled-($()-Y._started),Y._schedule(Y._scheduled)):(Y._triggered=!0,N.apply(null,Y._args))},this._timer=setTimeout(this._timerWrapper,O)}reschedule(N){N||(N=this._scheduled);let O=$();O+N-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(N)):this._triggered?this._schedule(N):(this._started=O,this._rescheduled=N)}_schedule(N){this._triggered=!1,this._started=$(),this._rescheduled=0,this._scheduled=N,this._timer=setTimeout(this._timerWrapper,N)}clear(){clearTimeout(this._timer)}}function X(){let N;if("function"!=typeof arguments[0])throw Error("callback needed");if("number"!=typeof arguments[1])throw Error("timeout needed");if(arguments.length>0){N=Array(arguments.length-2);for(var O=0;O<N.length;O++)N[O]=arguments[O+2]}return new Y(arguments[0],arguments[1],N)}N.exports=X},1807:function(N){"use strict";N.exports=function(){return Date.now()}},9353:function(N,O,U){U(1846)},1846:function(N,O,U){var $=U(1960);O.operation=function(N){var U=O.timeouts(N);return new $(U,{forever:N&&(N.forever||N.retries===1/0),unref:N&&N.unref,maxRetryTime:N&&N.maxRetryTime})},O.timeouts=function(N){if(N instanceof Array)return[].concat(N);var O={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var U in N)O[U]=N[U];if(O.minTimeout>O.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var $=[],Y=0;Y<O.retries;Y++)$.push(this.createTimeout(Y,O));return N&&N.forever&&!$.length&&$.push(this.createTimeout(Y,O)),$.sort(function(N,O){return N-O}),$},O.createTimeout=function(N,O){return Math.min(Math.round((O.randomize?Math.random()+1:1)*Math.max(O.minTimeout,1)*Math.pow(O.factor,N)),O.maxTimeout)},O.wrap=function(N,U,$){if(U instanceof Array&&($=U,U=null),!$)for(var Y in $=[],N)"function"==typeof N[Y]&&$.push(Y);for(var X=0;X<$.length;X++){var J=$[X],Z=N[J];N[J]=(function($){var Y=O.operation(U),X=Array.prototype.slice.call(arguments,1),J=X.pop();X.push(function(N){Y.retry(N)||(N&&(arguments[0]=Y.mainError()),J.apply(this,arguments))}),Y.attempt(function(){$.apply(N,X)})}).bind(N,Z),N[J].options=U}}},1960:function(N){function O(N,O){"boolean"==typeof O&&(O={forever:O}),this._originalTimeouts=JSON.parse(JSON.stringify(N)),this._timeouts=N,this._options=O||{},this._maxRetryTime=O&&O.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}N.exports=O,O.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},O.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},O.prototype.retry=function(N){if(this._timeout&&clearTimeout(this._timeout),!N)return!1;var O=new Date().getTime();if(N&&O-this._operationStart>=this._maxRetryTime)return this._errors.push(N),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(N);var U=this._timeouts.shift();if(void 0===U){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),U=this._cachedTimeouts.slice(-1)}var $=this;return this._timer=setTimeout(function(){$._attempts++,$._operationTimeoutCb&&($._timeout=setTimeout(function(){$._operationTimeoutCb($._attempts)},$._operationTimeout),$._options.unref&&$._timeout.unref()),$._fn($._attempts)},U),this._options.unref&&this._timer.unref(),!0},O.prototype.attempt=function(N,O){this._fn=N,O&&(O.timeout&&(this._operationTimeout=O.timeout),O.cb&&(this._operationTimeoutCb=O.cb));var U=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){U._operationTimeoutCb()},U._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},O.prototype.try=function(N){console.log("Using RetryOperation.try() is deprecated"),this.attempt(N)},O.prototype.start=function(N){console.log("Using RetryOperation.start() is deprecated"),this.attempt(N)},O.prototype.start=O.prototype.try,O.prototype.errors=function(){return this._errors},O.prototype.attempts=function(){return this._attempts},O.prototype.mainError=function(){if(0===this._errors.length)return null;for(var N={},O=null,U=0,$=0;$<this._errors.length;$++){var Y=this._errors[$],X=Y.message,J=(N[X]||0)+1;N[X]=J,J>=U&&(O=Y,U=J)}return O}},202:function(N,O,U){"use strict";var $=U(3700),Y=/[\/\?<>\\:\*\|"]/g,X=/[\x00-\x1f\x80-\x9f]/g,J=/^\.+$/,Z=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,en=/[\. ]+$/;function es(N,O){if("string"!=typeof N)throw Error("Input must be string");return $(N.replace(Y,O).replace(X,O).replace(J,O).replace(Z,O).replace(en,O),255)}N.exports=function(N,O){var U=O&&O.replacement||"",$=es(N,U);return""===U?$:es($,"")}},715:function(N,O,U){"use strict";let{AbortController:$}=globalThis,Y=U(2916);class X extends ${constructor(N){super(),this._ms=N,this._timer=Y(()=>this.abort(),N),Object.setPrototypeOf(this,X.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=Y(()=>this.abort(),this._ms)}}N.exports={TimeoutController:X}},3700:function(N,O,U){"use strict";var $=U(1156),Y=U(793);N.exports=$.bind(null,Y)},1156:function(N){"use strict";function O(N){return N>=55296&&N<=56319}function U(N){return N>=56320&&N<=57343}N.exports=function(N,$,Y){if("string"!=typeof $)throw Error("Input must be string");for(var X,J,Z=$.length,en=0,es=0;es<Z;es+=1){if(X=$.charCodeAt(es),J=$[es],O(X)&&U($.charCodeAt(es+1))&&(es+=1,J+=$[es]),(en+=N(J))===Y)return $.slice(0,es+1);if(en>Y)return $.slice(0,es-J.length+1)}return $}},793:function(N){"use strict";function O(N){return N>=55296&&N<=56319}function U(N){return N>=56320&&N<=57343}N.exports=function(N){if("string"!=typeof N)throw Error("Input must be string");for(var $=N.length,Y=0,X=null,J=null,Z=0;Z<$;Z++)U(X=N.charCodeAt(Z))?null!=J&&O(J)?Y+=1:Y+=3:X<=127?Y+=1:X>=128&&X<=2047?Y+=2:X>=2048&&X<=65535&&(Y+=3),J=X;return Y}},3209:function(N){N.exports=$;var O=128,U=127;function $(N,Y){var X,J=0,Y=Y||0,Z=0,en=Y,es=N.length;do{if(en>=es)throw $.bytes=0,RangeError("Could not decode varint");X=N[en++],J+=Z<28?(X&U)<<Z:(X&U)*Math.pow(2,Z),Z+=7}while(X>=O);return $.bytes=en-Y,J}},7089:function(N){N.exports=Y;var O=128,U=-128,$=2147483648;function Y(N,X,J){X=X||[];for(var Z=J=J||0;N>=$;)X[J++]=255&N|O,N/=128;for(;N&U;)X[J++]=255&N|O,N>>>=7;return X[J]=0|N,Y.bytes=J-Z+1,X}},3924:function(N,O,U){N.exports={encode:U(7089),decode:U(3209),encodingLength:U(4146)}},4146:function(N){var O=128,U=16384,$=2097152,Y=268435456,X=34359738368,J=4398046511104,Z=562949953421312,en=72057594037927940,es=0x7fffffffffffffff;N.exports=function(N){return N<O?1:N<U?2:N<$?3:N<Y?4:N<X?5:N<J?6:N<Z?7:N<en?8:N<es?9:10}},2838:function(N,O,U){"use strict";let $=U(3924);N.exports=N=>{if(!(N instanceof Uint8Array))throw Error("arg needs to be a Uint8Array");let O=[];for(;N.length>0;){let U=$.decode(N);O.push(U),N=N.slice($.decode.bytes)}return O}},6988:function(N){N.exports=$;var O=128,U=127;function $(N,Y){var X,J=0,Y=Y||0,Z=0,en=Y,es=N.length;do{if(en>=es||Z>49)throw $.bytes=0,RangeError("Could not decode varint");X=N[en++],J+=Z<28?(X&U)<<Z:(X&U)*Math.pow(2,Z),Z+=7}while(X>=O);return $.bytes=en-Y,J}},1312:function(N){N.exports=Y;var O=128,U=-128,$=2147483648;function Y(N,X,J){if(Number.MAX_SAFE_INTEGER&&N>Number.MAX_SAFE_INTEGER)throw Y.bytes=0,RangeError("Could not encode varint");X=X||[];for(var Z=J=J||0;N>=$;)X[J++]=255&N|O,N/=128;for(;N&U;)X[J++]=255&N|O,N>>>=7;return X[J]=0|N,Y.bytes=J-Z+1,X}},4676:function(N,O,U){N.exports={encode:U(1312),decode:U(6988),encodingLength:U(82)}},82:function(N){var O=128,U=16384,$=2097152,Y=268435456,X=34359738368,J=4398046511104,Z=562949953421312,en=72057594037927940,es=0x7fffffffffffffff;N.exports=function(N){return N<O?1:N<U?2:N<$?3:N<Y?4:N<X?5:N<J?6:N<Z?7:N<en?8:N<es?9:10}},4482:function(N,O,U){var $,Y,X;!function(J,Z){Y=[U(2100)],void 0!==(X="function"==typeof($=Z)?$.apply(O,Y):$)&&(N.exports=X)}(0,function(N){"use strict";var O=N.Reader,U=N.Writer,$=N.util,Y=N.roots.default||(N.roots.default={});return Y.RPC=function(){var X;function J(N){if(this.subscriptions=[],this.messages=[],N)for(var O=Object.keys(N),U=0;U<O.length;++U)null!=N[O[U]]&&(this[O[U]]=N[O[U]])}return J.prototype.subscriptions=$.emptyArray,J.prototype.messages=$.emptyArray,J.prototype.control=null,Object.defineProperty(J.prototype,"_control",{get:$.oneOfGetter(X=["control"]),set:$.oneOfSetter(X)}),J.encode=function(N,O){if(O||(O=U.create()),null!=N.subscriptions&&N.subscriptions.length)for(var $=0;$<N.subscriptions.length;++$)Y.RPC.SubOpts.encode(N.subscriptions[$],O.uint32(10).fork()).ldelim();if(null!=N.messages&&N.messages.length)for(var $=0;$<N.messages.length;++$)Y.RPC.Message.encode(N.messages[$],O.uint32(18).fork()).ldelim();return null!=N.control&&Object.hasOwnProperty.call(N,"control")&&Y.RPC.ControlMessage.encode(N.control,O.uint32(26).fork()).ldelim(),O},J.decode=function(N,U){N instanceof O||(N=O.create(N));for(var $=void 0===U?N.len:N.pos+U,X=new Y.RPC;N.pos<$;){var J=N.uint32();switch(J>>>3){case 1:X.subscriptions&&X.subscriptions.length||(X.subscriptions=[]),X.subscriptions.push(Y.RPC.SubOpts.decode(N,N.uint32()));break;case 2:X.messages&&X.messages.length||(X.messages=[]),X.messages.push(Y.RPC.Message.decode(N,N.uint32()));break;case 3:X.control=Y.RPC.ControlMessage.decode(N,N.uint32());break;default:N.skipType(7&J)}}return X},J.fromObject=function(N){if(N instanceof Y.RPC)return N;var O=new Y.RPC;if(N.subscriptions){if(!Array.isArray(N.subscriptions))throw TypeError(".RPC.subscriptions: array expected");O.subscriptions=[];for(var U=0;U<N.subscriptions.length;++U){if("object"!=typeof N.subscriptions[U])throw TypeError(".RPC.subscriptions: object expected");O.subscriptions[U]=Y.RPC.SubOpts.fromObject(N.subscriptions[U])}}if(N.messages){if(!Array.isArray(N.messages))throw TypeError(".RPC.messages: array expected");O.messages=[];for(var U=0;U<N.messages.length;++U){if("object"!=typeof N.messages[U])throw TypeError(".RPC.messages: object expected");O.messages[U]=Y.RPC.Message.fromObject(N.messages[U])}}if(null!=N.control){if("object"!=typeof N.control)throw TypeError(".RPC.control: object expected");O.control=Y.RPC.ControlMessage.fromObject(N.control)}return O},J.toObject=function(N,O){O||(O={});var U={};if((O.arrays||O.defaults)&&(U.subscriptions=[],U.messages=[]),N.subscriptions&&N.subscriptions.length){U.subscriptions=[];for(var $=0;$<N.subscriptions.length;++$)U.subscriptions[$]=Y.RPC.SubOpts.toObject(N.subscriptions[$],O)}if(N.messages&&N.messages.length){U.messages=[];for(var $=0;$<N.messages.length;++$)U.messages[$]=Y.RPC.Message.toObject(N.messages[$],O)}return null!=N.control&&N.hasOwnProperty("control")&&(U.control=Y.RPC.ControlMessage.toObject(N.control,O),O.oneofs&&(U._control="control")),U},J.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},J.SubOpts=function(){var X;function J(N){if(N)for(var O=Object.keys(N),U=0;U<O.length;++U)null!=N[O[U]]&&(this[O[U]]=N[O[U]])}return J.prototype.subscribe=null,J.prototype.topic=null,Object.defineProperty(J.prototype,"_subscribe",{get:$.oneOfGetter(X=["subscribe"]),set:$.oneOfSetter(X)}),Object.defineProperty(J.prototype,"_topic",{get:$.oneOfGetter(X=["topic"]),set:$.oneOfSetter(X)}),J.encode=function(N,O){return O||(O=U.create()),null!=N.subscribe&&Object.hasOwnProperty.call(N,"subscribe")&&O.uint32(8).bool(N.subscribe),null!=N.topic&&Object.hasOwnProperty.call(N,"topic")&&O.uint32(18).string(N.topic),O},J.decode=function(N,U){N instanceof O||(N=O.create(N));for(var $=void 0===U?N.len:N.pos+U,X=new Y.RPC.SubOpts;N.pos<$;){var J=N.uint32();switch(J>>>3){case 1:X.subscribe=N.bool();break;case 2:X.topic=N.string();break;default:N.skipType(7&J)}}return X},J.fromObject=function(N){if(N instanceof Y.RPC.SubOpts)return N;var O=new Y.RPC.SubOpts;return null!=N.subscribe&&(O.subscribe=!!N.subscribe),null!=N.topic&&(O.topic=String(N.topic)),O},J.toObject=function(N,O){O||(O={});var U={};return null!=N.subscribe&&N.hasOwnProperty("subscribe")&&(U.subscribe=N.subscribe,O.oneofs&&(U._subscribe="subscribe")),null!=N.topic&&N.hasOwnProperty("topic")&&(U.topic=N.topic,O.oneofs&&(U._topic="topic")),U},J.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},J}(),J.Message=function(){var X;function J(N){if(N)for(var O=Object.keys(N),U=0;U<O.length;++U)null!=N[O[U]]&&(this[O[U]]=N[O[U]])}return J.prototype.from=null,J.prototype.data=null,J.prototype.seqno=null,J.prototype.topic="",J.prototype.signature=null,J.prototype.key=null,Object.defineProperty(J.prototype,"_from",{get:$.oneOfGetter(X=["from"]),set:$.oneOfSetter(X)}),Object.defineProperty(J.prototype,"_data",{get:$.oneOfGetter(X=["data"]),set:$.oneOfSetter(X)}),Object.defineProperty(J.prototype,"_seqno",{get:$.oneOfGetter(X=["seqno"]),set:$.oneOfSetter(X)}),Object.defineProperty(J.prototype,"_signature",{get:$.oneOfGetter(X=["signature"]),set:$.oneOfSetter(X)}),Object.defineProperty(J.prototype,"_key",{get:$.oneOfGetter(X=["key"]),set:$.oneOfSetter(X)}),J.encode=function(N,O){return O||(O=U.create()),null!=N.from&&Object.hasOwnProperty.call(N,"from")&&O.uint32(10).bytes(N.from),null!=N.data&&Object.hasOwnProperty.call(N,"data")&&O.uint32(18).bytes(N.data),null!=N.seqno&&Object.hasOwnProperty.call(N,"seqno")&&O.uint32(26).bytes(N.seqno),O.uint32(34).string(N.topic),null!=N.signature&&Object.hasOwnProperty.call(N,"signature")&&O.uint32(42).bytes(N.signature),null!=N.key&&Object.hasOwnProperty.call(N,"key")&&O.uint32(50).bytes(N.key),O},J.decode=function(N,U){N instanceof O||(N=O.create(N));for(var X=void 0===U?N.len:N.pos+U,J=new Y.RPC.Message;N.pos<X;){var Z=N.uint32();switch(Z>>>3){case 1:J.from=N.bytes();break;case 2:J.data=N.bytes();break;case 3:J.seqno=N.bytes();break;case 4:J.topic=N.string();break;case 5:J.signature=N.bytes();break;case 6:J.key=N.bytes();break;default:N.skipType(7&Z)}}if(!J.hasOwnProperty("topic"))throw $.ProtocolError("missing required 'topic'",{instance:J});return J},J.fromObject=function(N){if(N instanceof Y.RPC.Message)return N;var O=new Y.RPC.Message;return null!=N.from&&("string"==typeof N.from?$.base64.decode(N.from,O.from=$.newBuffer($.base64.length(N.from)),0):N.from.length&&(O.from=N.from)),null!=N.data&&("string"==typeof N.data?$.base64.decode(N.data,O.data=$.newBuffer($.base64.length(N.data)),0):N.data.length&&(O.data=N.data)),null!=N.seqno&&("string"==typeof N.seqno?$.base64.decode(N.seqno,O.seqno=$.newBuffer($.base64.length(N.seqno)),0):N.seqno.length&&(O.seqno=N.seqno)),null!=N.topic&&(O.topic=String(N.topic)),null!=N.signature&&("string"==typeof N.signature?$.base64.decode(N.signature,O.signature=$.newBuffer($.base64.length(N.signature)),0):N.signature.length&&(O.signature=N.signature)),null!=N.key&&("string"==typeof N.key?$.base64.decode(N.key,O.key=$.newBuffer($.base64.length(N.key)),0):N.key.length&&(O.key=N.key)),O},J.toObject=function(N,O){O||(O={});var U={};return O.defaults&&(U.topic=""),null!=N.from&&N.hasOwnProperty("from")&&(U.from=O.bytes===String?$.base64.encode(N.from,0,N.from.length):O.bytes===Array?Array.prototype.slice.call(N.from):N.from,O.oneofs&&(U._from="from")),null!=N.data&&N.hasOwnProperty("data")&&(U.data=O.bytes===String?$.base64.encode(N.data,0,N.data.length):O.bytes===Array?Array.prototype.slice.call(N.data):N.data,O.oneofs&&(U._data="data")),null!=N.seqno&&N.hasOwnProperty("seqno")&&(U.seqno=O.bytes===String?$.base64.encode(N.seqno,0,N.seqno.length):O.bytes===Array?Array.prototype.slice.call(N.seqno):N.seqno,O.oneofs&&(U._seqno="seqno")),null!=N.topic&&N.hasOwnProperty("topic")&&(U.topic=N.topic),null!=N.signature&&N.hasOwnProperty("signature")&&(U.signature=O.bytes===String?$.base64.encode(N.signature,0,N.signature.length):O.bytes===Array?Array.prototype.slice.call(N.signature):N.signature,O.oneofs&&(U._signature="signature")),null!=N.key&&N.hasOwnProperty("key")&&(U.key=O.bytes===String?$.base64.encode(N.key,0,N.key.length):O.bytes===Array?Array.prototype.slice.call(N.key):N.key,O.oneofs&&(U._key="key")),U},J.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},J}(),J.ControlMessage=function(){function X(N){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],N)for(var O=Object.keys(N),U=0;U<O.length;++U)null!=N[O[U]]&&(this[O[U]]=N[O[U]])}return X.prototype.ihave=$.emptyArray,X.prototype.iwant=$.emptyArray,X.prototype.graft=$.emptyArray,X.prototype.prune=$.emptyArray,X.encode=function(N,O){if(O||(O=U.create()),null!=N.ihave&&N.ihave.length)for(var $=0;$<N.ihave.length;++$)Y.RPC.ControlIHave.encode(N.ihave[$],O.uint32(10).fork()).ldelim();if(null!=N.iwant&&N.iwant.length)for(var $=0;$<N.iwant.length;++$)Y.RPC.ControlIWant.encode(N.iwant[$],O.uint32(18).fork()).ldelim();if(null!=N.graft&&N.graft.length)for(var $=0;$<N.graft.length;++$)Y.RPC.ControlGraft.encode(N.graft[$],O.uint32(26).fork()).ldelim();if(null!=N.prune&&N.prune.length)for(var $=0;$<N.prune.length;++$)Y.RPC.ControlPrune.encode(N.prune[$],O.uint32(34).fork()).ldelim();return O},X.decode=function(N,U){N instanceof O||(N=O.create(N));for(var $=void 0===U?N.len:N.pos+U,X=new Y.RPC.ControlMessage;N.pos<$;){var J=N.uint32();switch(J>>>3){case 1:X.ihave&&X.ihave.length||(X.ihave=[]),X.ihave.push(Y.RPC.ControlIHave.decode(N,N.uint32()));break;case 2:X.iwant&&X.iwant.length||(X.iwant=[]),X.iwant.push(Y.RPC.ControlIWant.decode(N,N.uint32()));break;case 3:X.graft&&X.graft.length||(X.graft=[]),X.graft.push(Y.RPC.ControlGraft.decode(N,N.uint32()));break;case 4:X.prune&&X.prune.length||(X.prune=[]),X.prune.push(Y.RPC.ControlPrune.decode(N,N.uint32()));break;default:N.skipType(7&J)}}return X},X.fromObject=function(N){if(N instanceof Y.RPC.ControlMessage)return N;var O=new Y.RPC.ControlMessage;if(N.ihave){if(!Array.isArray(N.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");O.ihave=[];for(var U=0;U<N.ihave.length;++U){if("object"!=typeof N.ihave[U])throw TypeError(".RPC.ControlMessage.ihave: object expected");O.ihave[U]=Y.RPC.ControlIHave.fromObject(N.ihave[U])}}if(N.iwant){if(!Array.isArray(N.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");O.iwant=[];for(var U=0;U<N.iwant.length;++U){if("object"!=typeof N.iwant[U])throw TypeError(".RPC.ControlMessage.iwant: object expected");O.iwant[U]=Y.RPC.ControlIWant.fromObject(N.iwant[U])}}if(N.graft){if(!Array.isArray(N.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");O.graft=[];for(var U=0;U<N.graft.length;++U){if("object"!=typeof N.graft[U])throw TypeError(".RPC.ControlMessage.graft: object expected");O.graft[U]=Y.RPC.ControlGraft.fromObject(N.graft[U])}}if(N.prune){if(!Array.isArray(N.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");O.prune=[];for(var U=0;U<N.prune.length;++U){if("object"!=typeof N.prune[U])throw TypeError(".RPC.ControlMessage.prune: object expected");O.prune[U]=Y.RPC.ControlPrune.fromObject(N.prune[U])}}return O},X.toObject=function(N,O){O||(O={});var U={};if((O.arrays||O.defaults)&&(U.ihave=[],U.iwant=[],U.graft=[],U.prune=[]),N.ihave&&N.ihave.length){U.ihave=[];for(var $=0;$<N.ihave.length;++$)U.ihave[$]=Y.RPC.ControlIHave.toObject(N.ihave[$],O)}if(N.iwant&&N.iwant.length){U.iwant=[];for(var $=0;$<N.iwant.length;++$)U.iwant[$]=Y.RPC.ControlIWant.toObject(N.iwant[$],O)}if(N.graft&&N.graft.length){U.graft=[];for(var $=0;$<N.graft.length;++$)U.graft[$]=Y.RPC.ControlGraft.toObject(N.graft[$],O)}if(N.prune&&N.prune.length){U.prune=[];for(var $=0;$<N.prune.length;++$)U.prune[$]=Y.RPC.ControlPrune.toObject(N.prune[$],O)}return U},X.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},X}(),J.ControlIHave=function(){var X;function J(N){if(this.messageIDs=[],N)for(var O=Object.keys(N),U=0;U<O.length;++U)null!=N[O[U]]&&(this[O[U]]=N[O[U]])}return J.prototype.topicID=null,J.prototype.messageIDs=$.emptyArray,Object.defineProperty(J.prototype,"_topicID",{get:$.oneOfGetter(X=["topicID"]),set:$.oneOfSetter(X)}),J.encode=function(N,O){if(O||(O=U.create()),null!=N.topicID&&Object.hasOwnProperty.call(N,"topicID")&&O.uint32(10).string(N.topicID),null!=N.messageIDs&&N.messageIDs.length)for(var $=0;$<N.messageIDs.length;++$)O.uint32(18).bytes(N.messageIDs[$]);return O},J.decode=function(N,U){N instanceof O||(N=O.create(N));for(var $=void 0===U?N.len:N.pos+U,X=new Y.RPC.ControlIHave;N.pos<$;){var J=N.uint32();switch(J>>>3){case 1:X.topicID=N.string();break;case 2:X.messageIDs&&X.messageIDs.length||(X.messageIDs=[]),X.messageIDs.push(N.bytes());break;default:N.skipType(7&J)}}return X},J.fromObject=function(N){if(N instanceof Y.RPC.ControlIHave)return N;var O=new Y.RPC.ControlIHave;if(null!=N.topicID&&(O.topicID=String(N.topicID)),N.messageIDs){if(!Array.isArray(N.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");O.messageIDs=[];for(var U=0;U<N.messageIDs.length;++U)"string"==typeof N.messageIDs[U]?$.base64.decode(N.messageIDs[U],O.messageIDs[U]=$.newBuffer($.base64.length(N.messageIDs[U])),0):N.messageIDs[U].length&&(O.messageIDs[U]=N.messageIDs[U])}return O},J.toObject=function(N,O){O||(O={});var U={};if((O.arrays||O.defaults)&&(U.messageIDs=[]),null!=N.topicID&&N.hasOwnProperty("topicID")&&(U.topicID=N.topicID,O.oneofs&&(U._topicID="topicID")),N.messageIDs&&N.messageIDs.length){U.messageIDs=[];for(var Y=0;Y<N.messageIDs.length;++Y)U.messageIDs[Y]=O.bytes===String?$.base64.encode(N.messageIDs[Y],0,N.messageIDs[Y].length):O.bytes===Array?Array.prototype.slice.call(N.messageIDs[Y]):N.messageIDs[Y]}return U},J.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},J}(),J.ControlIWant=function(){function X(N){if(this.messageIDs=[],N)for(var O=Object.keys(N),U=0;U<O.length;++U)null!=N[O[U]]&&(this[O[U]]=N[O[U]])}return X.prototype.messageIDs=$.emptyArray,X.encode=function(N,O){if(O||(O=U.create()),null!=N.messageIDs&&N.messageIDs.length)for(var $=0;$<N.messageIDs.length;++$)O.uint32(10).bytes(N.messageIDs[$]);return O},X.decode=function(N,U){N instanceof O||(N=O.create(N));for(var $=void 0===U?N.len:N.pos+U,X=new Y.RPC.ControlIWant;N.pos<$;){var J=N.uint32();J>>>3==1?(X.messageIDs&&X.messageIDs.length||(X.messageIDs=[]),X.messageIDs.push(N.bytes())):N.skipType(7&J)}return X},X.fromObject=function(N){if(N instanceof Y.RPC.ControlIWant)return N;var O=new Y.RPC.ControlIWant;if(N.messageIDs){if(!Array.isArray(N.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");O.messageIDs=[];for(var U=0;U<N.messageIDs.length;++U)"string"==typeof N.messageIDs[U]?$.base64.decode(N.messageIDs[U],O.messageIDs[U]=$.newBuffer($.base64.length(N.messageIDs[U])),0):N.messageIDs[U].length&&(O.messageIDs[U]=N.messageIDs[U])}return O},X.toObject=function(N,O){O||(O={});var U={};if((O.arrays||O.defaults)&&(U.messageIDs=[]),N.messageIDs&&N.messageIDs.length){U.messageIDs=[];for(var Y=0;Y<N.messageIDs.length;++Y)U.messageIDs[Y]=O.bytes===String?$.base64.encode(N.messageIDs[Y],0,N.messageIDs[Y].length):O.bytes===Array?Array.prototype.slice.call(N.messageIDs[Y]):N.messageIDs[Y]}return U},X.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},X}(),J.ControlGraft=function(){var X;function J(N){if(N)for(var O=Object.keys(N),U=0;U<O.length;++U)null!=N[O[U]]&&(this[O[U]]=N[O[U]])}return J.prototype.topicID=null,Object.defineProperty(J.prototype,"_topicID",{get:$.oneOfGetter(X=["topicID"]),set:$.oneOfSetter(X)}),J.encode=function(N,O){return O||(O=U.create()),null!=N.topicID&&Object.hasOwnProperty.call(N,"topicID")&&O.uint32(10).string(N.topicID),O},J.decode=function(N,U){N instanceof O||(N=O.create(N));for(var $=void 0===U?N.len:N.pos+U,X=new Y.RPC.ControlGraft;N.pos<$;){var J=N.uint32();J>>>3==1?X.topicID=N.string():N.skipType(7&J)}return X},J.fromObject=function(N){if(N instanceof Y.RPC.ControlGraft)return N;var O=new Y.RPC.ControlGraft;return null!=N.topicID&&(O.topicID=String(N.topicID)),O},J.toObject=function(N,O){O||(O={});var U={};return null!=N.topicID&&N.hasOwnProperty("topicID")&&(U.topicID=N.topicID,O.oneofs&&(U._topicID="topicID")),U},J.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},J}(),J.ControlPrune=function(){var X;function J(N){if(this.peers=[],N)for(var O=Object.keys(N),U=0;U<O.length;++U)null!=N[O[U]]&&(this[O[U]]=N[O[U]])}return J.prototype.topicID=null,J.prototype.peers=$.emptyArray,J.prototype.backoff=null,Object.defineProperty(J.prototype,"_topicID",{get:$.oneOfGetter(X=["topicID"]),set:$.oneOfSetter(X)}),Object.defineProperty(J.prototype,"_backoff",{get:$.oneOfGetter(X=["backoff"]),set:$.oneOfSetter(X)}),J.encode=function(N,O){if(O||(O=U.create()),null!=N.topicID&&Object.hasOwnProperty.call(N,"topicID")&&O.uint32(10).string(N.topicID),null!=N.peers&&N.peers.length)for(var $=0;$<N.peers.length;++$)Y.RPC.PeerInfo.encode(N.peers[$],O.uint32(18).fork()).ldelim();return null!=N.backoff&&Object.hasOwnProperty.call(N,"backoff")&&O.uint32(24).uint64(N.backoff),O},J.decode=function(N,U){N instanceof O||(N=O.create(N));for(var $=void 0===U?N.len:N.pos+U,X=new Y.RPC.ControlPrune;N.pos<$;){var J=N.uint32();switch(J>>>3){case 1:X.topicID=N.string();break;case 2:X.peers&&X.peers.length||(X.peers=[]),X.peers.push(Y.RPC.PeerInfo.decode(N,N.uint32()));break;case 3:X.backoff=N.uint64();break;default:N.skipType(7&J)}}return X},J.fromObject=function(N){if(N instanceof Y.RPC.ControlPrune)return N;var O=new Y.RPC.ControlPrune;if(null!=N.topicID&&(O.topicID=String(N.topicID)),N.peers){if(!Array.isArray(N.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");O.peers=[];for(var U=0;U<N.peers.length;++U){if("object"!=typeof N.peers[U])throw TypeError(".RPC.ControlPrune.peers: object expected");O.peers[U]=Y.RPC.PeerInfo.fromObject(N.peers[U])}}return null!=N.backoff&&($.Long?(O.backoff=$.Long.fromValue(N.backoff)).unsigned=!0:"string"==typeof N.backoff?O.backoff=parseInt(N.backoff,10):"number"==typeof N.backoff?O.backoff=N.backoff:"object"==typeof N.backoff&&(O.backoff=new $.LongBits(N.backoff.low>>>0,N.backoff.high>>>0).toNumber(!0))),O},J.toObject=function(N,O){O||(O={});var U={};if((O.arrays||O.defaults)&&(U.peers=[]),null!=N.topicID&&N.hasOwnProperty("topicID")&&(U.topicID=N.topicID,O.oneofs&&(U._topicID="topicID")),N.peers&&N.peers.length){U.peers=[];for(var X=0;X<N.peers.length;++X)U.peers[X]=Y.RPC.PeerInfo.toObject(N.peers[X],O)}return null!=N.backoff&&N.hasOwnProperty("backoff")&&("number"==typeof N.backoff?U.backoff=O.longs===String?String(N.backoff):N.backoff:U.backoff=O.longs===String?$.Long.prototype.toString.call(N.backoff):O.longs===Number?new $.LongBits(N.backoff.low>>>0,N.backoff.high>>>0).toNumber(!0):N.backoff,O.oneofs&&(U._backoff="backoff")),U},J.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},J}(),J.PeerInfo=function(){var X;function J(N){if(N)for(var O=Object.keys(N),U=0;U<O.length;++U)null!=N[O[U]]&&(this[O[U]]=N[O[U]])}return J.prototype.peerID=null,J.prototype.signedPeerRecord=null,Object.defineProperty(J.prototype,"_peerID",{get:$.oneOfGetter(X=["peerID"]),set:$.oneOfSetter(X)}),Object.defineProperty(J.prototype,"_signedPeerRecord",{get:$.oneOfGetter(X=["signedPeerRecord"]),set:$.oneOfSetter(X)}),J.encode=function(N,O){return O||(O=U.create()),null!=N.peerID&&Object.hasOwnProperty.call(N,"peerID")&&O.uint32(10).bytes(N.peerID),null!=N.signedPeerRecord&&Object.hasOwnProperty.call(N,"signedPeerRecord")&&O.uint32(18).bytes(N.signedPeerRecord),O},J.decode=function(N,U){N instanceof O||(N=O.create(N));for(var $=void 0===U?N.len:N.pos+U,X=new Y.RPC.PeerInfo;N.pos<$;){var J=N.uint32();switch(J>>>3){case 1:X.peerID=N.bytes();break;case 2:X.signedPeerRecord=N.bytes();break;default:N.skipType(7&J)}}return X},J.fromObject=function(N){if(N instanceof Y.RPC.PeerInfo)return N;var O=new Y.RPC.PeerInfo;return null!=N.peerID&&("string"==typeof N.peerID?$.base64.decode(N.peerID,O.peerID=$.newBuffer($.base64.length(N.peerID)),0):N.peerID.length&&(O.peerID=N.peerID)),null!=N.signedPeerRecord&&("string"==typeof N.signedPeerRecord?$.base64.decode(N.signedPeerRecord,O.signedPeerRecord=$.newBuffer($.base64.length(N.signedPeerRecord)),0):N.signedPeerRecord.length&&(O.signedPeerRecord=N.signedPeerRecord)),O},J.toObject=function(N,O){O||(O={});var U={};return null!=N.peerID&&N.hasOwnProperty("peerID")&&(U.peerID=O.bytes===String?$.base64.encode(N.peerID,0,N.peerID.length):O.bytes===Array?Array.prototype.slice.call(N.peerID):N.peerID,O.oneofs&&(U._peerID="peerID")),null!=N.signedPeerRecord&&N.hasOwnProperty("signedPeerRecord")&&(U.signedPeerRecord=O.bytes===String?$.base64.encode(N.signedPeerRecord,0,N.signedPeerRecord.length):O.bytes===Array?Array.prototype.slice.call(N.signedPeerRecord):N.signedPeerRecord,O.oneofs&&(U._signedPeerRecord="signedPeerRecord")),U},J.prototype.toJSON=function(){return this.constructor.toObject(this,N.util.toJSONOptions)},J}(),J}(),Y})},5682:function(N,O,U){"use strict";let $,Y,X,J,Z;U.d(O,{F:function(){return C8}});var en,es,eo,ea,ec,eu,eh,ef,eg,ey,ew,ev,eE,e_,eS,eI,eR,ek,eD,eA,eT,eC,eP,eN,eB,eL,eO,eM,eU,eF,eV,ez,e$,eK,eq,ej,eW,eH,eG,eQ,eY,eX,eJ,eZ,e0,e3,e5,e6,e7,e9,te,tt,tr,ti,tn,ta,tl,tu,th,td,tp,tf,tg,ty,tm,tb,tw,tv,tE,t_,tS,tI,tR,tk,tD,tA,tT,tC,tP,tx,tN,tB,tL,tO,tM,tU,tF={};U.r(tF),U.d(tF,{base58btc:function(){return rS},base58flickr:function(){return rI}});var tV={};U.r(tV),U.d(tV,{base32:function(){return rR},base32hex:function(){return rT},base32hexpad:function(){return rP},base32hexpadupper:function(){return rx},base32hexupper:function(){return rC},base32pad:function(){return rD},base32padupper:function(){return rA},base32upper:function(){return rk},base32z:function(){return rN}});var tz={};U.r(tz),U.d(tz,{base64:function(){return rB},base64pad:function(){return rL},base64url:function(){return rO},base64urlpad:function(){return rM}});var t$={};U.r(t$),U.d(t$,{abortedError:function(){return rG},closeFailedError:function(){return r$},deleteFailedError:function(){return rj},getFailedError:function(){return rq},hasFailedError:function(){return rW},notFoundError:function(){return rH},openFailedError:function(){return rz},putFailedError:function(){return rK}});var tK={};U.r(tK),U.d(tK,{code:function(){return iV},decode:function(){return i$},encode:function(){return iz},name:function(){return iF}});var tq={};U.r(tq),U.d(tq,{identity:function(){return iG}});var tj={};U.r(tj),U.d(tj,{base2:function(){return iQ}});var tW={};U.r(tW),U.d(tW,{base8:function(){return iY}});var tH={};U.r(tH),U.d(tH,{base10:function(){return iX}});var tG={};U.r(tG),U.d(tG,{base16:function(){return iJ},base16upper:function(){return iZ}});var tQ={};U.r(tQ),U.d(tQ,{base36:function(){return i1},base36upper:function(){return i2}});var tY={};U.r(tY),U.d(tY,{base256emoji:function(){return i8}});var tX={};U.r(tX),U.d(tX,{sha256:function(){return nr},sha512:function(){return ni}});var tJ={};U.r(tJ),U.d(tJ,{identity:function(){return nh}});var tZ={};U.r(tZ),U.d(tZ,{code:function(){return ng},decode:function(){return nb},encode:function(){return ny},name:function(){return nf}});var ri={};U.r(ri),U.d(ri,{Ed25519PrivateKey:function(){return dX},Ed25519PublicKey:function(){return dY},generateKeyPair:function(){return pe},generateKeyPairFromSeed:function(){return pr},unmarshalEd25519PrivateKey:function(){return dJ},unmarshalEd25519PublicKey:function(){return dZ}});var rn={};U.r(rn),U.d(rn,{RsaPrivateKey:function(){return fW},RsaPublicKey:function(){return fj},fromJwk:function(){return fQ},generateKeyPair:function(){return fY},unmarshalRsaPrivateKey:function(){return fH},unmarshalRsaPublicKey:function(){return fG}});var ro={};U.r(ro),U.d(ro,{Secp256k1PrivateKey:function(){return f5},Secp256k1PublicKey:function(){return f4},generateKeyPair:function(){return f7},unmarshalSecp256k1PrivateKey:function(){return f6},unmarshalSecp256k1PublicKey:function(){return f8}});var ra=U(1227),rl=function(N,O){if(N.length>=255)throw TypeError("Alphabet too long");for(var U=new Uint8Array(256),$=0;$<U.length;$++)U[$]=255;for(var Y=0;Y<N.length;Y++){var X=N.charAt(Y),J=X.charCodeAt(0);if(255!==U[J])throw TypeError(X+" is ambiguous");U[J]=Y}var Z=N.length,en=N.charAt(0),es=Math.log(Z)/Math.log(256),eo=Math.log(256)/Math.log(Z);function ea(N){if("string"!=typeof N)throw TypeError("Expected String");if(0===N.length)return new Uint8Array;var O=0;if(" "!==N[0]){for(var $=0,Y=0;N[O]===en;)$++,O++;for(var X=(N.length-O)*es+1>>>0,J=new Uint8Array(X);N[O];){var eo=U[N.charCodeAt(O)];if(255===eo)return;for(var ea=0,ec=X-1;(0!==eo||ea<Y)&&-1!==ec;ec--,ea++)eo+=Z*J[ec]>>>0,J[ec]=eo%256>>>0,eo=eo/256>>>0;if(0!==eo)throw Error("Non-zero carry");Y=ea,O++}if(" "!==N[O]){for(var eu=X-Y;eu!==X&&0===J[eu];)eu++;for(var eh=new Uint8Array($+(X-eu)),ef=$;eu!==X;)eh[ef++]=J[eu++];return eh}}}function ec(N){var U=ea(N);if(U)return U;throw Error(`Non-${O} character`)}return{encode:function(O){if(O instanceof Uint8Array||(ArrayBuffer.isView(O)?O=new Uint8Array(O.buffer,O.byteOffset,O.byteLength):Array.isArray(O)&&(O=Uint8Array.from(O))),!(O instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===O.length)return"";for(var U=0,$=0,Y=0,X=O.length;Y!==X&&0===O[Y];)Y++,U++;for(var J=(X-Y)*eo+1>>>0,es=new Uint8Array(J);Y!==X;){for(var ea=O[Y],ec=0,eu=J-1;(0!==ea||ec<$)&&-1!==eu;eu--,ec++)ea+=256*es[eu]>>>0,es[eu]=ea%Z>>>0,ea=ea/Z>>>0;if(0!==ea)throw Error("Non-zero carry");$=ec,Y++}for(var eh=J-$;eh!==J&&0===es[eh];)eh++;for(var ef=en.repeat(U);eh<J;++eh)ef+=N.charAt(es[eh]);return ef},decodeUnsafe:ea,decode:ec}};new Uint8Array(0);let rc=(N,O)=>{if(N===O)return!0;if(N.byteLength!==O.byteLength)return!1;for(let U=0;U<N.byteLength;U++)if(N[U]!==O[U])return!1;return!0},ru=N=>{if(N instanceof Uint8Array&&"Uint8Array"===N.constructor.name)return N;if(N instanceof ArrayBuffer)return new Uint8Array(N);if(ArrayBuffer.isView(N))return new Uint8Array(N.buffer,N.byteOffset,N.byteLength);throw Error("Unknown type, must be binary type")},rh=N=>new TextEncoder().encode(N),rd=N=>new TextDecoder().decode(N);class rp{constructor(N,O,U){this.name=N,this.prefix=O,this.baseEncode=U}encode(N){if(N instanceof Uint8Array)return`${this.prefix}${this.baseEncode(N)}`;throw Error("Unknown type, must be binary type")}}class rf{constructor(N,O,U){if(this.name=N,this.prefix=O,void 0===O.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=O.codePointAt(0),this.baseDecode=U}decode(N){if("string"==typeof N){if(N.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(N)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(N.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(N){return ry(this,N)}}class rg{constructor(N){this.decoders=N}or(N){return ry(this,N)}decode(N){let O=N[0],U=this.decoders[O];if(U)return U.decode(N);throw RangeError(`Unable to decode multibase string ${JSON.stringify(N)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let ry=(N,O)=>new rg({...N.decoders||{[N.prefix]:N},...O.decoders||{[O.prefix]:O}});class rm{constructor(N,O,U,$){this.name=N,this.prefix=O,this.baseEncode=U,this.baseDecode=$,this.encoder=new rp(N,O,U),this.decoder=new rf(N,O,$)}encode(N){return this.encoder.encode(N)}decode(N){return this.decoder.decode(N)}}let rb=({name:N,prefix:O,encode:U,decode:$})=>new rm(N,O,U,$),rw=({prefix:N,name:O,alphabet:U})=>{let{encode:$,decode:Y}=rl(U,O);return rb({prefix:N,name:O,encode:$,decode:N=>ru(Y(N))})},rv=(N,O,U,$)=>{let Y={};for(let N=0;N<O.length;++N)Y[O[N]]=N;let X=N.length;for(;"="===N[X-1];)--X;let J=new Uint8Array(X*U/8|0),Z=0,en=0,es=0;for(let O=0;O<X;++O){let X=Y[N[O]];if(void 0===X)throw SyntaxError(`Non-${$} character`);en=en<<U|X,(Z+=U)>=8&&(Z-=8,J[es++]=255&en>>Z)}if(Z>=U||255&en<<8-Z)throw SyntaxError("Unexpected end of data");return J},rE=(N,O,U)=>{let $="="===O[O.length-1],Y=(1<<U)-1,X="",J=0,Z=0;for(let $=0;$<N.length;++$)for(Z=Z<<8|N[$],J+=8;J>U;)J-=U,X+=O[Y&Z>>J];if(J&&(X+=O[Y&Z<<U-J]),$)for(;X.length*U&7;)X+="=";return X},r_=({name:N,prefix:O,bitsPerChar:U,alphabet:$})=>rb({prefix:O,name:N,encode:N=>rE(N,$,U),decode:O=>rv(O,$,U,N)}),rS=rw({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),rI=rw({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),rR=r_({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rk=r_({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),rD=r_({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),rA=r_({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),rT=r_({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),rC=r_({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),rP=r_({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),rx=r_({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),rN=r_({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),rB=r_({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),rL=r_({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),rO=r_({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),rM=r_({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function rU(N){let O=()=>{};return O.enabled=!1,O.color="",O.diff=0,O.log=()=>{},O.namespace=N,O.destroy=()=>!0,O.extend=()=>O,O}function rF(N){let O=rU(`${N}:trace`);return ra.enabled(`${N}:trace`)&&null!=ra.names.map(N=>N.toString()).find(N=>N.includes(":trace"))&&(O=ra(`${N}:trace`)),Object.assign(ra(N),{error:ra(`${N}:error`),trace:O})}ra.formatters.b=N=>null==N?"undefined":rS.baseEncode(N),ra.formatters.t=N=>null==N?"undefined":rR.baseEncode(N),ra.formatters.m=N=>null==N?"undefined":rB.baseEncode(N),ra.formatters.p=N=>null==N?"undefined":N.toString(),ra.formatters.c=N=>null==N?"undefined":N.toString(),ra.formatters.k=N=>null==N?"undefined":N.toString(),ra.formatters.a=N=>null==N?"undefined":N.toString();var rV=U(2114);function rz(N){return rV(N=N??Error("Open failed"),"ERR_OPEN_FAILED")}function r$(N){return rV(N=N??Error("Close failed"),"ERR_CLOSE_FAILED")}function rK(N){return rV(N=N??Error("Put failed"),"ERR_PUT_FAILED")}function rq(N){return rV(N=N??Error("Get failed"),"ERR_GET_FAILED")}function rj(N){return rV(N=N??Error("Delete failed"),"ERR_DELETE_FAILED")}function rW(N){return rV(N=N??Error("Has failed"),"ERR_HAS_FAILED")}function rH(N){return rV(N=N??Error("Not Found"),"ERR_NOT_FOUND")}function rG(N){return rV(N=N??Error("Aborted"),"ERR_ABORTED")}var rQ=128,rY=-128,rX=2147483648;function rJ(N,O,U){O=O||[];for(var $=U=U||0;N>=rX;)O[U++]=255&N|rQ,N/=128;for(;N&rY;)O[U++]=255&N|rQ,N>>>=7;return O[U]=0|N,rJ.bytes=U-$+1,O}var rZ=128,ie=127;function ir(N,O){var U,$=0,O=O||0,Y=0,X=O,J=N.length;do{if(X>=J)throw ir.bytes=0,RangeError("Could not decode varint");U=N[X++],$+=Y<28?(U&ie)<<Y:(U&ie)*Math.pow(2,Y),Y+=7}while(U>=rZ);return ir.bytes=X-O,$}var io=128,ia=16384,il=2097152,ic=268435456,iu=34359738368,ih=4398046511104,ig=562949953421312,iy=72057594037927940,im=0x7fffffffffffffff,ib={encode:rJ,decode:ir,encodingLength:function(N){return N<io?1:N<ia?2:N<il?3:N<ic?4:N<iu?5:N<ih?6:N<ig?7:N<iy?8:N<im?9:10}};let iw=(N,O=0)=>{let U=ib.decode(N,O);return[U,ib.decode.bytes]},iE=(N,O,U=0)=>(ib.encode(N,O,U),O),i_=N=>ib.encodingLength(N),iS=(N,O)=>{let U=O.byteLength,$=i_(N),Y=$+i_(U),X=new Uint8Array(Y+U);return iE(N,X,0),iE(U,X,$),X.set(O,Y),new ik(N,U,O,X)},iI=N=>{let O=ru(N),[U,$]=iw(O),[Y,X]=iw(O.subarray($)),J=O.subarray($+X);if(J.byteLength!==Y)throw Error("Incorrect length");return new ik(U,Y,J,O)},iR=(N,O)=>{if(N===O)return!0;{let U=O;return N.code===U.code&&N.size===U.size&&U.bytes instanceof Uint8Array&&rc(N.bytes,U.bytes)}};class ik{constructor(N,O,U,$){this.code=N,this.size=O,this.digest=U,this.bytes=$}}let iD=(N,O)=>{let{bytes:U,version:$}=N;return 0===$?iN(U,iT(N),O||rS.encoder):iB(U,iT(N),O||rR.encoder)},iA=new WeakMap,iT=N=>{let O=iA.get(N);if(null==O){let O=new Map;return iA.set(N,O),O}return O};class iC{constructor(N,O,U,$){this.code=O,this.version=N,this.multihash=U,this.bytes=$,this["/"]=$}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:N,multihash:O}=this;if(N!==iL)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(O.code!==iO)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return iC.createV0(O)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:N,digest:O}=this.multihash,U=iS(N,O);return iC.createV1(this.code,U)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(N){return iC.equals(this,N)}static equals(N,O){let U=O;return U&&N.code===U.code&&N.version===U.version&&iR(N.multihash,U.multihash)}toString(N){return iD(this,N)}toJSON(){return{"/":iD(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(N){if(null==N)return null;let O=N;if(O instanceof iC)return O;if(null!=O["/"]&&O["/"]===O.bytes||O.asCID===O){let{version:N,code:U,multihash:$,bytes:Y}=O;return new iC(N,U,$,Y||iM(N,U,$.bytes))}if(!0!==O[iU])return null;{let{version:N,multihash:U,code:$}=O,Y=iI(U);return iC.create(N,$,Y)}}static create(N,O,U){if("number"!=typeof O)throw Error("String codecs are no longer supported");if(!(U.bytes instanceof Uint8Array))throw Error("Invalid digest");switch(N){case 0:if(O===iL)return new iC(N,O,U,U.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${iL}) block encoding`);case 1:{let $=iM(N,O,U.bytes);return new iC(N,O,U,$)}default:throw Error("Invalid version")}}static createV0(N){return iC.create(0,iL,N)}static createV1(N,O){return iC.create(1,N,O)}static decode(N){let[O,U]=iC.decodeFirst(N);if(U.length)throw Error("Incorrect length");return O}static decodeFirst(N){let O=iC.inspectBytes(N),U=O.size-O.multihashSize,$=ru(N.subarray(U,U+O.multihashSize));if($.byteLength!==O.multihashSize)throw Error("Incorrect length");let Y=$.subarray(O.multihashSize-O.digestSize),X=new ik(O.multihashCode,O.digestSize,Y,$),J=0===O.version?iC.createV0(X):iC.createV1(O.codec,X);return[J,N.subarray(O.size)]}static inspectBytes(N){let O=0,U=()=>{let[U,$]=iw(N.subarray(O));return O+=$,U},$=U(),Y=iL;if(18===$?($=0,O=0):Y=U(),0!==$&&1!==$)throw RangeError(`Invalid CID version ${$}`);let X=O,J=U(),Z=U(),en=O+Z,es=en-X;return{version:$,codec:Y,multihashCode:J,digestSize:Z,multihashSize:es,size:en}}static parse(N,O){let[U,$]=iP(N,O),Y=iC.decode($);if(0===Y.version&&"Q"!==N[0])throw Error("Version 0 CID string must not include multibase prefix");return iT(Y).set(U,N),Y}}let iP=(N,O)=>{switch(N[0]){case"Q":{let U=O||rS;return[rS.prefix,U.decode(`${rS.prefix}${N}`)]}case rS.prefix:{let U=O||rS;return[rS.prefix,U.decode(N)]}case rR.prefix:{let U=O||rR;return[rR.prefix,U.decode(N)]}default:if(null==O)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[N[0],O.decode(N)]}},iN=(N,O,U)=>{let{prefix:$}=U;if($!==rS.prefix)throw Error(`Cannot string encode V0 in ${U.name} encoding`);let Y=O.get($);if(null!=Y)return Y;{let Y=U.encode(N).slice(1);return O.set($,Y),Y}},iB=(N,O,U)=>{let{prefix:$}=U,Y=O.get($);if(null!=Y)return Y;{let Y=U.encode(N);return O.set($,Y),Y}},iL=112,iO=18,iM=(N,O,U)=>{let $=i_(N),Y=$+i_(O),X=new Uint8Array(Y+U.byteLength);return iE(N,X,0),iE(O,X,$),X.set(U,Y),X},iU=Symbol.for("@ipld/js-cid/CID"),iF="raw",iV=85,iz=N=>ru(N),i$=N=>ru(N);class iK{has(N,O){return Promise.reject(Error(".has is not implemented"))}put(N,O,U){return Promise.reject(Error(".put is not implemented"))}async *putMany(N,O){for await(let{cid:U,block:$}of N)await this.put(U,$,O),yield U}get(N,O){return Promise.reject(Error(".get is not implemented"))}async *getMany(N,O){for await(let U of N)yield{cid:U,block:await this.get(U,O)}}async delete(N,O){await Promise.reject(Error(".delete is not implemented"))}async *deleteMany(N,O){for await(let U of N)await this.delete(U,O),yield U}async *getAll(N){throw Error(".getAll is not implemented")}}class iq extends iK{data;constructor(){super(),this.data=new Map}put(N,O){return this.data.set(rR.encode(N.multihash.bytes),O),N}get(N){let O=this.data.get(rR.encode(N.multihash.bytes));if(null==O)throw rH();return O}has(N){return this.data.has(rR.encode(N.multihash.bytes))}async delete(N){this.data.delete(rR.encode(N.multihash.bytes))}async *getAll(){for(let[N,O]of this.data.entries())yield{cid:iC.createV1(iV,iI(rR.decode(N))),block:O}}}function ij(N){return rV(N=N??Error("Not Found"),"ERR_NOT_FOUND")}({...t$});let iW=(N=21)=>crypto.getRandomValues(new Uint8Array(N)).reduce((N,O)=>((O&=63)<36?N+=O.toString(36):O<62?N+=(O-26).toString(36).toUpperCase():O>62?N+="-":N+="_",N),"");function iH(N){return null!=globalThis.Buffer?new Uint8Array(N.buffer,N.byteOffset,N.byteLength):N}let iG=rb({prefix:"\x00",name:"identity",encode:N=>rd(N),decode:N=>rh(N)}),iQ=r_({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),iY=r_({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),iX=rw({prefix:"9",name:"base10",alphabet:"0123456789"}),iJ=r_({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),iZ=r_({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),i1=rw({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),i2=rw({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),i0=Array.from("\uD83D\uDE80\uD83E\uDE90☄\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09☀\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02❤\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09☺\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E✌✨\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D❣\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33✋\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13⭐✅\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6✔\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90☹\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20☝\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B⚽\uD83E\uDD19☕\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81⚡\uD83C\uDF1E\uD83C\uDF88❌✊\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C✈\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74▶➡❓\uD83D\uDC8E\uD83D\uDCB8⬇\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A⚠\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37☎\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51❄\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),i3=i0.reduce((N,O,U)=>(N[U]=O,N),[]),i4=i0.reduce((N,O,U)=>(N[O.codePointAt(0)]=U,N),[]);function i5(N){return N.reduce((N,O)=>N+=i3[O],"")}function i6(N){let O=[];for(let U of N){let N=i4[U.codePointAt(0)];if(void 0===N)throw Error(`Non-base256emoji character: ${U}`);O.push(N)}return new Uint8Array(O)}let i8=rb({prefix:"\uD83D\uDE80",name:"base256emoji",encode:i5,decode:i6}),i7=({name:N,code:O,encode:U})=>new i9(N,O,U);class i9{constructor(N,O,U){this.name=N,this.code=O,this.encode=U}digest(N){if(N instanceof Uint8Array){let O=this.encode(N);return O instanceof Uint8Array?iS(this.code,O):O.then(N=>iS(this.code,N))}throw Error("Unknown type, must be binary type")}}let nt=N=>async O=>new Uint8Array(await crypto.subtle.digest(N,O)),nr=i7({name:"sha2-256",code:18,encode:nt("SHA-256")}),ni=i7({name:"sha2-512",code:19,encode:nt("SHA-512")}),nn=0,no="identity",na=ru,nu=N=>iS(nn,na(N)),nh={code:nn,name:no,encode:na,digest:nu},nd=new TextEncoder,np=new TextDecoder,nf="json",ng=512,ny=N=>nd.encode(JSON.stringify(N)),nb=N=>JSON.parse(np.decode(N)),nw={...tq,...tj,...tW,...tH,...tG,...tV,...tQ,...tF,...tz,...tY};function nv(N=0){return globalThis.Buffer?.alloc!=null?iH(globalThis.Buffer.alloc(N)):new Uint8Array(N)}function nE(N=0){return globalThis.Buffer?.allocUnsafe!=null?iH(globalThis.Buffer.allocUnsafe(N)):new Uint8Array(N)}function n_(N,O,U,$){return{name:N,prefix:O,encoder:{name:N,prefix:O,encode:U},decoder:{decode:$}}}({...tX,...tJ});let nS=n_("utf8","u",N=>{let O=new TextDecoder("utf8");return"u"+O.decode(N)},N=>{let O=new TextEncoder;return O.encode(N.substring(1))}),nI=n_("ascii","a",N=>{let O="a";for(let U=0;U<N.length;U++)O+=String.fromCharCode(N[U]);return O},N=>{N=N.substring(1);let O=nE(N.length);for(let U=0;U<N.length;U++)O[U]=N.charCodeAt(U);return O}),nR={utf8:nS,"utf-8":nS,hex:nw.base16,latin1:nI,ascii:nI,binary:nI,...nw};var nk=nR;function nD(N,O="utf8"){let U=nk[O];if(null==U)throw Error(`Unsupported encoding "${O}"`);return("utf8"===O||"utf-8"===O)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?iH(globalThis.Buffer.from(N,"utf-8")):U.decoder.decode(`${U.prefix}${N}`)}function nA(N,O="utf8"){let U=nk[O];if(null==U)throw Error(`Unsupported encoding "${O}"`);return("utf8"===O||"utf-8"===O)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(N.buffer,N.byteOffset,N.byteLength).toString("utf8"):U.encoder.encode(N).substring(1)}let nT="/",nC=new TextEncoder().encode(nT),nP=nC[0];class nx{_buf;constructor(N,O){if("string"==typeof N)this._buf=nD(N);else if(N instanceof Uint8Array)this._buf=N;else throw Error("Invalid key, should be String of Uint8Array");if(null==O&&(O=!0),O&&this.clean(),0===this._buf.byteLength||this._buf[0]!==nP)throw Error("Invalid key")}toString(N="utf8"){return nA(this._buf,N)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(N){return new nx(N.join(nT))}static random(){return new nx(iW().replace(/-/g,""))}static asKey(N){return N instanceof Uint8Array||"string"==typeof N?new nx(N):"function"==typeof N.uint8Array?new nx(N.uint8Array()):null}clean(){if((null==this._buf||0===this._buf.byteLength)&&(this._buf=nC),this._buf[0]!==nP){let N=new Uint8Array(this._buf.byteLength+1);N.fill(nP,0,1),N.set(this._buf,1),this._buf=N}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===nP;)this._buf=this._buf.subarray(0,-1)}less(N){let O=this.list(),U=N.list();for(let N=0;N<O.length;N++){if(U.length<N+1)return!1;let $=O[N],Y=U[N];if($<Y)return!0;if($>Y)return!1}return O.length<U.length}reverse(){return nx.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let N=this.namespaces();return N[N.length-1]}list(){return this.toString().split(nT).slice(1)}type(){return nN(this.baseNamespace())}name(){return nB(this.baseNamespace())}instance(N){return new nx(this.toString()+":"+N)}path(){let N=this.parent().toString();return N.endsWith(nT)||(N+=nT),N+=this.type(),new nx(N)}parent(){let N=this.list();return new nx(1===N.length?nT:N.slice(0,-1).join(nT))}child(N){return this.toString()===nT?N:N.toString()===nT?this:new nx(this.toString()+N.toString(),!1)}isAncestorOf(N){return N.toString()!==this.toString()&&N.toString().startsWith(this.toString())}isDecendantOf(N){return N.toString()!==this.toString()&&this.toString().startsWith(N.toString())}isTopLevel(){return 1===this.list().length}concat(...N){return nx.withNamespaces([...this.namespaces(),...nL(N.map(N=>N.namespaces()))])}}function nN(N){let O=N.split(":");return O.length<2?"":O.slice(0,-1).join(":")}function nB(N){let O=N.split(":");return O[O.length-1]}function nL(N){return[].concat(...N)}let nO="SHARDING";function nM(N){return null!=N[Symbol.asyncIterator]}var nU=function(N){if(nM(N))return(async()=>{for await(let O of N);})();for(let O of N);},nF=function(N){let[O,U]=null!=N[Symbol.asyncIterator]?[N[Symbol.asyncIterator](),Symbol.asyncIterator]:[N[Symbol.iterator](),Symbol.iterator],$=[];return{peek:()=>O.next(),push:N=>{$.push(N)},next:()=>$.length>0?{done:!1,value:$.shift()}:O.next(),[U](){return this}}};function nV(N){return null!=N[Symbol.asyncIterator]}var nz=function(N,O){if(nV(N))return async function*(){for await(let U of N)await O(U)&&(yield U)}();let U=nF(N),{value:$,done:Y}=U.next();if(!0===Y)return function*(){}();let X=O($);if("function"==typeof X.then)return async function*(){for await(let N of(await X&&(yield $),U))await O(N)&&(yield N)}();let J=O;return function*(){for(let N of(!0===X&&(yield $),U))J(N)&&(yield N)}()};function n$(N){return null!=N[Symbol.asyncIterator]}var nK=function(N){if(n$(N))return(async()=>{let O=[];for await(let U of N)O.push(U);return O})();let O=[];for(let U of N)O.push(U);return O};function nq(N){return null!=N[Symbol.asyncIterator]}var nj=function(N,O){return nq(N)?async function*(){let U=await nK(N);yield*U.sort(O)}():function*(){let U=nK(N);yield*U.sort(O)}()};function nW(N){return null!=N[Symbol.asyncIterator]}var nH=function(N,O){return nW(N)?async function*(){let U=0;if(!(O<1)){for await(let $ of N)if(yield $,++U===O)return}}():function*(){let U=0;if(!(O<1)){for(let $ of N)if(yield $,++U===O)return}}()};class nG{put(N,O,U){return Promise.reject(Error(".put is not implemented"))}get(N,O){return Promise.reject(Error(".get is not implemented"))}has(N,O){return Promise.reject(Error(".has is not implemented"))}delete(N,O){return Promise.reject(Error(".delete is not implemented"))}async *putMany(N,O={}){for await(let{key:U,value:$}of N)await this.put(U,$,O),yield U}async *getMany(N,O={}){for await(let U of N)yield{key:U,value:await this.get(U,O)}}async *deleteMany(N,O={}){for await(let U of N)await this.delete(U,O),yield U}batch(){let N=[],O=[];return{put(O,U){N.push({key:O,value:U})},delete(N){O.push(N)},commit:async U=>{await nU(this.putMany(N,U)),N=[],await nU(this.deleteMany(O,U)),O=[]}}}async *_all(N,O){throw Error("._all is not implemented")}async *_allKeys(N,O){throw Error("._allKeys is not implemented")}query(N,O){let U=this._all(N,O);if(null!=N.prefix){let O=N.prefix;U=nz(U,N=>N.key.toString().startsWith(O))}if(Array.isArray(N.filters)&&(U=N.filters.reduce((N,O)=>nz(N,O),U)),Array.isArray(N.orders)&&(U=N.orders.reduce((N,O)=>nj(N,O),U)),null!=N.offset){let O=0,$=N.offset;U=nz(U,()=>O++>=$)}return null!=N.limit&&(U=nH(U,N.limit)),U}queryKeys(N,O){let U=this._allKeys(N,O);if(null!=N.prefix){let O=N.prefix;U=nz(U,N=>N.toString().startsWith(O))}if(Array.isArray(N.filters)&&(U=N.filters.reduce((N,O)=>nz(N,O),U)),Array.isArray(N.orders)&&(U=N.orders.reduce((N,O)=>nj(N,O),U)),null!=N.offset){let O=N.offset,$=0;U=nz(U,()=>$++>=O)}return null!=N.limit&&(U=nH(U,N.limit)),U}}class nQ extends nG{data;constructor(){super(),this.data=new Map}put(N,O){return this.data.set(N.toString(),O),N}get(N){let O=this.data.get(N.toString());if(null==O)throw ij();return O}has(N){return this.data.has(N.toString())}delete(N){this.data.delete(N.toString())}*_all(){for(let[N,O]of this.data.entries())yield{key:new nx(N),value:O}}*_allKeys(){for(let N of this.data.keys())yield new nx(N)}}function nY(N){let O=new globalThis.AbortController;function U(){for(let $ of(O.abort(),N))$?.removeEventListener!=null&&$.removeEventListener("abort",U)}for(let O of N){if(O?.aborted===!0){U();break}O?.addEventListener!=null&&O.addEventListener("abort",U)}function $(){for(let O of N)O?.removeEventListener!=null&&O.removeEventListener("abort",U)}let Y=O.signal;return Y.clear=$,Y}function nX(N){return null!=N[Symbol.asyncIterator]}new nx(nO),rF("datastore:core:tiered");var nJ=function(N,O){if(nX(N))return async function*(){for await(let U of N)await O(U),yield U}();let U=nF(N),{value:$,done:Y}=U.next();if(!0===Y)return function*(){}();let X=O($);if("function"==typeof X?.then)return async function*(){for await(let N of(yield $,U))await O(N),yield N}();let J=O;return function*(){for(let N of(yield $,U))J(N),yield N}()};class nZ extends Map{metric;constructor(N){super();let{name:O,metrics:U}=N;this.metric=U.registerMetric(O),this.updateComponentMetric()}set(N,O){return super.set(N,O),this.updateComponentMetric(),this}delete(N){let O=super.delete(N);return this.updateComponentMetric(),O}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function n2(N){let{name:O,metrics:U}=N;return null!=U?new nZ({name:O,metrics:U}):new Map}class n0 extends Error{code;type;constructor(N="The operation was aborted"){super(N),this.code=n0.code,this.type=n0.type}static code="ABORT_ERR";static type="aborted"}class n3 extends Error{code;props;constructor(N,O,U){super(N),this.code=O,this.name=U?.name??"CodeError",this.props=U??{}}}var n4=U(2838);function n5(N,O){if(N===O)return!0;if(N.byteLength!==O.byteLength)return!1;for(let U=0;U<N.byteLength;U++)if(N[U]!==O[U])return!1;return!0}class n6{_refCounter;cid;priority;wantType;constructor(N,O,U){this._refCounter=1,this.cid=N,this.priority=O??1,this.wantType=U}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){let N=this.cid.toString(rS);return`WantlistEntry <key: ${N}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(N){return this._refCounter===N._refCounter&&this.cid.equals(N.cid)&&this.priority===N.priority&&this.wantType===N.wantType}}class n8{entry;cancel;sendDontHave;constructor(N,O,U,$,Y){this.entry=new n6(N,O,U),this.cancel=!!$,this.sendDontHave=!!Y}get cid(){return this.entry.cid}set cid(N){this.entry.cid=N}get priority(){return this.entry.priority}set priority(N){this.entry.priority=N}get wantType(){return this.entry.wantType}set wantType(N){this.entry.wantType=N}get[Symbol.toStringTag](){let N=this.cid.toString(rS);return`BitswapMessageEntry ${N} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(N){return this.cancel===N.cancel&&this.sendDontHave===N.sendDontHave&&this.wantType===N.wantType&&this.entry.equals(N.entry)}}let n7=(N,O)=>{let U=["bitswap"];return null!=O&&U.push(O),null!=N&&U.push(`${N.toString().slice(0,8)}`),rF(U.join(":"))},n9=(N,O)=>{if(N.size!==O.size)return!1;for(let[U,$]of N){let N=O.get(U);if(void 0===N||$ instanceof Uint8Array&&N instanceof Uint8Array&&!n5($,N)||$ instanceof n8&&N instanceof n8&&!$.equals(N))return!1}return!0};var se=U(4676),sr=function(N){let O=new Uint8Array(N.reduce((N,O)=>N+se.encodingLength(O),0)),U=0;for(let $ of N)O=se.encode($,O,U),U+=se.encodingLength($);return O},si=U(7364),sn=U(922),so=U(8360),sa=U(62),sc=U(9157);!function(){so._configure(),si._configure(sn),sa._configure(sc)}();let su=["uint64","int64","sint64","fixed64","sfixed64"];function sd(N){for(let O of su){if(null==N[O])continue;let U=N[O];N[O]=function(){return BigInt(U.call(this).toString())}}return N}function sp(N){return sd(new si(N))}function sf(N){for(let O of su){if(null==N[O])continue;let U=N[O];N[O]=function(N){return U.call(this,N.toString())}}return N}function sg(){return sf(sa.create())}function sy(N,O){let U=sp(N instanceof Uint8Array?N:N.subarray());return O.decode(U)}function sm(N,O){let U=sg();return O.encode(N,U,{lengthDelimited:!1}),U.finish()}function sb(N,O,U,$){return{name:N,type:O,encode:U,decode:$}}function sv(N){function O(O){if(null==N[O.toString()])throw Error("Invalid enum value");return N[O]}let U=function(N,U){let $=O(N);U.int32($)},$=function(N){let U=N.int32();return O(U)};return sb("enum",en.VARINT,U,$)}function sE(N,O){return sb("message",en.LENGTH_DELIMITED,N,O)}!function(N){N[N.VARINT=0]="VARINT",N[N.BIT64=1]="BIT64",N[N.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",N[N.START_GROUP=3]="START_GROUP",N[N.END_GROUP=4]="END_GROUP",N[N.BIT32=5]="BIT32"}(en||(en={})),function(N){let O,U,$,Y,X,J;(function(O){let U,$,Y,X;(function(N){N.Block="Block",N.Have="Have"})(U=O.WantType||(O.WantType={})),function(N){N[N.Block=0]="Block",N[N.Have=1]="Have"}($||($={})),function(N){N.codec=()=>sv($)}(U=O.WantType||(O.WantType={})),function(O){let Y;O.codec=()=>(null==Y&&(Y=sE((O,U,Y={})=>{!1!==Y.lengthDelimited&&U.fork(),null!=O.block&&O.block.byteLength>0&&(U.uint32(10),U.bytes(O.block)),null!=O.priority&&0!==O.priority&&(U.uint32(16),U.int32(O.priority)),null!=O.cancel&&!1!==O.cancel&&(U.uint32(24),U.bool(O.cancel)),null!=O.wantType&&0!==$[O.wantType]&&(U.uint32(32),N.Wantlist.WantType.codec().encode(O.wantType,U)),null!=O.sendDontHave&&!1!==O.sendDontHave&&(U.uint32(40),U.bool(O.sendDontHave)),!1!==Y.lengthDelimited&&U.ldelim()},(O,$)=>{let Y={block:new Uint8Array(0),priority:0,cancel:!1,wantType:U.Block,sendDontHave:!1},X=null==$?O.len:O.pos+$;for(;O.pos<X;){let U=O.uint32();switch(U>>>3){case 1:Y.block=O.bytes();break;case 2:Y.priority=O.int32();break;case 3:Y.cancel=O.bool();break;case 4:Y.wantType=N.Wantlist.WantType.codec().decode(O);break;case 5:Y.sendDontHave=O.bool();break;default:O.skipType(7&U)}}return Y})),Y),O.encode=N=>sm(N,O.codec()),O.decode=N=>sy(N,O.codec())}(Y=O.Entry||(O.Entry={})),O.codec=()=>(null==X&&(X=sE((O,U,$={})=>{if(!1!==$.lengthDelimited&&U.fork(),null!=O.entries)for(let $ of O.entries)U.uint32(10),N.Wantlist.Entry.codec().encode($,U);null!=O.full&&!1!==O.full&&(U.uint32(16),U.bool(O.full)),!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let $={entries:[],full:!1},Y=null==U?O.len:O.pos+U;for(;O.pos<Y;){let U=O.uint32();switch(U>>>3){case 1:$.entries.push(N.Wantlist.Entry.codec().decode(O,O.uint32()));break;case 2:$.full=O.bool();break;default:O.skipType(7&U)}}return $})),X),O.encode=N=>sm(N,O.codec()),O.decode=N=>sy(N,O.codec())})(O=N.Wantlist||(N.Wantlist={})),function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),null!=N.prefix&&N.prefix.byteLength>0&&(O.uint32(10),O.bytes(N.prefix)),null!=N.data&&N.data.byteLength>0&&(O.uint32(18),O.bytes(N.data)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={prefix:new Uint8Array(0),data:new Uint8Array(0)},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.prefix=N.bytes();break;case 2:U.data=N.bytes();break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(U=N.Block||(N.Block={})),function(N){N.Have="Have",N.DontHave="DontHave"}($=N.BlockPresenceType||(N.BlockPresenceType={})),function(N){N[N.Have=0]="Have",N[N.DontHave=1]="DontHave"}(Y||(Y={})),function(N){N.codec=()=>sv(Y)}($=N.BlockPresenceType||(N.BlockPresenceType={})),function(O){let U;O.codec=()=>(null==U&&(U=sE((O,U,$={})=>{!1!==$.lengthDelimited&&U.fork(),null!=O.cid&&O.cid.byteLength>0&&(U.uint32(10),U.bytes(O.cid)),null!=O.type&&0!==Y[O.type]&&(U.uint32(16),N.BlockPresenceType.codec().encode(O.type,U)),!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let Y={cid:new Uint8Array(0),type:$.Have},X=null==U?O.len:O.pos+U;for(;O.pos<X;){let U=O.uint32();switch(U>>>3){case 1:Y.cid=O.bytes();break;case 2:Y.type=N.BlockPresenceType.codec().decode(O);break;default:O.skipType(7&U)}}return Y})),U),O.encode=N=>sm(N,O.codec()),O.decode=N=>sy(N,O.codec())}(X=N.BlockPresence||(N.BlockPresence={})),N.codec=()=>(null==J&&(J=sE((O,U,$={})=>{if(!1!==$.lengthDelimited&&U.fork(),null!=O.wantlist&&(U.uint32(10),N.Wantlist.codec().encode(O.wantlist,U)),null!=O.blocks)for(let N of O.blocks)U.uint32(18),U.bytes(N);if(null!=O.payload)for(let $ of O.payload)U.uint32(26),N.Block.codec().encode($,U);if(null!=O.blockPresences)for(let $ of O.blockPresences)U.uint32(34),N.BlockPresence.codec().encode($,U);null!=O.pendingBytes&&0!==O.pendingBytes&&(U.uint32(40),U.int32(O.pendingBytes)),!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let $={blocks:[],payload:[],blockPresences:[],pendingBytes:0},Y=null==U?O.len:O.pos+U;for(;O.pos<Y;){let U=O.uint32();switch(U>>>3){case 1:$.wantlist=N.Wantlist.codec().decode(O,O.uint32());break;case 2:$.blocks.push(O.bytes());break;case 3:$.payload.push(N.Block.codec().decode(O,O.uint32()));break;case 4:$.blockPresences.push(N.BlockPresence.codec().decode(O,O.uint32()));break;case 5:$.pendingBytes=O.int32();break;default:O.skipType(7&U)}}return $})),J),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(es||(es={}));class sS{static Entry=n8;static WantType={Block:es.Wantlist.WantType.Block,Have:es.Wantlist.WantType.Have};static BlockPresenceType={Have:es.BlockPresenceType.Have,DontHave:es.BlockPresenceType.DontHave};static deserialize=async(N,O)=>{let U=es.decode(N),$=U.wantlist?.full===!0,Y=new sS($);return(U.wantlist?.entries.forEach(N=>{if(null==N.block)return;let O=iC.decode(N.block);Y.addEntry(O,N.priority??0,N.wantType,!!N.cancel,!!N.sendDontHave)}),U.blockPresences.forEach(N=>{if(null==N.cid)return;let O=iC.decode(N.cid);N.type===sS.BlockPresenceType.Have?Y.addHave(O):Y.addDontHave(O)}),U.blocks.length>0)?(await Promise.all(U.blocks.map(async N=>{let O=await nr.digest(N),U=iC.createV0(O);Y.addBlock(U,N)})),Y):(U.payload.length>0&&(await Promise.all(U.payload.map(async N=>{if(null==N.prefix||null==N.data)return;let U=n4(N.prefix),$=U[0],X=U[1],J=U[2],Z=J===nr.code?nr:await O?.getHasher(J);if(null==Z)throw new n3("Unknown hash algorithm","ERR_UNKNOWN_HASH_ALG");let en=await Z.digest(N.data),es=iC.create($,X,en);Y.addBlock(es,N.data)})),Y.setPendingBytes(U.pendingBytes)),Y)};static blockPresenceSize=N=>N.bytes.length+1;full;wantlist;blocks;blockPresences;pendingBytes;constructor(N){this.full=N,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return 0===this.blocks.size&&0===this.wantlist.size&&0===this.blockPresences.size}addEntry(N,O,U,$,Y){null==U&&(U=sS.WantType.Block);let X=N.toString(rS),J=this.wantlist.get(X);null!=J?(J.wantType===U&&(J.priority=O),!0===$&&(J.cancel=!!$),!0===Y&&(J.sendDontHave=!!Y),U===sS.WantType.Block&&J.wantType===sS.WantType.Have&&(J.wantType=U)):this.wantlist.set(X,new n8(N,O,U,$,Y))}addBlock(N,O){let U=N.toString(rS);this.blocks.set(U,O)}addHave(N){let O=N.toString(rS);this.blockPresences.has(O)||this.blockPresences.set(O,sS.BlockPresenceType.Have)}addDontHave(N){let O=N.toString(rS);this.blockPresences.has(O)||this.blockPresences.set(O,sS.BlockPresenceType.DontHave)}cancel(N){let O=N.toString(rS);this.wantlist.delete(O),this.addEntry(N,0,sS.WantType.Block,!0,!1)}setPendingBytes(N){this.pendingBytes=N}serializeToBitswap100(){return es.encode({wantlist:{entries:Array.from(this.wantlist.values()).map(N=>({block:N.cid.bytes,priority:Number(N.priority),cancel:!!N.cancel,wantType:es.Wantlist.WantType.Block,sendDontHave:!1})),full:!!this.full},blocks:Array.from(this.blocks.values())})}serializeToBitswap110(){let N={wantlist:{entries:Array.from(this.wantlist.values()).map(N=>({block:N.cid.bytes,priority:Number(N.priority),wantType:N.wantType,cancel:!!N.cancel,sendDontHave:!!N.sendDontHave})),full:!!this.full},blockPresences:[],payload:[],pendingBytes:this.pendingBytes,blocks:[]};for(let[O,U]of this.blocks.entries()){let $=iC.parse(O),Y=$.version,X=$.code,J=$.multihash.code,Z=$.multihash.digest.length,en=sr([Y,X,J,Z]);N.payload.push({prefix:en,data:U})}for(let[O,U]of this.blockPresences)N.blockPresences.push({cid:iC.parse(O).bytes,type:U});return this.pendingBytes>0&&(N.pendingBytes=this.pendingBytes),es.encode(N)}equals(N){return!!(this.full===N.full&&this.pendingBytes===N.pendingBytes&&n9(this.wantlist,N.wantlist)&&n9(this.blocks,N.blocks)&&n9(this.blockPresences,N.blockPresences))}get[Symbol.toStringTag](){let N=Array.from(this.wantlist.keys()),O=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${N}, blocks: ${O}>`}}let sI={Block:es.Wantlist.WantType.Block,Have:es.Wantlist.WantType.Have},sR=(N,O)=>Array.prototype.slice.call(O,0).sort((O,U)=>{let $=N(O),Y=N(U);return $<Y?-1:$>Y?1:0});class sk{static Entry=n6;set;_stats;constructor(N,O){this.set=null!=O?n2({name:"ipfs_bitswap_wantlist",metrics:O.metrics}):new Map,this._stats=N}get length(){return this.set.size}add(N,O,U){let $=N.toString(rS),Y=this.set.get($);null!=Y?(Y.inc(),Y.priority=O,Y.wantType===sI.Have&&U===sI.Block&&(Y.wantType=U)):(this.set.set($,new n6(N,O,U)),null!=this._stats&&this._stats.push(void 0,"wantListSize",1))}remove(N){let O=N.toString(rS),U=this.set.get(O);null!=U&&(U.dec(),U.hasRefs()||(this.set.delete(O),null!=this._stats&&this._stats.push(void 0,"wantListSize",-1)))}removeForce(N){this.set.has(N)&&this.set.delete(N)}forEach(N){this.set.forEach(N)}entries(){return this.set.entries()}sortedEntries(){return new Map(sR(N=>N[1].key,Array.from(this.set.entries())))}contains(N){let O=N.toString(rS);return this.set.has(O)}get(N){let O=N.toString(rS);return this.set.get(O)}}class sD{partner;wantlist;exchangeCount;accounting;lastExchange;constructor(N){this.partner=N,this.wantlist=new sk,this.exchangeCount=0,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(N){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesSent+=N}receivedBytes(N){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesRecv+=N}wants(N,O,U){this.wantlist.add(N,O,U)}cancelWant(N){this.wantlist.remove(N)}wantlistContains(N){return this.wantlist.get(N)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}}class sA extends Map{_cmp;_keys;constructor(N,O){for(let[U,$]of(super(),this._cmp=O??this._defaultSort,this._keys=[],N??[]))this.set(U,$)}update(N){if(N<0||N>=this._keys.length)return;let O=this._keys[N];this._keys.splice(N,1);let U=this._find(O);this._keys.splice(U,0,O)}set(N,O){if(this.has(N)){let O=this.indexOf(N);this._keys.splice(O,1)}super.set(N,O);let U=this._find(N);return this._keys.splice(U,0,N),this}clear(){super.clear(),this._keys=[]}delete(N){if(!this.has(N))return!1;let O=this.indexOf(N);return this._keys.splice(O,1),super.delete(N)}indexOf(N){if(!this.has(N))return -1;let O=this._find(N);if(this._keys[O]===N)return O;for(let U=1;U<this._keys.length;U++){if(this._keys[O+U]===N)return O+U;if(this._keys[O-U]===N)return O-U}return -1}_find(N){let O=0,U=this._keys.length;for(;O<U;){let $=O+U>>>1,Y=this._kCmp(this._keys[$],N);if(Y<0)O=$+1;else{if(!(Y>0))return $;U=$}}return O}*keys(){for(let N of this._keys)yield N}*values(){for(let N of this._keys)yield this.get(N)}*entries(){for(let N of this._keys)yield[N,this.get(N)]}*[Symbol.iterator](){yield*this.entries()}forEach(N,O=this){if(null!=N)for(let U of this._keys){let $=this.get(U);if(null==$)throw Error("Value cannot be undefined");N.apply(O,[[U,$]])}}_defaultSort(N,O){return N[0]<O[0]?-1:O[0]<N[0]?1:0}_kCmp(N,O){return this._cmp([N,this.get(N)],[O,this.get(O)])}}let sT={hasNewInfo:()=>!1,merge(){}};class sC{_taskMerger;_byPeer;constructor(N=sT){this._taskMerger=N,this._byPeer=new sA([],sP.compare)}pushTasks(N,O){let U=this._byPeer.get(N.toString());null==U&&(U=new sP(N,this._taskMerger)),U.pushTasks(O),this._byPeer.set(N.toString(),U)}popTasks(N){let O=this._head();if(void 0===O)return{tasks:[],pendingSize:0};let{tasks:U,pendingSize:$}=O.popTasks(N);if(0===U.length)return{tasks:U,pendingSize:$};let Y=O.peerId;return O.isIdle()?this._byPeer.delete(Y.toString()):this._byPeer.update(0),{peerId:Y,tasks:U,pendingSize:$}}_head(){if(0!==this._byPeer.size)for(let[,N]of this._byPeer)return N}remove(N,O){let U=this._byPeer.get(O.toString());U?.remove(N)}tasksDone(N,O){let U=this._byPeer.get(N.toString());if(null==U)return;let $=this._byPeer.indexOf(N.toString());for(let N of O)U.taskDone(N);this._byPeer.update($)}}class sP{peerId;_taskMerger;_activeTotalSize;_pending;_active;constructor(N,O){this.peerId=N,this._taskMerger=O,this._activeTotalSize=0,this._pending=new sN,this._active=new Set}pushTasks(N){for(let O of N)this._pushTask(O)}_pushTask(N){if(!this._taskHasMoreInfoThanActiveTasks(N))return;let O=this._pending.get(N.topic);if(null!=O){N.priority>O.priority&&this._pending.updatePriority(N.topic,N.priority),this._taskMerger.merge(N,O);return}this._pending.add(N)}_taskHasMoreInfoThanActiveTasks(N){let O=[];for(let U of this._active)U.topic===N.topic&&O.push(U);return 0===O.length||this._taskMerger.hasNewInfo(N,O)}popTasks(N){let O=0,U=[],$=this._pending.tasks();for(let Y=0;Y<$.length&&O<N;Y++){let N=$[Y];U.push(N),O+=N.size,this._pending.delete(N.topic),this._activeTotalSize+=N.size,this._active.add(N)}return{tasks:U,pendingSize:this._pending.totalSize}}taskDone(N){this._active.has(N)&&(this._activeTotalSize-=N.size,this._active.delete(N))}remove(N){this._pending.delete(N)}isIdle(){return 0===this._pending.length&&0===this._active.size}static compare(N,O){return 0===N[1]._pending.length?1:0===O[1]._pending.length?-1:N[1]._activeTotalSize===O[1]._activeTotalSize?O[1]._pending.length-N[1]._pending.length:N[1]._activeTotalSize-O[1]._activeTotalSize}}class sN{_tasks;constructor(){this._tasks=new sA([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce((N,O)=>N+O.task.size,0)}get(N){return this._tasks?.get(N)?.task}add(N){this._tasks.set(N.topic,{created:Date.now(),task:N})}delete(N){this._tasks.delete(N)}tasks(){return[...this._tasks.values()].map(N=>N.task)}updatePriority(N,O){let U=this._tasks.get(N);if(null==U)return;let $=this._tasks.indexOf(N);U.task.priority=O,this._tasks.update($)}_compare(N,O){return N[1].task.priority===O[1].task.priority?N[1].created-O[1].created:O[1].task.priority-N[1].task.priority}}let sB={hasNewInfo(N,O){let U=!1,$=!1;for(let N of O)N.data.haveBlock&&(U=!0),N.data.isWantBlock&&($=!0);return!$&&!!N.data.isWantBlock||!U&&!!N.data.haveBlock},merge(N,O){let U=N.data,$=O.data;!$.haveBlock&&U.haveBlock&&($.haveBlock=U.haveBlock,$.blockSize=U.blockSize),!$.isWantBlock&&U.isWantBlock&&($.isWantBlock=!0,(!$.haveBlock||U.haveBlock)&&($.haveBlock=U.haveBlock,O.size=N.size)),$.isWantBlock&&$.haveBlock&&(O.size=$.blockSize)}},sL=sS.WantType,sO=16384,sM=1024;class sU{_log;blockstore;network;_stats;_opts;ledgerMap;_running;_requestQueue;constructor(N,O,U,$,Y,X={}){this._log=n7(N,"engine"),this.blockstore=O,this.network=U,this._stats=$,this._opts=this._processOpts(X),this.ledgerMap=n2({name:"ipfs_bitswap_ledger_map",metrics:Y.metrics}),this._running=!1,this._requestQueue=new sC(sB)}_processOpts(N){return{maxSizeReplaceHasWithBlock:sM,targetMessageSize:sO,...N}}_scheduleProcessTasks(){setTimeout(()=>{this._processTasks().catch(N=>{this._log.error("error processing stats",N)})})}async _processTasks(){if(!this._running)return;let{peerId:N,tasks:O,pendingSize:U}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(0===O.length)return;let $=new sS(!1);$.setPendingBytes(U);let Y=[],X=new Map;for(let N of O){let O=iC.parse(N.topic);N.data.haveBlock?N.data.isWantBlock?(Y.push(O),X.set(N.topic,N.data)):$.addHave(O):$.addDontHave(O)}let J=await this._getBlocks(Y);for(let[N,O]of X){let U=iC.parse(N),Y=J.get(N);null!=Y?$.addBlock(U,Y):O.sendDontHave&&$.addDontHave(U)}if($.empty){null!=N&&this._requestQueue.tasksDone(N,O),this._scheduleProcessTasks();return}try{for(let[O,U]of(null!=N&&await this.network.sendMessage(N,$),J.entries()))null!=N&&this.messageSent(N,iC.parse(O),U)}catch(N){this._log.error(N)}null!=N&&this._requestQueue.tasksDone(N,O),this._scheduleProcessTasks()}wantlistForPeer(N){let O=N.toString(),U=this.ledgerMap.get(O);return null!=U?U.wantlist.sortedEntries():new Map}ledgerForPeer(N){let O=N.toString(),U=this.ledgerMap.get(O);if(null!=U)return{peer:U.partner,value:U.debtRatio(),sent:U.accounting.bytesSent,recv:U.accounting.bytesRecv,exchanged:U.exchangeCount}}peers(){return Array.from(this.ledgerMap.values()).map(N=>N.partner)}receivedBlocks(N){if(0!==N.length){for(let O of this.ledgerMap.values())for(let{cid:U,block:$}of N){let N=O.wantlistContains(U);if(null==N)continue;let Y=$.length,X=this._sendAsBlock(N.wantType,Y),J=Y;X||(J=sS.blockPresenceSize(N.cid)),this._requestQueue.pushTasks(O.partner,[{topic:N.cid.toString(rS),priority:N.priority,size:J,data:{blockSize:Y,isWantBlock:X,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(N,O){let U=this._findOrCreate(N);if(O.empty)return;if(O.full&&(U.wantlist=new sk),this._updateBlockAccounting(O.blocks,U),0===O.wantlist.size){this._scheduleProcessTasks();return}let $=[],Y=[];O.wantlist.forEach(N=>{N.cancel?(U.cancelWant(N.cid),$.push(N.cid)):(U.wants(N.cid,N.priority,N.wantType),Y.push(N))}),this._cancelWants(N,$),await this._addWants(N,Y),this._scheduleProcessTasks()}_cancelWants(N,O){for(let U of O)this._requestQueue.remove(U.toString(rS),N)}async _addWants(N,O){let U=await this._getBlockSizes(O.map(N=>N.cid)),$=[];for(let Y of O){let O=Y.cid.toString(rS),X=U.get(O);if(null==X)Y.sendDontHave&&$.push({topic:O,priority:Y.priority,size:sS.blockPresenceSize(Y.cid),data:{isWantBlock:Y.wantType===sL.Block,blockSize:0,haveBlock:!1,sendDontHave:Y.sendDontHave}});else{let N=this._sendAsBlock(Y.wantType,X),U=X;N||(U=sS.blockPresenceSize(Y.cid)),$.push({topic:O,priority:Y.priority,size:U,data:{isWantBlock:N,blockSize:X,haveBlock:!0,sendDontHave:Y.sendDontHave}})}this._requestQueue.pushTasks(N,$)}}_sendAsBlock(N,O){return N===sL.Block||O<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(N){let O=await this._getBlocks(N);return new Map([...O].map(([N,O])=>[N,O.length]))}async _getBlocks(N){let O=new Map;return await Promise.all(N.map(async N=>{try{let U=await this.blockstore.get(N);O.set(N.toString(rS),U)}catch(O){"ERR_NOT_FOUND"!==O.code&&this._log.error("failed to query blockstore for %s: %s",N,O)}})),O}_updateBlockAccounting(N,O){for(let U of N.values())this._log("got block (%s bytes)",U.length),O.receivedBytes(U.length)}messageSent(N,O,U){let $=this._findOrCreate(N);$.sentBytes(U.length),$.wantlist.remove(O)}numBytesSentTo(N){return this._findOrCreate(N).accounting.bytesSent}numBytesReceivedFrom(N){return this._findOrCreate(N).accounting.bytesRecv}peerDisconnected(N){this.ledgerMap.delete(N.toString())}_findOrCreate(N){let O=N.toString(),U=this.ledgerMap.get(O);if(null!=U)return U;let $=new sD(N);return this.ledgerMap.set(O,$),null!=this._stats&&this._stats.push(O,"peerCount",1),$}start(){this._running=!0}stop(){this._running=!1}}let sF=Symbol.for("@libp2p/topology");function sV(N){return null!=N&&!!N[sF]}let sz=()=>{};class s${min;max;peers;onConnect;onDisconnect;registrar;constructor(N){this.min=N.min??0,this.max=N.max??1/0,this.peers=new Set,this.onConnect=N.onConnect??sz,this.onDisconnect=N.onDisconnect??sz}get[Symbol.toStringTag](){return sF.toString()}[sF]=!0;async setRegistrar(N){this.registrar=N}disconnect(N){this.onDisconnect(N)}}function sK(N){return new s$(N)}class sq extends Error{constructor(N,O){super(N??"The operation was aborted"),this.type="aborted",this.code=O??"ABORT_ERR"}}function sj(N){if(null!=N){if("function"==typeof N[Symbol.iterator])return N[Symbol.iterator]();if("function"==typeof N[Symbol.asyncIterator])return N[Symbol.asyncIterator]();if("function"==typeof N.next)return N}throw Error("argument is not an iterator or iterable")}function sW(N,O,U){let $=U??{},Y=sj(N);return async function*(){let U;let X=()=>{null!=U&&U()};for(O.addEventListener("abort",X);;){let J;try{if(O.aborted){let{abortMessage:N,abortCode:O}=$;throw new sq(N,O)}let N=new Promise((N,O)=>{U=()=>{let{abortMessage:N,abortCode:U}=$;O(new sq(N,U))}});J=await Promise.race([N,Y.next()]),U=null}catch(J){O.removeEventListener("abort",X);let U="aborted"===J.type&&O.aborted;if(U&&null!=$.onAbort&&$.onAbort(N),"function"==typeof Y.return)try{let N=Y.return();N instanceof Promise&&N.catch(N=>{null!=$.onReturnError&&$.onReturnError(N)})}catch(N){null!=$.onReturnError&&$.onReturnError(N)}if(U&&!0===$.returnOnAbort)return;throw J}if(!0===J.done)break;yield J.value}O.removeEventListener("abort",X)}()}function sH(N,O,U){return $=>N(sW($,O,U))}function sG(N,O,U){return{sink:sH(N.sink,O,{...U,onAbort:void 0}),source:sW(N.source,O,U)}}function sQ(N,O){null==O&&(O=N.reduce((N,O)=>N+O.length,0));let U=nE(O),$=0;for(let O of N)U.set(O,$),$+=O.length;return iH(U)}let sY=Symbol.for("@achingbrain/uint8arraylist");function sX(N,O){if(null==O||O<0)throw RangeError("index is out of bounds");let U=0;for(let $ of N){let N=U+$.byteLength;if(O<N)return{buf:$,index:O-U};U=N}throw RangeError("index is out of bounds")}function sJ(N){return!!N?.[sY]}class sZ{constructor(...N){Object.defineProperty(this,sY,{value:!0}),this.bufs=[],this.length=0,N.length>0&&this.appendAll(N)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...N){this.appendAll(N)}appendAll(N){let O=0;for(let U of N)if(U instanceof Uint8Array)O+=U.byteLength,this.bufs.push(U);else if(sJ(U))O+=U.byteLength,this.bufs.push(...U.bufs);else throw Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=O}prepend(...N){this.prependAll(N)}prependAll(N){let O=0;for(let U of N.reverse())if(U instanceof Uint8Array)O+=U.byteLength,this.bufs.unshift(U);else if(sJ(U))O+=U.byteLength,this.bufs.unshift(...U.bufs);else throw Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=O}get(N){let O=sX(this.bufs,N);return O.buf[O.index]}set(N,O){let U=sX(this.bufs,N);U.buf[U.index]=O}write(N,O=0){if(N instanceof Uint8Array)for(let U=0;U<N.length;U++)this.set(O+U,N[U]);else if(sJ(N))for(let U=0;U<N.length;U++)this.set(O+U,N.get(U));else throw Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(N){if(!Number.isNaN(N=Math.trunc(N))&&!(N<=0)){if(N===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(N>=this.bufs[0].byteLength)N-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(N),this.length-=N;break}}}slice(N,O){let{bufs:U,length:$}=this._subList(N,O);return sQ(U,$)}subarray(N,O){let{bufs:U,length:$}=this._subList(N,O);return 1===U.length?U[0]:sQ(U,$)}sublist(N,O){let{bufs:U,length:$}=this._subList(N,O),Y=new sZ;return Y.length=$,Y.bufs=U,Y}_subList(N,O){if(N=N??0,O=O??this.length,N<0&&(N=this.length+N),O<0&&(O=this.length+O),N<0||O>this.length)throw RangeError("index is out of bounds");if(N===O)return{bufs:[],length:0};if(0===N&&O===this.length)return{bufs:[...this.bufs],length:this.length};let U=[],$=0;for(let Y=0;Y<this.bufs.length;Y++){let X=this.bufs[Y],J=$,Z=J+X.byteLength;if($=Z,N>=Z)continue;let en=N>=J&&N<Z,es=O>J&&O<=Z;if(en&&es){if(N===J&&O===Z){U.push(X);break}let $=N-J;U.push(X.subarray($,$+(O-N)));break}if(en){if(0===N){U.push(X);continue}U.push(X.subarray(N-J));continue}if(es){if(O===Z){U.push(X);break}U.push(X.subarray(0,O-J));break}U.push(X)}return{bufs:U,length:O-N}}indexOf(N,O=0){let U;if(!sJ(N)&&!(N instanceof Uint8Array))throw TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let $=N instanceof Uint8Array?N:N.subarray();if(isNaN(O=Number(O??0))&&(O=0),O<0&&(O=this.length+O),O<0&&(O=0),0===N.length)return O>this.length?this.length:O;let Y=$.byteLength;if(0===Y)throw TypeError("search must be at least 1 byte long");let X=256,J=new Int32Array(X);for(let N=0;N<X;N++)J[N]=-1;for(let N=0;N<Y;N++)J[$[N]]=N;let Z=J,en=this.byteLength-$.byteLength,es=$.byteLength-1;for(let N=O;N<=en;N+=U){U=0;for(let O=es;O>=0;O--){let Y=this.get(N+O);if($[O]!==Y){U=Math.max(1,O-Z[Y]);break}}if(0===U)return N}return -1}getInt8(N){let O=this.subarray(N,N+1),U=new DataView(O.buffer,O.byteOffset,O.byteLength);return U.getInt8(0)}setInt8(N,O){let U=nE(1),$=new DataView(U.buffer,U.byteOffset,U.byteLength);$.setInt8(0,O),this.write(U,N)}getInt16(N,O){let U=this.subarray(N,N+2),$=new DataView(U.buffer,U.byteOffset,U.byteLength);return $.getInt16(0,O)}setInt16(N,O,U){let $=nv(2),Y=new DataView($.buffer,$.byteOffset,$.byteLength);Y.setInt16(0,O,U),this.write($,N)}getInt32(N,O){let U=this.subarray(N,N+4),$=new DataView(U.buffer,U.byteOffset,U.byteLength);return $.getInt32(0,O)}setInt32(N,O,U){let $=nv(4),Y=new DataView($.buffer,$.byteOffset,$.byteLength);Y.setInt32(0,O,U),this.write($,N)}getBigInt64(N,O){let U=this.subarray(N,N+8),$=new DataView(U.buffer,U.byteOffset,U.byteLength);return $.getBigInt64(0,O)}setBigInt64(N,O,U){let $=nv(8),Y=new DataView($.buffer,$.byteOffset,$.byteLength);Y.setBigInt64(0,O,U),this.write($,N)}getUint8(N){let O=this.subarray(N,N+1),U=new DataView(O.buffer,O.byteOffset,O.byteLength);return U.getUint8(0)}setUint8(N,O){let U=nE(1),$=new DataView(U.buffer,U.byteOffset,U.byteLength);$.setUint8(0,O),this.write(U,N)}getUint16(N,O){let U=this.subarray(N,N+2),$=new DataView(U.buffer,U.byteOffset,U.byteLength);return $.getUint16(0,O)}setUint16(N,O,U){let $=nv(2),Y=new DataView($.buffer,$.byteOffset,$.byteLength);Y.setUint16(0,O,U),this.write($,N)}getUint32(N,O){let U=this.subarray(N,N+4),$=new DataView(U.buffer,U.byteOffset,U.byteLength);return $.getUint32(0,O)}setUint32(N,O,U){let $=nv(4),Y=new DataView($.buffer,$.byteOffset,$.byteLength);Y.setUint32(0,O,U),this.write($,N)}getBigUint64(N,O){let U=this.subarray(N,N+8),$=new DataView(U.buffer,U.byteOffset,U.byteLength);return $.getBigUint64(0,O)}setBigUint64(N,O,U){let $=nv(8),Y=new DataView($.buffer,$.byteOffset,$.byteLength);Y.setBigUint64(0,O,U),this.write($,N)}getFloat32(N,O){let U=this.subarray(N,N+4),$=new DataView(U.buffer,U.byteOffset,U.byteLength);return $.getFloat32(0,O)}setFloat32(N,O,U){let $=nv(4),Y=new DataView($.buffer,$.byteOffset,$.byteLength);Y.setFloat32(0,O,U),this.write($,N)}getFloat64(N,O){let U=this.subarray(N,N+8),$=new DataView(U.buffer,U.byteOffset,U.byteLength);return $.getFloat64(0,O)}setFloat64(N,O,U){let $=nv(8),Y=new DataView($.buffer,$.byteOffset,$.byteLength);Y.setFloat64(0,O,U),this.write($,N)}equals(N){if(null==N||!(N instanceof sZ)||N.bufs.length!==this.bufs.length)return!1;for(let O=0;O<this.bufs.length;O++)if(!n5(this.bufs[O],N.bufs[O]))return!1;return!0}static fromUint8Arrays(N,O){let U=new sZ;return U.bufs=N,null==O&&(O=N.reduce((N,O)=>N+O.byteLength,0)),U.length=O,U}}function s4(N){return N instanceof Uint8Array?{get:O=>N[O],set(O,U){N[O]=U}}:{get:O=>N.get(O),set(O,U){N.set(O,U)}}}let s5=4294967296;class s6{constructor(N=0,O=0){this.hi=N,this.lo=O}toBigInt(N){if(!0===N)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!=0){let N=~this.lo+1>>>0,O=~this.hi>>>0;return 0===N&&(O=O+1>>>0),-(BigInt(N)+(BigInt(O)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toNumber(N){return Number(this.toBigInt(N))}zzDecode(){let N=-(1&this.lo),O=((this.lo>>>1|this.hi<<31)^N)>>>0,U=(this.hi>>>1^N)>>>0;return new s6(U,O)}zzEncode(){let N=this.hi>>31,O=((this.hi<<1|this.lo>>>31)^N)>>>0,U=(this.lo<<1^N)>>>0;return new s6(O,U)}toBytes(N,O=0){let U=s4(N);for(;this.hi>0;)U.set(O++,127&this.lo|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;for(;this.lo>127;)U.set(O++,127&this.lo|128),this.lo=this.lo>>>7;U.set(O++,this.lo)}static fromBigInt(N){if(0n===N)return new s6;let O=N<0;O&&(N=-N);let U=0|Number(N>>32n),$=0|Number(N-(BigInt(U)<<32n));return O&&(U=~U>>>0,$=~$>>>0,++$>s5&&($=0,++U>s5&&(U=0))),new s6(U,$)}static fromNumber(N){if(0===N)return new s6;let O=N<0;O&&(N=-N);let U=N>>>0,$=(N-U)/4294967296>>>0;return O&&($=~$>>>0,U=~U>>>0,++U>4294967295&&(U=0,++$>4294967295&&($=0))),new s6($,U)}static fromBytes(N,O=0){let U=s4(N),$=new s6,Y=0;if(N.length-O>4){for(;Y<4;++Y)if($.lo=($.lo|(127&U.get(O))<<7*Y)>>>0,128>U.get(O++))return $;if($.lo=($.lo|(127&U.get(O))<<28)>>>0,$.hi=($.hi|(127&U.get(O))>>4)>>>0,128>U.get(O++))return $;Y=0}else for(;Y<4;++Y){if(O>=N.length)throw RangeError(`index out of range: ${O} > ${N.length}`);if($.lo=($.lo|(127&U.get(O))<<7*Y)>>>0,128>U.get(O++))return $}if(N.length-O>4){for(;Y<5;++Y)if($.hi=($.hi|(127&U.get(O))<<7*Y+3)>>>0,128>U.get(O++))return $}else if(O<N.byteLength)for(;Y<5;++Y){if(O>=N.length)throw RangeError(`index out of range: ${O} > ${N.length}`);if($.hi=($.hi|(127&U.get(O))<<7*Y+3)>>>0,128>U.get(O++))return $}throw RangeError("invalid varint encoding")}}let s8=128,s7=16384,s9=2097152,oe=268435456,ot=34359738368,oi=4398046511104,on=562949953421312,oo=72057594037927940,oa=0x7fffffffffffffff,ol={encodingLength:N=>N<s8?1:N<s7?2:N<s9?3:N<oe?4:N<ot?5:N<oi?6:N<on?7:N<oo?8:N<oa?9:10,encode(N,O,U=0){if(null!=Number.MAX_SAFE_INTEGER&&N>Number.MAX_SAFE_INTEGER)throw RangeError("Could not encode varint");return null==O&&(O=nE(ol.encodingLength(N))),s6.fromNumber(N).toBytes(O,U),O},decode:(N,O=0)=>s6.fromBytes(N,O).toNumber(!0)},oc={encodingLength:N=>N<0?10:ol.encodingLength(N),encode:(N,O,U)=>(null==O&&(O=nE(oc.encodingLength(N))),N<0)?(s6.fromNumber(N).toBytes(O,U),O):ol.encode(N,O,U),decode:(N,O=0)=>s6.fromBytes(N,O).toNumber(!1)};function ou(N){return null!=N[Symbol.asyncIterator]}let oh=N=>{let O=ol.encodingLength(N),U=nE(O);return ol.encode(N,U),oh.bytes=O,U};function od(N,O){O=O??{};let U=O.lengthEncoder??oh;function*$(N){let O=U(N.byteLength);O instanceof Uint8Array?yield O:yield*O,N instanceof Uint8Array?yield N:yield*N}return ou(N)?async function*(){for await(let O of N)yield*$(O)}():function*(){for(let O of N)yield*$(O)}()}oh.bytes=0,od.single=(N,O)=>{O=O??{};let U=O.lengthEncoder??oh;return new sZ(U(N.byteLength),N)};let of=8,og=4194304;!function(N){N[N.LENGTH=0]="LENGTH",N[N.DATA=1]="DATA"}(eo||(eo={}));let oy=N=>{let O=ol.decode(N);return oy.bytes=ol.encodingLength(O),O};function om(N,O){let U=new sZ,$=eo.LENGTH,Y=-1,X=O?.lengthDecoder??oy,J=O?.maxLengthLength??of,Z=O?.maxDataLength??og;function*en(){for(;U.byteLength>0;){if($===eo.LENGTH)try{if((Y=X(U))<0)throw rV(Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(Y>Z)throw rV(Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");let N=X.bytes;U.consume(N),O?.onLength!=null&&O.onLength(Y),$=eo.DATA}catch(N){if(N instanceof RangeError){if(U.byteLength>J)throw rV(Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw N}if($===eo.DATA){if(U.byteLength<Y)break;let N=U.sublist(0,Y);U.consume(Y),O?.onData!=null&&O.onData(N),yield N,$=eo.LENGTH}}}return ou(N)?async function*(){for await(let O of N)U.append(O),yield*en();if(U.byteLength>0)throw rV(Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}():function*(){for(let O of N)U.append(O),yield*en();if(U.byteLength>0)throw rV(Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}()}function ob(N){return null!=N[Symbol.asyncIterator]}oy.bytes=0,om.fromReader=(N,O)=>{let U=1,$=async function*(){for(;;)try{let{done:O,value:$}=await N.next(U);if(!0===O)return;null!=$&&(yield $)}catch(N){if("ERR_UNDER_READ"===N.code)return{done:!0,value:null};throw N}finally{U=1}}(),Y=N=>{U=N};return om($,{...O??{},onLength:Y})};var ow=function(N,O){if(ob(N))return async function*(){for await(let U of N)yield O(U)}();let U=nF(N),{value:$,done:Y}=U.next();if(!0===Y)return function*(){}();let X=O($);if("function"==typeof X.then)return async function*(){for await(let N of(yield await X,U))yield O(N)}();let J=O;return function*(){for(let N of(yield X,U))yield J(N)}()};class ov{constructor(N){if(!(N>0)||(N-1&N)!=0)throw Error("Max size for a FixedFIFO should be a power of two");this.buffer=Array(N),this.mask=N-1,this.top=0,this.btm=0,this.next=null}push(N){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=N,this.top=this.top+1&this.mask,!0)}shift(){let N=this.buffer[this.btm];if(void 0!==N)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,N}isEmpty(){return void 0===this.buffer[this.btm]}}class oE{constructor(N={}){this.hwm=N.splitLimit??16,this.head=new ov(this.hwm),this.tail=this.head,this.size=0}calculateSize(N){return N?.byteLength!=null?N.byteLength:1}push(N){if(N?.value!=null&&(this.size+=this.calculateSize(N.value)),!this.head.push(N)){let O=this.head;this.head=O.next=new ov(2*this.head.buffer.length),this.head.push(N)}}shift(){let N=this.tail.shift();if(void 0===N&&null!=this.tail.next){let O=this.tail.next;this.tail.next=null,this.tail=O,N=this.tail.shift()}return N?.value!=null&&(this.size-=this.calculateSize(N.value)),N}isEmpty(){return this.head.isEmpty()}}function o_(N={}){let O=N=>{let O=N.shift();if(null==O)return{done:!0};if(null!=O.error)throw O.error;return{done:!0===O.done,value:O.value}};return oI(O,N)}function oS(N={}){let O=N=>{let O;let U=[];for(;!N.isEmpty()&&null!=(O=N.shift());){if(null!=O.error)throw O.error;!1===O.done&&U.push(O.value)}return null==O?{done:!0}:{done:!0===O.done,value:U}};return oI(O,N)}function oI(N,O){let U,$,Y;let X=(O=O??{}).onEnd,J=new oE,Z=async()=>J.isEmpty()?Y?{done:!0}:await new Promise((O,Y)=>{$=X=>{$=null,J.push(X);try{O(N(J))}catch(N){Y(N)}return U}}):N(J),en=N=>null!=$?$(N):(J.push(N),U),es=N=>(J=new oE,null!=$)?$({error:N}):(J.push({error:N}),U),eo=N=>{if(Y)return U;if(O?.objectMode!==!0&&N?.byteLength==null)throw Error("objectMode was not true but tried to push non-Uint8Array value");return en({done:!1,value:N})},ea=N=>Y?U:(Y=!0,null!=N?es(N):en({done:!0})),ec=()=>(J=new oE,ea(),{done:!0}),eu=N=>(ea(N),{done:!0});if(U={[Symbol.asyncIterator](){return this},next:Z,return:ec,throw:eu,push:eo,end:ea,get readableLength(){return J.size}},null==X)return U;let eh=U;return U={[Symbol.asyncIterator](){return this},next:()=>eh.next(),throw:N=>(eh.throw(N),null!=X&&(X(N),X=void 0),{done:!0}),return:()=>(eh.return(),null!=X&&(X(),X=void 0),{done:!0}),push:eo,end:N=>(eh.end(N),null!=X&&(X(N),X=void 0),U),get readableLength(){return eh.readableLength}}}function oR(N){return null!=N[Symbol.asyncIterator]}var ok=function(...N){let O=[];for(let U of N)oR(U)||O.push(U);return O.length===N.length?function*(){for(let N of O)yield*N}():async function*(){let O=o_({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(N.map(async N=>{for await(let U of N)O.push(U)})),O.end()}catch(N){O.end(N)}}),yield*O}()};function oD(N,...O){if(null==N)throw Error("Empty pipeline");if(oP(N)){let O=N;N=()=>O.source}else if(oC(N)||oT(N)){let O=N;N=()=>O}let U=[N,...O];if(U.length>1&&oP(U[U.length-1])&&(U[U.length-1]=U[U.length-1].sink),U.length>2)for(let N=1;N<U.length-1;N++)oP(U[N])&&(U[N]=ox(U[N]));return oA(...U)}let oA=(...N)=>{let O;for(;N.length>0;)O=N.shift()(O);return O},oT=N=>N?.[Symbol.asyncIterator]!=null,oC=N=>N?.[Symbol.iterator]!=null,oP=N=>null!=N&&null!=N.sink&&null!=N.source,ox=N=>O=>{let U=N.sink(O);if(U?.then!=null){let O;let $=o_({objectMode:!0});U.then(()=>{$.end()},N=>{$.end(N)});let Y=N.source;if(oT(Y))O=async function*(){yield*Y,$.end()};else if(oC(Y))O=function*(){yield*Y,$.end()};else throw Error("Unknown duplex source type - must be Iterable or AsyncIterable");return ok($,O())}return N.source};class oN extends Event{constructor(N,O){super(N),this.detail=O}}var oB=U(715);let oL=3,oO=2147483647,oM=1e3,oU=1,oF="/ipfs/bitswap/1.0.0",oV="/ipfs/bitswap/1.1.0",oz="/ipfs/bitswap/1.2.0",o$=1024,oK=1024,oq=3e4;class oj{_log;_libp2p;_bitswap;_protocols;_stats;_running;_hashLoader;_maxInboundStreams;_maxOutboundStreams;_incomingStreamTimeout;_registrarIds;constructor(N,O,U,$={}){this._log=n7(N.peerId,"network"),this._libp2p=N,this._bitswap=O,this._protocols=[oF],!0!==$.b100Only&&(this._protocols.unshift(oV),this._protocols.unshift(oz)),this._stats=U,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashLoader=$.hashLoader??{async getHasher(){throw Error("Not implemented")}},this._maxInboundStreams=$.maxInboundStreams??o$,this._maxOutboundStreams=$.maxOutboundStreams??oK,this._incomingStreamTimeout=$.incomingStreamTimeout??oq}async start(){this._running=!0,await this._libp2p.handle(this._protocols,this._onConnection,{maxInboundStreams:this._maxInboundStreams,maxOutboundStreams:this._maxOutboundStreams});let N=sK({onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect});for(let O of(this._registrarIds=[],this._protocols))this._registrarIds.push(await this._libp2p.register(O,N));this._libp2p.getConnections().forEach(N=>{this._onPeerConnect(N.remotePeer)})}async stop(){if(this._running=!1,await this._libp2p.unhandle(this._protocols),null!=this._registrarIds){for(let N of this._registrarIds)this._libp2p.unregister(N);this._registrarIds=[]}}_onConnection(N){if(!this._running)return;let{stream:O,connection:U}=N,$=new oB.TimeoutController(this._incomingStreamTimeout);Promise.resolve().then(async()=>{this._log("incoming new bitswap %s connection from %p",O.stat.protocol,U.remotePeer),await oD(sW(O.source,$.signal),N=>om(N),async N=>{for await(let O of N){try{let N=await sS.deserialize(O.subarray(),this._hashLoader);await this._bitswap._receiveMessage(U.remotePeer,N)}catch(N){this._bitswap._receiveError(N);break}$.reset()}})}).catch(N=>{this._log(N),O.abort(N)}).finally(()=>{$.clear(),O.close()})}_onPeerConnect(N){this._bitswap._onPeerConnected(N)}_onPeerDisconnect(N){this._bitswap._onPeerDisconnected(N)}findProviders(N,O={}){return O.onProgress?.(new oN("bitswap:network:find-providers",N)),this._libp2p.contentRouting.findProviders(N,O)}async findAndConnect(N,O){await nU(nH(ow(this.findProviders(N,O),async N=>this.connectTo(N.id,O).catch(N=>{this._log.error(N)})),oL)).catch(N=>{this._log.error(N)})}async provide(N,O={}){O.onProgress?.(new oN("bitswap:network:provide",N)),await this._libp2p.contentRouting.provide(N,O)}async sendMessage(N,O,U={}){if(!this._running)throw Error("network isn't running");let $=N.toString();this._log("sendMessage to %s",$,O),U.onProgress?.(new oN("bitswap:network:send-wantlist",N)),await this._writeMessage(N,O,U),this._updateSentStats(N,O.blocks)}async connectTo(N,O={}){if(!this._running)throw Error("network isn't running");return O.onProgress?.(new oN("bitswap:network:dial",N)),this._libp2p.dial(N,O)}_updateSentStats(N,O){let U=N.toString();if(null!=this._stats){for(let N of O.values())this._stats.push(U,"dataSent",N.length);this._stats.push(U,"blocksSent",O.size)}}async _writeMessage(N,O,U={}){let $=await this._libp2p.dialProtocol(N,[oz,oV,oF]);try{let N;switch($.stat.protocol){case oF:N=O.serializeToBitswap100();break;case oV:case oz:N=O.serializeToBitswap110();break;default:throw Error(`Unknown protocol: ${$.stat.protocol}`)}await oD([N],N=>od(N),$)}catch(O){U.onProgress?.(new oN("bitswap:network:send-wantlist:error",{peer:N,error:O})),this._log(O)}finally{$.close()}}}var oW=U(7187);let oH=N=>`unwant:${nA(N.multihash.bytes,"base64")}`,oG=N=>`block:${nA(N.multihash.bytes,"base64")}`;class oQ extends oW.EventEmitter{_log;constructor(N){super(),this.setMaxListeners(oM),this._log=n7(N,"notif")}hasBlock(N,O){let U=oG(N);this._log(U),this.emit(U,O)}async wantBlock(N,O={}){if(null==N)throw Error("Not a valid cid");let U=oG(N),$=oH(N);return this._log(`wantBlock:${N}`),new Promise((Y,X)=>{let J=()=>{this.removeListener(U,Z),O.onProgress?.(new oN("bitswap:want-block:unwant",N)),X(Error(`Block for ${N} unwanted`))},Z=U=>{this.removeListener($,J),O.onProgress?.(new oN("bitswap:want-block:block",N)),Y(U)};this.once($,J),this.once(U,Z),O.signal?.addEventListener("abort",()=>{this.removeListener(U,Z),this.removeListener($,J),X(Error(`Want for ${N} aborted`))})})}unwantBlock(N){let O=oH(N);this._log(O),this.emit(O)}}var oY=U(3573);class oX extends oW.EventEmitter{_options;_queue;_stats;_frequencyLastTime;_frequencyAccumulators;_movingAverages;_enabled;_timeout;constructor(N,O){super(),this._options=O,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),N.forEach(N=>{this._stats[N]=BigInt(0),this._movingAverages[N]={},this._options.movingAverageIntervals.forEach(O=>{let U=this._movingAverages[N][O]=oY(O);U.push(this._frequencyLastTime,0)})}),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._enabled=!1}stop(){null!=this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(N,O){this._enabled&&(this._queue.push([N,O,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){null!=this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){let N=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-N),0)}_update(){if(this._timeout=void 0,this._queue.length>0){let N;for(;this._queue.length>0;){let O=N=this._queue.shift();null!=O&&this._applyOp(O)}null!=N&&this._updateFrequency(N[2]),this.emit("update",this._stats)}}_updateFrequency(N){let O=N-this._frequencyLastTime;O>0&&Object.keys(this._stats).forEach(U=>{this._updateFrequencyFor(U,O,N)}),this._frequencyLastTime=N}_updateFrequencyFor(N,O,U){let $=this._frequencyAccumulators[N]??0;this._frequencyAccumulators[N]=0;let Y=$/O*1e3,X=this._movingAverages[N];null==X&&(X=this._movingAverages[N]={}),this._options.movingAverageIntervals.forEach(N=>{let O=X[N];null==O&&(O=X[N]=oY(N)),O.push(U,Y)})}_applyOp(N){let O=N[0],U=N[1];if("number"!=typeof U)throw Error(`invalid increment number: ${U}`);Object.prototype.hasOwnProperty.call(this._stats,O)||(this._stats[O]=BigInt(0)),this._stats[O]=BigInt(this._stats[O])+BigInt(U),null==this._frequencyAccumulators[O]&&(this._frequencyAccumulators[O]=0),this._frequencyAccumulators[O]+=U}}let oJ={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[6e4,3e5,9e5]};class oZ extends oW.EventEmitter{_initialCounters;_options;_enabled;_global;_peers;constructor(N,O=[],U=oJ){super();let $=Object.assign({},oJ,U);if("number"!=typeof $.computeThrottleTimeout)throw Error("need computeThrottleTimeout");if("number"!=typeof $.computeThrottleMaxQueueSize)throw Error("need computeThrottleMaxQueueSize");this._initialCounters=O,this._options=$,this._enabled=this._options.enabled,this._global=new oX(O,$),this._global.on("update",N=>this.emit("update",N)),this._peers=n2({name:"ipfs_bitswap_stats_peers",metrics:N.metrics})}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){for(let N of(this._enabled=!1,this._global.stop(),this._peers))N[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(N){let O=N.toString();return this._peers.get(O)}push(N,O,U){if(this._enabled&&(this._global.push(O,U),null!=N)){let $=this._peers.get(N);null==$&&($=new oX(this._initialCounters,this._options),this._peers.set(N,$)),$.push(O,U)}}disconnected(N){let O=N.toString(),U=this._peers.get(O);null!=U&&(U.stop(),this._peers.delete(O))}}var o1=o2;function o2(N,O,U){var $=null,Y=null,X=function(){$&&(clearTimeout($),Y=null,$=null)},J=function(){var N=Y;X(),N&&N()},Z=function(){if(!O)return N.apply(this,arguments);var J=this,Z=arguments,en=U&&!$;if(X(),Y=function(){N.apply(J,Z)},$=setTimeout(function(){if($=null,!en){var N=Y;return Y=null,N()}},O),en)return Y()};return Z.cancel=X,Z.flush=J,Z}class o0{peerId;refcnt;network;_entries;_log;constructor(N,O,U){this.peerId=O,this.network=U,this.refcnt=1,this._entries=[],this._log=n7(N,"msgqueue"),this.sendEntries=o1(this.sendEntries.bind(this),oU)}addMessage(N,O={}){N.empty||this.send(N,O)}addEntries(N,O={}){this._entries=this._entries.concat(N),this.sendEntries(O)}sendEntries(N={}){if(0===this._entries.length)return;let O=new sS(!1);this._entries.forEach(N=>{!0===N.cancel?O.cancel(N.cid):O.addEntry(N.cid,N.priority)}),this._entries=[],this.addMessage(O,N)}async send(N,O={}){try{await this.network.connectTo(this.peerId,O)}catch(N){this._log.error("cant connect to peer %p: %s",this.peerId,N.message);return}this._log("sending message to peer %p",this.peerId),this.network.sendMessage(this.peerId,N,O).catch(N=>{this._log.error("send error",N)})}}class o3{peers;wantlist;network;_peerId;_log;constructor(N,O,U,$){this.peers=n2({name:"ipfs_bitswap_want_manager_peers",metrics:$.metrics}),this.wantlist=new sk(U,$),this.network=O,this._peerId=N,this._log=n7(N,"want")}_addEntries(N,O,U,$={}){let Y=N.map((N,U)=>new sS.Entry(N,oO-U,sS.WantType.Block,O));for(let N of(Y.forEach(N=>{N.cancel?!0===U?this.wantlist.removeForce(N.cid.toString(rS)):this.wantlist.remove(N.cid):(this._log("adding to wantlist"),this.wantlist.add(N.cid,N.priority))}),this.peers.values()))N.addEntries(Y,$)}_startPeerHandler(N){let O=this.peers.get(N.toString());if(null!=O){O.refcnt++;return}O=new o0(this._peerId,N,this.network);let U=new sS(!0);for(let N of this.wantlist.entries())U.addEntry(N[1].cid,N[1].priority);return O.addMessage(U),this.peers.set(N.toString(),O),O}_stopPeerHandler(N){let O=this.peers.get(N.toString());null!=O&&(O.refcnt--,O.refcnt>0||this.peers.delete(N.toString()))}wantBlocks(N,O={}){this._addEntries(N,!1,!1,O),O.signal?.addEventListener("abort",()=>{this.cancelWants(N)})}unwantBlocks(N){this._log("unwant blocks: %s",N.length),this._addEntries(N,!0,!0)}cancelWants(N){this._log("cancel wants: %s",N.length),this._addEntries(N,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(N){this._startPeerHandler(N)}disconnected(N){this._stopPeerHandler(N)}start(){}stop(){this.peers.forEach(N=>{this.disconnected(N.peerId)})}}let o4={async getHasher(){throw Error("Not implemented")}},o5={maxInboundStreams:1024,maxOutboundStreams:1024,incomingStreamTimeout:3e4,hashLoader:o4,statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},o6=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"];class o8{_libp2p;_log;stats;network;blockstore;engine;wm;notifications;started;constructor(N,O,U={}){this._libp2p=N,this._log=n7(this.peerId),U=Object.assign({},o5,U),this.stats=new oZ(N,o6,{enabled:U.statsEnabled,computeThrottleTimeout:U.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:U.statsComputeThrottleMaxQueueSize}),this.network=new oj(N,this,this.stats,{hashLoader:U.hashLoader,maxInboundStreams:U.maxInboundStreams,maxOutboundStreams:U.maxOutboundStreams,incomingStreamTimeout:U.incomingStreamTimeout}),this.blockstore=O,this.engine=new sU(this.peerId,O,this.network,this.stats,N),this.wm=new o3(this.peerId,this.network,this.stats,N),this.notifications=new oQ(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(N,O){try{await this.engine.messageReceived(N,O)}catch(N){this._log("failed to receive message",O)}if(0===O.blocks.size)return;let U=[];for(let[N,$]of O.blocks.entries()){let O=iC.parse(N);U.push({wasWanted:this.wm.wantlist.contains(O),cid:O,data:$})}this.wm.cancelWants(U.filter(({wasWanted:N})=>N).map(({cid:N})=>N)),await Promise.all(U.map(async({cid:O,wasWanted:U,data:$})=>{await this._handleReceivedBlock(N,O,$,U)}))}async _handleReceivedBlock(N,O,U,$){this._log("received block");let Y=await this.blockstore.has(O);this._updateReceiveCounters(N.toString(),O,U,Y),$&&await this.put(O,U)}_updateReceiveCounters(N,O,U,$){this.stats.push(N,"blocksReceived",1),this.stats.push(N,"dataReceived",U.length),$&&(this.stats.push(N,"dupBlksReceived",1),this.stats.push(N,"dupDataReceived",U.length))}_receiveError(N){this._log.error("ReceiveError",N)}_onPeerConnected(N){this.wm.connected(N)}_onPeerDisconnected(N){this.wm.disconnected(N),this.engine.peerDisconnected(N),this.stats.disconnected(N)}enableStats(){this.stats.enable()}disableStats(){this.stats.disable()}wantlistForPeer(N,O){return this.engine.wantlistForPeer(N)}ledgerForPeer(N){return this.engine.ledgerForPeer(N)}async want(N,O={}){let U=async(N,O)=>(this.wm.wantBlocks([N],O),this.notifications.wantBlock(N,O)),$=!1,Y=async(N,O)=>{try{let U=await this.blockstore.get(N,O);return U}catch(Y){if("ERR_NOT_FOUND"!==Y.code)throw Y;return $||($=!0,this.network.findAndConnect(N,O).catch(N=>{this._log.error(N)})),await U(N,O)}},X=new AbortController,J=nY([X.signal,O.signal]);try{let U=await Promise.race([this.notifications.wantBlock(N,{...O,signal:J}),Y(N,{...O,signal:J})]);return U}finally{X.abort(),J.clear()}}unwant(N){let O=Array.isArray(N)?N:[N];this.wm.unwantBlocks(O),O.forEach(N=>{this.notifications.unwantBlock(N)})}cancelWants(N){this.wm.cancelWants(Array.isArray(N)?N:[N])}async put(N,O,U){await this.blockstore.put(N,O),this.notify(N,O)}async *putMany(N,O){yield*this.blockstore.putMany(nJ(N,({cid:N,block:O})=>{this.notify(N,O)}),O)}notify(N,O,U={}){this.notifications.hasBlock(N,O),this.engine.receivedBlocks([{cid:N,block:O}]),this.network.provide(N,U).catch(N=>{this._log.error("Failed to provide: %s",N.message)})}getWantlist(){return this.wm.wantlist.entries()}get peers(){return this.engine.peers()}async start(){this.wm.start(),await this.network.start(),this.engine.start(),this.started=!0}async stop(){this.stats.stop(),this.wm.stop(),await this.network.stop(),this.engine.stop(),this.started=!1}}let o7=(N,O,U={})=>new o8(N,O,U),o9=["string","number","bigint","symbol"],ae=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function at(N){if(null===N)return"null";if(void 0===N)return"undefined";if(!0===N||!1===N)return"boolean";let O=typeof N;if(o9.includes(O))return O;if("function"===O)return"Function";if(Array.isArray(N))return"Array";if(ai(N))return"Buffer";let U=an(N);return U||"Object"}function ai(N){return N&&N.constructor&&N.constructor.isBuffer&&N.constructor.isBuffer.call(null,N)}function an(N){let O=Object.prototype.toString.call(N).slice(8,-1);if(ae.includes(O))return O}class as{constructor(N,O,U){this.major=N,this.majorEncoded=N<<5,this.name=O,this.terminal=U}toString(){return`Type[${this.major}].${this.name}`}compare(N){return this.major<N.major?-1:this.major>N.major?1:0}}as.uint=new as(0,"uint",!0),as.negint=new as(1,"negint",!0),as.bytes=new as(2,"bytes",!0),as.string=new as(3,"string",!0),as.array=new as(4,"array",!1),as.map=new as(5,"map",!1),as.tag=new as(6,"tag",!1),as.float=new as(7,"float",!0),as.false=new as(7,"false",!0),as.true=new as(7,"true",!0),as.null=new as(7,"null",!0),as.undefined=new as(7,"undefined",!0),as.break=new as(7,"break",!0);class ao{constructor(N,O,U){this.type=N,this.value=O,this.encodedLength=U,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}let au=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,ap=new TextDecoder,af=new TextEncoder;function ag(N){return au&&globalThis.Buffer.isBuffer(N)}function am(N){return N instanceof Uint8Array?ag(N)?new Uint8Array(N.buffer,N.byteOffset,N.byteLength):N:Uint8Array.from(N)}let ab=au?(N,O,U)=>U-O>64?globalThis.Buffer.from(N.subarray(O,U)).toString("utf8"):ak(N,O,U):(N,O,U)=>U-O>64?ap.decode(N.subarray(O,U)):ak(N,O,U),aw=au?N=>N.length>64?globalThis.Buffer.from(N):aR(N):N=>N.length>64?af.encode(N):aR(N),av=N=>Uint8Array.from(N),aE=au?(N,O,U)=>ag(N)?new Uint8Array(N.subarray(O,U)):N.slice(O,U):(N,O,U)=>N.slice(O,U),a_=au?(N,O)=>(N=N.map(N=>N instanceof Uint8Array?N:globalThis.Buffer.from(N)),am(globalThis.Buffer.concat(N,O))):(N,O)=>{let U=new Uint8Array(O),$=0;for(let O of N)$+O.length>U.length&&(O=O.subarray(0,U.length-$)),U.set(O,$),$+=O.length;return U},aS=au?N=>globalThis.Buffer.allocUnsafe(N):N=>new Uint8Array(N);function aI(N,O){if(ag(N)&&ag(O))return N.compare(O);for(let U=0;U<N.length;U++)if(N[U]!==O[U])return N[U]<O[U]?-1:1;return 0}function aR(N,O=1/0){let U;let $=N.length,Y=null,X=[];for(let J=0;J<$;++J){if((U=N.charCodeAt(J))>55295&&U<57344){if(!Y){if(U>56319||J+1===$){(O-=3)>-1&&X.push(239,191,189);continue}Y=U;continue}if(U<56320){(O-=3)>-1&&X.push(239,191,189),Y=U;continue}U=(Y-55296<<10|U-56320)+65536}else Y&&(O-=3)>-1&&X.push(239,191,189);if(Y=null,U<128){if((O-=1)<0)break;X.push(U)}else if(U<2048){if((O-=2)<0)break;X.push(U>>6|192,63&U|128)}else if(U<65536){if((O-=3)<0)break;X.push(U>>12|224,U>>6&63|128,63&U|128)}else if(U<1114112){if((O-=4)<0)break;X.push(U>>18|240,U>>12&63|128,U>>6&63|128,63&U|128)}else throw Error("Invalid code point")}return X}function ak(N,O,U){let $=[];for(;O<U;){let Y=N[O],X=null,J=Y>239?4:Y>223?3:Y>191?2:1;if(O+J<=U){let U,$,Z,en;switch(J){case 1:Y<128&&(X=Y);break;case 2:(192&(U=N[O+1]))==128&&(en=(31&Y)<<6|63&U)>127&&(X=en);break;case 3:U=N[O+1],$=N[O+2],(192&U)==128&&(192&$)==128&&(en=(15&Y)<<12|(63&U)<<6|63&$)>2047&&(en<55296||en>57343)&&(X=en);break;case 4:U=N[O+1],$=N[O+2],Z=N[O+3],(192&U)==128&&(192&$)==128&&(192&Z)==128&&(en=(15&Y)<<18|(63&U)<<12|(63&$)<<6|63&Z)>65535&&en<1114112&&(X=en)}}null===X?(X=65533,J=1):X>65535&&(X-=65536,$.push(X>>>10&1023|55296),X=56320|1023&X),$.push(X),O+=J}return aA($)}let aD=4096;function aA(N){let O=N.length;if(O<=aD)return String.fromCharCode.apply(String,N);let U="",$=0;for(;$<O;)U+=String.fromCharCode.apply(String,N.slice($,$+=aD));return U}let aT=256;class aC{constructor(N=aT){this.chunkSize=N,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(N){let O=this.chunks[this.chunks.length-1],U=this.cursor+N.length;if(U<=this.maxCursor+1){let U=O.length-(this.maxCursor-this.cursor)-1;O.set(N,U)}else{if(O){let N=O.length-(this.maxCursor-this.cursor)-1;N<O.length&&(this.chunks[this.chunks.length-1]=O.subarray(0,N),this.maxCursor=this.cursor-1)}N.length<64&&N.length<this.chunkSize?(O=aS(this.chunkSize),this.chunks.push(O),this.maxCursor+=O.length,null===this._initReuseChunk&&(this._initReuseChunk=O),O.set(N,0)):(this.chunks.push(N),this.maxCursor+=N.length)}this.cursor+=N.length}toBytes(N=!1){let O;if(1===this.chunks.length){let U=this.chunks[0];N&&this.cursor>U.length/2?(O=this.cursor===U.length?U:U.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):O=aE(U,0,this.cursor)}else O=a_(this.chunks,this.cursor);return N&&this.reset(),O}}let aN="CBOR decode error:",aB="CBOR encode error:",aL=[];function aO(N,O,U){if(N.length-O<U)throw Error(`${aN} not enough data for type`)}aL[23]=1,aL[24]=2,aL[25]=3,aL[26]=5,aL[27]=9;let aM=[24,256,65536,4294967296,BigInt("18446744073709551616")];function aU(N,O,U){aO(N,O,1);let $=N[O];if(!0===U.strict&&$<aM[0])throw Error(`${aN} integer encoded in more bytes than necessary (strict decode)`);return $}function aF(N,O,U){aO(N,O,2);let $=N[O]<<8|N[O+1];if(!0===U.strict&&$<aM[1])throw Error(`${aN} integer encoded in more bytes than necessary (strict decode)`);return $}function aV(N,O,U){aO(N,O,4);let $=16777216*N[O]+(N[O+1]<<16)+(N[O+2]<<8)+N[O+3];if(!0===U.strict&&$<aM[2])throw Error(`${aN} integer encoded in more bytes than necessary (strict decode)`);return $}function az(N,O,U){aO(N,O,8);let $=16777216*N[O]+(N[O+1]<<16)+(N[O+2]<<8)+N[O+3],Y=16777216*N[O+4]+(N[O+5]<<16)+(N[O+6]<<8)+N[O+7],X=(BigInt($)<<BigInt(32))+BigInt(Y);if(!0===U.strict&&X<aM[3])throw Error(`${aN} integer encoded in more bytes than necessary (strict decode)`);if(X<=Number.MAX_SAFE_INTEGER)return Number(X);if(!0===U.allowBigInt)return X;throw Error(`${aN} integers outside of the safe integer range are not supported`)}function a$(N,O,U,$){return new ao(as.uint,aU(N,O+1,$),2)}function aK(N,O,U,$){return new ao(as.uint,aF(N,O+1,$),3)}function aq(N,O,U,$){return new ao(as.uint,aV(N,O+1,$),5)}function aj(N,O,U,$){return new ao(as.uint,az(N,O+1,$),9)}function aW(N,O){return aH(N,0,O.value)}function aH(N,O,U){if(U<aM[0]){let $=Number(U);N.push([O|$])}else if(U<aM[1]){let $=Number(U);N.push([24|O,$])}else if(U<aM[2]){let $=Number(U);N.push([25|O,$>>>8,255&$])}else if(U<aM[3]){let $=Number(U);N.push([26|O,$>>>24&255,$>>>16&255,$>>>8&255,255&$])}else{let $=BigInt(U);if($<aM[4]){let U=[27|O,0,0,0,0,0,0,0],Y=Number($&BigInt(4294967295)),X=Number($>>BigInt(32)&BigInt(4294967295));U[8]=255&Y,Y>>=8,U[7]=255&Y,Y>>=8,U[6]=255&Y,Y>>=8,U[5]=255&Y,U[4]=255&X,X>>=8,U[3]=255&X,X>>=8,U[2]=255&X,X>>=8,U[1]=255&X,N.push(U)}else throw Error(`${aN} encountered BigInt larger than allowable range`)}}function aG(N,O,U,$){return new ao(as.negint,-1-aU(N,O+1,$),2)}function aQ(N,O,U,$){return new ao(as.negint,-1-aF(N,O+1,$),3)}function aY(N,O,U,$){return new ao(as.negint,-1-aV(N,O+1,$),5)}aW.encodedSize=function(N){return aH.encodedSize(N.value)},aH.encodedSize=function(N){return N<aM[0]?1:N<aM[1]?2:N<aM[2]?3:N<aM[3]?5:9},aW.compareTokens=function(N,O){return N.value<O.value?-1:N.value>O.value?1:0};let aX=BigInt(-1),aJ=BigInt(1);function aZ(N,O,U,$){let Y=az(N,O+1,$);if("bigint"!=typeof Y){let N=-1-Y;if(N>=Number.MIN_SAFE_INTEGER)return new ao(as.negint,N,9)}if(!0!==$.allowBigInt)throw Error(`${aN} integers outside of the safe integer range are not supported`);return new ao(as.negint,aX-BigInt(Y),9)}function a0(N,O){let U=O.value,$="bigint"==typeof U?U*aX-aJ:-1*U-1;aH(N,O.type.majorEncoded,$)}function a6(N,O,U,$){aO(N,O,U+$);let Y=aE(N,O+U,O+U+$);return new ao(as.bytes,Y,U+$)}function a8(N,O,U,$){return a6(N,O,1,U)}function a7(N,O,U,$){return a6(N,O,2,aU(N,O+1,$))}function a9(N,O,U,$){return a6(N,O,3,aF(N,O+1,$))}function lt(N,O,U,$){return a6(N,O,5,aV(N,O+1,$))}function lr(N,O,U,$){let Y=az(N,O+1,$);if("bigint"==typeof Y)throw Error(`${aN} 64-bit integer bytes lengths not supported`);return a6(N,O,9,Y)}function ln(N){return void 0===N.encodedBytes&&(N.encodedBytes=N.type===as.string?aw(N.value):N.value),N.encodedBytes}function ls(N,O){let U=ln(O);aH(N,O.type.majorEncoded,U.length),N.push(U)}function la(N,O){return N.length<O.length?-1:N.length>O.length?1:aI(N,O)}function ll(N,O,U,$,Y){let X=U+$;aO(N,O,X);let J=new ao(as.string,ab(N,O+U,O+X),X);return!0===Y.retainStringBytes&&(J.byteValue=aE(N,O+U,O+X)),J}function lc(N,O,U,$){return ll(N,O,1,U,$)}function lu(N,O,U,$){return ll(N,O,2,aU(N,O+1,$),$)}function lh(N,O,U,$){return ll(N,O,3,aF(N,O+1,$),$)}function ld(N,O,U,$){return ll(N,O,5,aV(N,O+1,$),$)}function lp(N,O,U,$){let Y=az(N,O+1,$);if("bigint"==typeof Y)throw Error(`${aN} 64-bit integer string lengths not supported`);return ll(N,O,9,Y,$)}a0.encodedSize=function(N){let O=N.value,U="bigint"==typeof O?O*aX-aJ:-1*O-1;return U<aM[0]?1:U<aM[1]?2:U<aM[2]?3:U<aM[3]?5:9},a0.compareTokens=function(N,O){return N.value<O.value?1:N.value>O.value?-1:0},ls.encodedSize=function(N){let O=ln(N);return aH.encodedSize(O.length)+O.length},ls.compareTokens=function(N,O){return la(ln(N),ln(O))};let lf=ls;function lg(N,O,U,$){return new ao(as.array,$,U)}function ly(N,O,U,$){return lg(N,O,1,U)}function lm(N,O,U,$){return lg(N,O,2,aU(N,O+1,$))}function lb(N,O,U,$){return lg(N,O,3,aF(N,O+1,$))}function lw(N,O,U,$){return lg(N,O,5,aV(N,O+1,$))}function lv(N,O,U,$){let Y=az(N,O+1,$);if("bigint"==typeof Y)throw Error(`${aN} 64-bit integer array lengths not supported`);return lg(N,O,9,Y)}function lE(N,O,U,$){if(!1===$.allowIndefinite)throw Error(`${aN} indefinite length items not allowed`);return lg(N,O,1,1/0)}function l_(N,O){aH(N,as.array.majorEncoded,O.value)}function lS(N,O,U,$){return new ao(as.map,$,U)}function lI(N,O,U,$){return lS(N,O,1,U)}function lR(N,O,U,$){return lS(N,O,2,aU(N,O+1,$))}function lk(N,O,U,$){return lS(N,O,3,aF(N,O+1,$))}function lD(N,O,U,$){return lS(N,O,5,aV(N,O+1,$))}function lA(N,O,U,$){let Y=az(N,O+1,$);if("bigint"==typeof Y)throw Error(`${aN} 64-bit integer map lengths not supported`);return lS(N,O,9,Y)}function lT(N,O,U,$){if(!1===$.allowIndefinite)throw Error(`${aN} indefinite length items not allowed`);return lS(N,O,1,1/0)}function lC(N,O){aH(N,as.map.majorEncoded,O.value)}function lP(N,O,U,$){return new ao(as.tag,U,1)}function lx(N,O,U,$){return new ao(as.tag,aU(N,O+1,$),2)}function lN(N,O,U,$){return new ao(as.tag,aF(N,O+1,$),3)}function lB(N,O,U,$){return new ao(as.tag,aV(N,O+1,$),5)}function lL(N,O,U,$){return new ao(as.tag,az(N,O+1,$),9)}function lO(N,O){aH(N,as.tag.majorEncoded,O.value)}l_.compareTokens=aW.compareTokens,l_.encodedSize=function(N){return aH.encodedSize(N.value)},lC.compareTokens=aW.compareTokens,lC.encodedSize=function(N){return aH.encodedSize(N.value)},lO.compareTokens=aW.compareTokens,lO.encodedSize=function(N){return aH.encodedSize(N.value)};let lM=20,lU=21,lF=22,lV=23;function lz(N,O,U,$){if(!1===$.allowUndefined)throw Error(`${aN} undefined values are not supported`);return!0===$.coerceUndefinedToNull?new ao(as.null,null,1):new ao(as.undefined,void 0,1)}function l$(N,O,U,$){if(!1===$.allowIndefinite)throw Error(`${aN} indefinite length items not allowed`);return new ao(as.break,void 0,1)}function lK(N,O,U){if(U){if(!1===U.allowNaN&&Number.isNaN(N))throw Error(`${aN} NaN values are not supported`);if(!1===U.allowInfinity&&(N===1/0||N===-1/0))throw Error(`${aN} Infinity values are not supported`)}return new ao(as.float,N,O)}function lq(N,O,U,$){return lK(lJ(N,O+1),3,$)}function lj(N,O,U,$){return lK(l1(N,O+1),5,$)}function lW(N,O,U,$){return lK(l0(N,O+1),9,$)}function lH(N,O,U){let $=O.value;if(!1===$)N.push([as.float.majorEncoded|lM]);else if(!0===$)N.push([as.float.majorEncoded|lU]);else if(null===$)N.push([as.float.majorEncoded|lF]);else if(void 0===$)N.push([as.float.majorEncoded|lV]);else{let O;let Y=!1;U&&!0===U.float64||(lX($),$===(O=lJ(lY,1))||Number.isNaN($)?(lY[0]=249,N.push(lY.slice(0,3)),Y=!0):(lZ($),$!==(O=l1(lY,1))||(lY[0]=250,N.push(lY.slice(0,5)),Y=!0))),Y||(l2($),O=l0(lY,1),lY[0]=251,N.push(lY.slice(0,9)))}}lH.encodedSize=function(N,O){let U=N.value;if(!1===U||!0===U||null==U)return 1;if(!O||!0!==O.float64){lX(U);let N=lJ(lY,1);if(U===N||Number.isNaN(U))return 3;if(lZ(U),U===(N=l1(lY,1)))return 5}return 9};let lG=new ArrayBuffer(9),lQ=new DataView(lG,1),lY=new Uint8Array(lG,0);function lX(N){if(N===1/0)lQ.setUint16(0,31744,!1);else if(N===-1/0)lQ.setUint16(0,64512,!1);else if(Number.isNaN(N))lQ.setUint16(0,32256,!1);else{lQ.setFloat32(0,N);let O=lQ.getUint32(0),U=(2139095040&O)>>23,$=8388607&O;if(255===U)lQ.setUint16(0,31744,!1);else if(0===U)lQ.setUint16(0,(2147483648&N)>>16|$>>13,!1);else{let N=U-127;N<-24?lQ.setUint16(0,0):N<-14?lQ.setUint16(0,(2147483648&O)>>16|1<<24+N,!1):lQ.setUint16(0,(2147483648&O)>>16|N+15<<10|$>>13,!1)}}}function lJ(N,O){let U;if(N.length-O<2)throw Error(`${aN} not enough data for float16`);let $=(N[O]<<8)+N[O+1];if(31744===$)return 1/0;if(64512===$)return-1/0;if(32256===$)return NaN;let Y=$>>10&31,X=1023&$;return U=0===Y?5960464477539063e-23*X:31!==Y?(X+1024)*2**(Y-25):0===X?1/0:NaN,32768&$?-U:U}function lZ(N){lQ.setFloat32(0,N,!1)}function l1(N,O){if(N.length-O<4)throw Error(`${aN} not enough data for float32`);let U=(N.byteOffset||0)+O;return new DataView(N.buffer,U,4).getFloat32(0,!1)}function l2(N){lQ.setFloat64(0,N,!1)}function l0(N,O){if(N.length-O<8)throw Error(`${aN} not enough data for float64`);let U=(N.byteOffset||0)+O;return new DataView(N.buffer,U,8).getFloat64(0,!1)}function l3(N,O,U){throw Error(`${aN} encountered invalid minor (${U}) for major ${N[O]>>>5}`)}function l4(N){return()=>{throw Error(`${aN} ${N}`)}}lH.compareTokens=aW.compareTokens;let l5=[];for(let N=0;N<=23;N++)l5[N]=l3;l5[24]=a$,l5[25]=aK,l5[26]=aq,l5[27]=aj,l5[28]=l3,l5[29]=l3,l5[30]=l3,l5[31]=l3;for(let N=32;N<=55;N++)l5[N]=l3;l5[56]=aG,l5[57]=aQ,l5[58]=aY,l5[59]=aZ,l5[60]=l3,l5[61]=l3,l5[62]=l3,l5[63]=l3;for(let N=64;N<=87;N++)l5[N]=a8;l5[88]=a7,l5[89]=a9,l5[90]=lt,l5[91]=lr,l5[92]=l3,l5[93]=l3,l5[94]=l3,l5[95]=l4("indefinite length bytes/strings are not supported");for(let N=96;N<=119;N++)l5[N]=lc;l5[120]=lu,l5[121]=lh,l5[122]=ld,l5[123]=lp,l5[124]=l3,l5[125]=l3,l5[126]=l3,l5[127]=l4("indefinite length bytes/strings are not supported");for(let N=128;N<=151;N++)l5[N]=ly;l5[152]=lm,l5[153]=lb,l5[154]=lw,l5[155]=lv,l5[156]=l3,l5[157]=l3,l5[158]=l3,l5[159]=lE;for(let N=160;N<=183;N++)l5[N]=lI;l5[184]=lR,l5[185]=lk,l5[186]=lD,l5[187]=lA,l5[188]=l3,l5[189]=l3,l5[190]=l3,l5[191]=lT;for(let N=192;N<=215;N++)l5[N]=lP;l5[216]=lx,l5[217]=lN,l5[218]=lB,l5[219]=lL,l5[220]=l3,l5[221]=l3,l5[222]=l3,l5[223]=l3;for(let N=224;N<=243;N++)l5[N]=l4("simple values are not supported");l5[244]=l3,l5[245]=l3,l5[246]=l3,l5[247]=lz,l5[248]=l4("simple values are not supported"),l5[249]=lq,l5[250]=lj,l5[251]=lW,l5[252]=l3,l5[253]=l3,l5[254]=l3,l5[255]=l$;let l6=[];for(let N=0;N<24;N++)l6[N]=new ao(as.uint,N,1);for(let N=-1;N>=-24;N--)l6[31-N]=new ao(as.negint,N,1);function l8(N){switch(N.type){case as.false:return av([244]);case as.true:return av([245]);case as.null:return av([246]);case as.bytes:if(!N.value.length)return av([64]);return;case as.string:if(""===N.value)return av([96]);return;case as.array:if(0===N.value)return av([128]);return;case as.map:if(0===N.value)return av([160]);return;case as.uint:if(N.value<24)return av([Number(N.value)]);return;case as.negint:if(N.value>=-24)return av([31-Number(N.value)])}}l6[64]=new ao(as.bytes,new Uint8Array(0),1),l6[96]=new ao(as.string,"",1),l6[128]=new ao(as.array,0,1),l6[160]=new ao(as.map,0,1),l6[244]=new ao(as.false,!1,1),l6[245]=new ao(as.true,!0,1),l6[246]=new ao(as.null,null,1);let l7={float64:!1,mapSorter:cl,quickEncodeToken:l8};function l9(){let N=[];return N[as.uint.major]=aW,N[as.negint.major]=a0,N[as.bytes.major]=ls,N[as.string.major]=lf,N[as.array.major]=l_,N[as.map.major]=lC,N[as.tag.major]=lO,N[as.float.major]=lH,N}let ce=l9(),ct=new aC;class cr{constructor(N,O){this.obj=N,this.parent=O}includes(N){let O=this;do if(O.obj===N)return!0;while(O=O.parent);return!1}static createCheck(N,O){if(N&&N.includes(O))throw Error(`${aB} object contains circular references`);return new cr(O,N)}}let ci={null:new ao(as.null,null),undefined:new ao(as.undefined,void 0),true:new ao(as.true,!0),false:new ao(as.false,!1),emptyArray:new ao(as.array,0),emptyMap:new ao(as.map,0)},cn={number:(N,O,U,$)=>Number.isInteger(N)&&Number.isSafeInteger(N)?N>=0?new ao(as.uint,N):new ao(as.negint,N):new ao(as.float,N),bigint:(N,O,U,$)=>N>=BigInt(0)?new ao(as.uint,N):new ao(as.negint,N),Uint8Array:(N,O,U,$)=>new ao(as.bytes,N),string:(N,O,U,$)=>new ao(as.string,N),boolean:(N,O,U,$)=>N?ci.true:ci.false,null:(N,O,U,$)=>ci.null,undefined:(N,O,U,$)=>ci.undefined,ArrayBuffer:(N,O,U,$)=>new ao(as.bytes,new Uint8Array(N)),DataView:(N,O,U,$)=>new ao(as.bytes,new Uint8Array(N.buffer,N.byteOffset,N.byteLength)),Array(N,O,U,$){if(!N.length)return!0===U.addBreakTokens?[ci.emptyArray,new ao(as.break)]:ci.emptyArray;$=cr.createCheck($,N);let Y=[],X=0;for(let O of N)Y[X++]=co(O,U,$);return U.addBreakTokens?[new ao(as.array,N.length),Y,new ao(as.break)]:[new ao(as.array,N.length),Y]},Object(N,O,U,$){let Y="Object"!==O,X=Y?N.keys():Object.keys(N),J=Y?N.size:X.length;if(!J)return!0===U.addBreakTokens?[ci.emptyMap,new ao(as.break)]:ci.emptyMap;$=cr.createCheck($,N);let Z=[],en=0;for(let O of X)Z[en++]=[co(O,U,$),co(Y?N.get(O):N[O],U,$)];return(ca(Z,U),U.addBreakTokens)?[new ao(as.map,J),Z,new ao(as.break)]:[new ao(as.map,J),Z]}};for(let N of(cn.Map=cn.Object,cn.Buffer=cn.Uint8Array,"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" ")))cn[`${N}Array`]=cn.DataView;function co(N,O={},U){let $=at(N),Y=O&&O.typeEncoders&&O.typeEncoders[$]||cn[$];if("function"==typeof Y){let X=Y(N,$,O,U);if(null!=X)return X}let X=cn[$];if(!X)throw Error(`${aB} unsupported type: ${$}`);return X(N,$,O,U)}function ca(N,O){O.mapSorter&&N.sort(O.mapSorter)}function cl(N,O){let U=Array.isArray(N[0])?N[0][0]:N[0],$=Array.isArray(O[0])?O[0][0]:O[0];if(U.type!==$.type)return U.type.compare($.type);let Y=U.type.major,X=ce[Y].compareTokens(U,$);return 0===X&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),X}function cc(N,O,U,$){if(Array.isArray(O))for(let Y of O)cc(N,Y,U,$);else U[O.type.major](N,O,$)}function cu(N,O,U){let $=co(N,U);if(!Array.isArray($)&&U.quickEncodeToken){let N=U.quickEncodeToken($);if(N)return N;let Y=O[$.type.major];if(Y.encodedSize){let N=Y.encodedSize($,U),O=new aC(N);if(Y(O,$,U),1!==O.chunks.length)throw Error(`Unexpected error: pre-calculated length for ${$} was wrong`);return am(O.chunks[0])}}return ct.reset(),cc(ct,$,O,U),ct.toBytes(!0)}function cd(N,O){return cu(N,ce,O=Object.assign({},l7,O))}let cp={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class cf{constructor(N,O={}){this.pos=0,this.data=N,this.options=O}done(){return this.pos>=this.data.length}next(){let N=this.data[this.pos],O=l6[N];if(void 0===O){let U=l5[N];if(!U)throw Error(`${aN} no decoder for major type ${N>>>5} (byte 0x${N.toString(16).padStart(2,"0")})`);let $=31&N;O=U(this.data,this.pos,$,this.options)}return this.pos+=O.encodedLength,O}}let cg=Symbol.for("DONE"),cy=Symbol.for("BREAK");function cm(N,O,U){let $=[];for(let Y=0;Y<N.value;Y++){let X=cv(O,U);if(X===cy){if(N.value===1/0)break;throw Error(`${aN} got unexpected break to lengthed array`)}if(X===cg)throw Error(`${aN} found array but not enough entries (got ${Y}, expected ${N.value})`);$[Y]=X}return $}function cw(N,O,U){let $=!0===U.useMaps,Y=$?void 0:{},X=$?new Map:void 0;for(let J=0;J<N.value;J++){let Z=cv(O,U);if(Z===cy){if(N.value===1/0)break;throw Error(`${aN} got unexpected break to lengthed map`)}if(Z===cg)throw Error(`${aN} found map but not enough entries (got ${J} [no key], expected ${N.value})`);if(!0!==$&&"string"!=typeof Z)throw Error(`${aN} non-string keys not supported (got ${typeof Z})`);if(!0===U.rejectDuplicateMapKeys&&($&&X.has(Z)||!$&&Z in Y))throw Error(`${aN} found repeat map key "${Z}"`);let en=cv(O,U);if(en===cg)throw Error(`${aN} found map but not enough entries (got ${J} [no value], expected ${N.value})`);$?X.set(Z,en):Y[Z]=en}return $?X:Y}function cv(N,O){if(N.done())return cg;let U=N.next();if(U.type===as.break)return cy;if(U.type.terminal)return U.value;if(U.type===as.array)return cm(U,N,O);if(U.type===as.map)return cw(U,N,O);if(U.type===as.tag){if(O.tags&&"function"==typeof O.tags[U.value]){let $=cv(N,O);return O.tags[U.value]($)}throw Error(`${aN} tag not supported (${U.value})`)}throw Error("unsupported")}function cE(N,O){if(!(N instanceof Uint8Array))throw Error(`${aN} data to decode must be a Uint8Array`);O=Object.assign({},cp,O);let U=O.tokenizer||new cf(N,O),$=cv(U,O);if($===cg)throw Error(`${aN} did not find any content to decode`);if($===cy)throw Error(`${aN} got unexpected break`);if(!U.done())throw Error(`${aN} too many terminals, data makes no sense`);return $}function c_(){let N={};return N.promise=new Promise((O,U)=>{N.resolve=O,N.reject=U}),N}var cS=U(6729);class cI extends Error{constructor(N){super(N),this.name="TimeoutError"}}class cR extends Error{constructor(N){super(),this.name="AbortError",this.message=N}}let cD=N=>void 0===globalThis.DOMException?new cR(N):new DOMException(N),cA=N=>{let O=void 0===N.reason?cD("This operation was aborted."):N.reason;return O instanceof Error?O:cD(O)};function cT(N,O,U,$){let Y;let X=new Promise((X,J)=>{if("number"!=typeof O||1!==Math.sign(O))throw TypeError(`Expected \`milliseconds\` to be a positive number, got \`${O}\``);if(O===Number.POSITIVE_INFINITY){X(N);return}if(($={customTimers:{setTimeout,clearTimeout},...$}).signal){let{signal:N}=$;N.aborted&&J(cA(N)),N.addEventListener("abort",()=>{J(cA(N))})}Y=$.customTimers.setTimeout.call(void 0,()=>{if("function"==typeof U){try{X(U())}catch(N){J(N)}return}let $="string"==typeof U?U:`Promise timed out after ${O} milliseconds`,Y=U instanceof Error?U:new cI($);"function"==typeof N.cancel&&N.cancel(),J(Y)},O),(async()=>{try{X(await N)}catch(N){J(N)}finally{$.customTimers.clearTimeout.call(void 0,Y)}})()});return X.clear=()=>{clearTimeout(Y),Y=void 0},X}function cC(N,O,U){let $=0,Y=N.length;for(;Y>0;){let X=Math.trunc(Y/2),J=$+X;0>=U(N[J],O)?($=++J,Y-=X+1):Y=X}return $}var cP=function(N,O,U,$){if("a"===U&&!$)throw TypeError("Private accessor was defined without a getter");if("function"==typeof O?N!==O||!$:!O.has(N))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===U?$:"a"===U?$.call(N):$?$.value:O.get(N)};class cx{constructor(){ea.set(this,[])}enqueue(N,O){O={priority:0,...O};let U={priority:O.priority,run:N};if(this.size&&cP(this,ea,"f")[this.size-1].priority>=O.priority){cP(this,ea,"f").push(U);return}let $=cC(cP(this,ea,"f"),U,(N,O)=>O.priority-N.priority);cP(this,ea,"f").splice($,0,U)}dequeue(){let N=cP(this,ea,"f").shift();return null==N?void 0:N.run}filter(N){return cP(this,ea,"f").filter(O=>O.priority===N.priority).map(N=>N.run)}get size(){return cP(this,ea,"f").length}}ea=new WeakMap;var cN=function(N,O,U,$,Y){if("m"===$)throw TypeError("Private method is not writable");if("a"===$&&!Y)throw TypeError("Private accessor was defined without a setter");if("function"==typeof O?N!==O||!Y:!O.has(N))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===$?Y.call(N,U):Y?Y.value=U:O.set(N,U),U},cB=function(N,O,U,$){if("a"===U&&!$)throw TypeError("Private accessor was defined without a getter");if("function"==typeof O?N!==O||!$:!O.has(N))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===U?$:"a"===U?$.call(N):$?$.value:O.get(N)};class cL extends Error{}class cO extends cS{constructor(N){var O,U,$,Y;if(super(),ec.add(this),eu.set(this,void 0),eh.set(this,void 0),ef.set(this,0),eg.set(this,void 0),ey.set(this,void 0),ew.set(this,0),ev.set(this,void 0),eE.set(this,void 0),e_.set(this,void 0),eS.set(this,void 0),eI.set(this,0),eR.set(this,void 0),ek.set(this,void 0),eD.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!("number"==typeof(N={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:cx,...N}).intervalCap&&N.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(U=null===(O=N.intervalCap)||void 0===O?void 0:O.toString())&&void 0!==U?U:""}\` (${typeof N.intervalCap})`);if(void 0===N.interval||!(Number.isFinite(N.interval)&&N.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(Y=null===($=N.interval)||void 0===$?void 0:$.toString())&&void 0!==Y?Y:""}\` (${typeof N.interval})`);cN(this,eu,N.carryoverConcurrencyCount,"f"),cN(this,eh,N.intervalCap===Number.POSITIVE_INFINITY||0===N.interval,"f"),cN(this,eg,N.intervalCap,"f"),cN(this,ey,N.interval,"f"),cN(this,e_,new N.queueClass,"f"),cN(this,eS,N.queueClass,"f"),this.concurrency=N.concurrency,this.timeout=N.timeout,cN(this,eD,!0===N.throwOnTimeout,"f"),cN(this,ek,!1===N.autoStart,"f")}get concurrency(){return cB(this,eR,"f")}set concurrency(N){if(!("number"==typeof N&&N>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${N}\` (${typeof N})`);cN(this,eR,N,"f"),cB(this,ec,"m",eM).call(this)}async add(N,O={}){return O={timeout:this.timeout,throwOnTimeout:cB(this,eD,"f"),...O},new Promise((U,$)=>{cB(this,e_,"f").enqueue(async()=>{var Y,X,J;cN(this,eI,(X=cB(this,eI,"f"),++X),"f"),cN(this,ef,(J=cB(this,ef,"f"),++J),"f");try{if(null===(Y=O.signal)||void 0===Y?void 0:Y.aborted)throw new cL("The task was aborted.");let $=N({signal:O.signal});O.timeout&&($=cT(Promise.resolve($),O.timeout)),O.signal&&($=Promise.race([$,cB(this,ec,"m",eU).call(this,O.signal)]));let X=await $;U(X),this.emit("completed",X)}catch(N){if(N instanceof cI&&!O.throwOnTimeout){U();return}$(N),this.emit("error",N)}finally{cB(this,ec,"m",eC).call(this)}},O),this.emit("add"),cB(this,ec,"m",eB).call(this)})}async addAll(N,O){return Promise.all(N.map(async N=>this.add(N,O)))}start(){return cB(this,ek,"f")&&(cN(this,ek,!1,"f"),cB(this,ec,"m",eM).call(this)),this}pause(){cN(this,ek,!0,"f")}clear(){cN(this,e_,new(cB(this,eS,"f")),"f")}async onEmpty(){0!==cB(this,e_,"f").size&&await cB(this,ec,"m",eF).call(this,"empty")}async onSizeLessThan(N){cB(this,e_,"f").size<N||await cB(this,ec,"m",eF).call(this,"next",()=>cB(this,e_,"f").size<N)}async onIdle(){(0!==cB(this,eI,"f")||0!==cB(this,e_,"f").size)&&await cB(this,ec,"m",eF).call(this,"idle")}get size(){return cB(this,e_,"f").size}sizeBy(N){return cB(this,e_,"f").filter(N).length}get pending(){return cB(this,eI,"f")}get isPaused(){return cB(this,ek,"f")}}eu=new WeakMap,eh=new WeakMap,ef=new WeakMap,eg=new WeakMap,ey=new WeakMap,ew=new WeakMap,ev=new WeakMap,eE=new WeakMap,e_=new WeakMap,eS=new WeakMap,eI=new WeakMap,eR=new WeakMap,ek=new WeakMap,eD=new WeakMap,ec=new WeakSet,eA=function(){return cB(this,eh,"f")||cB(this,ef,"f")<cB(this,eg,"f")},eT=function(){return cB(this,eI,"f")<cB(this,eR,"f")},eC=function(){var N;cN(this,eI,(N=cB(this,eI,"f"),--N),"f"),cB(this,ec,"m",eB).call(this),this.emit("next")},eP=function(){cB(this,ec,"m",eO).call(this),cB(this,ec,"m",eL).call(this),cN(this,eE,void 0,"f")},eN=function(){let N=Date.now();if(void 0===cB(this,ev,"f")){let O=cB(this,ew,"f")-N;if(!(O<0))return void 0===cB(this,eE,"f")&&cN(this,eE,setTimeout(()=>{cB(this,ec,"m",eP).call(this)},O),"f"),!0;cN(this,ef,cB(this,eu,"f")?cB(this,eI,"f"):0,"f")}return!1},eB=function(){if(0===cB(this,e_,"f").size)return cB(this,ev,"f")&&clearInterval(cB(this,ev,"f")),cN(this,ev,void 0,"f"),this.emit("empty"),0===cB(this,eI,"f")&&this.emit("idle"),!1;if(!cB(this,ek,"f")){let N=!cB(this,ec,"a",eN);if(cB(this,ec,"a",eA)&&cB(this,ec,"a",eT)){let O=cB(this,e_,"f").dequeue();return!!O&&(this.emit("active"),O(),N&&cB(this,ec,"m",eL).call(this),!0)}}return!1},eL=function(){cB(this,eh,"f")||void 0!==cB(this,ev,"f")||(cN(this,ev,setInterval(()=>{cB(this,ec,"m",eO).call(this)},cB(this,ey,"f")),"f"),cN(this,ew,Date.now()+cB(this,ey,"f"),"f"))},eO=function(){0===cB(this,ef,"f")&&0===cB(this,eI,"f")&&cB(this,ev,"f")&&(clearInterval(cB(this,ev,"f")),cN(this,ev,void 0,"f")),cN(this,ef,cB(this,eu,"f")?cB(this,eI,"f"):0,"f"),cB(this,ec,"m",eM).call(this)},eM=function(){for(;cB(this,ec,"m",eB).call(this););},eU=async function(N){return new Promise((O,U)=>{N.addEventListener("abort",()=>{U(new cL("The task was aborted."))},{once:!0})})},eF=async function(N,O){return new Promise(U=>{let $=()=>{(!O||O())&&(this.off(N,$),U())};this.on(N,$)})};var cM=128,cU=-128,cF=2147483648;function cV(N,O,U){O=O||[];for(var $=U=U||0;N>=cF;)O[U++]=255&N|cM,N/=128;for(;N&cU;)O[U++]=255&N|cM,N>>>=7;return O[U]=0|N,cV.bytes=U-$+1,O}var cz=128,c$=127;function cK(N,O){var U,$=0,O=O||0,Y=0,X=O,J=N.length;do{if(X>=J)throw cK.bytes=0,RangeError("Could not decode varint");U=N[X++],$+=Y<28?(U&c$)<<Y:(U&c$)*Math.pow(2,Y),Y+=7}while(U>=cz);return cK.bytes=X-O,$}var cq=128,cj=16384,cW=2097152,cH=268435456,cG=34359738368,cQ=4398046511104,cY=562949953421312,cX=72057594037927940,cJ=0x7fffffffffffffff,cZ={encode:cV,decode:cK,encodingLength:function(N){return N<cq?1:N<cj?2:N<cW?3:N<cH?4:N<cG?5:N<cQ?6:N<cY?7:N<cX?8:N<cJ?9:10}};let c0=(N,O=0)=>{let U=cZ.decode(N,O);return[U,cZ.decode.bytes]},c3=(N,O,U=0)=>(cZ.encode(N,O,U),O),c4=N=>cZ.encodingLength(N);new Uint8Array(0);let c5=(N,O)=>{if(N===O)return!0;if(N.byteLength!==O.byteLength)return!1;for(let U=0;U<N.byteLength;U++)if(N[U]!==O[U])return!1;return!0},c6=N=>{if(N instanceof Uint8Array&&"Uint8Array"===N.constructor.name)return N;if(N instanceof ArrayBuffer)return new Uint8Array(N);if(ArrayBuffer.isView(N))return new Uint8Array(N.buffer,N.byteOffset,N.byteLength);throw Error("Unknown type, must be binary type")},c8=(N,O)=>{let U=O.byteLength,$=c4(N),Y=$+c4(U),X=new Uint8Array(Y+U);return c3(N,X,0),c3(U,X,$),X.set(O,Y),new ue(N,U,O,X)},c7=N=>{let O=c6(N),[U,$]=c0(O),[Y,X]=c0(O.subarray($)),J=O.subarray($+X);if(J.byteLength!==Y)throw Error("Incorrect length");return new ue(U,Y,J,O)},c9=(N,O)=>{if(N===O)return!0;{let U=O;return N.code===U.code&&N.size===U.size&&U.bytes instanceof Uint8Array&&c5(N.bytes,U.bytes)}};class ue{constructor(N,O,U,$){this.code=N,this.size=O,this.digest=U,this.bytes=$}}var ut=function(N,O){if(N.length>=255)throw TypeError("Alphabet too long");for(var U=new Uint8Array(256),$=0;$<U.length;$++)U[$]=255;for(var Y=0;Y<N.length;Y++){var X=N.charAt(Y),J=X.charCodeAt(0);if(255!==U[J])throw TypeError(X+" is ambiguous");U[J]=Y}var Z=N.length,en=N.charAt(0),es=Math.log(Z)/Math.log(256),eo=Math.log(256)/Math.log(Z);function ea(N){if("string"!=typeof N)throw TypeError("Expected String");if(0===N.length)return new Uint8Array;var O=0;if(" "!==N[0]){for(var $=0,Y=0;N[O]===en;)$++,O++;for(var X=(N.length-O)*es+1>>>0,J=new Uint8Array(X);N[O];){var eo=U[N.charCodeAt(O)];if(255===eo)return;for(var ea=0,ec=X-1;(0!==eo||ea<Y)&&-1!==ec;ec--,ea++)eo+=Z*J[ec]>>>0,J[ec]=eo%256>>>0,eo=eo/256>>>0;if(0!==eo)throw Error("Non-zero carry");Y=ea,O++}if(" "!==N[O]){for(var eu=X-Y;eu!==X&&0===J[eu];)eu++;for(var eh=new Uint8Array($+(X-eu)),ef=$;eu!==X;)eh[ef++]=J[eu++];return eh}}}function ec(N){var U=ea(N);if(U)return U;throw Error(`Non-${O} character`)}return{encode:function(O){if(O instanceof Uint8Array||(ArrayBuffer.isView(O)?O=new Uint8Array(O.buffer,O.byteOffset,O.byteLength):Array.isArray(O)&&(O=Uint8Array.from(O))),!(O instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===O.length)return"";for(var U=0,$=0,Y=0,X=O.length;Y!==X&&0===O[Y];)Y++,U++;for(var J=(X-Y)*eo+1>>>0,es=new Uint8Array(J);Y!==X;){for(var ea=O[Y],ec=0,eu=J-1;(0!==ea||ec<$)&&-1!==eu;eu--,ec++)ea+=256*es[eu]>>>0,es[eu]=ea%Z>>>0,ea=ea/Z>>>0;if(0!==ea)throw Error("Non-zero carry");$=ec,Y++}for(var eh=J-$;eh!==J&&0===es[eh];)eh++;for(var ef=en.repeat(U);eh<J;++eh)ef+=N.charAt(es[eh]);return ef},decodeUnsafe:ea,decode:ec}};class ur{constructor(N,O,U){this.name=N,this.prefix=O,this.baseEncode=U}encode(N){if(N instanceof Uint8Array)return`${this.prefix}${this.baseEncode(N)}`;throw Error("Unknown type, must be binary type")}}class ui{constructor(N,O,U){if(this.name=N,this.prefix=O,void 0===O.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=O.codePointAt(0),this.baseDecode=U}decode(N){if("string"==typeof N){if(N.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(N)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(N.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(N){return us(this,N)}}class un{constructor(N){this.decoders=N}or(N){return us(this,N)}decode(N){let O=N[0],U=this.decoders[O];if(U)return U.decode(N);throw RangeError(`Unable to decode multibase string ${JSON.stringify(N)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let us=(N,O)=>new un({...N.decoders||{[N.prefix]:N},...O.decoders||{[O.prefix]:O}});class uo{constructor(N,O,U,$){this.name=N,this.prefix=O,this.baseEncode=U,this.baseDecode=$,this.encoder=new ur(N,O,U),this.decoder=new ui(N,O,$)}encode(N){return this.encoder.encode(N)}decode(N){return this.decoder.decode(N)}}let ul=({name:N,prefix:O,encode:U,decode:$})=>new uo(N,O,U,$),uc=({prefix:N,name:O,alphabet:U})=>{let{encode:$,decode:Y}=ut(U,O);return ul({prefix:N,name:O,encode:$,decode:N=>c6(Y(N))})},uu=(N,O,U,$)=>{let Y={};for(let N=0;N<O.length;++N)Y[O[N]]=N;let X=N.length;for(;"="===N[X-1];)--X;let J=new Uint8Array(X*U/8|0),Z=0,en=0,es=0;for(let O=0;O<X;++O){let X=Y[N[O]];if(void 0===X)throw SyntaxError(`Non-${$} character`);en=en<<U|X,(Z+=U)>=8&&(Z-=8,J[es++]=255&en>>Z)}if(Z>=U||255&en<<8-Z)throw SyntaxError("Unexpected end of data");return J},uh=(N,O,U)=>{let $="="===O[O.length-1],Y=(1<<U)-1,X="",J=0,Z=0;for(let $=0;$<N.length;++$)for(Z=Z<<8|N[$],J+=8;J>U;)J-=U,X+=O[Y&Z>>J];if(J&&(X+=O[Y&Z<<U-J]),$)for(;X.length*U&7;)X+="=";return X},ud=({name:N,prefix:O,bitsPerChar:U,alphabet:$})=>ul({prefix:O,name:N,encode:N=>uh(N,$,U),decode:O=>uu(O,$,U,N)}),up=uc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});uc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});let uf=ud({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});ud({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ud({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ud({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ud({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ud({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ud({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ud({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ud({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});let ug=(N,O)=>{let{bytes:U,version:$}=N;return 0===$?uv(U,um(N),O||up.encoder):uE(U,um(N),O||uf.encoder)},uy=new WeakMap,um=N=>{let O=uy.get(N);if(null==O){let O=new Map;return uy.set(N,O),O}return O};class ub{constructor(N,O,U,$){this.code=O,this.version=N,this.multihash=U,this.bytes=$,this["/"]=$}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:N,multihash:O}=this;if(N!==u_)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(O.code!==uS)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return ub.createV0(O)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:N,digest:O}=this.multihash,U=c8(N,O);return ub.createV1(this.code,U)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(N){return ub.equals(this,N)}static equals(N,O){let U=O;return U&&N.code===U.code&&N.version===U.version&&c9(N.multihash,U.multihash)}toString(N){return ug(this,N)}toJSON(){return{"/":ug(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(N){if(null==N)return null;let O=N;if(O instanceof ub)return O;if(null!=O["/"]&&O["/"]===O.bytes||O.asCID===O){let{version:N,code:U,multihash:$,bytes:Y}=O;return new ub(N,U,$,Y||uI(N,U,$.bytes))}if(!0!==O[uR])return null;{let{version:N,multihash:U,code:$}=O,Y=c7(U);return ub.create(N,$,Y)}}static create(N,O,U){if("number"!=typeof O)throw Error("String codecs are no longer supported");if(!(U.bytes instanceof Uint8Array))throw Error("Invalid digest");switch(N){case 0:if(O===u_)return new ub(N,O,U,U.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${u_}) block encoding`);case 1:{let $=uI(N,O,U.bytes);return new ub(N,O,U,$)}default:throw Error("Invalid version")}}static createV0(N){return ub.create(0,u_,N)}static createV1(N,O){return ub.create(1,N,O)}static decode(N){let[O,U]=ub.decodeFirst(N);if(U.length)throw Error("Incorrect length");return O}static decodeFirst(N){let O=ub.inspectBytes(N),U=O.size-O.multihashSize,$=c6(N.subarray(U,U+O.multihashSize));if($.byteLength!==O.multihashSize)throw Error("Incorrect length");let Y=$.subarray(O.multihashSize-O.digestSize),X=new ue(O.multihashCode,O.digestSize,Y,$),J=0===O.version?ub.createV0(X):ub.createV1(O.codec,X);return[J,N.subarray(O.size)]}static inspectBytes(N){let O=0,U=()=>{let[U,$]=c0(N.subarray(O));return O+=$,U},$=U(),Y=u_;if(18===$?($=0,O=0):Y=U(),0!==$&&1!==$)throw RangeError(`Invalid CID version ${$}`);let X=O,J=U(),Z=U(),en=O+Z,es=en-X;return{version:$,codec:Y,multihashCode:J,digestSize:Z,multihashSize:es,size:en}}static parse(N,O){let[U,$]=uw(N,O),Y=ub.decode($);if(0===Y.version&&"Q"!==N[0])throw Error("Version 0 CID string must not include multibase prefix");return um(Y).set(U,N),Y}}let uw=(N,O)=>{switch(N[0]){case"Q":{let U=O||up;return[up.prefix,U.decode(`${up.prefix}${N}`)]}case up.prefix:{let U=O||up;return[up.prefix,U.decode(N)]}case uf.prefix:{let U=O||uf;return[uf.prefix,U.decode(N)]}default:if(null==O)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[N[0],O.decode(N)]}},uv=(N,O,U)=>{let{prefix:$}=U;if($!==up.prefix)throw Error(`Cannot string encode V0 in ${U.name} encoding`);let Y=O.get($);if(null!=Y)return Y;{let Y=U.encode(N).slice(1);return O.set($,Y),Y}},uE=(N,O,U)=>{let{prefix:$}=U,Y=O.get($);if(null!=Y)return Y;{let Y=U.encode(N);return O.set($,Y),Y}},u_=112,uS=18,uI=(N,O,U)=>{let $=c4(N),Y=$+c4(O),X=new Uint8Array(Y+U.byteLength);return c3(N,X,0),c3(O,X,$),X.set(U,Y),X},uR=Symbol.for("@ipld/js-cid/CID"),uk=new TextDecoder;function uD(N,O){let U=0;for(let $=0;;$+=7){if($>=64)throw Error("protobuf: varint overflow");if(O>=N.length)throw Error("protobuf: unexpected end of data");let Y=N[O++];if(U+=$<28?(127&Y)<<$:(127&Y)*2**$,Y<128)break}return[U,O]}function uA(N,O){let U;[U,O]=uD(N,O);let $=O+U;if(U<0||$<0)throw Error("protobuf: invalid length");if($>N.length)throw Error("protobuf: unexpected end of data");return[N.subarray(O,$),$]}function uT(N,O){let U;return[U,O]=uD(N,O),[7&U,U>>3,O]}function uC(N){let O={},U=N.length,$=0;for(;$<U;){let U,Y;if([U,Y,$]=uT(N,$),1===Y){if(O.Hash)throw Error("protobuf: (PBLink) duplicate Hash section");if(2!==U)throw Error(`protobuf: (PBLink) wrong wireType (${U}) for Hash`);if(void 0!==O.Name)throw Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==O.Tsize)throw Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[O.Hash,$]=uA(N,$)}else if(2===Y){let Y;if(void 0!==O.Name)throw Error("protobuf: (PBLink) duplicate Name section");if(2!==U)throw Error(`protobuf: (PBLink) wrong wireType (${U}) for Name`);if(void 0!==O.Tsize)throw Error("protobuf: (PBLink) invalid order, found Tsize before Name");[Y,$]=uA(N,$),O.Name=uk.decode(Y)}else if(3===Y){if(void 0!==O.Tsize)throw Error("protobuf: (PBLink) duplicate Tsize section");if(0!==U)throw Error(`protobuf: (PBLink) wrong wireType (${U}) for Tsize`);[O.Tsize,$]=uD(N,$)}else throw Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${Y}`)}if($>U)throw Error("protobuf: (PBLink) unexpected end of data");return O}function uP(N){let O,U;let $=N.length,Y=0,X=!1;for(;Y<$;){let $,J;if([$,J,Y]=uT(N,Y),2!==$)throw Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${$}`);if(1===J){if(U)throw Error("protobuf: (PBNode) duplicate Data section");[U,Y]=uA(N,Y),O&&(X=!0)}else if(2===J){let U;if(X)throw Error("protobuf: (PBNode) duplicate Links section");O||(O=[]),[U,Y]=uA(N,Y),O.push(uC(U))}else throw Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${J}`)}if(Y>$)throw Error("protobuf: (PBNode) unexpected end of data");let J={};return U&&(J.Data=U),J.Links=O||[],J}new TextEncoder,new TextEncoder;let ux=112;function uN(N){let O=uP(N),U={};return O.Data&&(U.Data=O.Data),O.Links&&(U.Links=O.Links.map(N=>{let O={};try{O.Hash=ub.decode(N.Hash)}catch(N){}if(!O.Hash)throw Error("Invalid Hash field found in link, expected CID");return void 0!==N.Name&&(O.Name=N.Name),void 0!==N.Tsize&&(O.Tsize=N.Tsize),O})),U}as.uint.major,as.negint.major,as.bytes.major,as.string.major,as.array.major,as.map.major,as.tag.major,as.float.major;class uB{constructor(N,O={}){this.pos=0,this.data=N,this.options=O,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let N=this.ch();for(;32===N||9===N||13===N||10===N;)N=this.data[++this.pos]}expect(N){if(this.data.length-this.pos<N.length)throw Error(`${aN} unexpected end of input at position ${this.pos}`);for(let O=0;O<N.length;O++)if(this.data[this.pos++]!==N[O])throw Error(`${aN} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...N)}'`)}parseNumber(){let N=this.pos,O=!1,U=!1,$=N=>{for(;!this.done();){let O=this.ch();if(N.includes(O))this.pos++;else break}};if(45===this.ch()&&(O=!0,this.pos++),48===this.ch()){if(this.pos++,46!==this.ch())return new ao(as.uint,0,this.pos-N);this.pos++,U=!0}if($([48,49,50,51,52,53,54,55,56,57]),O&&this.pos===N+1)throw Error(`${aN} unexpected token at position ${this.pos}`);if(!this.done()&&46===this.ch()){if(U)throw Error(`${aN} unexpected token at position ${this.pos}`);U=!0,this.pos++,$([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(U=!0,this.pos++,!this.done()&&(43===this.ch()||45===this.ch())&&this.pos++,$([48,49,50,51,52,53,54,55,56,57]));let Y=String.fromCharCode.apply(null,this.data.subarray(N,this.pos)),X=parseFloat(Y);return U?new ao(as.float,X,this.pos-N):!0!==this.options.allowBigInt||Number.isSafeInteger(X)?new ao(X>=0?as.uint:as.negint,X,this.pos-N):new ao(X>=0?as.uint:as.negint,BigInt(Y),this.pos-N)}parseString(){if(34!==this.ch())throw Error(`${aN} unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let N=this.pos,O=0;N<this.data.length&&O<65536;N++,O++){let U=this.data[N];if(92===U||U<32||U>=128)break;if(34===U){let U=String.fromCharCode.apply(null,this.data.subarray(this.pos,N));return this.pos=N+1,new ao(as.string,U,O)}}let N=this.pos,O=[],U=()=>{if(this.pos+4>=this.data.length)throw Error(`${aN} unexpected end of unicode escape sequence at position ${this.pos}`);let N=0;for(let O=0;O<4;O++){let O=this.ch();if(O>=48&&O<=57)O-=48;else if(O>=97&&O<=102)O=O-97+10;else if(O>=65&&O<=70)O=O-65+10;else throw Error(`${aN} unexpected unicode escape character at position ${this.pos}`);N=16*N+O,this.pos++}return N},$=()=>{let N,U,$,Y;let X=this.ch(),J=null,Z=X>239?4:X>223?3:X>191?2:1;if(this.pos+Z>this.data.length)throw Error(`${aN} unexpected unicode sequence at position ${this.pos}`);switch(Z){case 1:X<128&&(J=X);break;case 2:(192&(N=this.data[this.pos+1]))==128&&(Y=(31&X)<<6|63&N)>127&&(J=Y);break;case 3:N=this.data[this.pos+1],U=this.data[this.pos+2],(192&N)==128&&(192&U)==128&&(Y=(15&X)<<12|(63&N)<<6|63&U)>2047&&(Y<55296||Y>57343)&&(J=Y);break;case 4:N=this.data[this.pos+1],U=this.data[this.pos+2],$=this.data[this.pos+3],(192&N)==128&&(192&U)==128&&(192&$)==128&&(Y=(15&X)<<18|(63&N)<<12|(63&U)<<6|63&$)>65535&&Y<1114112&&(J=Y)}null===J?(J=65533,Z=1):J>65535&&(J-=65536,O.push(J>>>10&1023|55296),J=56320|1023&J),O.push(J),this.pos+=Z};for(;!this.done();){let Y;let X=this.ch();switch(X){case 92:if(this.pos++,this.done())throw Error(`${aN} unexpected string termination at position ${this.pos}`);switch(Y=this.ch(),this.pos++,Y){case 34:case 39:case 92:case 47:O.push(Y);break;case 98:O.push(8);break;case 116:O.push(9);break;case 110:O.push(10);break;case 102:O.push(12);break;case 114:O.push(13);break;case 117:O.push(U());break;default:throw Error(`${aN} unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new ao(as.string,aA(O),this.pos-N);default:if(X<32)throw Error(`${aN} invalid control character at position ${this.pos}`);X<128?(O.push(X),this.pos++):$()}}throw Error(`${aN} unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new ao(as.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new ao(as.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new ao(as.null,null,4);case 102:return this.expect([102,97,108,115,101]),new ao(as.false,!1,5);case 116:return this.expect([116,114,117,101]),new ao(as.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw Error(`${aN} unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this.pos++,this.skipWhitespace(),new ao(as.break,void 0,1);if(44!==this.ch())throw Error(`${aN} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":if(this.modeStack.pop(),93===this.ch())return this.pos++,this.skipWhitespace(),new ao(as.break,void 0,1);return this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"obj-key":if(125===this.ch())return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new ao(as.break,void 0,1);if(44!==this.ch())throw Error(`${aN} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this.pos++,this.skipWhitespace(),new ao(as.break,void 0,1);let N=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw Error(`${aN} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),N}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw Error(`${aN} unexpected parse state at position ${this.pos}; this shouldn't happen`)}}}function uL(N,O){return O=Object.assign({tokenizer:new uB(N,O)},O),cE(N,O)}let uO={codec:ux,async *walk(N){let O=uN(N);yield*O.Links.map(N=>N.Hash)}},uM={codec:iV,async *walk(){}},uU=42,uF={codec:113,async *walk(N){let O=[],U=[];U[uU]=N=>{if(0!==N[0])throw Error("Invalid CID for CBOR tag 42; expected leading 0x00");let U=iC.decode(N.subarray(1));return O.push(U),U},cE(N,{tags:U}),yield*O}};class uV extends uB{tokenBuffer;constructor(N,O){super(N,O),this.tokenBuffer=[]}done(){return 0===this.tokenBuffer.length&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let N=this._next();if(N.type===as.map){let N=this._next();if(N.type===as.string&&"/"===N.value){let N=this._next();if(N.type===as.string){let O=this._next();if(O.type!==as.break)throw Error("Invalid encoded CID form");return this.tokenBuffer.push(N),new ao(as.tag,42,0)}if(N.type===as.map){let N=this._next();if(N.type===as.string&&"bytes"===N.value){let N=this._next();if(N.type===as.string){for(let N=0;N<2;N++){let N=this._next();if(N.type!==as.break)throw Error("Invalid encoded Bytes form")}let O=rB.decode(`m${N.value}`);return new ao(as.bytes,O,N.value.length)}this.tokenBuffer.push(N)}this.tokenBuffer.push(N)}this.tokenBuffer.push(N)}this.tokenBuffer.push(N)}return N}}let uz={codec:297,async *walk(N){let O=[],U=[];U[uU]=N=>{let U=iC.parse(N);return O.push(U),U},uL(N,{tags:U,tokenizer:new uV(N,{tags:U,allowIndefinite:!0,allowUndefined:!0,allowNaN:!0,allowInfinity:!0,allowBigInt:!0,strict:!1,rejectDuplicateMapKeys:!1})}),yield*O}},u$=[uM,uO,uF,uz],uK="/pin/",uq="/pinned-block/",uj=i1,uW=1;function uH(N){return 0===N.version&&(N=N.toV1()),new nx(`${uK}${N.toString(uj)}`)}class uG{datastore;blockstore;dagWalkers;constructor(N,O,U){this.datastore=N,this.blockstore=O,this.dagWalkers={},[...u$,...U].forEach(N=>{this.dagWalkers[N.codec]=N})}async add(N,O={}){let U=uH(N);if(await this.datastore.has(U))throw Error("Already pinned");let $=Math.round(O.depth??1/0);if($<0)throw Error("Depth must be greater than or equal to 0");let Y=new cO({concurrency:uW});Y.add(async()=>{await this.#e(N,Y,O=>{null==O.pinnedBy.find(O=>n5(O,N.bytes))&&(O.pinCount++,O.pinnedBy.push(N.bytes))},{...O,depth:$})});let X=c_();Y.on("error",N=>{Y.clear(),X.reject(N)}),await Promise.race([Y.onIdle(),X.promise]);let J={depth:$,metadata:O.metadata??{}};return await this.datastore.put(U,cd(J),O),{cid:N,...J}}async #e(N,O,U,$){if(-1===$.depth)return;let Y=this.dagWalkers[N.code];if(null==Y)throw Error(`No dag walker found for cid codec ${N.code}`);let X=await this.blockstore.get(N,$);for await(let J of(await this.#t(N,U,$),Y.walk(X)))O.add(async()=>{await this.#e(J,O,U,{...$,depth:$.depth-1})})}async #t(N,O,U){let $=new nx(`${uq}${uj.encode(N.multihash.bytes)}`),Y={pinCount:0,pinnedBy:[]};try{Y=cE(await this.datastore.get($,U))}catch(N){if("ERR_NOT_FOUND"!==N.code)throw N}if(O(Y),0===Y.pinCount&&await this.datastore.has($)){await this.datastore.delete($);return}await this.datastore.put($,cd(Y),U),U.onProgress?.(new oN("helia:pin:add",{detail:N}))}async rm(N,O={}){let U=uH(N),$=await this.datastore.get(U,O),Y=cE($);await this.datastore.delete(U,O);let X=new cO({concurrency:uW});return X.add(async()=>{await this.#e(N,X,O=>{O.pinCount--,O.pinnedBy=O.pinnedBy.filter(O=>n5(O,N.bytes))},{...O,depth:Y.depth})}),await X.onIdle(),{cid:N,...Y}}async *ls(N={}){for await(let{key:O,value:U}of this.datastore.query({prefix:uK+(null!=N.cid?`${N.cid.toString(i1)}`:"")},N)){let N=iC.parse(O.toString().substring(5),i1),$=cE(U);yield{cid:N,...$}}}async isPinned(N,O={}){let U=new nx(`${uq}${uj.encode(N.multihash.bytes)}`);return this.datastore.has(U,O)}}class uQ extends Error{constructor(N){super(N),this.name="TimeoutError"}}class uY extends Error{constructor(N){super(),this.name="AbortError",this.message=N}}let uX=N=>void 0===globalThis.DOMException?new uY(N):new DOMException(N),uJ=N=>{let O=void 0===N.reason?uX("This operation was aborted."):N.reason;return O instanceof Error?O:uX(O)};function uZ(N,O){let U;let{milliseconds:$,fallback:Y,message:X,customTimers:J={setTimeout,clearTimeout}}=O,Z=new Promise((Z,en)=>{if("number"!=typeof $||1!==Math.sign($))throw TypeError(`Expected \`milliseconds\` to be a positive number, got \`${$}\``);if(O.signal){let{signal:N}=O;N.aborted&&en(uJ(N)),N.addEventListener("abort",()=>{en(uJ(N))})}if($===Number.POSITIVE_INFINITY){N.then(Z,en);return}let es=new uQ;U=J.setTimeout.call(void 0,()=>{if(Y){try{Z(Y())}catch(N){en(N)}return}"function"==typeof N.cancel&&N.cancel(),!1===X?Z():X instanceof Error?en(X):(es.message=X??`Promise timed out after ${$} milliseconds`,en(es))},$),(async()=>{try{Z(await N)}catch(N){en(N)}})()}),en=Z.finally(()=>{en.clear()});return en.clear=()=>{J.clearTimeout.call(void 0,U),U=void 0},en}let u3="lock:worker:request-read",u5="lock:worker:release-read",u6="lock:master:grant-read",u7="lock:worker:request-write",u9="lock:worker:release-write",he="lock:master:grant-write",ht={},hr=N=>{N.addEventListener("message",O=>{hr.dispatchEvent("message",N,O)}),null!=N.port&&N.port.addEventListener("message",O=>{hr.dispatchEvent("message",N,O)})};hr.addEventListener=(N,O)=>{null==ht[N]&&(ht[N]=[]),ht[N].push(O)},hr.removeEventListener=(N,O)=>{null!=ht[N]&&(ht[N]=ht[N].filter(N=>N===O))},hr.dispatchEvent=function(N,O,U){null!=ht[N]&&ht[N].forEach(N=>N(O,U))};var hn=hr;let ho=(N,O,U,$,Y)=>(X,J)=>{if(J.data.type!==U)return;let Z={type:J.data.type,name:J.data.name,identifier:J.data.identifier};N.dispatchEvent(new MessageEvent(O,{data:{name:Z.name,handler:async()=>(X.postMessage({type:Y,name:Z.name,identifier:Z.identifier}),await new Promise(N=>{let O=U=>{if(null==U||null==U.data)return;let Y={type:U.data.type,name:U.data.name,identifier:U.data.identifier};Y.type===$&&Y.identifier===Z.identifier&&(X.removeEventListener("message",O),N())};X.addEventListener("message",O)}))}}))},ha=(N,O,U,$)=>async()=>{let Y=iW();return globalThis.postMessage({type:O,identifier:Y,name:N}),await new Promise(O=>{let X=J=>{if(null==J||null==J.data)return;let Z={type:J.data.type,identifier:J.data.identifier};Z.type===U&&Z.identifier===Y&&(globalThis.removeEventListener("message",X),O(()=>{globalThis.postMessage({type:$,identifier:Y,name:N})}))};globalThis.addEventListener("message",X)})},hl={singleProcess:!1};var hc=N=>{N=Object.assign({},hl,N);let O=!!globalThis.document||N.singleProcess;if(O){let N=new EventTarget;return hn.addEventListener("message",ho(N,"requestReadLock",u3,u5,u6)),hn.addEventListener("message",ho(N,"requestWriteLock",u7,u9,he)),N}return{isWorker:!0,readLock:N=>ha(N,u3,u6,u5),writeLock:N=>ha(N,u7,he,u9)}};let hu={};async function hd(N,O){let U;let $=new Promise(N=>{U=N});return N.add(async()=>await uZ((async()=>await new Promise(N=>{U(()=>{N()})}))(),{milliseconds:O.timeout})),await $}let hp=(N,O)=>{let U;if(!0===$.isWorker)return{readLock:$.readLock(N,O),writeLock:$.writeLock(N,O)};let Y=new cO({concurrency:1});return{async readLock(){if(null!=U)return await hd(U,O);U=new cO({concurrency:O.concurrency,autoStart:!1});let N=U,$=hd(U,O);return Y.add(async()=>(N.start(),await N.onIdle().then(()=>{U===N&&(U=null)}))),await $},writeLock:async()=>(U=null,await hd(Y,O))}},hf={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function hg(N){let O=Object.assign({},hf,N);return null==$&&!0!==($=hc(O)).isWorker&&($.addEventListener("requestReadLock",N=>{null!=hu[N.data.name]&&hu[N.data.name].readLock().then(async O=>await N.data.handler().finally(()=>O()))}),$.addEventListener("requestWriteLock",async N=>{null!=hu[N.data.name]&&hu[N.data.name].writeLock().then(async O=>await N.data.handler().finally(()=>O()))})),null==hu[O.name]&&(hu[O.name]=hp(O.name,O)),hu[O.name]}class hy{lock;child;pins;constructor(N,O,U={}){this.child=N,this.pins=O,this.lock=hg({singleProcess:U.holdGcLock})}unwrap(){return this.child}async put(N,O,U={}){let $=await this.lock.readLock();try{return await this.child.put(N,O,U)}finally{$()}}async *putMany(N,O={}){let U=await this.lock.readLock();try{yield*this.child.putMany(N,O)}finally{U()}}async get(N,O={}){let U=await this.lock.readLock();try{return await this.child.get(N,O)}finally{U()}}async *getMany(N,O={}){let U=await this.lock.readLock();try{yield*this.child.getMany(N,O)}finally{U()}}async delete(N,O={}){let U=await this.lock.writeLock();try{if(await this.pins.isPinned(N))throw Error("CID was pinned");await this.child.delete(N,O)}finally{U()}}async *deleteMany(N,O={}){let U=await this.lock.writeLock();try{let U=this;yield*this.child.deleteMany(async function*(){for await(let O of N){if(await U.pins.isPinned(O))throw Error("CID was pinned");yield O}}(),O)}finally{U()}}async has(N,O={}){let U=await this.lock.readLock();try{return await this.child.has(N,O)}finally{U()}}async *getAll(N={}){let O=await this.lock.readLock();try{yield*this.child.getAll(N)}finally{O()}}}let hm=new nx("/version"),hb=1;async function hw(N){if(!await N.has(hm)){await N.put(hm,nD(`${hb}`));return}let O=await N.get(hm),U=nA(O),$=parseInt(U,10);if($!==hb)throw Error("Unknown datastore version, a datastore migration may be required")}class hv{child;bitswap;constructor(N,O={}){this.child=N,this.bitswap=O.bitswap}unwrap(){return this.child}async put(N,O,U={}){return await this.child.has(N)?(U.onProgress?.(new oN("blocks:put:duplicate",N)),N):(!0===this.bitswap?.isStarted()&&(U.onProgress?.(new oN("blocks:put:bitswap:notify",N)),this.bitswap.notify(N,O,U)),U.onProgress?.(new oN("blocks:put:blockstore:put",N)),this.child.put(N,O,U))}async *putMany(N,O={}){let U=nz(N,async({cid:N})=>{let U=await this.child.has(N);return U&&O.onProgress?.(new oN("blocks:put-many:duplicate",N)),!U}),$=nJ(U,({cid:N,block:U})=>{O.onProgress?.(new oN("blocks:put-many:bitswap:notify",N)),this.bitswap?.notify(N,U,O)});O.onProgress?.(new oN("blocks:put-many:blockstore:put-many")),yield*this.child.putMany($,O)}async get(N,O={}){if(!0!==O.offline&&null!=this.bitswap?.isStarted()&&!await this.child.has(N)){O.onProgress?.(new oN("blocks:get:bitswap:get",N));let U=await this.bitswap.want(N,O);return O.onProgress?.(new oN("blocks:get:blockstore:put",N)),await this.child.put(N,U,O),U}return O.onProgress?.(new oN("blocks:get:blockstore:get",N)),this.child.get(N,O)}async *getMany(N,O={}){O.onProgress?.(new oN("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(nJ(N,async N=>{if(!0!==O.offline&&!0===this.bitswap?.isStarted()&&!await this.child.has(N)){O.onProgress?.(new oN("blocks:get-many:bitswap:get",N));let U=await this.bitswap.want(N,O);O.onProgress?.(new oN("blocks:get-many:blockstore:put",N)),await this.child.put(N,U,O)}}))}async delete(N,O={}){O.onProgress?.(new oN("blocks:delete:blockstore:delete",N)),await this.child.delete(N,O)}async *deleteMany(N,O={}){O.onProgress?.(new oN("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(let O of N)yield O}(),O)}async has(N,O={}){return this.child.has(N,O)}async *getAll(N={}){N.onProgress?.(new oN("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(N)}}let hE=rF("helia");class h_{libp2p;blockstore;datastore;pins;#r;constructor(N){let O=[nr,ni,nh,...N.hashers??[]];this.#r=o7(N.libp2p,N.blockstore,{hashLoader:{getHasher:async N=>{let U=O.find(O=>O.code===N||O.name===N);if(null!=U)return U;throw Error(`Could not load hasher for code/name "${N}"`)}}});let U=new hv(N.blockstore,{bitswap:this.#r});this.pins=new uG(N.datastore,U,N.dagWalkers??[]),this.libp2p=N.libp2p,this.blockstore=new hy(U,this.pins,{holdGcLock:N.holdGcLock}),this.datastore=N.datastore}async start(){await hw(this.datastore),await this.#r?.start(),await this.libp2p.start()}async stop(){await this.libp2p.stop(),await this.#r?.stop()}async gc(N={}){let O=await this.blockstore.lock.writeLock();try{let O=this,U=this.blockstore.unwrap();hE("gc start"),await nU(U.deleteMany(async function*(){for await(let{cid:$}of U.getAll())try{if(await O.pins.isPinned($,N))continue;yield $,N.onProgress?.(new oN("helia:gc:deleted",$))}catch(O){hE.error("Error during gc",O),N.onProgress?.(new oN("helia:gc:error",O))}}()))}finally{O()}hE("gc finished")}}U(3068),U(7450);var hS=U(3832),hI=U(7420),hR=U.t(hI,2);/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */let hk=BigInt(0),hD=BigInt(1),hA=BigInt(2),hT=BigInt(8),hC=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),hP=Object.freeze({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l:hC,n:hC,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")}),hx=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000"),hN=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");let hB=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),hL=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),hO=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),hM=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class hU{constructor(N,O,U,$){this.x=N,this.y=O,this.z=U,this.t=$}static fromAffine(N){if(!(N instanceof hW))throw TypeError("ExtendedPoint#fromAffine: expected Point");return N.equals(hW.ZERO)?hU.ZERO:new hU(N.x,N.y,hD,dn(N.x*N.y))}static toAffineBatch(N){let O=dl(N.map(N=>N.z));return N.map((N,U)=>N.toAffine(O[U]))}static normalizeZ(N){return this.toAffineBatch(N).map(this.fromAffine)}equals(N){hV(N);let{x:O,y:U,z:$}=this,{x:Y,y:X,z:J}=N,Z=dn(O*J),en=dn(Y*$),es=dn(U*J),eo=dn(X*$);return Z===en&&es===eo}negate(){return new hU(dn(-this.x),this.y,this.z,dn(-this.t))}double(){let{x:N,y:O,z:U}=this,{a:$}=hP,Y=dn(N*N),X=dn(O*O),J=dn(hA*dn(U*U)),Z=dn($*Y),en=N+O,es=dn(dn(en*en)-Y-X),eo=Z+X,ea=eo-J,ec=Z-X,eu=dn(es*ea),eh=dn(eo*ec),ef=dn(es*ec),eg=dn(ea*eo);return new hU(eu,eh,eg,ef)}add(N){hV(N);let{x:O,y:U,z:$,t:Y}=this,{x:X,y:J,z:Z,t:en}=N,es=dn((U-O)*(J+X)),eo=dn((U+O)*(J-X)),ea=dn(eo-es);if(ea===hk)return this.double();let ec=dn($*hA*en),eu=dn(Y*hA*Z),eh=eu+ec,ef=eo+es,eg=eu-ec,ey=dn(eh*ea),ew=dn(ef*eg),ev=dn(eh*eg),eE=dn(ea*ef);return new hU(ey,ew,eE,ev)}subtract(N){return this.add(N.negate())}precomputeWindow(N){let O=1+256/N,U=[],$=this,Y=$;for(let X=0;X<O;X++){Y=$,U.push(Y);for(let O=1;O<2**(N-1);O++)Y=Y.add($),U.push(Y);$=Y.double()}return U}wNAF(N,O){!O&&this.equals(hU.BASE)&&(O=hW.BASE);let U=O&&O._WINDOW_SIZE||1;if(256%U)throw Error("Point#wNAF: Invalid precomputation window, must be power of 2");let $=O&&hj.get(O);!$&&($=this.precomputeWindow(U),O&&1!==U&&($=hU.normalizeZ($),hj.set(O,$)));let Y=hU.ZERO,X=hU.BASE,J=1+256/U,Z=2**(U-1),en=BigInt(2**U-1),es=2**U,eo=BigInt(U);for(let O=0;O<J;O++){let U=O*Z,J=Number(N&en);N>>=eo,J>Z&&(J-=es,N+=hD);let ea=U,ec=U+Math.abs(J)-1,eu=O%2!=0,eh=J<0;0===J?X=X.add(hF(eu,$[ea])):Y=Y.add(hF(eh,$[ec]))}return hU.normalizeZ([Y,X])[0]}multiply(N,O){return this.wNAF(dy(N,hP.l),O)}multiplyUnsafe(N){let O=dy(N,hP.l,!1),U=hU.BASE,$=hU.ZERO;if(O===hk)return $;if(this.equals($)||O===hD)return this;if(this.equals(U))return this.wNAF(O);let Y=$,X=this;for(;O>hk;)O&hD&&(Y=Y.add(X)),X=X.double(),O>>=hD;return Y}isSmallOrder(){return this.multiplyUnsafe(hP.h).equals(hU.ZERO)}isTorsionFree(){let N=this.multiplyUnsafe(hP.l/hA).double();return hP.l%hA&&(N=N.add(this)),N.equals(hU.ZERO)}toAffine(N){let{x:O,y:U,z:$}=this,Y=this.equals(hU.ZERO);null==N&&(N=Y?hT:da($));let X=dn(O*N),J=dn(U*N),Z=dn($*N);if(Y)return hW.ZERO;if(Z!==hD)throw Error("invZ was invalid");return new hW(X,J)}fromRistrettoBytes(){hK()}toRistrettoBytes(){hK()}fromRistrettoHash(){hK()}}function hF(N,O){let U=O.negate();return N?U:O}function hV(N){if(!(N instanceof hU))throw TypeError("ExtendedPoint expected")}function h$(N){if(!(N instanceof hq))throw TypeError("RistrettoPoint expected")}function hK(){throw Error("Legacy method: switch to RistrettoPoint")}hU.BASE=new hU(hP.Gx,hP.Gy,hD,dn(hP.Gx*hP.Gy)),hU.ZERO=new hU(hk,hD,hD,hk);class hq{constructor(N){this.ep=N}static calcElligatorRistrettoMap(N){let{d:O}=hP,U=dn(hN*N*N),$=dn((U+hD)*hO),Y=BigInt(-1),X=dn((Y-O*U)*dn(U+O)),{isValid:J,value:Z}=dh($,X),en=dn(Z*N);de(en)||(en=dn(-en)),J||(Z=en),J||(Y=U);let es=dn(Y*(U-hD)*hM-X),eo=Z*Z,ea=dn((Z+Z)*X),ec=dn(es*hB),eu=dn(hD-eo),eh=dn(hD+eo);return new hU(dn(ea*eh),dn(eu*ec),dn(ec*eh),dn(ea*eu))}static hashToCurve(N){N=dg(N,64);let O=di(N.slice(0,32)),U=this.calcElligatorRistrettoMap(O),$=di(N.slice(32,64)),Y=this.calcElligatorRistrettoMap($);return new hq(U.add(Y))}static fromHex(N){N=dg(N,32);let{a:O,d:U}=hP,$="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",Y=di(N);if(!df(hZ(Y),N)||de(Y))throw Error($);let X=dn(Y*Y),J=dn(hD+O*X),Z=dn(hD-O*X),en=dn(J*J),es=dn(Z*Z),eo=dn(O*U*en-es),{isValid:ea,value:ec}=dd(dn(eo*es)),eu=dn(ec*Z),eh=dn(ec*eu*eo),ef=dn((Y+Y)*eu);de(ef)&&(ef=dn(-ef));let eg=dn(J*eh),ey=dn(ef*eg);if(!ea||de(ey)||eg===hk)throw Error($);return new hq(new hU(ef,eg,hD,ey))}toRawBytes(){let N,{x:O,y:U,z:$,t:Y}=this.ep,X=dn(dn($+U)*dn($-U)),J=dn(O*U),Z=dn(J*J),{value:en}=dd(dn(X*Z)),es=dn(en*X),eo=dn(en*J),ea=dn(es*eo*Y);if(de(Y*ea)){let $=dn(U*hN),Y=dn(O*hN);O=$,U=Y,N=dn(es*hL)}else N=eo;de(O*ea)&&(U=dn(-U));let ec=dn(($-U)*N);return de(ec)&&(ec=dn(-ec)),hZ(ec)}toHex(){return hY(this.toRawBytes())}toString(){return this.toHex()}equals(N){h$(N);let O=this.ep,U=N.ep,$=dn(O.x*U.y)===dn(O.y*U.x),Y=dn(O.y*U.y)===dn(O.x*U.x);return $||Y}add(N){return h$(N),new hq(this.ep.add(N.ep))}subtract(N){return h$(N),new hq(this.ep.subtract(N.ep))}multiply(N){return new hq(this.ep.multiply(N))}multiplyUnsafe(N){return new hq(this.ep.multiplyUnsafe(N))}}hq.BASE=new hq(hU.BASE),hq.ZERO=new hq(hU.ZERO);let hj=new WeakMap;class hW{constructor(N,O){this.x=N,this.y=O}_setWindowSize(N){this._WINDOW_SIZE=N,hj.delete(this)}static fromHex(N,O=!0){let{d:U,P:$}=hP;N=dg(N,32);let Y=N.slice();Y[31]=-129&N[31];let X=dt(Y);if(O&&X>=$)throw Error("Expected 0 < hex < P");if(!O&&X>=hx)throw Error("Expected 0 < hex < 2**256");let J=dn(X*X),Z=dn(J-hD),en=dn(U*J+hD),{isValid:es,value:eo}=dh(Z,en);if(!es)throw Error("Point.fromHex: invalid y coordinate");let ea=(eo&hD)===hD,ec=(128&N[31])!=0;return ec!==ea&&(eo=dn(-eo)),new hW(eo,X)}static async fromPrivateKey(N){return(await d_(N)).point}toRawBytes(){let N=hZ(this.y);return N[31]|=this.x&hD?128:0,N}toHex(){return hY(this.toRawBytes())}toX25519(){let{y:N}=this,O=dn((hD+N)*da(hD-N));return hZ(O)}isTorsionFree(){return hU.fromAffine(this).isTorsionFree()}equals(N){return this.x===N.x&&this.y===N.y}negate(){return new hW(dn(-this.x),this.y)}add(N){return hU.fromAffine(this).add(hU.fromAffine(N)).toAffine()}subtract(N){return this.add(N.negate())}multiply(N){return hU.fromAffine(this).multiply(N,this).toAffine()}}hW.BASE=new hW(hP.Gx,hP.Gy),hW.ZERO=new hW(hk,hD);class hH{constructor(N,O){this.r=N,this.s=O,this.assertValidity()}static fromHex(N){let O=dg(N,64),U=hW.fromHex(O.slice(0,32),!1),$=dt(O.slice(32,64));return new hH(U,$)}assertValidity(){let{r:N,s:O}=this;if(!(N instanceof hW))throw Error("Expected Point instance");return dy(O,hP.l,!1),this}toRawBytes(){let N=new Uint8Array(64);return N.set(this.r.toRawBytes()),N.set(hZ(this.s),32),N}toHex(){return hY(this.toRawBytes())}}function hG(...N){if(!N.every(N=>N instanceof Uint8Array))throw Error("Expected Uint8Array list");if(1===N.length)return N[0];let O=N.reduce((N,O)=>N+O.length,0),U=new Uint8Array(O);for(let O=0,$=0;O<N.length;O++){let Y=N[O];U.set(Y,$),$+=Y.length}return U}let hQ=Array.from({length:256},(N,O)=>O.toString(16).padStart(2,"0"));function hY(N){if(!(N instanceof Uint8Array))throw Error("Uint8Array expected");let O="";for(let U=0;U<N.length;U++)O+=hQ[N[U]];return O}function hX(N){if("string"!=typeof N)throw TypeError("hexToBytes: expected string, got "+typeof N);if(N.length%2)throw Error("hexToBytes: received invalid unpadded hex");let O=new Uint8Array(N.length/2);for(let U=0;U<O.length;U++){let $=2*U,Y=N.slice($,$+2),X=Number.parseInt(Y,16);if(Number.isNaN(X)||X<0)throw Error("Invalid byte sequence");O[U]=X}return O}function hJ(N){let O=32,U=N.toString(16).padStart(2*O,"0");return hX(U)}function hZ(N){return hJ(N).reverse()}function de(N){return(dn(N)&hD)===hD}function dt(N){if(!(N instanceof Uint8Array))throw Error("Expected Uint8Array");return BigInt("0x"+hY(Uint8Array.from(N).reverse()))}let dr=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function di(N){return dn(dt(N)&dr)}function dn(N,O=hP.P){let U=N%O;return U>=hk?U:O+U}function da(N,O=hP.P){if(N===hk||O<=hk)throw Error(`invert: expected positive integers, got n=${N} mod=${O}`);let U=dn(N,O),$=O,Y=hk,X=hD,J=hD,Z=hk;for(;U!==hk;){let N=$/U,O=$%U,en=Y-J*N,es=X-Z*N;$=U,U=O,Y=J,X=Z,J=en,Z=es}let en=$;if(en!==hD)throw Error("invert: does not exist");return dn(Y,O)}function dl(N,O=hP.P){let U=Array(N.length),$=N.reduce((N,$,Y)=>$===hk?N:(U[Y]=N,dn(N*$,O)),hD),Y=da($,O);return N.reduceRight((N,$,Y)=>$===hk?N:(U[Y]=dn(N*U[Y],O),dn(N*$,O)),Y),U}function dc(N,O){let{P:U}=hP,$=N;for(;O-- >hk;)$*=$,$%=U;return $}function du(N){let{P:O}=hP,U=BigInt(5),$=BigInt(10),Y=BigInt(20),X=BigInt(40),J=BigInt(80),Z=N*N%O,en=Z*N%O,es=dc(en,hA)*en%O,eo=dc(es,hD)*N%O,ea=dc(eo,U)*eo%O,ec=dc(ea,$)*ea%O,eu=dc(ec,Y)*ec%O,eh=dc(eu,X)*eu%O,ef=dc(eh,J)*eh%O,eg=dc(ef,J)*eh%O,ey=dc(eg,$)*ea%O,ew=dc(ey,hA)*N%O;return{pow_p_5_8:ew,b2:en}}function dh(N,O){let U=dn(O*O*O),$=dn(U*U*O),Y=du(N*$).pow_p_5_8,X=dn(N*U*Y),J=dn(O*X*X),Z=X,en=dn(X*hN),es=J===N,eo=J===dn(-N),ea=J===dn(-N*hN);return es&&(X=Z),(eo||ea)&&(X=en),de(X)&&(X=dn(-X)),{isValid:es||eo,value:X}}function dd(N){return dh(hD,N)}function dp(N){return dn(dt(N),hP.l)}function df(N,O){if(N.length!==O.length)return!1;for(let U=0;U<N.length;U++)if(N[U]!==O[U])return!1;return!0}function dg(N,O){let U=N instanceof Uint8Array?Uint8Array.from(N):hX(N);if("number"==typeof O&&U.length!==O)throw Error(`Expected ${O} bytes`);return U}function dy(N,O,U=!0){if(!O)throw TypeError("Specify max value");if("number"==typeof N&&Number.isSafeInteger(N)&&(N=BigInt(N)),"bigint"==typeof N&&N<O){if(U){if(hk<N)return N}else if(hk<=N)return N}throw TypeError("Expected valid scalar: 0 < scalar < max")}function dm(N){return N[0]&=248,N[31]&=127,N[31]|=64,N}function dw(N){return dt(dm(dg(N,32)))}function dv(N){if(32!==(N="bigint"==typeof N||"number"==typeof N?hJ(dy(N,hx)):dg(N)).length)throw Error("Expected 32 bytes");return N}function dE(N){let O=dm(N.slice(0,32)),U=N.slice(32,64),$=dp(O),Y=hW.BASE.multiply($),X=Y.toRawBytes();return{head:O,prefix:U,scalar:$,point:Y,pointBytes:X}}async function d_(N){return dE(await dO.sha512(dv(N)))}async function dS(N){return(await d_(N)).pointBytes}async function dI(N,O){N=dg(N);let{prefix:U,scalar:$,pointBytes:Y}=await d_(O),X=dp(await dO.sha512(U,N)),J=hW.BASE.multiply(X),Z=dp(await dO.sha512(J.toRawBytes(),Y,N)),en=dn(X+Z*$,hP.l);return new hH(J,en).toRawBytes()}function dR(N,O,U){O=dg(O),U instanceof hW||(U=hW.fromHex(U,!1));let{r:$,s:Y}=N instanceof hH?N.assertValidity():hH.fromHex(N),X=hU.BASE.multiplyUnsafe(Y);return{r:$,s:Y,SB:X,pub:U,msg:O}}function dD(N,O,U,$){let Y=dp($),X=hU.fromAffine(N).multiplyUnsafe(Y),J=hU.fromAffine(O).add(X);return J.subtract(U).multiplyUnsafe(hP.h).equals(hU.ZERO)}async function dA(N,O,U){let{r:$,SB:Y,msg:X,pub:J}=dR(N,O,U),Z=await dO.sha512($.toRawBytes(),J.toRawBytes(),X);return dD(J,$,Y,Z)}function dT(N,O,U){let $=dn(N*(O-U));return[O=dn(O-$),U=dn(U+$)]}function dC(N,O){let U;let{P:$}=hP,Y=dy(N,$),X=dy(O,$),J=BigInt(121665),Z=Y,en=hD,es=hk,eo=Y,ea=hD,ec=hk;for(let N=BigInt(254);N>=hk;N--){let O=X>>N&hD;ec^=O,en=(U=dT(ec,en,eo))[0],eo=U[1],es=(U=dT(ec,es,ea))[0],ea=U[1],ec=O;let $=en+es,Y=dn($*$),eu=en-es,eh=dn(eu*eu),ef=Y-eh,eg=eo+ea,ey=eo-ea,ew=dn(ey*$),ev=dn(eg*eu),eE=ew+ev,e_=ew-ev;eo=dn(eE*eE),ea=dn(Z*dn(e_*e_)),en=dn(Y*eh),es=dn(ef*(Y+dn(J*ef)))}en=(U=dT(ec,en,eo))[0],eo=U[1],es=(U=dT(ec,es,ea))[0],ea=U[1];let{pow_p_5_8:eu,b2:eh}=du(es),ef=dn(dc(eu,BigInt(3))*eh);return dn(en*ef)}function dx(N){return hZ(dn(N,hP.P))}function dN(N){let O=dg(N,32);return O[31]&=127,dt(O)}hW.BASE._setWindowSize(8);let dB={BASE_POINT_U:"0900000000000000000000000000000000000000000000000000000000000000",scalarMult(N,O){let U=dN(O),$=dw(N),Y=dC(U,$);if(Y===hk)throw Error("Invalid private or public key received");return dx(Y)},scalarMultBase:N=>dB.scalarMult(N,dB.BASE_POINT_U)},dL={node:hR,web:"object"==typeof self&&"crypto"in self?self.crypto:void 0},dO={bytesToHex:hY,hexToBytes:hX,concatBytes:hG,getExtendedPublicKey:d_,mod:dn,invert:da,TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],hashToPrivateScalar:N=>{if((N=dg(N)).length<40||N.length>1024)throw Error("Expected 40-1024 bytes of private key as per FIPS 186");return dn(dt(N),hP.l-hD)+hD},randomBytes:(N=32)=>{if(dL.web)return dL.web.getRandomValues(new Uint8Array(N));if(dL.node){let{randomBytes:O}=dL.node;return new Uint8Array(O(N).buffer)}throw Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>dO.randomBytes(32),sha512:async(...N)=>{let O=hG(...N);if(dL.web){let N=await dL.web.subtle.digest("SHA-512",O.buffer);return new Uint8Array(N)}if(dL.node)return Uint8Array.from(dL.node.createHash("sha512").update(O).digest());throw Error("The environment doesn't have sha512 function")},precompute(N=8,O=hW.BASE){let U=O.equals(hW.BASE)?O:new hW(O.x,O.y);return U._setWindowSize(N),U.multiply(hA),U},sha512Sync:void 0};Object.defineProperties(dO,{sha512Sync:{configurable:!1,get:()=>Y,set(N){Y||(Y=N)}}});let dM=32,dU=64,dF=32;async function dV(){let N=dO.randomPrivateKey(),O=await dS(N),U=dq(N,O);return{privateKey:U,publicKey:O}}async function dz(N){if(N.length!==dF)throw TypeError('"seed" must be 32 bytes in length.');if(!(N instanceof Uint8Array))throw TypeError('"seed" must be a node.js Buffer, or Uint8Array.');let O=N,U=await dS(O),$=dq(O,U);return{privateKey:$,publicKey:U}}async function d$(N,O){let U=N.subarray(0,dF);return dI(O,U)}async function dK(N,O,U){return dA(O,U,N)}function dq(N,O){let U=new Uint8Array(dU);for(let $=0;$<dF;$++)U[$]=N[$],U[dF+$]=O[$];return U}var dj={get(N=globalThis){let O=N.crypto;if(null==O||null==O.subtle)throw Object.assign(Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return O}};let dW={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function dH(N){let O=N?.algorithm??"AES-GCM",U=N?.keyLength??16,$=N?.nonceLength??12,Y=N?.digest??"SHA-256",X=N?.saltLength??16,J=N?.iterations??32767,Z=dj.get();async function en(N,en){let es;let eo=Z.getRandomValues(new Uint8Array(X)),ea=Z.getRandomValues(new Uint8Array($)),ec={name:O,iv:ea};if("string"==typeof en&&(en=nD(en)),0===en.length){es=await Z.subtle.importKey("jwk",dW,{name:"AES-GCM"},!0,["encrypt"]);try{let N={name:"PBKDF2",salt:eo,iterations:J,hash:{name:Y}},$=await Z.subtle.importKey("raw",en,{name:"PBKDF2"},!1,["deriveKey"]);es=await Z.subtle.deriveKey(N,$,{name:O,length:U},!0,["encrypt"])}catch{es=await Z.subtle.importKey("jwk",dW,{name:"AES-GCM"},!0,["encrypt"])}}else{let N={name:"PBKDF2",salt:eo,iterations:J,hash:{name:Y}},$=await Z.subtle.importKey("raw",en,{name:"PBKDF2"},!1,["deriveKey"]);es=await Z.subtle.deriveKey(N,$,{name:O,length:U},!0,["encrypt"])}let eu=await Z.subtle.encrypt(ec,es,N);return sQ([eo,ec.iv,new Uint8Array(eu)])}async function es(N,en){let es;let eo=N.subarray(0,X),ea=N.subarray(X,X+$),ec=N.subarray(X+$),eu={name:O,iv:ea};if("string"==typeof en&&(en=nD(en)),0===en.length)try{let N={name:"PBKDF2",salt:eo,iterations:J,hash:{name:Y}},$=await Z.subtle.importKey("raw",en,{name:"PBKDF2"},!1,["deriveKey"]);es=await Z.subtle.deriveKey(N,$,{name:O,length:U},!0,["decrypt"])}catch{es=await Z.subtle.importKey("jwk",dW,{name:"AES-GCM"},!0,["decrypt"])}else{let N={name:"PBKDF2",salt:eo,iterations:J,hash:{name:Y}},$=await Z.subtle.importKey("raw",en,{name:"PBKDF2"},!1,["deriveKey"]);es=await Z.subtle.deriveKey(N,$,{name:O,length:U},!0,["decrypt"])}let eh=await Z.subtle.decrypt(eu,es,ec);return new Uint8Array(eh)}U*=8;let eo={encrypt:en,decrypt:es};return eo}async function dG(N,O){let U=dH(),$=await U.encrypt(N,O);return rB.encode($)}!function(N){N.RSA="RSA",N.Ed25519="Ed25519",N.Secp256k1="Secp256k1"}(eV||(eV={})),function(N){N[N.RSA=0]="RSA",N[N.Ed25519=1]="Ed25519",N[N.Secp256k1=2]="Secp256k1"}(ez||(ez={})),function(N){N.codec=()=>sv(ez)}(eV||(eV={})),function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),null!=N.Type&&(O.uint32(8),eV.codec().encode(N.Type,O)),null!=N.Data&&(O.uint32(18),O.bytes(N.Data)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.Type=eV.codec().decode(N);break;case 2:U.Data=N.bytes();break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(e$||(e$={})),function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),null!=N.Type&&(O.uint32(8),eV.codec().encode(N.Type,O)),null!=N.Data&&(O.uint32(18),O.bytes(N.Data)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.Type=eV.codec().decode(N);break;case 2:U.Data=N.bytes();break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(eK||(eK={}));class dY{_key;constructor(N){this._key=pn(N,dM)}async verify(N,O){return dK(this._key,O,N)}marshal(){return this._key}get bytes(){return e$.encode({Type:eV.Ed25519,Data:this.marshal()}).subarray()}equals(N){return n5(this.bytes,N.bytes)}async hash(){let{bytes:N}=await nr.digest(this.bytes);return N}}class dX{_key;_publicKey;constructor(N,O){this._key=pn(N,dU),this._publicKey=pn(O,dM)}async sign(N){return d$(this._key,N)}get public(){return new dY(this._publicKey)}marshal(){return this._key}get bytes(){return eK.encode({Type:eV.Ed25519,Data:this.marshal()}).subarray()}equals(N){return n5(this.bytes,N.bytes)}async hash(){let{bytes:N}=await nr.digest(this.bytes);return N}async id(){let N=nh.digest(this.public.bytes);return rS.encode(N.bytes).substring(1)}async export(N,O="libp2p-key"){if("libp2p-key"===O)return dG(this.bytes,N);throw new n3(`export format '${O}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function dJ(N){if(N.length>dU){N=pn(N,dU+dM);let O=N.subarray(0,dU),U=N.subarray(dU,N.length);return new dX(O,U)}N=pn(N,dU);let O=N.subarray(0,dU),U=N.subarray(dM);return new dX(O,U)}function dZ(N){return N=pn(N,dM),new dY(N)}async function pe(){let{privateKey:N,publicKey:O}=await dV();return new dX(N,O)}async function pr(N){let{privateKey:O,publicKey:U}=await dz(N);return new dX(O,U)}function pn(N,O){if((N=Uint8Array.from(N??[])).length!==O)throw new n3(`Key must be a Uint8Array of length ${O}, got ${N.length}`,"ERR_INVALID_KEY_TYPE");return N}var ps=U(7116);function po(N,O){let U=Uint8Array.from(N.abs().toByteArray());if(U=0===U[0]?U.subarray(1):U,null!=O){if(U.length>O)throw Error("byte array longer than desired length");U=sQ([new Uint8Array(O-U.length),U])}return nA(U,"base64url")}function pa(N){let O=pl(N);return new hS.jsbn.BigInteger(nA(O,"base16"),16)}function pl(N,O){let U=nD(N,"base64urlpad");if(null!=O){if(U.length>O)throw Error("byte array longer than desired length");U=sQ([new Uint8Array(O-U.length),U])}return U}U(5764);let ph={"P-256":256,"P-384":384,"P-521":521},pp=Object.keys(ph);async function pf(N,O){let U=rB.decode(N),$=dH();return $.decrypt(U,O)}pp.join(" / "),U(3219);var pg=U(5856),py=U.t(pg,2);/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */let pw=BigInt(0),pv=BigInt(1),pE=BigInt(2),p_=BigInt(3),pS=BigInt(8),pI=Object.freeze({a:pw,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:pv,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),pR=(N,O)=>(N+O/pE)/O,pD={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(N){let{n:O}=pI,U=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),$=-pv*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),Y=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),X=U,J=BigInt("0x100000000000000000000000000000000"),Z=pR(X*N,O),en=pR(-$*N,O),es=ft(N-Z*U-en*Y,O),eo=ft(-Z*$-en*X,O),ea=es>J,ec=eo>J;if(ea&&(es=O-es),ec&&(eo=O-eo),es>J||eo>J)throw Error("splitScalarEndo: Endomorphism failed, k="+N);return{k1neg:ea,k1:es,k2neg:ec,k2:eo}}},pA=32,pT=32,pC=32,pP=pA+1,pN=2*pA+1;function pB(N){let{a:O,b:U}=pI,$=ft(N*N),Y=ft($*N);return ft(Y+O*N+U)}let pL=pI.a===pw;class pO extends Error{constructor(N){super(N)}}function pM(N){if(!(N instanceof pU))throw TypeError("JacobianPoint expected")}class pU{constructor(N,O,U){this.x=N,this.y=O,this.z=U}static fromAffine(N){if(!(N instanceof pz))throw TypeError("JacobianPoint#fromAffine: expected Point");return N.equals(pz.ZERO)?pU.ZERO:new pU(N.x,N.y,pv)}static toAffineBatch(N){let O=fo(N.map(N=>N.z));return N.map((N,U)=>N.toAffine(O[U]))}static normalizeZ(N){return pU.toAffineBatch(N).map(pU.fromAffine)}equals(N){pM(N);let{x:O,y:U,z:$}=this,{x:Y,y:X,z:J}=N,Z=ft($*$),en=ft(J*J),es=ft(O*en),eo=ft(Y*Z),ea=ft(ft(U*J)*en),ec=ft(ft(X*$)*Z);return es===eo&&ea===ec}negate(){return new pU(this.x,ft(-this.y),this.z)}double(){let{x:N,y:O,z:U}=this,$=ft(N*N),Y=ft(O*O),X=ft(Y*Y),J=N+Y,Z=ft(pE*(ft(J*J)-$-X)),en=ft(p_*$),es=ft(en*en),eo=ft(es-pE*Z),ea=ft(en*(Z-eo)-pS*X),ec=ft(pE*O*U);return new pU(eo,ea,ec)}add(N){pM(N);let{x:O,y:U,z:$}=this,{x:Y,y:X,z:J}=N;if(Y===pw||X===pw)return this;if(O===pw||U===pw)return N;let Z=ft($*$),en=ft(J*J),es=ft(O*en),eo=ft(Y*Z),ea=ft(ft(U*J)*en),ec=ft(ft(X*$)*Z),eu=ft(eo-es),eh=ft(ec-ea);if(eu===pw)return eh===pw?this.double():pU.ZERO;let ef=ft(eu*eu),eg=ft(eu*ef),ey=ft(es*ef),ew=ft(eh*eh-eg-pE*ey),ev=ft(eh*(ey-ew)-ea*eg),eE=ft($*J*eu);return new pU(ew,ev,eE)}subtract(N){return this.add(N.negate())}multiplyUnsafe(N){let O=pU.ZERO;if("bigint"==typeof N&&N===pw)return O;let U=fe(N);if(U===pv)return this;if(!pL){let N=O,$=this;for(;U>pw;)U&pv&&(N=N.add($)),$=$.double(),U>>=pv;return N}let{k1neg:$,k1:Y,k2neg:X,k2:J}=pD.splitScalar(U),Z=O,en=O,es=this;for(;Y>pw||J>pw;)Y&pv&&(Z=Z.add(es)),J&pv&&(en=en.add(es)),es=es.double(),Y>>=pv,J>>=pv;return $&&(Z=Z.negate()),X&&(en=en.negate()),en=new pU(ft(en.x*pD.beta),en.y,en.z),Z.add(en)}precomputeWindow(N){let O=pL?128/N+1:256/N+1,U=[],$=this,Y=$;for(let X=0;X<O;X++){Y=$,U.push(Y);for(let O=1;O<2**(N-1);O++)Y=Y.add($),U.push(Y);$=Y.double()}return U}wNAF(N,O){!O&&this.equals(pU.BASE)&&(O=pz.BASE);let U=O&&O._WINDOW_SIZE||1;if(256%U)throw Error("Point#wNAF: Invalid precomputation window, must be power of 2");let $=O&&pV.get(O);!$&&($=this.precomputeWindow(U),O&&1!==U&&($=pU.normalizeZ($),pV.set(O,$)));let Y=pU.ZERO,X=pU.BASE,J=1+(pL?128/U:256/U),Z=2**(U-1),en=BigInt(2**U-1),es=2**U,eo=BigInt(U);for(let O=0;O<J;O++){let U=O*Z,J=Number(N&en);N>>=eo,J>Z&&(J-=es,N+=pv);let ea=U,ec=U+Math.abs(J)-1,eu=O%2!=0,eh=J<0;0===J?X=X.add(pF(eu,$[ea])):Y=Y.add(pF(eh,$[ec]))}return{p:Y,f:X}}multiply(N,O){let U,$,Y=fe(N);if(pL){let{k1neg:N,k1:X,k2neg:J,k2:Z}=pD.splitScalar(Y),{p:en,f:es}=this.wNAF(X,O),{p:eo,f:ea}=this.wNAF(Z,O);en=pF(N,en),eo=pF(J,eo),eo=new pU(ft(eo.x*pD.beta),eo.y,eo.z),U=en.add(eo),$=es.add(ea)}else{let{p:N,f:X}=this.wNAF(Y,O);U=N,$=X}return pU.normalizeZ([U,$])[0]}toAffine(N){let{x:O,y:U,z:$}=this,Y=this.equals(pU.ZERO);null==N&&(N=Y?pS:fs($));let X=N,J=ft(X*X),Z=ft(J*X),en=ft(O*J),es=ft(U*Z),eo=ft($*X);if(Y)return pz.ZERO;if(eo!==pv)throw Error("invZ was invalid");return new pz(en,es)}}function pF(N,O){let U=O.negate();return N?U:O}pU.BASE=new pU(pI.Gx,pI.Gy,pv),pU.ZERO=new pU(pw,pv,pw);let pV=new WeakMap;class pz{constructor(N,O){this.x=N,this.y=O}_setWindowSize(N){this._WINDOW_SIZE=N,pV.delete(this)}hasEvenY(){return this.y%pE===pw}static fromCompressedHex(N){let O=32===N.length,U=p8(O?N:N.subarray(1));if(!fh(U))throw Error("Point is not on curve");let $=pB(U),Y=fi($),X=(Y&pv)===pv;if(O)X&&(Y=ft(-Y));else{let O=(1&N[0])==1;O!==X&&(Y=ft(-Y))}let J=new pz(U,Y);return J.assertValidity(),J}static fromUncompressedHex(N){let O=p8(N.subarray(1,pA+1)),U=p8(N.subarray(pA+1,2*pA+1)),$=new pz(O,U);return $.assertValidity(),$}static fromHex(N){let O=p9(N),U=O.length,$=O[0];if(U===pA||U===pP&&(2===$||3===$))return this.fromCompressedHex(O);if(U===pN&&4===$)return this.fromUncompressedHex(O);throw Error(`Point.fromHex: received invalid point. Expected 32-${pP} compressed bytes or ${pN} uncompressed bytes, not ${U}`)}static fromPrivateKey(N){return pz.BASE.multiply(fp(N))}static fromSignature(N,O,U){let{r:$,s:Y}=fg(O);if(![0,1,2,3].includes(U))throw Error("Cannot recover: invalid recovery bit");let X=fl(p9(N)),{n:J}=pI,Z=2===U||3===U?$+J:$,en=fs(Z,J),es=ft(-X*en,J),eo=ft(Y*en,J),ea=1&U?"03":"02",ec=pz.fromHex(ea+pY(Z)),eu=pz.BASE.multiplyAndAddUnsafe(ec,es,eo);if(!eu)throw Error("Cannot recover signature: point at infinify");return eu.assertValidity(),eu}toRawBytes(N=!1){return p0(this.toHex(N))}toHex(N=!1){let O=pY(this.x);if(!N)return`04${O}${pY(this.y)}`;{let N=this.hasEvenY()?"02":"03";return`${N}${O}`}}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){let N="Point is not on elliptic curve",{x:O,y:U}=this;if(!fh(O)||!fh(U))throw Error(N);let $=ft(U*U),Y=pB(O);if(ft($-Y)!==pw)throw Error(N)}equals(N){return this.x===N.x&&this.y===N.y}negate(){return new pz(this.x,ft(-this.y))}double(){return pU.fromAffine(this).double().toAffine()}add(N){return pU.fromAffine(this).add(pU.fromAffine(N)).toAffine()}subtract(N){return this.add(N.negate())}multiply(N){return pU.fromAffine(this).multiply(N,this).toAffine()}multiplyAndAddUnsafe(N,O,U){let $=pU.fromAffine(this),Y=O===pw||O===pv||this!==pz.BASE?$.multiplyUnsafe(O):$.multiply(O),X=pU.fromAffine(N).multiplyUnsafe(U),J=Y.add(X);return J.equals(pU.ZERO)?void 0:J.toAffine()}}function p$(N){return Number.parseInt(N[0],16)>=8?"00"+N:N}function pK(N){if(N.length<2||2!==N[0])throw Error(`Invalid signature integer tag: ${pG(N)}`);let O=N[1],U=N.subarray(2,O+2);if(!O||U.length!==O)throw Error("Invalid signature integer: wrong length");if(0===U[0]&&U[1]<=127)throw Error("Invalid signature integer: trailing length");return{data:p8(U),left:N.subarray(O+2)}}function pq(N){if(N.length<2||48!=N[0])throw Error(`Invalid signature tag: ${pG(N)}`);if(N[1]!==N.length-2)throw Error("Invalid signature: incorrect length");let{data:O,left:U}=pK(N.subarray(2)),{data:$,left:Y}=pK(U);if(Y.length)throw Error(`Invalid signature: left bytes after parsing: ${pG(Y)}`);return{r:O,s:$}}pz.BASE=new pz(pI.Gx,pI.Gy),pz.ZERO=new pz(pw,pw);class pj{constructor(N,O){this.r=N,this.s=O,this.assertValidity()}static fromCompact(N){let O=N instanceof Uint8Array,U="Signature.fromCompact";if("string"!=typeof N&&!O)throw TypeError(`${U}: Expected string or Uint8Array`);let $=O?pG(N):N;if(128!==$.length)throw Error(`${U}: Expected 64-byte hex`);return new pj(pZ($.slice(0,64)),pZ($.slice(64,128)))}static fromDER(N){let O=N instanceof Uint8Array;if("string"!=typeof N&&!O)throw TypeError("Signature.fromDER: Expected string or Uint8Array");let{r:U,s:$}=pq(O?N:p0(N));return new pj(U,$)}static fromHex(N){return this.fromDER(N)}assertValidity(){let{r:N,s:O}=this;if(!fu(N))throw Error("Invalid Signature: r must be 0 < r < n");if(!fu(O))throw Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){let N=pI.n>>pv;return this.s>N}normalizeS(){return this.hasHighS()?new pj(this.r,ft(-this.s,pI.n)):this}toDERRawBytes(){return p0(this.toDERHex())}toDERHex(){let N=p$(pJ(this.s)),O=p$(pJ(this.r)),U=N.length/2,$=O.length/2,Y=pJ(U),X=pJ($),J=pJ($+U+4);return`30${J}02${X}${O}02${Y}${N}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return p0(this.toCompactHex())}toCompactHex(){return pY(this.r)+pY(this.s)}}function pW(...N){if(!N.every(N=>N instanceof Uint8Array))throw Error("Uint8Array list expected");if(1===N.length)return N[0];let O=N.reduce((N,O)=>N+O.length,0),U=new Uint8Array(O);for(let O=0,$=0;O<N.length;O++){let Y=N[O];U.set(Y,$),$+=Y.length}return U}let pH=Array.from({length:256},(N,O)=>O.toString(16).padStart(2,"0"));function pG(N){if(!(N instanceof Uint8Array))throw Error("Expected Uint8Array");let O="";for(let U=0;U<N.length;U++)O+=pH[N[U]];return O}let pQ=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function pY(N){if("bigint"!=typeof N)throw Error("Expected bigint");if(!(pw<=N&&N<pQ))throw Error("Expected number 0 <= n < 2^256");return N.toString(16).padStart(64,"0")}function pX(N){let O=p0(pY(N));if(32!==O.length)throw Error("Error: expected 32 bytes");return O}function pJ(N){let O=N.toString(16);return 1&O.length?`0${O}`:O}function pZ(N){if("string"!=typeof N)throw TypeError("hexToNumber: expected string, got "+typeof N);return BigInt(`0x${N}`)}function p0(N){if("string"!=typeof N)throw TypeError("hexToBytes: expected string, got "+typeof N);if(N.length%2)throw Error("hexToBytes: received invalid unpadded hex"+N.length);let O=new Uint8Array(N.length/2);for(let U=0;U<O.length;U++){let $=2*U,Y=N.slice($,$+2),X=Number.parseInt(Y,16);if(Number.isNaN(X)||X<0)throw Error("Invalid byte sequence");O[U]=X}return O}function p8(N){return pZ(pG(N))}function p9(N){return N instanceof Uint8Array?Uint8Array.from(N):p0(N)}function fe(N){if("number"==typeof N&&Number.isSafeInteger(N)&&N>0)return BigInt(N);if("bigint"==typeof N&&fu(N))return N;throw TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function ft(N,O=pI.P){let U=N%O;return U>=pw?U:O+U}function fr(N,O){let{P:U}=pI,$=N;for(;O-- >pw;)$*=$,$%=U;return $}function fi(N){let{P:O}=pI,U=BigInt(6),$=BigInt(11),Y=BigInt(22),X=BigInt(23),J=BigInt(44),Z=BigInt(88),en=N*N*N%O,es=en*en*N%O,eo=fr(es,p_)*es%O,ea=fr(eo,p_)*es%O,ec=fr(ea,pE)*en%O,eu=fr(ec,$)*ec%O,eh=fr(eu,Y)*eu%O,ef=fr(eh,J)*eh%O,eg=fr(ef,Z)*ef%O,ey=fr(eg,J)*eh%O,ew=fr(ey,p_)*es%O,ev=fr(ew,X)*eu%O,eE=fr(ev,U)*en%O,e_=fr(eE,pE),eS=e_*e_%O;if(eS!==N)throw Error("Cannot find square root");return e_}function fs(N,O=pI.P){if(N===pw||O<=pw)throw Error(`invert: expected positive integers, got n=${N} mod=${O}`);let U=ft(N,O),$=O,Y=pw,X=pv,J=pv,Z=pw;for(;U!==pw;){let N=$/U,O=$%U,en=Y-J*N,es=X-Z*N;$=U,U=O,Y=J,X=Z,J=en,Z=es}let en=$;if(en!==pv)throw Error("invert: does not exist");return ft(Y,O)}function fo(N,O=pI.P){let U=Array(N.length),$=N.reduce((N,$,Y)=>$===pw?N:(U[Y]=N,ft(N*$,O)),pv),Y=fs($,O);return N.reduceRight((N,$,Y)=>$===pw?N:(U[Y]=ft(N*U[Y],O),ft(N*$,O)),Y),U}function fa(N){let O=8*N.length-8*pT,U=p8(N);return O>0?U>>BigInt(O):U}function fl(N,O=!1){let U=fa(N);if(O)return U;let{n:$}=pI;return U>=$?U-$:U}class fc{constructor(N,O){if(this.hashLen=N,this.qByteLen=O,"number"!=typeof N||N<2)throw Error("hashLen must be a number");if("number"!=typeof O||O<2)throw Error("qByteLen must be a number");this.v=new Uint8Array(N).fill(1),this.k=new Uint8Array(N).fill(0),this.counter=0}hmac(...N){return fD.hmacSha256(this.k,...N)}hmacSync(...N){return J(this.k,...N)}checkSync(){if("function"!=typeof J)throw new pO("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(N=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),N),this.v=await this.hmac(this.v),0!==N.length&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),N),this.v=await this.hmac(this.v))}reseedSync(N=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),N),this.v=this.hmacSync(this.v),0!==N.length&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),N),this.v=this.hmacSync(this.v))}async generate(){this.incr();let N=0,O=[];for(;N<this.qByteLen;){this.v=await this.hmac(this.v);let U=this.v.slice();O.push(U),N+=this.v.length}return pW(...O)}generateSync(){this.checkSync(),this.incr();let N=0,O=[];for(;N<this.qByteLen;){this.v=this.hmacSync(this.v);let U=this.v.slice();O.push(U),N+=this.v.length}return pW(...O)}}function fu(N){return pw<N&&N<pI.n}function fh(N){return pw<N&&N<pI.P}function fd(N,O,U,$=!0){let{n:Y}=pI,X=fl(N,!0);if(!fu(X))return;let J=fs(X,Y),Z=pz.BASE.multiply(X),en=ft(Z.x,Y);if(en===pw)return;let es=ft(J*ft(O+U*en,Y),Y);if(es===pw)return;let eo=new pj(en,es),ea=(Z.x===eo.r?0:2)|Number(Z.y&pv);return $&&eo.hasHighS()&&(eo=eo.normalizeS(),ea^=1),{sig:eo,recovery:ea}}function fp(N){let O;if("bigint"==typeof N)O=N;else if("number"==typeof N&&Number.isSafeInteger(N)&&N>0)O=BigInt(N);else if("string"==typeof N){if(N.length!==2*pT)throw Error("Expected 32 bytes of private key");O=pZ(N)}else if(N instanceof Uint8Array){if(N.length!==pT)throw Error("Expected 32 bytes of private key");O=p8(N)}else throw TypeError("Expected valid private key");if(!fu(O))throw Error("Expected private key: 0 < key < n");return O}function ff(N){return N instanceof pz?(N.assertValidity(),N):pz.fromHex(N)}function fg(N){if(N instanceof pj)return N.assertValidity(),N;try{return pj.fromDER(N)}catch(O){return pj.fromCompact(N)}}function fy(N,O=!1){return pz.fromPrivateKey(N).toRawBytes(O)}function fm(N){let O=N.length>pA?N.slice(0,pA):N;return p8(O)}function fb(N){let O=fm(N),U=ft(O,pI.n);return fw(U<pw?O:U)}function fw(N){return pX(N)}function fv(N,O,U){if(null==N)throw Error(`sign: expected valid message hash, not "${N}"`);let $=p9(N),Y=fp(O),X=[fw(Y),fb($)];if(null!=U){!0===U&&(U=fD.randomBytes(pA));let N=p9(U);if(N.length!==pA)throw Error(`sign: Expected ${pA} bytes of extra data`);X.push(N)}let J=pW(...X),Z=fm($);return{seed:J,m:Z,d:Y}}function fE(N,O){let{sig:U,recovery:$}=N,{der:Y,recovered:X}=Object.assign({canonical:!0,der:!0},O),J=Y?U.toDERRawBytes():U.toCompactRawBytes();return X?[J,$]:J}async function f_(N,O,U={}){let $;let{seed:Y,m:X,d:J}=fv(N,O,U.extraEntropy),Z=new fc(pC,pT);for(await Z.reseed(Y);!($=fd(await Z.generate(),X,J,U.canonical));)await Z.reseed();return fE($,U)}let fS={strict:!0};function fI(N,O,U,$=fS){let Y,X;try{Y=fg(N),O=p9(O)}catch(N){return!1}let{r:J,s:Z}=Y;if($.strict&&Y.hasHighS())return!1;let en=fl(O);try{X=ff(U)}catch(N){return!1}let{n:es}=pI,eo=fs(Z,es),ea=ft(en*eo,es),ec=ft(J*eo,es),eu=pz.BASE.multiplyAndAddUnsafe(X,ea,ec);if(!eu)return!1;let eh=ft(eu.x,es);return eh===J}pz.BASE._setWindowSize(8);let fR={node:py,web:"object"==typeof self&&"crypto"in self?self.crypto:void 0},fk={},fD={bytesToHex:pG,hexToBytes:p0,concatBytes:pW,mod:ft,invert:fs,isValidPrivateKey(N){try{return fp(N),!0}catch(N){return!1}},_bigintTo32Bytes:pX,_normalizePrivateKey:fp,hashToPrivateKey:N=>{N=p9(N);let O=pT+8;if(N.length<O||N.length>1024)throw Error("Expected valid bytes of private key as per FIPS 186");let U=ft(p8(N),pI.n-pv)+pv;return pX(U)},randomBytes:(N=32)=>{if(fR.web)return fR.web.getRandomValues(new Uint8Array(N));if(fR.node){let{randomBytes:O}=fR.node;return Uint8Array.from(O(N))}throw Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>fD.hashToPrivateKey(fD.randomBytes(pT+8)),precompute(N=8,O=pz.BASE){let U=O===pz.BASE?O:new pz(O.x,O.y);return U._setWindowSize(N),U.multiply(p_),U},sha256:async(...N)=>{if(fR.web){let O=await fR.web.subtle.digest("SHA-256",pW(...N));return new Uint8Array(O)}if(fR.node){let{createHash:O}=fR.node,U=O("sha256");return N.forEach(N=>U.update(N)),Uint8Array.from(U.digest())}throw Error("The environment doesn't have sha256 function")},hmacSha256:async(N,...O)=>{if(fR.web){let U=await fR.web.subtle.importKey("raw",N,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),$=pW(...O),Y=await fR.web.subtle.sign("HMAC",U,$);return new Uint8Array(Y)}if(fR.node){let{createHmac:U}=fR.node,$=U("sha256",N);return O.forEach(N=>$.update(N)),Uint8Array.from($.digest())}throw Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(N,...O)=>{let U=fk[N];if(void 0===U){let O=await fD.sha256(Uint8Array.from(N,N=>N.charCodeAt(0)));U=pW(O,O),fk[N]=U}return fD.sha256(U,...O)},taggedHashSync:(N,...O)=>{if("function"!=typeof X)throw new pO("sha256Sync is undefined, you need to set it");let U=fk[N];if(void 0===U){let O=X(Uint8Array.from(N,N=>N.charCodeAt(0)));U=pW(O,O),fk[N]=U}return X(U,...O)},_JacobianPoint:pU};function fA(N){if(isNaN(N)||N<=0)throw new n3("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return fD.randomBytes(N)}function fT(N,O){return O.map(O=>pa(N[O]))}function fC(N){return hS.pki.setRsaPrivateKey(...fT(N,["n","e","d","p","q","dp","dq","qi"]))}function fP(N){return hS.pki.setRsaPublicKey(...fT(N,["n","e"]))}function fx(N){let O=hS.asn1.fromDer(nA(N,"ascii")),U=hS.pki.privateKeyFromAsn1(O);return{kty:"RSA",n:po(U.n),e:po(U.e),d:po(U.d),p:po(U.p),q:po(U.q),dp:po(U.dP),dq:po(U.dQ),qi:po(U.qInv),alg:"RS256"}}function fN(N){if(null==N.n||null==N.e||null==N.d||null==N.p||null==N.q||null==N.dp||null==N.dq||null==N.qi)throw new n3("JWK was missing components","ERR_INVALID_PARAMETERS");let O=hS.pki.privateKeyToAsn1({n:pa(N.n),e:pa(N.e),d:pa(N.d),p:pa(N.p),q:pa(N.q),dP:pa(N.dp),dQ:pa(N.dq),qInv:pa(N.qi)});return nD(hS.asn1.toDer(O).getBytes(),"ascii")}function fB(N){let O=hS.asn1.fromDer(nA(N,"ascii")),U=hS.pki.publicKeyFromAsn1(O);return{kty:"RSA",n:po(U.n),e:po(U.e)}}function fL(N){if(null==N.n||null==N.e)throw new n3("JWK was missing components","ERR_INVALID_PARAMETERS");let O=hS.pki.publicKeyToAsn1({n:pa(N.n),e:pa(N.e)});return nD(hS.asn1.toDer(O).getBytes(),"ascii")}async function fO(N){let O=await dj.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:N,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),U=await fV(O);return{privateKey:U[0],publicKey:U[1]}}async function fM(N){let O=await dj.get().subtle.importKey("jwk",N,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),U=[O,await fz(N)],$=await fV({privateKey:U[0],publicKey:U[1]});return{privateKey:$[0],publicKey:$[1]}}async function fU(N,O){let U=await dj.get().subtle.importKey("jwk",N,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),$=await dj.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},U,Uint8Array.from(O));return new Uint8Array($,0,$.byteLength)}async function fF(N,O,U){let $=await dj.get().subtle.importKey("jwk",N,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return dj.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},$,O,U)}async function fV(N){if(null==N.privateKey||null==N.publicKey)throw new n3("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([dj.get().subtle.exportKey("jwk",N.privateKey),dj.get().subtle.exportKey("jwk",N.publicKey)])}async function fz(N){return dj.get().subtle.importKey("jwk",{kty:N.kty,n:N.n,e:N.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function f$(N,O,U,$){let Y=O?fP(N):fC(N),X=nA(Uint8Array.from(U),"ascii"),J=$(X,Y);return nD(J,"ascii")}function fK(N,O){return f$(N,!0,O,(N,O)=>O.encrypt(N))}function fq(N,O){return f$(N,!1,O,(N,O)=>O.decrypt(N))}Object.defineProperties(fD,{sha256Sync:{configurable:!1,get:()=>X,set(N){X||(X=N)}},hmacSha256Sync:{configurable:!1,get:()=>J,set(N){J||(J=N)}}}),U(8095);class fj{_key;constructor(N){this._key=N}async verify(N,O){return fF(this._key,O,N)}marshal(){return fL(this._key)}get bytes(){return e$.encode({Type:eV.RSA,Data:this.marshal()}).subarray()}encrypt(N){return fK(this._key,N)}equals(N){return n5(this.bytes,N.bytes)}async hash(){let{bytes:N}=await nr.digest(this.bytes);return N}}class fW{_key;_publicKey;constructor(N,O){this._key=N,this._publicKey=O}genSecret(){return fA(16)}async sign(N){return fU(this._key,N)}get public(){if(null==this._publicKey)throw new n3("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new fj(this._publicKey)}decrypt(N){return fq(this._key,N)}marshal(){return fN(this._key)}get bytes(){return eK.encode({Type:eV.RSA,Data:this.marshal()}).subarray()}equals(N){return n5(this.bytes,N.bytes)}async hash(){let{bytes:N}=await nr.digest(this.bytes);return N}async id(){let N=await this.public.hash();return nA(N,"base58btc")}async export(N,O="pkcs-8"){if("pkcs-8"===O){let O=new hS.util.ByteBuffer(this.marshal()),U=hS.asn1.fromDer(O),$=hS.pki.privateKeyFromAsn1(U),Y={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return hS.pki.encryptRsaPrivateKey($,N,Y)}if("libp2p-key"===O)return dG(this.bytes,N);throw new n3(`export format '${O}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function fH(N){let O=fx(N),U=await fM(O);return new fW(U.privateKey,U.publicKey)}function fG(N){let O=fB(N);return new fj(O)}async function fQ(N){let O=await fM(N);return new fW(O.privateKey,O.publicKey)}async function fY(N){let O=await fO(N);return new fW(O.privateKey,O.publicKey)}function fX(){return fD.randomPrivateKey()}async function fJ(N,O){let{digest:U}=await nr.digest(O);try{return await f_(U,N)}catch(N){throw new n3(String(N),"ERR_INVALID_INPUT")}}async function fZ(N,O,U){try{let{digest:$}=await nr.digest(U);return fI(O,$,N)}catch(N){throw new n3(String(N),"ERR_INVALID_INPUT")}}function f1(N){let O=pz.fromHex(N).toRawBytes(!0);return O}function f2(N){try{fy(N,!0)}catch(N){throw new n3(String(N),"ERR_INVALID_PRIVATE_KEY")}}function f0(N){try{pz.fromHex(N)}catch(N){throw new n3(String(N),"ERR_INVALID_PUBLIC_KEY")}}function f3(N){try{return fy(N,!0)}catch(N){throw new n3(String(N),"ERR_INVALID_PRIVATE_KEY")}}class f4{_key;constructor(N){f0(N),this._key=N}async verify(N,O){return fZ(this._key,O,N)}marshal(){return f1(this._key)}get bytes(){return e$.encode({Type:eV.Secp256k1,Data:this.marshal()}).subarray()}equals(N){return n5(this.bytes,N.bytes)}async hash(){let{bytes:N}=await nr.digest(this.bytes);return N}}class f5{_key;_publicKey;constructor(N,O){this._key=N,this._publicKey=O??f3(N),f2(this._key),f0(this._publicKey)}async sign(N){return fJ(this._key,N)}get public(){return new f4(this._publicKey)}marshal(){return this._key}get bytes(){return eK.encode({Type:eV.Secp256k1,Data:this.marshal()}).subarray()}equals(N){return n5(this.bytes,N.bytes)}async hash(){let{bytes:N}=await nr.digest(this.bytes);return N}async id(){let N=await this.public.hash();return nA(N,"base58btc")}async export(N,O="libp2p-key"){if("libp2p-key"===O)return dG(this.bytes,N);throw new n3(`export format '${O}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function f6(N){return new f5(N)}function f8(N){return new f4(N)}async function f7(){let N=fX();return new f5(N)}let f9={rsa:rn,ed25519:ri,secp256k1:ro};function ge(N){let O=Object.keys(f9).join(" / ");return new n3(`invalid or unsupported key type ${N}. Must be ${O}`,"ERR_UNSUPPORTED_KEY_TYPE")}function gt(N){if("rsa"===(N=N.toLowerCase())||"ed25519"===N||"secp256k1"===N)return f9[N];throw ge(N)}async function gr(N,O){return gt(N).generateKeyPair(O??2048)}function gi(N){let O=e$.decode(N),U=O.Data??new Uint8Array;switch(O.Type){case eV.RSA:return f9.rsa.unmarshalRsaPublicKey(U);case eV.Ed25519:return f9.ed25519.unmarshalEd25519PublicKey(U);case eV.Secp256k1:return f9.secp256k1.unmarshalSecp256k1PublicKey(U);default:throw ge(O.Type??"RSA")}}function gn(N,O){return gt(O=(O??"rsa").toLowerCase()),N.bytes}async function gs(N){let O=eK.decode(N),U=O.Data??new Uint8Array;switch(O.Type){case eV.RSA:return f9.rsa.unmarshalRsaPrivateKey(U);case eV.Ed25519:return f9.ed25519.unmarshalEd25519PrivateKey(U);case eV.Secp256k1:return f9.secp256k1.unmarshalSecp256k1PrivateKey(U);default:throw ge(O.Type??"RSA")}}function go(N,O){return gt(O=(O??"rsa").toLowerCase()),N.bytes}async function ga(N,O){try{let U=await pf(N,O);return await gs(U)}catch(N){}let U=hS.pki.decryptRsaPrivateKey(N,O);if(null===U)throw new n3("Cannot read the key, most likely the password is wrong or not a RSA key","ERR_CANNOT_DECRYPT_PEM");let $=hS.asn1.toDer(hS.pki.privateKeyToAsn1(U));return $=nD($.getBytes(),"ascii"),f9.rsa.unmarshalRsaPrivateKey($)}let gl=Symbol.for("@libp2p/content-routing"),gc=Symbol.for("@libp2p/peer-discovery"),gu=Symbol.for("@libp2p/peer-routing");class gh extends EventTarget{#i=new Map;listenerCount(N){let O=this.#i.get(N);return null==O?0:O.length}addEventListener(N,O,U){super.addEventListener(N,O,U);let $=this.#i.get(N);null==$&&($=[],this.#i.set(N,$)),$.push({callback:O,once:(!0!==U&&!1!==U&&U?.once)??!1})}removeEventListener(N,O,U){super.removeEventListener(N.toString(),O??null,U);let $=this.#i.get(N);null!=$&&($=$.filter(({callback:N})=>N!==O),this.#i.set(N,$))}dispatchEvent(N){let O=super.dispatchEvent(N),U=this.#i.get(N.type);return null==U||(U=U.filter(({once:N})=>!N),this.#i.set(N.type,U)),O}safeDispatchEvent(N,O){return this.dispatchEvent(new gp(N,O))}}class gd extends Event{detail;constructor(N,O){super(N,O),this.detail=O?.detail}}let gp=globalThis.CustomEvent??gd;U(8925);var gg=U(8960);let gy={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function gm(N,O,U,$,Y){if("sha1"!==Y&&"sha2-256"!==Y&&"sha2-512"!==Y){let N=Object.keys(gy).join(" / ");throw new n3(`Hash '${Y}' is unknown or not supported. Must be ${N}`,"ERR_UNSUPPORTED_HASH_TYPE")}let X=gy[Y],J=gg(N,O,U,$,X);return ps.encode64(J,null)}let gb=Symbol.for("@libp2p/peer-id");function gw(N){return null!=N&&!!N[gb]}let gv=Symbol.for("nodejs.util.inspect.custom"),gE=Object.values(nw).map(N=>N.decoder).reduce((N,O)=>N.or(O),nw.identity.decoder),g_=114,gS=36,gI=37;class gR{type;multihash;privateKey;publicKey;string;constructor(N){this.type=N.type,this.multihash=N.multihash,this.privateKey=N.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[gb]=!0;toString(){return null==this.string&&(this.string=rS.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return iC.createV1(g_,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(N){if(N instanceof Uint8Array)return n5(this.multihash.bytes,N);if("string"==typeof N)return gC(N).equals(this);if(N?.multihash?.bytes!=null)return n5(this.multihash.bytes,N.multihash.bytes);throw Error("not valid Id")}[gv](){return`PeerId(${this.toString()})`}}class gk extends gR{type="RSA";publicKey;constructor(N){super({...N,type:"RSA"}),this.publicKey=N.publicKey}}class gD extends gR{type="Ed25519";publicKey;constructor(N){super({...N,type:"Ed25519"}),this.publicKey=N.multihash.digest}}class gA extends gR{type="secp256k1";publicKey;constructor(N){super({...N,type:"secp256k1"}),this.publicKey=N.multihash.digest}}function gT(N){if("RSA"===N.type)return new gk(N);if("Ed25519"===N.type)return new gD(N);if("secp256k1"===N.type)return new gA(N);throw new n3("Not a PeerId","ERR_INVALID_PARAMETERS")}function gC(N,O){if(O=O??gE,"1"===N.charAt(0)||"Q"===N.charAt(0)){let O=iI(rS.decode(`z${N}`));return N.startsWith("12D")?new gD({multihash:O}):N.startsWith("16U")?new gA({multihash:O}):new gk({multihash:O})}return gP(gE.decode(N))}function gP(N){try{let O=iI(N);if(O.code===nh.code){if(O.digest.length===gS)return new gD({multihash:O});if(O.digest.length===gI)return new gA({multihash:O})}if(O.code===nr.code)return new gk({multihash:O})}catch{return gx(iC.decode(N))}throw Error("Supplied PeerID CID is invalid")}function gx(N){if(null==N||null==N.multihash||null==N.version||1===N.version&&N.code!==g_)throw Error("Supplied PeerID CID is invalid");let O=N.multihash;if(O.code===nr.code)return new gk({multihash:N.multihash});if(O.code===nh.code){if(O.digest.length===gS)return new gD({multihash:N.multihash});if(O.digest.length===gI)return new gA({multihash:N.multihash})}throw Error("Supplied PeerID CID is invalid")}async function gN(N,O){return N.length===gS?new gD({multihash:iS(nh.code,N),privateKey:O}):N.length===gI?new gA({multihash:iS(nh.code,N),privateKey:O}):new gk({multihash:await nr.digest(N),publicKey:N,privateKey:O})}var gB=U(942),gL=U(202);!function(N){N.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",N.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",N.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",N.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",N.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",N.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",N.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",N.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",N.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",N.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",N.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",N.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",N.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",N.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",N.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH"}(eq||(eq={}));let gO=rF("libp2p:keychain"),gM="/pkcs8/",gU="/info/",gF=new WeakMap,gV={minKeyLength:14,minSaltLength:16,minIterationCount:1e3},gz={dek:{keyLength:64,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function g$(N){return null!=N&&"string"==typeof N&&N===gL(N.trim())&&N.length>0}async function gK(){let N=200,O=1e3,U=Math.random()*(O-N)+N;await new Promise(N=>setTimeout(N,U))}function gq(N){return new nx(gM+N)}function gj(N){return new nx(gU+N)}class gW{components;init;constructor(N,O){if(this.components=N,this.init=gB(gz,O),null!=this.init.pass&&this.init.pass?.length<20)throw Error("pass must be least 20 characters");if(this.init.dek?.keyLength!=null&&this.init.dek.keyLength<gV.minKeyLength)throw Error(`dek.keyLength must be least ${gV.minKeyLength} bytes`);if(this.init.dek?.salt?.length!=null&&this.init.dek.salt.length<gV.minSaltLength)throw Error(`dek.saltLength must be least ${gV.minSaltLength} bytes`);if(this.init.dek?.iterationCount!=null&&this.init.dek.iterationCount<gV.minIterationCount)throw Error(`dek.iterationCount must be least ${gV.minIterationCount}`);let U=null!=this.init.pass&&this.init.dek?.salt!=null?gm(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";gF.set(this,{dek:U})}static generateOptions(){let N=Object.assign({},gz),O=3*Math.ceil(gV.minSaltLength/3);return N.dek.salt=nA(fA(O),"base64"),N}static get options(){return gz}async createKey(N,O,U=2048){let $;if(!g$(N)||"self"===N)throw await gK(),new n3("Invalid key name",eq.ERR_INVALID_KEY_NAME);if("string"!=typeof O)throw await gK(),new n3("Invalid key type",eq.ERR_INVALID_KEY_TYPE);let Y=gq(N),X=await this.components.datastore.has(Y);if(X)throw await gK(),new n3("Key name already exists",eq.ERR_KEY_ALREADY_EXISTS);if("rsa"===O.toLowerCase()&&(!Number.isSafeInteger(U)||U<2048))throw await gK(),new n3("Invalid RSA key size",eq.ERR_INVALID_KEY_SIZE);try{let X=await gr(O,U),J=await X.id(),Z=gF.get(this);if(null==Z)throw new n3("dek missing",eq.ERR_INVALID_PARAMETERS);let en=Z.dek,es=await X.export(en);$={name:N,id:J};let eo=this.components.datastore.batch();eo.put(Y,nD(es)),eo.put(gj(N),nD(JSON.stringify($))),await eo.commit()}catch(N){throw await gK(),N}return $}async listKeys(){let N={prefix:gU},O=[];for await(let U of this.components.datastore.query(N))O.push(JSON.parse(nA(U.value)));return O}async findKeyById(N){try{let O=await this.listKeys(),U=O.find(O=>O.id===N);if(null==U)throw new n3(`Key with id '${N}' does not exist.`,eq.ERR_KEY_NOT_FOUND);return U}catch(N){throw await gK(),N}}async findKeyByName(N){if(!g$(N))throw await gK(),new n3(`Invalid key name '${N}'`,eq.ERR_INVALID_KEY_NAME);let O=gj(N);try{let N=await this.components.datastore.get(O);return JSON.parse(nA(N))}catch(O){throw await gK(),gO.error(O),new n3(`Key '${N}' does not exist.`,eq.ERR_KEY_NOT_FOUND)}}async removeKey(N){if(!g$(N)||"self"===N)throw await gK(),new n3(`Invalid key name '${N}'`,eq.ERR_INVALID_KEY_NAME);let O=gq(N),U=await this.findKeyByName(N),$=this.components.datastore.batch();return $.delete(O),$.delete(gj(N)),await $.commit(),U}async renameKey(N,O){if(!g$(N)||"self"===N)throw await gK(),new n3(`Invalid old key name '${N}'`,eq.ERR_OLD_KEY_NAME_INVALID);if(!g$(O)||"self"===O)throw await gK(),new n3(`Invalid new key name '${O}'`,eq.ERR_NEW_KEY_NAME_INVALID);let U=gq(N),$=gq(O),Y=gj(N),X=gj(O),J=await this.components.datastore.has($);if(J)throw await gK(),new n3(`Key '${O}' already exists`,eq.ERR_KEY_ALREADY_EXISTS);try{let N=await this.components.datastore.get(U),J=await this.components.datastore.get(Y),Z=JSON.parse(nA(J));Z.name=O;let en=this.components.datastore.batch();return en.put($,N),en.put(X,nD(JSON.stringify(Z))),en.delete(U),en.delete(Y),await en.commit(),Z}catch(N){throw await gK(),N}}async exportKey(N,O){if(!g$(N))throw await gK(),new n3(`Invalid key name '${N}'`,eq.ERR_INVALID_KEY_NAME);if(null==O)throw await gK(),new n3("Password is required",eq.ERR_PASSWORD_REQUIRED);let U=gq(N);try{let N=await this.components.datastore.get(U),$=nA(N),Y=gF.get(this);if(null==Y)throw new n3("dek missing",eq.ERR_INVALID_PARAMETERS);let X=Y.dek,J=await ga($,X);return await J.export(O)}catch(N){throw await gK(),N}}async exportPeerId(N){let O="temporary-password",U=await this.exportKey(N,O),$=await ga(U,O);return gN($.public.bytes,$.bytes)}async importKey(N,O,U){let $,Y;if(!g$(N)||"self"===N)throw await gK(),new n3(`Invalid key name '${N}'`,eq.ERR_INVALID_KEY_NAME);if(null==O)throw await gK(),new n3("PEM encoded key is required",eq.ERR_PEM_REQUIRED);let X=gq(N),J=await this.components.datastore.has(X);if(J)throw await gK(),new n3(`Key '${N}' already exists`,eq.ERR_KEY_ALREADY_EXISTS);try{$=await ga(O,U)}catch(N){throw await gK(),new n3("Cannot read the key, most likely the password is wrong",eq.ERR_CANNOT_READ_KEY)}try{Y=await $.id();let N=gF.get(this);if(null==N)throw new n3("dek missing",eq.ERR_INVALID_PARAMETERS);let U=N.dek;O=await $.export(U)}catch(N){throw await gK(),N}let Z={name:N,id:Y},en=this.components.datastore.batch();return en.put(X,nD(O)),en.put(gj(N),nD(JSON.stringify(Z))),await en.commit(),Z}async importPeer(N,O){try{if(!g$(N))throw new n3(`Invalid key name '${N}'`,eq.ERR_INVALID_KEY_NAME);if(null==O)throw new n3("PeerId is required",eq.ERR_MISSING_PRIVATE_KEY);if(null==O.privateKey)throw new n3("PeerId.privKey is required",eq.ERR_MISSING_PRIVATE_KEY);let U=await gs(O.privateKey),$=gq(N),Y=await this.components.datastore.has($);if(Y)throw await gK(),new n3(`Key '${N}' already exists`,eq.ERR_KEY_ALREADY_EXISTS);let X=gF.get(this);if(null==X)throw new n3("dek missing",eq.ERR_INVALID_PARAMETERS);let J=X.dek,Z=await U.export(J),en={name:N,id:O.toString()},es=this.components.datastore.batch();return es.put($,nD(Z)),es.put(gj(N),nD(JSON.stringify(en))),await es.commit(),en}catch(N){throw await gK(),N}}async getPrivateKey(N){if(!g$(N))throw await gK(),new n3(`Invalid key name '${N}'`,eq.ERR_INVALID_KEY_NAME);try{let O=gq(N),U=await this.components.datastore.get(O);return nA(U)}catch(O){throw await gK(),gO.error(O),new n3(`Key '${N}' does not exist.`,eq.ERR_KEY_NOT_FOUND)}}async rotateKeychainPass(N,O){if("string"!=typeof N)throw await gK(),new n3(`Invalid old pass type '${typeof N}'`,eq.ERR_INVALID_OLD_PASS_TYPE);if("string"!=typeof O)throw await gK(),new n3(`Invalid new pass type '${typeof O}'`,eq.ERR_INVALID_NEW_PASS_TYPE);if(O.length<20)throw await gK(),new n3(`Invalid pass length ${O.length}`,eq.ERR_INVALID_PASS_LENGTH);gO("recreating keychain");let U=gF.get(this);if(null==U)throw new n3("dek missing",eq.ERR_INVALID_PARAMETERS);let $=U.dek;this.init.pass=O;let Y=null!=O&&this.init.dek?.salt!=null?gm(O,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";gF.set(this,{dek:Y});let X=await this.listKeys();for(let N of X){let O=await this.components.datastore.get(gq(N.name)),U=nA(O),X=await ga(U,$),J=Y.toString(),Z=await X.export(J),en=this.components.datastore.batch(),es={name:N.name,id:N.id};en.put(gq(N.name),nD(Z)),en.put(gj(N.name),nD(JSON.stringify(es))),await en.commit()}gO("keychain reconstructed")}}function gH(N,O){let U={[Symbol.iterator]:()=>U,next:()=>{let U=N.next(),$=U.value;if(!0===U.done||null==$){let N={done:!0,value:void 0};return N}return{done:!1,value:O($)}}};return U}class gG{map;constructor(N){if(this.map=new Map,null!=N)for(let[O,U]of N.entries())this.map.set(O.toString(),U)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(N){this.map.delete(N.toString())}entries(){return gH(this.map.entries(),N=>[gC(N[0]),N[1]])}forEach(N){this.map.forEach((O,U)=>{N(O,gC(U),this)})}get(N){return this.map.get(N.toString())}has(N){return this.map.has(N.toString())}set(N,O){this.map.set(N.toString(),O)}keys(){return gH(this.map.keys(),N=>gC(N))}values(){return this.map.values()}get size(){return this.map.size}}class gQ{set;constructor(N){if(this.set=new Set,null!=N)for(let O of N)this.set.add(O.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(N){this.set.add(N.toString())}clear(){this.set.clear()}delete(N){this.set.delete(N.toString())}entries(){return gH(this.set.entries(),N=>{let O=gC(N[0]);return[O,O]})}forEach(N){this.set.forEach(O=>{let U=gC(O);N(U,U,this)})}has(N){return this.set.has(N.toString())}values(){return gH(this.set.values(),N=>gC(N))}intersection(N){let O=new gQ;for(let U of N)this.has(U)&&O.add(U);return O}difference(N){let O=new gQ;for(let U of this)N.has(U)||O.add(U);return O}union(N){let O=new gQ;for(let U of N)O.add(U);for(let N of this)O.add(N);return O}}class gY{list;constructor(N){if(this.list=[],null!=N)for(let O of N)this.list.push(O.toString())}[Symbol.iterator](){return gH(this.list.entries(),N=>gC(N[1]))}concat(N){let O=new gY(this);for(let U of N)O.push(U);return O}entries(){return gH(this.list.entries(),N=>[N[0],gC(N[1])])}every(N){return this.list.every((O,U)=>N(gC(O),U,this))}filter(N){let O=new gY;return this.list.forEach((U,$)=>{let Y=gC(U);N(Y,$,this)&&O.push(Y)}),O}find(N){let O=this.list.find((O,U)=>N(gC(O),U,this));if(null!=O)return gC(O)}findIndex(N){return this.list.findIndex((O,U)=>N(gC(O),U,this))}forEach(N){this.list.forEach((O,U)=>{N(gC(O),U,this)})}includes(N){return this.list.includes(N.toString())}indexOf(N){return this.list.indexOf(N.toString())}pop(){let N=this.list.pop();if(null!=N)return gC(N)}push(...N){for(let O of N)this.list.push(O.toString())}shift(){let N=this.list.shift();if(null!=N)return gC(N)}unshift(...N){let O=this.list.length;for(let U=N.length-1;U>-1;U--)O=this.list.unshift(N[U].toString());return O}get length(){return this.list.length}}!function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),null!=N.id&&(O.uint32(10),O.bytes(N.id)),null!=N.pubKey&&(O.uint32(18),O.bytes(N.pubKey)),null!=N.privKey&&(O.uint32(26),O.bytes(N.privKey)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.id=N.bytes();break;case 2:U.pubKey=N.bytes();break;case 3:U.privKey=N.bytes();break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(ej||(ej={}));let gX=async()=>{let N=await gr("Ed25519"),O=await gJ(N);if("Ed25519"===O.type)return O;throw Error(`Generated unexpected PeerId type "${O.type}"`)};async function gJ(N){return gN(gn(N.public),go(N))}let gZ={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};!function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),null!=N.publicKey&&N.publicKey.byteLength>0&&(O.uint32(10),O.bytes(N.publicKey)),null!=N.payloadType&&N.payloadType.byteLength>0&&(O.uint32(18),O.bytes(N.payloadType)),null!=N.payload&&N.payload.byteLength>0&&(O.uint32(26),O.bytes(N.payload)),null!=N.signature&&N.signature.byteLength>0&&(O.uint32(42),O.bytes(N.signature)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.publicKey=N.bytes();break;case 2:U.payloadType=N.bytes();break;case 3:U.payload=N.bytes();break;case 5:U.signature=N.bytes();break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(eW||(eW={}));class g1{static createFromProtobuf=async N=>{let O=eW.decode(N),U=await gN(O.publicKey);return new g1({peerId:U,payloadType:O.payloadType,payload:O.payload,signature:O.signature})};static seal=async(N,O)=>{if(null==O.privateKey)throw Error("Missing private key");let U=N.domain,$=N.codec,Y=N.marshal(),X=g0(U,$,Y),J=await gs(O.privateKey),Z=await J.sign(X.subarray());return new g1({peerId:O,payloadType:$,payload:Y,signature:Z})};static openAndCertify=async(N,O)=>{let U=await g1.createFromProtobuf(N),$=await U.validate(O);if(!$)throw new n3("envelope signature is not valid for the given domain",gZ.ERR_SIGNATURE_NOT_VALID);return U};peerId;payloadType;payload;signature;marshaled;constructor(N){let{peerId:O,payloadType:U,payload:$,signature:Y}=N;this.peerId=O,this.payloadType=U,this.payload=$,this.signature=Y}marshal(){if(null==this.peerId.publicKey)throw Error("Missing public key");return null==this.marshaled&&(this.marshaled=eW.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(N){return n5(this.marshal(),N.marshal())}async validate(N){let O=g0(N,this.payloadType,this.payload);if(null==this.peerId.publicKey)throw Error("Missing public key");let U=gi(this.peerId.publicKey);return U.verify(O.subarray(),this.signature)}}let g0=(N,O,U)=>{let $=nD(N),Y=ol.encode($.byteLength),X=ol.encode(O.length),J=ol.encode(U.length);return new sZ(Y,$,X,O,J,U)};function g3(N,O){let U=(N,O)=>N.toString().localeCompare(O.toString());return N.length===O.length&&(O.sort(U),N.sort(U).every((N,U)=>O[U].equals(N)))}class g4{index=0;input="";new(N){return this.index=0,this.input=N,this}readAtomically(N){let O=this.index,U=N();return void 0===U&&(this.index=O),U}parseWith(N){let O=N();if(this.index===this.input.length)return O}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(N){return this.readAtomically(()=>{let O=this.readChar();if(O===N)return O})}readSeparator(N,O,U){return this.readAtomically(()=>{if(!(O>0)||void 0!==this.readGivenChar(N))return U()})}readNumber(N,O,U,$){return this.readAtomically(()=>{let Y=0,X=0,J=this.peekChar();if(void 0===J)return;let Z="0"===J,en=2**(8*$)-1;for(;;){let U=this.readAtomically(()=>{let O=this.readChar();if(void 0===O)return;let U=Number.parseInt(O,N);if(!Number.isNaN(U))return U});if(void 0===U)break;if(Y*=N,(Y+=U)>en||(X+=1,void 0!==O&&X>O))return}return 0===X?void 0:!U&&Z&&X>1?void 0:Y})}readIPv4Addr(){return this.readAtomically(()=>{let N=new Uint8Array(4);for(let O=0;O<N.length;O++){let U=this.readSeparator(".",O,()=>this.readNumber(10,3,!1,1));if(void 0===U)return;N[O]=U}return N})}readIPv6Addr(){let N=N=>{for(let O=0;O<N.length/2;O++){let U=2*O;if(O<N.length-3){let $=this.readSeparator(":",O,()=>this.readIPv4Addr());if(void 0!==$)return N[U]=$[0],N[U+1]=$[1],N[U+2]=$[2],N[U+3]=$[3],[U+4,!0]}let $=this.readSeparator(":",O,()=>this.readNumber(16,4,!0,2));if(void 0===$)return[U,!1];N[U]=$>>8,N[U+1]=255&$}return[N.length,!1]};return this.readAtomically(()=>{let O=new Uint8Array(16),[U,$]=N(O);if(16===U)return O;if($||void 0===this.readGivenChar(":")||void 0===this.readGivenChar(":"))return;let Y=new Uint8Array(14),X=16-(U+2),[J]=N(Y.subarray(0,X));return O.set(Y.subarray(0,J),16-J),O})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}let g5=45,g6=15,g8=new g4;function g7(N){if(!(N.length>g6))return g8.new(N).parseWith(()=>g8.readIPv4Addr())}function g9(N){if(!(N.length>g5))return g8.new(N).parseWith(()=>g8.readIPv6Addr())}function ye(N){if(!(N.length>g5))return g8.new(N).parseWith(()=>g8.readIPAddr())}function yr(N){return!!g7(N)}function yi(N){return!!g9(N)}function yn(N){return!!ye(N)}parseInt("0xFFFF",16),new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);let yo=yr,ya=yi,yl=function(N){let O=0;if(yo(N=N.toString().trim())){let U=new Uint8Array(O+4);return N.split(/\./g).forEach(N=>{U[O++]=255&parseInt(N,10)}),U}if(ya(N)){let U;let $=N.split(":",8);for(U=0;U<$.length;U++){let N;let O=yo($[U]);O&&(N=yl($[U]),$[U]=nA(N.slice(0,2),"base16")),null!=N&&++U<8&&$.splice(U,0,nA(N.slice(2,4),"base16"))}if(""===$[0])for(;$.length<8;)$.unshift("0");else if(""===$[$.length-1])for(;$.length<8;)$.push("0");else if($.length<8){for(U=0;U<$.length&&""!==$[U];U++);let N=[U,1];for(U=9-$.length;U>0;U--)N.push("0");$.splice.apply($,N)}let Y=new Uint8Array(O+16);for(U=0;U<$.length;U++){let N=parseInt($[U],16);Y[O++]=N>>8&255,Y[O++]=255&N}return Y}throw Error("invalid ip address")},yc=function(N,O=0,U){O=~~O,U=U??N.length-O;let $=new DataView(N.buffer);if(4===U){let $=[];for(let Y=0;Y<U;Y++)$.push(N[O+Y]);return $.join(".")}if(16===U){let N=[];for(let Y=0;Y<U;Y+=2)N.push($.getUint16(O+Y).toString(16));return N.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},yu=-1,yh={},yd={},yp=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,yu,"ip6zone"],[43,8,"ipcidr"],[53,yu,"dns",!0],[54,yu,"dns4",!0],[55,yu,"dns6",!0],[56,yu,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,yu,"unix",!1,!0],[421,yu,"ipfs"],[421,yu,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,yu,"garlic64"],[448,0,"tls"],[449,yu,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,yu,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,yu,"memory"]];function yf(N,O,U,$,Y){return{code:N,size:O,name:U,resolvable:!!$,path:!!Y}}function yg(N){if("number"==typeof N){if(null!=yd[N])return yd[N];throw Error(`no protocol with code: ${N}`)}if("string"==typeof N){if(null!=yh[N])return yh[N];throw Error(`no protocol with name: ${N}`)}throw Error(`invalid protocol id type: ${typeof N}`)}function yy(N,O){let U=yg(N);switch(U.code){case 4:case 41:return yE(O);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return yR(O);case 6:case 273:case 33:case 132:return yS(O).toString();case 421:return yT(O);case 444:case 445:return yx(O);case 466:return yA(O);default:return nA(O,"base16")}}function ym(N,O){let U=yg(N);switch(U.code){case 4:case 41:return yv(O);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return yI(O);case 6:case 273:case 33:case 132:return y_(parseInt(O,10));case 421:return yk(O);case 444:return yC(O);case 445:return yP(O);case 466:return yD(O);default:return nD(O,"base16")}}yp.forEach(N=>{let O=yf(...N);yd[O.code]=O,yh[O.name]=O}),yg("ip4"),yg("ip6"),yg("ipcidr");let yb=Object.values(nw).map(N=>N.decoder),yw=function(){let N=yb[0].or(yb[1]);return yb.slice(2).forEach(O=>N=N.or(O)),N}();function yv(N){if(!yn(N))throw Error("invalid ip address");return yl(N)}function yE(N){let O=yc(N,0,N.length);if(null==O)throw Error("ipBuff is required");if(!yn(O))throw Error("invalid ip address");return O}function y_(N){let O=new ArrayBuffer(2),U=new DataView(O);return U.setUint16(0,N),new Uint8Array(O)}function yS(N){let O=new DataView(N.buffer);return O.getUint16(N.byteOffset)}function yI(N){let O=nD(N),U=Uint8Array.from(se.encode(O.length));return sQ([U,O],U.length+O.length)}function yR(N){let O=se.decode(N);if((N=N.slice(se.decode.bytes)).length!==O)throw Error("inconsistent lengths");return nA(N)}function yk(N){let O;O="Q"===N[0]||"1"===N[0]?iI(rS.decode(`z${N}`)).bytes:iC.parse(N).multihash.bytes;let U=Uint8Array.from(se.encode(O.length));return sQ([U,O],U.length+O.length)}function yD(N){let O=yw.decode(N),U=Uint8Array.from(se.encode(O.length));return sQ([U,O],U.length+O.length)}function yA(N){let O=se.decode(N),U=N.slice(se.decode.bytes);if(U.length!==O)throw Error("inconsistent lengths");return"u"+nA(U,"base64url")}function yT(N){let O=se.decode(N),U=N.slice(se.decode.bytes);if(U.length!==O)throw Error("inconsistent lengths");return nA(U,"base58btc")}function yC(N){let O=N.split(":");if(2!==O.length)throw Error(`failed to parse onion addr: ["'${O.join('", "')}'"]' does not contain a port number`);if(16!==O[0].length)throw Error(`failed to parse onion addr: ${O[0]} not a Tor onion address.`);let U=rR.decode("b"+O[0]),$=parseInt(O[1],10);if($<1||$>65536)throw Error("Port number is not in range(1, 65536)");let Y=y_($);return sQ([U,Y],U.length+Y.length)}function yP(N){let O=N.split(":");if(2!==O.length)throw Error(`failed to parse onion addr: ["'${O.join('", "')}'"]' does not contain a port number`);if(56!==O[0].length)throw Error(`failed to parse onion addr: ${O[0]} not a Tor onion3 address.`);let U=rR.decode(`b${O[0]}`),$=parseInt(O[1],10);if($<1||$>65536)throw Error("Port number is not in range(1, 65536)");let Y=y_($);return sQ([U,Y],U.length+Y.length)}function yx(N){let O=N.slice(0,N.length-2),U=N.slice(N.length-2),$=nA(O,"base32"),Y=yS(U);return`${$}:${Y}`}function yN(N){let O=[],U=N.split("/").slice(1);if(1===U.length&&""===U[0])return[];for(let $=0;$<U.length;$++){let Y=U[$],X=yg(Y);if(0===X.size){O.push([Y]);continue}if(++$>=U.length)throw yW("invalid address: "+N);if(!0===X.path){O.push([Y,yj(U.slice($).join("/"))]);break}O.push([Y,U[$]])}return O}function yB(N){let O=[];return N.map(N=>{let U=yH(N);return O.push(U.name),N.length>1&&null!=N[1]&&O.push(N[1]),null}),yj(O.join("/"))}function yL(N){return N.map(N=>{Array.isArray(N)||(N=[N]);let O=yH(N);return N.length>1?[O.code,ym(O.code,N[1])]:[O.code]})}function yO(N){return N.map(N=>{let O=yH(N);return null!=N[1]?[O.code,yy(O.code,N[1])]:[O.code]})}function yM(N){return yK(sQ(N.map(N=>{let O=yH(N),U=Uint8Array.from(se.encode(O.code));return N.length>1&&null!=N[1]&&(U=sQ([U,N[1]])),U})))}function yU(N,O){if(N.size>0)return N.size/8;if(0===N.size)return 0;{let N=se.decode(O);return N+(se.decode.bytes??0)}}function yF(N){let O=[],U=0;for(;U<N.length;){let $=se.decode(N,U),Y=se.decode.bytes??0,X=yg($),J=yU(X,N.slice(U+Y));if(0===J){O.push([$]),U+=Y;continue}let Z=N.slice(U+Y,U+Y+J);if((U+=J+Y)>N.length)throw yW("Invalid address Uint8Array: "+nA(N,"base16"));O.push([$,Z])}return O}function yV(N){let O=yF(N),U=yO(O);return yB(U)}function yz(N){N=yj(N);let O=yN(N),U=yL(O);return yM(U)}function y$(N){return yz(N)}function yK(N){let O=yq(N);if(null!=O)throw O;return Uint8Array.from(N)}function yq(N){try{yF(N)}catch(N){return N}}function yj(N){return"/"+N.trim().split("/").filter(N=>N).join("/")}function yW(N){return Error("Error parsing address: "+N)}function yH(N){let O=yg(N[0]);return O}let yG=Symbol.for("nodejs.util.inspect.custom"),yQ=[yg("dns").code,yg("dns4").code,yg("dns6").code,yg("dnsaddr").code],yY=new Map,yX=Symbol.for("@multiformats/js-multiaddr/multiaddr");function yJ(N){return!!N?.[yX]}class yZ{bytes;#n;#s;#o;#a;[yX]=!0;constructor(N){if(null==N&&(N=""),N instanceof Uint8Array)this.bytes=yK(N);else if("string"==typeof N){if(N.length>0&&"/"!==N.charAt(0))throw Error(`multiaddr "${N}" must start with a "/"`);this.bytes=y$(N)}else if(yJ(N))this.bytes=yK(N.bytes);else throw Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return null==this.#n&&(this.#n=yV(this.bytes)),this.#n}toJSON(){return this.toString()}toOptions(){let N,O,U,$;let Y="",X=yg("tcp"),J=yg("udp"),Z=yg("ip4"),en=yg("ip6"),es=yg("dns6"),eo=yg("ip6zone");for(let[ea,ec]of this.stringTuples())ea===eo.code&&(Y=`%${ec??""}`),yQ.includes(ea)&&(O=X.name,$=443,U=`${ec??""}${Y}`,N=ea===es.code?6:4),(ea===X.code||ea===J.code)&&(O=yg(ea).name,$=parseInt(ec??"")),(ea===Z.code||ea===en.code)&&(O=yg(ea).name,U=`${ec??""}${Y}`,N=ea===en.code?6:4);if(null==N||null==O||null==U||null==$)throw Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');let ea={family:N,host:U,transport:O,port:$};return ea}protos(){return this.protoCodes().map(N=>Object.assign({},yg(N)))}protoCodes(){let N=[],O=this.bytes,U=0;for(;U<O.length;){let $=se.decode(O,U),Y=se.decode.bytes??0,X=yg($),J=yU(X,O.slice(U+Y));U+=J+Y,N.push($)}return N}protoNames(){return this.protos().map(N=>N.name)}tuples(){return null==this.#s&&(this.#s=yF(this.bytes)),this.#s}stringTuples(){return null==this.#o&&(this.#o=yO(this.tuples())),this.#o}encapsulate(N){return N=new yZ(N),new yZ(this.toString()+N.toString())}decapsulate(N){let O=N.toString(),U=this.toString(),$=U.lastIndexOf(O);if($<0)throw Error(`Address ${this.toString()} does not contain subaddress: ${N.toString()}`);return new yZ(U.slice(0,$))}decapsulateCode(N){let O=this.tuples();for(let U=O.length-1;U>=0;U--)if(O[U][0]===N)return new yZ(yM(O.slice(0,U)));return this}getPeerId(){try{let N=this.stringTuples().filter(N=>N[0]===yh.ipfs.code),O=N.pop();if(O?.[1]!=null){let N=O[1];if("Q"===N[0]||"1"===N[0])return nA(rS.decode(`z${N}`),"base58btc");return nA(iC.parse(N).multihash.bytes,"base58btc")}return null}catch(N){return null}}getPath(){if(void 0===this.#a)try{this.#a=this.stringTuples().filter(N=>{let O=yg(N[0]);return!0===O.path})[0][1],null==this.#a&&(this.#a=null)}catch{this.#a=null}return this.#a}equals(N){return n5(this.bytes,N.bytes)}async resolve(N){let O=this.protos().find(N=>N.resolvable);if(null==O)return[this];let U=yY.get(O.name);if(null==U)throw new n3(`no available resolver for ${O.name}`,"ERR_NO_AVAILABLE_RESOLVER");let $=await U(this,N);return $.map(N=>new yZ(N))}nodeAddress(){let N=this.toOptions();if("tcp"!==N.transport&&"udp"!==N.transport)throw Error(`multiaddr must have a valid format - no protocol with name: "${N.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:N.family,address:N.host,port:N.port}}isThinWaistAddress(N){let O=(N??this).protos();return 2===O.length&&(4===O[0].code||41===O[0].code)&&(6===O[1].code||273===O[1].code)}[yG](){return`Multiaddr(${yV(this.bytes)})`}}function y1(N){return new yZ(N)}let y3="libp2p-peer-record",y4=Uint8Array.from([3,1]);!function(N){let O,U;!function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),null!=N.multiaddr&&N.multiaddr.byteLength>0&&(O.uint32(10),O.bytes(N.multiaddr)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={multiaddr:new Uint8Array(0)},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();O>>>3==1?U.multiaddr=N.bytes():N.skipType(7&O)}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(O=N.AddressInfo||(N.AddressInfo={})),N.codec=()=>(null==U&&(U=sE((O,U,$={})=>{if(!1!==$.lengthDelimited&&U.fork(),null!=O.peerId&&O.peerId.byteLength>0&&(U.uint32(10),U.bytes(O.peerId)),null!=O.seq&&0n!==O.seq&&(U.uint32(16),U.uint64(O.seq)),null!=O.addresses)for(let $ of O.addresses)U.uint32(26),N.AddressInfo.codec().encode($,U);!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let $={peerId:new Uint8Array(0),seq:0n,addresses:[]},Y=null==U?O.len:O.pos+U;for(;O.pos<Y;){let U=O.uint32();switch(U>>>3){case 1:$.peerId=O.bytes();break;case 2:$.seq=O.uint64();break;case 3:$.addresses.push(N.AddressInfo.codec().decode(O,O.uint32()));break;default:O.skipType(7&U)}}return $})),U),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(eH||(eH={}));class y5{static createFromProtobuf=N=>{let O=eH.decode(N),U=gP(O.peerId),$=(O.addresses??[]).map(N=>y1(N.multiaddr)),Y=O.seq;return new y5({peerId:U,multiaddrs:$,seqNumber:Y})};static DOMAIN=y3;static CODEC=y4;peerId;multiaddrs;seqNumber;domain=y5.DOMAIN;codec=y5.CODEC;marshaled;constructor(N){let{peerId:O,multiaddrs:U,seqNumber:$}=N;this.peerId=O,this.multiaddrs=U??[],this.seqNumber=$??BigInt(Date.now())}marshal(){return null==this.marshaled&&(this.marshaled=eH.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(N=>({multiaddr:N.bytes}))})),this.marshaled}equals(N){return!!(N instanceof y5&&this.peerId.equals(N.peerId)&&this.seqNumber===N.seqNumber&&g3(this.multiaddrs,N.multiaddrs))}}let y6={ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS"};function y8(N,O){let U=eG.decode(O);null!=U.publicKey&&null==N.publicKey&&(N=gT({...N,publicKey:N.publicKey}));let $=new Map,Y=BigInt(Date.now());for(let[N,O]of U.tags.entries())null!=O.expiry&&O.expiry<Y||$.set(N,O);return{...U,id:N,addresses:U.addresses.map(({multiaddr:N,isCertified:O})=>({multiaddr:y1(N),isCertified:O??!1})),metadata:U.metadata,peerRecordEnvelope:U.peerRecordEnvelope??void 0,tags:$}}!function(N){let O,U,$;(function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),null!=N.key&&""!==N.key&&(O.uint32(10),O.string(N.key)),null!=N.value&&N.value.byteLength>0&&(O.uint32(18),O.bytes(N.value)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={key:"",value:new Uint8Array(0)},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.key=N.string();break;case 2:U.value=N.bytes();break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())})(O=N.Peer$metadataEntry||(N.Peer$metadataEntry={})),function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),null!=N.key&&""!==N.key&&(O.uint32(10),O.string(N.key)),null!=N.value&&(O.uint32(18),eY.codec().encode(N.value,O)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={key:""},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.key=N.string();break;case 2:U.value=eY.codec().decode(N,N.uint32());break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(U=N.Peer$tagsEntry||(N.Peer$tagsEntry={})),N.codec=()=>(null==$&&($=sE((O,U,$={})=>{if(!1!==$.lengthDelimited&&U.fork(),null!=O.addresses)for(let N of O.addresses)U.uint32(10),eQ.codec().encode(N,U);if(null!=O.protocols)for(let N of O.protocols)U.uint32(18),U.string(N);if(null!=O.publicKey&&(U.uint32(34),U.bytes(O.publicKey)),null!=O.peerRecordEnvelope&&(U.uint32(42),U.bytes(O.peerRecordEnvelope)),null!=O.metadata&&0!==O.metadata.size)for(let[$,Y]of O.metadata.entries())U.uint32(50),N.Peer$metadataEntry.codec().encode({key:$,value:Y},U);if(null!=O.tags&&0!==O.tags.size)for(let[$,Y]of O.tags.entries())U.uint32(58),N.Peer$tagsEntry.codec().encode({key:$,value:Y},U);!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let $={addresses:[],protocols:[],metadata:new Map,tags:new Map},Y=null==U?O.len:O.pos+U;for(;O.pos<Y;){let U=O.uint32();switch(U>>>3){case 1:$.addresses.push(eQ.codec().decode(O,O.uint32()));break;case 2:$.protocols.push(O.string());break;case 4:$.publicKey=O.bytes();break;case 5:$.peerRecordEnvelope=O.bytes();break;case 6:{let U=N.Peer$metadataEntry.codec().decode(O,O.uint32());$.metadata.set(U.key,U.value);break}case 7:{let U=N.Peer$tagsEntry.codec().decode(O,O.uint32());$.tags.set(U.key,U.value);break}default:O.skipType(7&U)}}return $})),$),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(eG||(eG={})),function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),null!=N.multiaddr&&N.multiaddr.byteLength>0&&(O.uint32(10),O.bytes(N.multiaddr)),null!=N.isCertified&&(O.uint32(16),O.bool(N.isCertified)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={multiaddr:new Uint8Array(0)},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.multiaddr=N.bytes();break;case 2:U.isCertified=N.bool();break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(eQ||(eQ={})),function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),null!=N.value&&0!==N.value&&(O.uint32(8),O.uint32(N.value)),null!=N.expiry&&(O.uint32(16),O.uint64(N.expiry)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={value:0},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.value=N.uint32();break;case 2:U.expiry=N.uint64();break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(eY||(eY={}));let y7="/peers/";function y9(N){if(!gw(N)||null==N.type)throw new n3("Invalid PeerId",y6.ERR_INVALID_PARAMETERS);let O=N.toCID().toString();return new nx(`${y7}${O}`)}async function mt(N,O,U){let $=new Map;for(let Y of U){if(null==Y)continue;if(Y.multiaddr instanceof Uint8Array&&(Y.multiaddr=y1(Y.multiaddr)),!yJ(Y.multiaddr))throw new n3("Multiaddr was invalid",y6.ERR_INVALID_PARAMETERS);if(!await O(N,Y.multiaddr))continue;let U=Y.isCertified??!1,X=Y.multiaddr.toString(),J=$.get(X);null!=J?Y.isCertified=J.isCertified||U:$.set(X,{multiaddr:Y.multiaddr,isCertified:U})}return[...$.values()].sort((N,O)=>N.multiaddr.toString().localeCompare(O.multiaddr.toString())).map(({isCertified:N,multiaddr:O})=>({isCertified:N,multiaddr:O.bytes}))}async function mr(N,O,U,$){if(null==O)throw new n3("Invalid PeerData",y6.ERR_INVALID_PARAMETERS);if(null!=O.publicKey&&null!=N.publicKey&&!n5(O.publicKey,N.publicKey))throw new n3("publicKey bytes do not match peer id publicKey bytes",y6.ERR_INVALID_PARAMETERS);let Y=$.existingPeer;if(null!=Y&&!N.equals(Y.id))throw new n3("peer id did not match existing peer id",y6.ERR_INVALID_PARAMETERS);let X=Y?.addresses??[],J=new Set(Y?.protocols??[]),Z=Y?.metadata??new Map,en=Y?.tags??new Map,es=Y?.peerRecordEnvelope;if("patch"===U){if((null!=O.multiaddrs||null!=O.addresses)&&(X=[],null!=O.multiaddrs&&X.push(...O.multiaddrs.map(N=>({isCertified:!1,multiaddr:N}))),null!=O.addresses&&X.push(...O.addresses)),null!=O.protocols&&(J=new Set(O.protocols)),null!=O.metadata){let N=O.metadata instanceof Map?[...O.metadata.entries()]:Object.entries(O.metadata);Z=mn(N,{validate:mo})}if(null!=O.tags){let N=O.tags instanceof Map?[...O.tags.entries()]:Object.entries(O.tags);en=mn(N,{validate:mc,map:mu})}null!=O.peerRecordEnvelope&&(es=O.peerRecordEnvelope)}if("merge"===U){if(null!=O.multiaddrs&&X.push(...O.multiaddrs.map(N=>({isCertified:!1,multiaddr:N}))),null!=O.addresses&&X.push(...O.addresses),null!=O.protocols&&(J=new Set([...J,...O.protocols])),null!=O.metadata){let N=O.metadata instanceof Map?[...O.metadata.entries()]:Object.entries(O.metadata);for(let[O,U]of N)null==U?Z.delete(O):Z.set(O,U);Z=mn([...Z.entries()],{validate:mo})}if(null!=O.tags){let N=O.tags instanceof Map?[...O.tags.entries()]:Object.entries(O.tags),U=new Map(en);for(let[O,$]of N)null==$?U.delete(O):U.set(O,$);en=mn([...U.entries()],{validate:mc,map:mu})}null!=O.peerRecordEnvelope&&(es=O.peerRecordEnvelope)}let eo={addresses:await mt(N,$.addressFilter??(async()=>!0),X),protocols:[...J.values()].sort((N,O)=>N.localeCompare(O)),metadata:Z,tags:en,publicKey:Y?.id.publicKey??O.publicKey??N.publicKey,peerRecordEnvelope:es};return"RSA"!==N.type&&delete eo.publicKey,eo}function mn(N,O){let U=new Map;for(let[U,$]of N)null!=$&&O.validate(U,$);for(let[$,Y]of N.sort(([N],[O])=>N.localeCompare(O)))null!=Y&&U.set($,O.map?.($,Y)??Y);return U}function mo(N,O){if("string"!=typeof N)throw new n3("Metadata key must be a string",y6.ERR_INVALID_PARAMETERS);if(!(O instanceof Uint8Array))throw new n3("Metadata value must be a Uint8Array",y6.ERR_INVALID_PARAMETERS)}function mc(N,O){if("string"!=typeof N)throw new n3("Tag name must be a string",y6.ERR_INVALID_PARAMETERS);if(null!=O.value){if(parseInt(`${O.value}`,10)!==O.value)throw new n3("Tag value must be an integer",y6.ERR_INVALID_PARAMETERS);if(O.value<0||O.value>100)throw new n3("Tag value must be between 0-100",y6.ERR_INVALID_PARAMETERS)}if(null!=O.ttl){if(parseInt(`${O.ttl}`,10)!==O.ttl)throw new n3("Tag ttl must be an integer",y6.ERR_INVALID_PARAMETERS);if(O.ttl<0)throw new n3("Tag ttl must be between greater than 0",y6.ERR_INVALID_PARAMETERS)}}function mu(N,O){let U;return null!=O.expiry&&(U=O.expiry),null!=O.ttl&&(U=BigInt(Date.now()+Number(O.ttl))),{value:O.value??0,expiry:U}}function mp(N,O,U){let $=N.toString().split("/")[2],Y=rR.decode($),X=gP(Y),J=U.get(X);if(null!=J)return J;let Z=y8(X,O);return U.set(X,Z),Z}function mf(N,O){return null==N?{}:{prefix:y7,filters:(N.filters??[]).map(N=>({key:U,value:$})=>N(mp(U,$,O))),orders:(N.orders??[]).map(N=>(U,$)=>N(mp(U.key,U.value,O),mp($.key,$.value,O)))}}class mg{peerId;datastore;lock;addressFilter;constructor(N,O={}){this.peerId=N.peerId,this.datastore=N.datastore,this.addressFilter=O.addressFilter,this.lock=hg({name:"peer-store",singleProcess:!0})}async has(N){return this.datastore.has(y9(N))}async delete(N){if(this.peerId.equals(N))throw new n3("Cannot delete self peer",y6.ERR_INVALID_PARAMETERS);await this.datastore.delete(y9(N))}async load(N){let O=await this.datastore.get(y9(N));return y8(N,O)}async save(N,O){let{existingBuf:U,existingPeer:$}=await this.#l(N),Y=await mr(N,O,"patch",{addressFilter:this.addressFilter});return this.#c(N,Y,U,$)}async patch(N,O){let{existingBuf:U,existingPeer:$}=await this.#l(N),Y=await mr(N,O,"patch",{addressFilter:this.addressFilter,existingPeer:$});return this.#c(N,Y,U,$)}async merge(N,O){let{existingBuf:U,existingPeer:$}=await this.#l(N),Y=await mr(N,O,"merge",{addressFilter:this.addressFilter,existingPeer:$});return this.#c(N,Y,U,$)}async *all(N){let O=new gG;for await(let{key:U,value:$}of this.datastore.query(mf(N??{},O))){let N=mp(U,$,O);N.id.equals(this.peerId)||(yield N)}}async #l(N){try{let O=await this.datastore.get(y9(N)),U=y8(N,O);return{existingBuf:O,existingPeer:U}}catch(N){if("ERR_NOT_FOUND"!==N.code)throw N}return{}}async #c(N,O,U,$){let Y=eG.encode(O);return null!=U&&n5(Y,U)?{peer:y8(N,Y),previous:$,updated:!1}:(await this.datastore.put(y9(N),Y),{peer:y8(N,Y),previous:$,updated:!0})}}let my=rF("libp2p:peer-store");class mw{store;events;peerId;constructor(N,O={}){this.events=N.events,this.peerId=N.peerId,this.store=new mg(N,O)}async forEach(N,O){my.trace("forEach await read lock");let U=await this.store.lock.readLock();my.trace("forEach got read lock");try{for await(let U of this.store.all(O))N(U)}finally{my.trace("forEach release read lock"),U()}}async all(N){my.trace("all await read lock");let O=await this.store.lock.readLock();my.trace("all got read lock");try{return await nK(this.store.all(N))}finally{my.trace("all release read lock"),O()}}async delete(N){my.trace("delete await write lock");let O=await this.store.lock.writeLock();my.trace("delete got write lock");try{await this.store.delete(N)}finally{my.trace("delete release write lock"),O()}}async has(N){my.trace("has await read lock");let O=await this.store.lock.readLock();my.trace("has got read lock");try{return await this.store.has(N)}finally{my.trace("has release read lock"),O()}}async get(N){my.trace("get await read lock");let O=await this.store.lock.readLock();my.trace("get got read lock");try{return await this.store.load(N)}finally{my.trace("get release read lock"),O()}}async save(N,O){my.trace("save await write lock");let U=await this.store.lock.writeLock();my.trace("save got write lock");try{let U=await this.store.save(N,O);return this.#u(N,U),U.peer}finally{my.trace("save release write lock"),U()}}async patch(N,O){my.trace("patch await write lock");let U=await this.store.lock.writeLock();my.trace("patch got write lock");try{let U=await this.store.patch(N,O);return this.#u(N,U),U.peer}finally{my.trace("patch release write lock"),U()}}async merge(N,O){my.trace("merge await write lock");let U=await this.store.lock.writeLock();my.trace("merge got write lock");try{let U=await this.store.merge(N,O);return this.#u(N,U),U.peer}finally{my.trace("merge release write lock"),U()}}async consumePeerRecord(N,O){let U;let $=await g1.openAndCertify(N,y5.DOMAIN);if(!1===O?.equals($.peerId))return my("envelope peer id was not the expected peer id - expected: %p received: %p",O,$.peerId),!1;let Y=y5.createFromProtobuf($.payload);try{U=await this.get($.peerId)}catch(N){if("ERR_NOT_FOUND"!==N.code)throw N}if(U?.peerRecordEnvelope!=null){let N=await g1.createFromProtobuf(U.peerRecordEnvelope),O=y5.createFromProtobuf(N.payload);if(O.seqNumber>=Y.seqNumber)return my("sequence number was lower or equal to existing sequence number - stored: %d received: %d",O.seqNumber,Y.seqNumber),!1}return await this.patch(Y.peerId,{peerRecordEnvelope:N,addresses:Y.multiaddrs.map(N=>({isCertified:!0,multiaddr:N}))}),!0}#u(N,O){O.updated&&(this.peerId.equals(N)?this.events.safeDispatchEvent("self:peer:update",{detail:O}):this.events.safeDispatchEvent("peer:update",{detail:O}))}}function mv(N,O){let U;return function(){let $=function(){U=void 0,N()};clearTimeout(U),U=setTimeout($,O)}}let mE=rF("libp2p:address-manager"),m_=N=>N;function mS(N,O){let U=N.getPeerId();if(null!=U){let $=gC(U);$.equals(O)&&(N=N.decapsulate(y1(`/p2p/${O.toString()}`)))}return N}class mI{components;listen;announce;observed;announceFilter;constructor(N,O={}){let{listen:U=[],announce:$=[]}=O;this.components=N,this.listen=U.map(N=>N.toString()),this.announce=new Set($.map(N=>N.toString())),this.observed=new Map,this.announceFilter=O.announceFilter??m_,this._updatePeerStoreAddresses=mv(this._updatePeerStoreAddresses.bind(this),1e3),N.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),N.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}_updatePeerStoreAddresses(){let N=this.getAnnounceAddrs().concat(this.components.transportManager.getAddrs()).concat([...this.observed.entries()].filter(([N,O])=>O.confident).map(([N])=>y1(N))).map(N=>N.getPeerId()===this.components.peerId.toString()?N.decapsulate(`/p2p/${this.components.peerId.toString()}`):N);this.components.peerStore.patch(this.components.peerId,{multiaddrs:N}).catch(N=>{mE.error("error updating addresses",N)})}getListenAddrs(){return Array.from(this.listen).map(N=>y1(N))}getAnnounceAddrs(){return Array.from(this.announce).map(N=>y1(N))}getObservedAddrs(){return Array.from(this.observed).map(([N])=>y1(N))}addObservedAddr(N){N=mS(N,this.components.peerId);let O=N.toString();this.observed.has(O)||this.observed.set(O,{confident:!1})}confirmObservedAddr(N){N=mS(N,this.components.peerId);let O=N.toString(),U=this.observed.get(O)??{confident:!1},$=U.confident;this.observed.set(O,{confident:!0}),$||this._updatePeerStoreAddresses()}removeObservedAddr(N){N=mS(N,this.components.peerId);let O=N.toString();this.observed.delete(O)}getAddresses(){let N=this.getAnnounceAddrs().map(N=>N.toString());0===N.length&&(N=this.components.transportManager.getAddrs().map(N=>N.toString())),N=N.concat(Array.from(this.observed).filter(([N,O])=>O.confident).map(([N])=>N));let O=new Set(N);return this.announceFilter(Array.from(O).map(N=>y1(N))).map(N=>N.protos().pop()?.path===!0||N.getPeerId()===this.components.peerId.toString()?N:N.encapsulate(`/p2p/${this.components.peerId.toString()}`))}}function mR(N){return null!=N&&"function"==typeof N.start&&"function"==typeof N.stop}class mk{components={};_started=!1;constructor(N={}){for(let[O,U]of(this.components={},Object.entries(N)))this.components[O]=U}isStarted(){return this._started}async _invokeStartableMethod(N){await Promise.all(Object.values(this.components).filter(N=>mR(N)).map(async O=>{await O[N]?.()}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}let mD=["metrics","connectionProtector"],mA=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function mT(N={}){let O=new mk(N),U=new Proxy(O,{get(N,U,$){if("string"==typeof U&&!mA.includes(U)){let N=O.components[U];if(null==N&&!mD.includes(U))throw new n3(`${U} not set`,"ERR_SERVICE_MISSING");return N}return Reflect.get(N,U,$)},set:(N,U,$)=>("string"==typeof U?O.components[U]=$:Reflect.set(N,U,$),!0)});return U}var mC=U(8951);let mP="[a-fA-F\\d:]",mx=N=>N&&N.includeBoundaries?`(?:(?<=\\s|^)(?=${mP})|(?<=${mP})(?=\\s|$))`:"",mN="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",mB="[a-fA-F\\d]{1,4}",mL=`
(?:
(?:${mB}:){7}(?:${mB}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${mB}:){6}(?:${mN}|:${mB}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${mB}:){5}(?::${mN}|(?::${mB}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${mB}:){4}(?:(?::${mB}){0,1}:${mN}|(?::${mB}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${mB}:){3}(?:(?::${mB}){0,2}:${mN}|(?::${mB}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${mB}:){2}(?:(?::${mB}){0,3}:${mN}|(?::${mB}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${mB}:){1}(?:(?::${mB}){0,4}:${mN}|(?::${mB}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${mB}){0,5}:${mN}|(?::${mB}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),mO=RegExp(`(?:^${mN}$)|(?:^${mL}$)`),mM=RegExp(`^${mN}$`),mU=RegExp(`^${mL}$`),mF=N=>N&&N.exact?mO:RegExp(`(?:${mx(N)}${mN}${mx(N)})|(?:${mx(N)}${mL}${mx(N)})`,"g");mF.v4=N=>N&&N.exact?mM:RegExp(`${mx(N)}${mN}${mx(N)}`,"g"),mF.v6=N=>N&&N.exact?mU:RegExp(`${mx(N)}${mL}${mx(N)}`,"g");var mV=mF,mz=U(6512);let{isValid:m$,parse:mK}=mz,mj=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],mW=mj.map(N=>new mC.Netmask(N));function mH(N){for(let O of mW)if(O.contains(N))return!0;return!1}function mG(N){return/^::$/.test(N)||/^::1$/.test(N)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(N)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(N)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(N)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(N)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(N)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(N)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(N)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(N)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(N)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(N)||/^ff([0-9a-fA-F]{2,2}):/i.test(N)}var mQ=N=>{if(m$(N)){let O=mK(N);if("ipv4"===O.kind())return mH(O.toNormalizedString());if("ipv6"===O.kind())return mG(N)}else if(yn(N)&&mV.v6().test(N))return mG(N)};function mY(N={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async N=>{let O=N.stringTuples();return(4===O[0][0]||41===O[0][0])&&!!mQ(`${O[0][1]}`)},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...N}}let mX=Symbol.for("@libp2p/transport");function mJ(N){try{let{address:O}=N.nodeAddress();return!!mQ(O)}catch{return!0}}function mZ(N,O){let U=mJ(N.multiaddr),$=mJ(O.multiaddr);return U&&!$?1:!U&&$?-1:N.isCertified&&!O.isCertified?-1:!N.isCertified&&O.isCertified?1:0}!function(N){N[N.FATAL_ALL=0]="FATAL_ALL",N[N.NO_FATAL=1]="NO_FATAL"}(eX||(eX={}));var m4=U(3692);let m5=globalThis.fetch,m6=globalThis.Headers;function m8(N,O,U){return`${N}?name=${O}&type=${U}`}async function m7(N,O){let U=await m5(N,{headers:new m6({accept:"application/dns-json"}),signal:O}),$=await U.json();return $}function m9(N,O){return`${O}_${N}`}let be=Object.assign(ra("dns-over-http-resolver"),{error:ra("dns-over-http-resolver:error")});class br{constructor(N={}){this._cache=new m4({max:N?.maxCache??100}),this._TXTcache=new m4({max:N?.maxCache??100}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"],this._request=N.request??m7,this._abortControllers=[]}cancel(){this._abortControllers.forEach(N=>N.abort())}getServers(){return this._servers}_getShuffledServers(){let N=[...this._servers];for(let O=N.length-1;O>0;O--){let U=Math.floor(Math.random()*O),$=N[O];N[O]=N[U],N[U]=$}return N}setServers(N){this._servers=N}async resolve(N,O="A"){switch(O){case"A":return await this.resolve4(N);case"AAAA":return await this.resolve6(N);case"TXT":return await this.resolveTxt(N);default:throw Error(`${O} is not supported`)}}async resolve4(N){let O="A",U=this._cache.get(m9(N,O));if(null!=U)return U;let $=!1;for(let U of this._getShuffledServers()){let Y=new AbortController;this._abortControllers.push(Y);try{let $=await this._request(m8(U,N,O),Y.signal),X=$.Answer.map(N=>N.data),J=Math.min(...$.Answer.map(N=>N.TTL));return this._cache.set(m9(N,O),X,{ttl:J}),X}catch(X){Y.signal.aborted&&($=!0),be.error(`${U} could not resolve ${N} record ${O}`)}finally{this._abortControllers=this._abortControllers.filter(N=>N!==Y)}}if($)throw Object.assign(Error("queryA ECANCELLED"),{code:"ECANCELLED"});throw Error(`Could not resolve ${N} record ${O}`)}async resolve6(N){let O="AAAA",U=this._cache.get(m9(N,O));if(null!=U)return U;let $=!1;for(let U of this._getShuffledServers()){let Y=new AbortController;this._abortControllers.push(Y);try{let $=await this._request(m8(U,N,O),Y.signal),X=$.Answer.map(N=>N.data),J=Math.min(...$.Answer.map(N=>N.TTL));return this._cache.set(m9(N,O),X,{ttl:J}),X}catch(X){Y.signal.aborted&&($=!0),be.error(`${U} could not resolve ${N} record ${O}`)}finally{this._abortControllers=this._abortControllers.filter(N=>N!==Y)}}if($)throw Object.assign(Error("queryAaaa ECANCELLED"),{code:"ECANCELLED"});throw Error(`Could not resolve ${N} record ${O}`)}async resolveTxt(N){let O="TXT",U=this._TXTcache.get(m9(N,O));if(null!=U)return U;let $=!1;for(let U of this._getShuffledServers()){let Y=new AbortController;this._abortControllers.push(Y);try{let $=await this._request(m8(U,N,O),Y.signal),X=$.Answer.map(N=>[N.data.replace(/['"]+/g,"")]),J=Math.min(...$.Answer.map(N=>N.TTL));return this._TXTcache.set(m9(N,O),X,{ttl:J}),X}catch(X){Y.signal.aborted&&($=!0),be.error(`${U} could not resolve ${N} record ${O}`)}finally{this._abortControllers=this._abortControllers.filter(N=>N!==Y)}}if($)throw Object.assign(Error("queryTxt ECANCELLED"),{code:"ECANCELLED"});throw Error(`Could not resolve ${N} record ${O}`)}clearCache(){this._cache.clear(),this._TXTcache.clear()}}var bi=br;let{code:bn}=yg("dnsaddr");async function bo(N,O={}){let U=new bi;null!=O.signal&&O.signal.addEventListener("abort",()=>{U.cancel()});let $=N.getPeerId(),[,Y]=N.stringTuples().find(([N])=>N===bn)??[];if(null==Y)throw Error("No hostname found in multiaddr");let X=await U.resolveTxt(`_dnsaddr.${Y}`),J=X.flat().map(N=>N.split("=")[1]).filter(Boolean);return null!=$&&(J=J.filter(N=>N.includes($))),J}!function(N){N.NOT_STARTED_YET="The libp2p node is not started yet",N.DHT_DISABLED="DHT is not available",N.PUBSUB_DISABLED="PubSub is not available",N.CONN_ENCRYPTION_REQUIRED="At least one connection encryption module is required",N.ERR_TRANSPORTS_REQUIRED="At least one transport module is required",N.ERR_PROTECTOR_REQUIRED="Private network is enforced, but no protector was provided",N.NOT_FOUND="Not found"}(eJ||(eJ={})),function(N){N.DHT_DISABLED="ERR_DHT_DISABLED",N.ERR_PUBSUB_DISABLED="ERR_PUBSUB_DISABLED",N.PUBSUB_NOT_STARTED="ERR_PUBSUB_NOT_STARTED",N.DHT_NOT_STARTED="ERR_DHT_NOT_STARTED",N.CONN_ENCRYPTION_REQUIRED="ERR_CONN_ENCRYPTION_REQUIRED",N.ERR_TRANSPORTS_REQUIRED="ERR_TRANSPORTS_REQUIRED",N.ERR_PROTECTOR_REQUIRED="ERR_PROTECTOR_REQUIRED",N.ERR_PEER_DIAL_INTERCEPTED="ERR_PEER_DIAL_INTERCEPTED",N.ERR_CONNECTION_INTERCEPTED="ERR_CONNECTION_INTERCEPTED",N.ERR_INVALID_PROTOCOLS_FOR_STREAM="ERR_INVALID_PROTOCOLS_FOR_STREAM",N.ERR_CONNECTION_ENDED="ERR_CONNECTION_ENDED",N.ERR_CONNECTION_FAILED="ERR_CONNECTION_FAILED",N.ERR_NODE_NOT_STARTED="ERR_NODE_NOT_STARTED",N.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",N.ERR_TOO_MANY_ADDRESSES="ERR_TOO_MANY_ADDRESSES",N.ERR_NO_VALID_ADDRESSES="ERR_NO_VALID_ADDRESSES",N.ERR_RELAYED_DIAL="ERR_RELAYED_DIAL",N.ERR_DIALED_SELF="ERR_DIALED_SELF",N.ERR_DISCOVERED_SELF="ERR_DISCOVERED_SELF",N.ERR_DUPLICATE_TRANSPORT="ERR_DUPLICATE_TRANSPORT",N.ERR_ENCRYPTION_FAILED="ERR_ENCRYPTION_FAILED",N.ERR_HOP_REQUEST_FAILED="ERR_HOP_REQUEST_FAILED",N.ERR_INVALID_KEY="ERR_INVALID_KEY",N.ERR_INVALID_MESSAGE="ERR_INVALID_MESSAGE",N.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",N.ERR_INVALID_PEER="ERR_INVALID_PEER",N.ERR_MUXER_UNAVAILABLE="ERR_MUXER_UNAVAILABLE",N.ERR_NOT_FOUND="ERR_NOT_FOUND",N.ERR_TIMEOUT="ERR_TIMEOUT",N.ERR_TRANSPORT_UNAVAILABLE="ERR_TRANSPORT_UNAVAILABLE",N.ERR_TRANSPORT_DIAL_FAILED="ERR_TRANSPORT_DIAL_FAILED",N.ERR_UNSUPPORTED_PROTOCOL="ERR_UNSUPPORTED_PROTOCOL",N.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",N.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",N.ERR_SIGNATURE_NOT_VALID="ERR_SIGNATURE_NOT_VALID",N.ERR_FIND_SELF="ERR_FIND_SELF",N.ERR_NO_ROUTERS_AVAILABLE="ERR_NO_ROUTERS_AVAILABLE",N.ERR_CONNECTION_NOT_MULTIPLEXED="ERR_CONNECTION_NOT_MULTIPLEXED",N.ERR_NO_DIAL_TOKENS="ERR_NO_DIAL_TOKENS",N.ERR_KEYCHAIN_REQUIRED="ERR_KEYCHAIN_REQUIRED",N.ERR_INVALID_CMS="ERR_INVALID_CMS",N.ERR_MISSING_KEYS="ERR_MISSING_KEYS",N.ERR_NO_KEY="ERR_NO_KEY",N.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",N.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",N.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",N.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",N.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",N.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",N.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",N.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",N.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",N.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",N.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",N.ERR_MISSING_PUBLIC_KEY="ERR_MISSING_PUBLIC_KEY",N.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",N.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",N.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH",N.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",N.ERR_WRONG_PING_ACK="ERR_WRONG_PING_ACK",N.ERR_INVALID_RECORD="ERR_INVALID_RECORD",N.ERR_ALREADY_SUCCEEDED="ERR_ALREADY_SUCCEEDED",N.ERR_NO_HANDLER_FOR_PROTOCOL="ERR_NO_HANDLER_FOR_PROTOCOL",N.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",N.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",N.ERR_CONNECTION_DENIED="ERR_CONNECTION_DENIED",N.ERR_TRANSFER_LIMIT_EXCEEDED="ERR_TRANSFER_LIMIT_EXCEEDED"}(eZ||(eZ={}));let ba={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:N=>N},connectionManager:{resolvers:{dnsaddr:bo},addressSorter:mZ},transportManager:{faultTolerance:eX.FATAL_ALL}};function bc(N){let O=gB(ba,N);if(null==O.transports||O.transports.length<1)throw new n3(eJ.ERR_TRANSPORTS_REQUIRED,eZ.ERR_TRANSPORTS_REQUIRED);if(null===O.connectionProtector&&globalThis.process?.env?.LIBP2P_FORCE_PNET!=null)throw new n3(eJ.ERR_PROTECTOR_REQUIRED,eZ.ERR_PROTECTOR_REQUIRED);return O}let bu="keep-alive";var bd=U(8558);let bp=rF("libp2p:get-peer");function bf(N){let O;if(gw(N))return{peerId:N,multiaddrs:[]};if(Array.isArray(N)||(N=[N]),N.length>0){let U=N[0].getPeerId();O=null==U?void 0:gC(U),N.forEach(N=>{if(!yJ(N))throw bp.error("multiaddr %s was invalid",N),new n3("Invalid Multiaddr",eZ.ERR_INVALID_MULTIADDR);let U=N.getPeerId();if(null==U){if(null!=O)throw new n3("Multiaddrs must all have the same peer id or have no peer id",eZ.ERR_INVALID_PARAMETERS)}else{let N=gC(U);if(null==O||!O.equals(N))throw new n3("Multiaddrs must all have the same peer id or have no peer id",eZ.ERR_INVALID_PARAMETERS)}})}return{peerId:O,multiaddrs:N}}function bg(N,O,U){let $=0,Y=N.length;for(;Y>0;){let X=Math.trunc(Y/2),J=$+X;0>=U(N[J],O)?($=++J,Y-=X+1):Y=X}return $}class by{#h=[];enqueue(N,O){let U=O?.peerId,$=O?.priority??0;if(null==U)throw new n3("missing peer id",eZ.ERR_INVALID_PARAMETERS);let Y={priority:$,peerId:U,run:N};if(this.size>0&&this.#h[this.size-1].priority>=$){this.#h.push(Y);return}let X=bg(this.#h,Y,(N,O)=>O.priority-N.priority);this.#h.splice(X,0,Y)}dequeue(){let N=this.#h.shift();return N?.run}filter(N){if(null!=N.peerId){let O=N.peerId;return this.#h.filter(N=>O.equals(N.peerId)).map(N=>N.run)}return this.#h.filter(O=>O.priority===N.priority).map(N=>N.run)}get size(){return this.#h.length}}class bw extends cO{constructor(N={}){super({...N,queueClass:by})}hasJob(N){return this.sizeBy({peerId:N})>0}}let bv=3e4,bE=3e4,b_=100,bS=25,bI=10,bR=50,bk=300,bD=5e3,bA=25,bT=0,bC=100,bP=5,bx=10,bN=rF("libp2p:connection-manager:auto-dial"),bB={minConnections:bR,maxQueueLength:bC,autoDialConcurrency:bA,autoDialPriority:bT,autoDialInterval:bD};class bL{connectionManager;peerStore;queue;minConnections;autoDialPriority;autoDialIntervalMs;autoDialMaxQueueLength;autoDialInterval;started;running;constructor(N,O){this.connectionManager=N.connectionManager,this.peerStore=N.peerStore,this.minConnections=O.minConnections??bB.minConnections,this.autoDialPriority=O.autoDialPriority??bB.autoDialPriority,this.autoDialIntervalMs=O.autoDialInterval??bB.autoDialInterval,this.autoDialMaxQueueLength=O.maxQueueLength??bB.maxQueueLength,this.started=!1,this.running=!1,this.queue=new bw({concurrency:O.autoDialConcurrency??bB.autoDialConcurrency}),this.queue.addListener("error",N=>{bN.error("error during auto-dial",N)}),N.events.addEventListener("connection:close",()=>{this.autoDial().catch(N=>{bN.error(N)})})}isStarted(){return this.started}start(){this.autoDialInterval=setTimeout(()=>{this.autoDial().catch(N=>{bN.error("error while autodialing",N)})},this.autoDialIntervalMs),this.started=!0}afterStart(){this.autoDial().catch(N=>{bN.error("error while autodialing",N)})}stop(){this.queue.clear(),clearTimeout(this.autoDialInterval),this.started=!1,this.running=!1}async autoDial(){if(!this.started)return;let N=this.connectionManager.getConnectionsMap(),O=N.size;if(O>=this.minConnections){bN.trace("have enough connections %d/%d",O,this.minConnections);return}if(this.queue.size>this.autoDialMaxQueueLength){bN("not enough connections %d/%d but auto dial queue is full",O,this.minConnections);return}if(this.running){bN("not enough connections %d/%d - but skipping autodial as it is already running",O,this.minConnections);return}this.running=!0,bN("not enough connections %d/%d - will dial peers to increase the number of connections",O,this.minConnections);let U=new gQ(this.connectionManager.getDialQueue().map(N=>N.peerId).filter(Boolean)),$=await this.peerStore.all({filters:[O=>0===O.addresses.length?(bN.trace("not autodialing %p because they have no addresses"),!1):N.has(O.id)?(bN.trace("not autodialing %p because they are already connected"),!1):U.has(O.id)?(bN.trace("not autodialing %p because they are already being dialed"),!1):!this.queue.hasJob(O.id)||(bN.trace("not autodialing %p because they are already being autodialed"),!1)]}),Y=$.sort(()=>Math.random()>.5?1:-1),X=new gG;for(let N of Y)X.has(N.id)||X.set(N.id,[...N.tags.values()].reduce((N,O)=>N+O.value,0));let J=Y.sort((N,O)=>{let U=X.get(N.id)??0,$=X.get(O.id)??0;return U>$?-1:U<$?1:0});for(let N of(bN("selected %d/%d peers to dial",J.length,$.length),J))this.queue.add(async()=>{let O=this.connectionManager.getConnectionsMap().size;if(O>=this.minConnections){bN("got enough connections now %d/%d",O,this.minConnections),this.queue.clear();return}bN("connecting to a peerStore stored peer %p",N.id),await this.connectionManager.openConnection(N.id,{priority:this.autoDialPriority})},{peerId:N.id}).catch(N=>{bN.error("could not connect to peerStore stored peer",N)});this.running=!1,this.started&&(this.autoDialInterval=setTimeout(()=>{this.autoDial().catch(N=>{bN.error("error while autodialing",N)})},this.autoDialIntervalMs))}}let bO=rF("libp2p:connection-manager:connection-pruner"),bM={maxConnections:bk,allow:[]};class bU{maxConnections;connectionManager;peerStore;allow;events;constructor(N,O={}){this.maxConnections=O.maxConnections??bM.maxConnections,this.allow=O.allow??bM.allow,this.connectionManager=N.connectionManager,this.peerStore=N.peerStore,this.events=N.events,N.events.addEventListener("connection:open",()=>{this.maybePruneConnections().catch(N=>{bO.error(N)})})}async maybePruneConnections(){let N=this.connectionManager.getConnections(),O=N.length,U=Math.max(O-this.maxConnections,0);if(bO("checking max connections limit %d/%d",O,this.maxConnections),O<=this.maxConnections)return;bO("max connections limit exceeded %d/%d, pruning %d connection(s)",O,this.maxConnections,U);let $=new gG;for(let O of N){let N=O.remotePeer;if(!$.has(N)){$.set(N,0);try{let O=await this.peerStore.get(N);$.set(N,[...O.tags.values()].reduce((N,O)=>N+O.value,0))}catch(N){"ERR_NOT_FOUND"!==N.code&&bO.error("error loading peer tags",N)}}}let Y=N.sort((N,O)=>{let U=$.get(N.remotePeer)??0,Y=$.get(O.remotePeer)??0;if(U>Y)return 1;if(U<Y)return -1;let X=N.stat.timeline.open,J=O.stat.timeline.open;return X<J?1:X>J?-1:0}),X=[];for(let N of Y){bO("too many connections open - closing a connection to %p",N.remotePeer);let O=this.allow.some(O=>N.remoteAddr.toString().startsWith(O.toString()));if(O||X.push(N),X.length===U)break}await Promise.all(X.map(async N=>{try{await N.close()}catch(N){bO.error(N)}})),this.events.safeDispatchEvent("connection:prune",{detail:X})}}let bF=rF("libp2p:connection-manager:utils");async function bV(N,O){let U=N.protoNames().includes("dnsaddr");if(!U)return[N];let $=await bz(N,O),Y=await Promise.all($.map(async N=>bV(N,O))),X=Y.flat(),J=X.reduce((N,O)=>(null==N.find(N=>N.equals(O))&&N.push(O),N),[]);return bF("resolved %s to",N,J.map(N=>N.toString())),J}async function bz(N,O){try{N=y1(N.toString());let U=await N.resolve(O);return U}catch(O){return bF.error(`multiaddr ${N.toString()} could not be resolved`,O),[]}}function b$(...N){let O=[];for(let U of N)if(null!=U){try{oW.setMaxListeners?.(1/0,U)}catch{}O.push(U)}let U=nY(O);try{oW.setMaxListeners?.(1/0,U)}catch{}return U}let bK=rF("libp2p:connection-manager:dial-queue"),bq={addressSorter:mZ,maxParallelDials:b_,maxPeerAddrsToDial:bS,maxParallelDialsPerPeer:bI,dialTimeout:bv,resolvers:{dnsaddr:bo}};class bj{pendingDials;queue;peerId;peerStore;connectionGater;transportManager;addressSorter;maxPeerAddrsToDial;maxParallelDialsPerPeer;dialTimeout;inProgressDialCount;pendingDialCount;shutDownController;constructor(N,O={}){this.addressSorter=O.addressSorter??bq.addressSorter,this.maxPeerAddrsToDial=O.maxPeerAddrsToDial??bq.maxPeerAddrsToDial,this.maxParallelDialsPerPeer=O.maxParallelDialsPerPeer??bq.maxParallelDialsPerPeer,this.dialTimeout=O.dialTimeout??bq.dialTimeout,this.peerId=N.peerId,this.peerStore=N.peerStore,this.connectionGater=N.connectionGater,this.transportManager=N.transportManager,this.shutDownController=new AbortController;try{oW.setMaxListeners?.(1/0,this.shutDownController.signal)}catch{}for(let[U,$]of(this.pendingDialCount=N.metrics?.registerMetric("libp2p_dialler_pending_dials"),this.inProgressDialCount=N.metrics?.registerMetric("libp2p_dialler_in_progress_dials"),this.pendingDials=[],Object.entries(O.resolvers??{})))yY.set(U,$);this.queue=new cO({concurrency:O.maxParallelDials??bq.maxParallelDials}),this.queue.on("add",()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)}),this.queue.on("active",()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)}),this.queue.on("completed",()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)}),this.queue.on("error",N=>{bK.error("error in dial queue",N),this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)}),this.queue.on("empty",()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)}),this.queue.on("idle",()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)})}stop(){this.shutDownController.abort()}async dial(N,O={}){let U;let{peerId:$,multiaddrs:Y}=bf(N),X=Y.map(N=>({multiaddr:N,isCertified:!1})),J=this.createDialAbortControllers(O.signal);try{U=await this.calculateMultiaddrs($,X,{...O,signal:J})}catch(N){throw J.clear(),N}let Z=this.pendingDials.find(N=>!!(null!=N.peerId&&null!=$&&N.peerId.equals($))||U.map(({multiaddr:N})=>N.toString()).join()===N.multiaddrs.map(N=>N.toString()).join());if(null!=Z)return bK("joining existing dial target for %p",$),J.clear(),Z.promise;bK("creating dial target for",U.map(({multiaddr:N})=>N.toString()));let en={id:bW(),status:"queued",peerId:$,multiaddrs:U.map(({multiaddr:N})=>N)};return en.promise=this.performDial(en,{...O,signal:J}).finally(()=>{this.pendingDials=this.pendingDials.filter(N=>N.id!==en.id),J.clear()}).catch(N=>{if(bK.error("dial failed to %s",en.multiaddrs.map(N=>N.toString()).join(", "),N),J.aborted){let O=new n3(N.message,eZ.ERR_TIMEOUT);throw O}throw N}),this.pendingDials.push(en),en.promise}createDialAbortControllers(N){let O=nY([AbortSignal.timeout(this.dialTimeout),this.shutDownController.signal,N]);try{oW.setMaxListeners?.(1/0,O)}catch{}return O}async calculateMultiaddrs(N,O=[],U={}){if(null!=N){if(this.peerId.equals(N))throw new n3("Tried to dial self",eZ.ERR_DIALED_SELF);if(await this.connectionGater.denyDialPeer?.(N)===!0)throw new n3("The dial request is blocked by gater.allowDialPeer",eZ.ERR_PEER_DIAL_INTERCEPTED);if(0===O.length){bK("loading multiaddrs for %p",N);try{let U=await this.peerStore.get(N);O.push(...U.addresses),bK("loaded multiaddrs for %p",N,O.map(({multiaddr:N})=>N.toString()))}catch(N){if(N.code!==eZ.ERR_NOT_FOUND)throw N}}}let $=(await Promise.all(O.map(async N=>{let O=await bV(N.multiaddr,U);return 1===O.length&&O[0].equals(N.multiaddr)?N:O.map(N=>({multiaddr:N,isCertified:!1}))}))).flat(),Y=$.filter(N=>!!this.transportManager.transportForMultiaddr(N.multiaddr)),X=new Map;for(let N of Y){let O=N.multiaddr.toString(),U=X.get(O);if(null!=U){U.isCertified=U.isCertified||N.isCertified||!1;continue}X.set(O,N)}let J=[...X.values()];if((0===J.length||J.length>this.maxPeerAddrsToDial)&&(bK("addresses for %p before filtering",N??"unknown peer",$.map(({multiaddr:N})=>N.toString())),bK("addresses for %p after filtering",N??"unknown peer",J.map(({multiaddr:N})=>N.toString()))),0===J.length)throw new n3("The dial request has no valid addresses",eZ.ERR_NO_VALID_ADDRESSES);if(J.length>this.maxPeerAddrsToDial)throw new n3("dial with more addresses than allowed",eZ.ERR_TOO_MANY_ADDRESSES);if(null!=N){let O=`/p2p/${N.toString()}`;J=J.map(U=>{let $=U.multiaddr.getPeerId(),Y=U.multiaddr.protos().pop();return Y?.path===!0?U:$!==N.toString()?{multiaddr:U.multiaddr.encapsulate(O),isCertified:U.isCertified}:U})}let Z=[];for(let N of J)null!=this.connectionGater.denyDialMultiaddr&&await this.connectionGater.denyDialMultiaddr(N.multiaddr)||Z.push(N);let en=Z.sort(this.addressSorter);if(0===en.length)throw new n3("The connection gater denied all addresses in the dial request",eZ.ERR_NO_VALID_ADDRESSES);return en}async performDial(N,O={}){let U=N.multiaddrs.map(()=>new AbortController);try{let $=new cO({concurrency:this.maxParallelDialsPerPeer});$.on("error",N=>{bK.error("error dialling",N)});let Y=await Promise.any(N.multiaddrs.map(async(Y,X)=>{let J=U[X];if(null==J)throw new n3("dialAction did not come with an AbortController",eZ.ERR_INVALID_PARAMETERS);let Z=b$(J.signal,O.signal);Z.addEventListener("abort",()=>{bK("dial to %s aborted",Y)});let en=c_();return await $.add(async()=>{if(Z.aborted){bK("dial to %s was aborted before reaching the head of the peer dial queue",Y),en.reject(new n0);return}await this.queue.add(async()=>{try{if(Z.aborted){bK("dial to %s was aborted before reaching the head of the dial queue",Y),en.reject(new n0);return}N.status="active";let $=await this.transportManager.dial(Y,{...O,signal:Z});if(J.signal.aborted){bK("multiple dials succeeded, closing superfluous connection"),$.close().catch(N=>{bK.error("error closing superfluous connection",N)}),en.reject(new n0);return}U[X]=void 0,U.forEach(N=>{void 0!==N&&N.abort()}),bK("dial to %s succeeded",Y),en.resolve($)}catch(N){bK.error("error during dial of %s",Y,N),en.reject(N)}},{...O,signal:Z}).catch(N=>{en.reject(N)})},{signal:Z}).catch(N=>{en.reject(N)}).finally(()=>{Z.clear()}),en.promise}));if(null==Y)throw new n3("successful dial led to empty object returned from peer dial queue",eZ.ERR_TRANSPORT_DIAL_FAILED);return N.status="success",Y}catch(O){if(N.status="error",1===N.multiaddrs.length&&"AggregateError"===O.name)throw O.errors[0];throw O}}}function bW(){return`${parseInt(String(1e9*Math.random()),10).toString()}${Date.now()}`}let bH=rF("libp2p:connection-manager"),bG=50,bY={minConnections:bR,maxConnections:bk,inboundConnectionThreshold:bP,maxIncomingPendingConnections:bx,autoDialConcurrency:bA,autoDialPriority:bT,autoDialMaxQueueLength:bC};class bX{started;connections;allow;deny;maxIncomingPendingConnections;incomingPendingConnections;maxConnections;dialQueue;autoDial;connectionPruner;inboundConnectionRateLimiter;peerStore;metrics;events;constructor(N,O={}){this.maxConnections=O.maxConnections??bY.maxConnections;let U=O.minConnections??bY.minConnections;if(this.maxConnections<U)throw new n3("Connection Manager maxConnections must be greater than minConnections",eZ.ERR_INVALID_PARAMETERS);this.connections=new gG,this.started=!1,this.peerStore=N.peerStore,this.metrics=N.metrics,this.events=N.events,this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),this.allow=(O.allow??[]).map(N=>y1(N)),this.deny=(O.deny??[]).map(N=>y1(N)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=O.maxIncomingPendingConnections??bY.maxIncomingPendingConnections,this.inboundConnectionRateLimiter=new bd.RateLimiterMemory({points:O.inboundConnectionThreshold??bY.inboundConnectionThreshold,duration:1}),this.autoDial=new bL({connectionManager:this,peerStore:N.peerStore,events:N.events},{minConnections:U,autoDialConcurrency:O.autoDialConcurrency??bY.autoDialConcurrency,autoDialPriority:O.autoDialPriority??bY.autoDialPriority,maxQueueLength:O.autoDialMaxQueueLength??bY.autoDialMaxQueueLength}),this.connectionPruner=new bU({connectionManager:this,peerStore:N.peerStore,events:N.events},{maxConnections:this.maxConnections,allow:this.allow}),this.dialQueue=new bj({peerId:N.peerId,metrics:N.metrics,peerStore:N.peerStore,transportManager:N.transportManager,connectionGater:N.connectionGater},{addressSorter:O.addressSorter??mZ,maxParallelDials:O.maxParallelDials??b_,maxPeerAddrsToDial:O.maxPeerAddrsToDial??bS,dialTimeout:O.dialTimeout??bv,resolvers:O.resolvers??{dnsaddr:bo}})}isStarted(){return this.started}async start(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{let N={inbound:0,outbound:0};for(let O of this.connections.values())for(let U of O)"inbound"===U.stat.direction?N.inbound++:N.outbound++;return N}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{let N={};for(let O of this.connections.values())for(let U of O)for(let O of U.streams){let U=`${O.stat.direction} ${O.stat.protocol??"unnegotiated"}`;N[U]=(N[U]??0)+1}return N}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{let N={};for(let O of this.connections.values())for(let U of O){let O={};for(let N of U.streams){let U=`${N.stat.direction} ${N.stat.protocol??"unnegotiated"}`;O[U]=(O[U]??0)+1}for(let[U,$]of Object.entries(O))N[U]=N[U]??[],N[U].push($)}let O={};for(let[U,$]of Object.entries(N)){$=$.sort((N,O)=>N-O);let N=Math.floor(.9*$.length);O[U]=$[N]}return O}}),this.autoDial.start(),this.started=!0,bH("started")}async afterStart(){Promise.resolve().then(async()=>{let N=await this.peerStore.all({filters:[N=>N.tags.has(bu)]});await Promise.all(N.map(async N=>{await this.openConnection(N.id).catch(N=>{bH.error(N)})}))}).catch(N=>{bH.error(N)}),this.autoDial.afterStart()}async stop(){this.dialQueue.stop(),this.autoDial.stop();let N=[];for(let O of this.connections.values())for(let U of O)N.push((async()=>{try{await U.close()}catch(N){bH.error(N)}})());bH("closing %d connections",N.length),await Promise.all(N),this.connections.clear(),bH("stopped")}onConnect(N){this._onConnect(N).catch(N=>{bH.error(N)})}async _onConnect(N){let{detail:O}=N;if(!this.started){await O.close();return}let U=O.remotePeer,$=this.connections.get(U),Y=!1;null!=$?$.push(O):(Y=!0,this.connections.set(U,[O])),null!=U.publicKey&&"RSA"===U.type&&await this.peerStore.patch(U,{publicKey:U.publicKey}),Y&&this.events.safeDispatchEvent("peer:connect",{detail:O.remotePeer})}onDisconnect(N){let{detail:O}=N;if(!this.started)return;let U=O.remotePeer,$=this.connections.get(U);null!=$&&$.length>1?($=$.filter(N=>N.id!==O.id),this.connections.set(U,$)):null!=$&&(this.connections.delete(U),this.events.safeDispatchEvent("peer:disconnect",{detail:O.remotePeer}))}getConnections(N){if(null!=N)return this.connections.get(N)??[];let O=[];for(let N of this.connections.values())O=O.concat(N);return O}getConnectionsMap(){return this.connections}async openConnection(N,O={}){if(!this.isStarted())throw new n3("Not started",eZ.ERR_NODE_NOT_STARTED);let{peerId:U}=bf(N);if(null!=U){bH("dial %p",U);let N=this.getConnections(U);if(N.length>0)return bH("had an existing connection to %p",U),N[0]}let $=await this.dialQueue.dial(N,{...O,priority:O.priority??bG}),Y=this.connections.get($.remotePeer);null==Y&&(Y=[],this.connections.set($.remotePeer,Y));let X=!1;for(let N of Y)N.id===$.id&&(X=!0);return X||Y.push($),$}async closeConnections(N){let O=this.connections.get(N)??[];await Promise.all(O.map(async N=>{await N.close()}))}async acceptIncomingConnection(N){let O=this.deny.some(O=>N.remoteAddr.toString().startsWith(O.toString()));if(O)return bH("connection from %s refused - connection remote address was in deny list",N.remoteAddr),!1;let U=this.allow.some(O=>N.remoteAddr.toString().startsWith(O.toString()));if(U)return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return bH("connection from %s refused - incomingPendingConnections exceeded by peer %s",N.remoteAddr),!1;if(N.remoteAddr.isThinWaistAddress()){let O=N.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(O,1)}catch{return bH("connection from %s refused - inboundConnectionThreshold exceeded by host %s",O,N.remoteAddr),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(bH("connection from %s refused - maxConnections exceeded",N.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){return this.dialQueue.pendingDials}}async function*bJ(N,O){yield*ow(N,async N=>(await O.merge(N.id,{multiaddrs:N.multiaddrs}),N))}function bZ(N){let O=new Set;return nz(N,N=>!O.has(N.id.toString())&&(O.add(N.id.toString()),!0))}async function*we(N,O=1){let U=0;for await(let O of N)U++,yield O;if(U<O)throw new n3(`more peers required, seen: ${U}  min: ${O}`,"NOT_FOUND")}class wr{routers;started;components;constructor(N,O){this.routers=O.routers??[],this.started=!1,this.components=N}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async *findProviders(N,O={}){if(0===this.routers.length)throw new n3("No content routers available",eZ.ERR_NO_ROUTERS_AVAILABLE);yield*oD(ok(...this.routers.map(U=>U.findProviders(N,O))),N=>bJ(N,this.components.peerStore),N=>bZ(N),N=>we(N))}async provide(N,O={}){if(0===this.routers.length)throw new n3("No content routers available",eZ.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map(async U=>{await U.provide(N,O)}))}async put(N,O,U){if(!this.isStarted())throw new n3(eJ.NOT_STARTED_YET,eZ.DHT_NOT_STARTED);await Promise.all(this.routers.map(async $=>{await $.put(N,O,U)}))}async get(N,O){if(!this.isStarted())throw new n3(eJ.NOT_STARTED_YET,eZ.DHT_NOT_STARTED);return Promise.any(this.routers.map(async U=>U.get(N,O)))}}function wn(N){return null!=N[Symbol.asyncIterator]}var wo=function(N){if(wn(N))return(async()=>{for await(let O of N)return O})();for(let O of N)return O};let wa=rF("libp2p:peer-routing");class wc{components;routers;constructor(N,O){this.components=N,this.routers=O.routers??[]}async findPeer(N,O){if(0===this.routers.length)throw new n3("No peer routers available",eZ.ERR_NO_ROUTERS_AVAILABLE);if(N.toString()===this.components.peerId.toString())throw new n3("Should not try to find self",eZ.ERR_FIND_SELF);let U=await oD(ok(...this.routers.map(U=>(async function*(){try{yield await U.findPeer(N,O)}catch(N){wa.error(N)}})())),N=>nz(N,Boolean),N=>bJ(N,this.components.peerStore),async N=>wo(N));if(null!=U)return U;throw new n3(eJ.NOT_FOUND,eZ.ERR_NOT_FOUND)}async *getClosestPeers(N,O){if(0===this.routers.length)throw new n3("No peer routers available",eZ.ERR_NO_ROUTERS_AVAILABLE);yield*oD(ok(...this.routers.map(U=>U.getClosestPeers(N,O))),N=>bJ(N,this.components.peerStore),N=>bZ(N),N=>we(N))}}let wu=rF("libp2p:registrar"),wd=32,wp=64;class wf{topologies;handlers;components;constructor(N){this.topologies=new Map,this.handlers=new Map,this.components=N,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onConnect=this._onConnect.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:connect",this._onConnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(N){let O=this.handlers.get(N);if(null==O)throw new n3(`No handler registered for protocol ${N}`,eZ.ERR_NO_HANDLER_FOR_PROTOCOL);return O}getTopologies(N){let O=this.topologies.get(N);return null==O?[]:[...O.values()]}async handle(N,O,U){if(this.handlers.has(N))throw new n3(`Handler already registered for protocol ${N}`,eZ.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);let $=gB.bind({ignoreUndefined:!0})({maxInboundStreams:wd,maxOutboundStreams:wp},U);this.handlers.set(N,{handler:O,options:$}),await this.components.peerStore.merge(this.components.peerId,{protocols:[N]})}async unhandle(N){let O=Array.isArray(N)?N:[N];O.forEach(N=>{this.handlers.delete(N)}),await this.components.peerStore.patch(this.components.peerId,{protocols:O})}async register(N,O){if(!sV(O))throw wu.error("topology must be an instance of interfaces/topology"),new n3("topology must be an instance of interfaces/topology",eZ.ERR_INVALID_PARAMETERS);let U=`${(1e9*Math.random()).toString(36)}${Date.now()}`,$=this.topologies.get(N);return null==$&&($=new Map,this.topologies.set(N,$)),$.set(U,O),await O.setRegistrar(this),U}unregister(N){for(let[O,U]of this.topologies.entries())U.has(N)&&(U.delete(N),0===U.size&&this.topologies.delete(O))}_onDisconnect(N){let O=N.detail;this.components.peerStore.get(O).then(N=>{for(let U of N.protocols){let N=this.topologies.get(U);if(null!=N)for(let U of N.values())U.onDisconnect(O)}}).catch(N=>{N.code!==eZ.ERR_NOT_FOUND&&wu.error("could not inform topologies of disconnecting peer %p",O,N)})}_onConnect(N){let O=N.detail;this.components.peerStore.get(O).then(N=>{let U=this.components.connectionManager.getConnections(N.id)[0];if(null==U){wu("peer %p connected but the connection manager did not have a connection",N);return}for(let $ of N.protocols){let N=this.topologies.get($);if(null!=N)for(let $ of N.values())$.onConnect(O,U)}}).catch(N=>{N.code!==eZ.ERR_NOT_FOUND&&wu.error("could not inform topologies of connecting peer %p",O,N)})}_onPeerUpdate(N){let{peer:O,previous:U}=N.detail,$=(U?.protocols??[]).filter(N=>!O.protocols.includes(N)),Y=O.protocols.filter(N=>!(U?.protocols??[]).includes(N));for(let N of $){let U=this.topologies.get(N);if(null!=U)for(let N of U.values())N.onDisconnect(O.id)}for(let N of Y){let U=this.topologies.get(N);if(null!=U)for(let N of U.values()){let U=this.components.connectionManager.getConnections(O.id)[0];null!=U&&N.onConnect(O.id,U)}}}}let wg=rF("libp2p:transports");class wy{components;transports;listeners;faultTolerance;started;constructor(N,O={}){this.components=N,this.started=!1,this.transports=new Map,this.listeners=n2({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=O.faultTolerance??eX.FATAL_ALL}add(N){let O=N[Symbol.toStringTag];if(null==O)throw new n3("Transport must have a valid tag",eZ.ERR_INVALID_KEY);if(this.transports.has(O))throw new n3(`There is already a transport with the tag ${O}`,eZ.ERR_DUPLICATE_TRANSPORT);wg("adding transport %s",O),this.transports.set(O,N),this.listeners.has(O)||this.listeners.set(O,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){let N=this.components.addressManager.getListenAddrs();await this.listen(N)}async stop(){let N=[];for(let[O,U]of this.listeners)for(wg("closing listeners for %s",O);U.length>0;){let O=U.pop();null!=O&&N.push(O.close())}for(let O of(await Promise.all(N),wg("all listeners closed"),this.listeners.keys()))this.listeners.set(O,[]);this.started=!1}async dial(N,O){let U=this.transportForMultiaddr(N);if(null==U)throw new n3(`No transport available for address ${String(N)}`,eZ.ERR_TRANSPORT_UNAVAILABLE);try{return await U.dial(N,{...O,upgrader:this.components.upgrader})}catch(N){throw null==N.code&&(N.code=eZ.ERR_TRANSPORT_DIAL_FAILED),N}}getAddrs(){let N=[];for(let O of this.listeners.values())for(let U of O)N=[...N,...U.getAddrs()];return N}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}transportForMultiaddr(N){for(let O of this.transports.values()){let U=O.filter([N]);if(U.length>0)return O}}async listen(N){if(null==N||0===N.length){wg("no addresses were provided for listening, this node is dial only");return}let O=[];for(let[U,$]of this.transports.entries()){let Y=$.filter(N),X=[];for(let N of Y){wg("creating listener for %s on %s",U,N);let O=$.createListener({upgrader:this.components.upgrader}),Y=this.listeners.get(U)??[];null==Y&&(Y=[],this.listeners.set(U,Y)),Y.push(O),O.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:O})}),O.addEventListener("close",()=>{let N=Y.findIndex(N=>N===O);Y.splice(N,1),this.components.events.safeDispatchEvent("transport:close",{detail:O})}),X.push(O.listen(N))}if(0===X.length){O.push(U);continue}let J=await Promise.allSettled(X),Z=J.find(N=>"fulfilled"===N.status);if(null==Z&&this.faultTolerance!==eX.NO_FATAL)throw new n3(`Transport (${U}) could not listen on any available address`,eZ.ERR_NO_VALID_ADDRESSES)}if(O.length===this.transports.size){let N=`no valid addresses were provided for transports [${O.join(", ")}]`;if(this.faultTolerance===eX.FATAL_ALL)throw new n3(N,eZ.ERR_NO_VALID_ADDRESSES);wg(`libp2p in dial mode only: ${N}`)}}async remove(N){for(let O of(wg("removing %s",N),this.listeners.get(N)??[]))await O.close();this.transports.delete(N),this.listeners.delete(N)}async removeAll(){let N=[];for(let O of this.transports.keys())N.push(this.remove(O));await Promise.all(N)}}let wm="/multistream/1.0.0",wb=1024;function ww(N){let O=async function*(){let O=yield,U=new sZ;for await(let $ of N){if(null==O){U.append($),O=yield U,U=new sZ;continue}for(U.append($);U.length>=O;){let N=U.sublist(0,O);if(U.consume(O),null==(O=yield N)){U.length>0&&(O=yield U,U=new sZ);break}}}if(null!=O)throw Object.assign(Error(`stream ended before ${O} bytes became available`),{code:"ERR_UNDER_READ",buffer:U})}();return O.next(),O}function wv(N){let O;let U=o_(),$=ww(N.source),Y=c_(),X=N.sink(async function*(){yield*U;let N=await Y.promise;yield*N}());X.catch(N=>{O=N});let J={sink:async N=>{if(null!=O){await Promise.reject(O);return}Y.resolve(N),await X},source:$};return{reader:$,writer:U,stream:J,rest:()=>U.end(),write:U.push,read:async()=>{let N=await $.next();if(null!=N.value)return N.value}}}let wE=rF("libp2p:mss"),w_=nD("\n");function wS(N){let O=new sZ(N,w_);return od.single(O)}function wI(N,O,U={}){let $=wS(O);!0===U.writeBytes?N.push($.subarray()):N.push($)}function wR(N,O,U={}){let $=new sZ;for(let N of O)$.append(wS(N));!0===U.writeBytes?N.push($.subarray()):N.push($)}async function wk(N,O){let U=1,$={[Symbol.asyncIterator]:()=>$,next:async()=>N.next(U)},Y=$;O?.signal!=null&&(Y=sW($,O.signal));let X=N=>{U=N},J=await oD(Y,N=>om(N,{onLength:X,maxDataLength:wb}),async N=>wo(N));if(null==J||0===J.length)throw new n3("no buffer returned","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");if(J.get(J.byteLength-1)!==w_[0])throw wE.error("Invalid mss message - missing newline - %s",J.subarray()),new n3("missing newline","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return J.sublist(0,-1)}async function wD(N,O){let U=await wk(N,O);return nA(U.subarray())}let wA=rF("libp2p:mss:select");async function wT(N,O,U={}){O=Array.isArray(O)?[...O]:[O];let{reader:$,writer:Y,rest:X,stream:J}=wv(N),Z=O.shift();if(null==Z)throw Error("At least one protocol must be specified");wA.trace('select: write ["%s", "%s"]',wm,Z);let en=nD(wm),es=nD(Z);wR(Y,[en,es],U);let eo=await wD($,U);if(wA.trace('select: read "%s"',eo),eo===wm&&(eo=await wD($,U),wA.trace('select: read "%s"',eo)),eo===Z)return X(),{stream:J,protocol:Z};for(let N of O){wA.trace('select: write "%s"',N),wI(Y,nD(N),U);let O=await wD($,U);if(wA.trace('select: read "%s" for "%s"',O,N),O===N)return X(),{stream:J,protocol:N}}throw X(),new n3("protocol selection failed","ERR_UNSUPPORTED_PROTOCOL")}let wC=rF("libp2p:mss:handle");async function wP(N,O,U){O=Array.isArray(O)?O:[O];let{writer:$,reader:Y,rest:X,stream:J}=wv(N);for(;;){let N=await wD(Y,U);if(wC.trace('read "%s"',N),N===wm){wC.trace('respond with "%s" for "%s"',wm,N),wI($,nD(wm),U);continue}if(O.includes(N))return wI($,nD(N),U),wC.trace('respond with "%s" for "%s"',N,N),X(),{stream:J,protocol:N};if("ls"===N){wI($,new sZ(...O.map(N=>wS(nD(N)))),U),wC.trace('respond with "%s" for %s',O,N);continue}wI($,nD("na"),U),wC('respond with "na" for "%s"',N)}}let wx=Symbol.for("@libp2p/connection"),wN="OPEN",wB="CLOSING",wL="CLOSED",wO=rF("libp2p:connection");class wM{id;remoteAddr;remotePeer;stat;tags;_newStream;_close;_getStreams;_closing;constructor(N){let{remoteAddr:O,remotePeer:U,newStream:$,close:Y,getStreams:X,stat:J}=N;this.id=`${parseInt(String(1e9*Math.random())).toString(36)}${Date.now()}`,this.remoteAddr=O,this.remotePeer=U,this.stat={...J,status:wN},this._newStream=$,this._close=Y,this._getStreams=X,this.tags=[],this._closing=!1}[Symbol.toStringTag]="Connection";[wx]=!0;get streams(){return this._getStreams()}async newStream(N,O){if(this.stat.status===wB)throw new n3("the connection is being closed","ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===wL)throw new n3("the connection is closed","ERR_CONNECTION_CLOSED");Array.isArray(N)||(N=[N]);let U=await this._newStream(N,O);return U.stat.direction="outbound",U}addStream(N){N.stat.direction="inbound"}removeStream(N){}async close(){if(this.stat.status!==wL&&!this._closing){this.stat.status=wB;try{this.streams.forEach(N=>{N.close()})}catch(N){wO.error(N)}this._closing=!0,await this._close(),this._closing=!1,this.stat.timeline.close=Date.now(),this.stat.status=wL}}}function wU(N){return new wM(N)}let wF=rF("libp2p:upgrader");function wV(N,O){try{let{options:U}=O.getHandler(N);return U.maxInboundStreams}catch(N){if(N.code!==eZ.ERR_NO_HANDLER_FOR_PROTOCOL)throw N}return wd}function wz(N,O,U={}){try{let{options:U}=O.getHandler(N);if(null!=U.maxOutboundStreams)return U.maxOutboundStreams}catch(N){if(N.code!==eZ.ERR_NO_HANDLER_FOR_PROTOCOL)throw N}return U.maxOutboundStreams??wp}function w$(N,O,U){let $=0;return U.streams.forEach(U=>{U.stat.direction===O&&U.stat.protocol===N&&$++}),$}class wK{components;connectionEncryption;muxers;inboundUpgradeTimeout;events;constructor(N,O){this.components=N,this.connectionEncryption=new Map,O.connectionEncryption.forEach(N=>{this.connectionEncryption.set(N.protocol,N)}),this.muxers=new Map,O.muxers.forEach(N=>{this.muxers.set(N.protocol,N)}),this.inboundUpgradeTimeout=O.inboundUpgradeTimeout??bE,this.events=N.events}async shouldBlockConnection(N,O,U){let $=this.components.connectionGater[U];if(void 0!==$&&await $(N,O))throw new n3(`The multiaddr connection is blocked by gater.${U}`,eZ.ERR_CONNECTION_INTERCEPTED)}async upgradeInbound(N,O){let U,$,Y,X,J;let Z=await this.components.connectionManager.acceptIncomingConnection(N);if(!Z)throw new n3("connection denied",eZ.ERR_CONNECTION_DENIED);let en=nY([AbortSignal.timeout(this.inboundUpgradeTimeout)]);try{oW.setMaxListeners?.(1/0,en)}catch{}try{let Z=sG(N,en);if(N.source=Z.source,N.sink=Z.sink,await this.components.connectionGater.denyInboundConnection?.(N)===!0)throw new n3("The multiaddr connection is blocked by gater.acceptConnection",eZ.ERR_CONNECTION_INTERCEPTED);this.components.metrics?.trackMultiaddrConnection(N),wF("starting the inbound connection upgrade");let es=N;if(O?.skipProtection!==!0){let O=this.components.connectionProtector;null!=O&&(wF("protecting the inbound connection"),es=await O.protect(N))}try{if(U=es,O?.skipEncryption!==!0){({conn:U,remotePeer:$,protocol:J}=await this._encryptInbound(es));let N={...es,...U};await this.shouldBlockConnection($,N,"denyInboundEncryptedConnection")}else{let O=N.remoteAddr.getPeerId();if(null==O)throw new n3("inbound connection that skipped encryption must have a peer id",eZ.ERR_INVALID_MULTIADDR);let U=gC(O);J="native",$=U}if(Y=U,O?.muxerFactory!=null)X=O.muxerFactory;else if(this.muxers.size>0){let N=await this._multiplexInbound({...es,...U},this.muxers);X=N.muxerFactory,Y=N.stream}}catch(N){throw wF.error("Failed to upgrade inbound connection",N),N}return await this.shouldBlockConnection($,N,"denyInboundUpgradedConnection"),wF("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:J,direction:"inbound",maConn:N,upgradedConn:Y,muxerFactory:X,remotePeer:$})}finally{this.components.connectionManager.afterUpgradeInbound(),en.clear()}}async upgradeOutbound(N,O){let U,$,Y,X,J,Z;let en=N.remoteAddr.getPeerId();null!=en&&(U=gC(en),await this.shouldBlockConnection(U,N,"denyOutboundConnection")),this.components.metrics?.trackMultiaddrConnection(N),wF("Starting the outbound connection upgrade");let es=N;if(O?.skipProtection!==!0){let O=this.components.connectionProtector;null!=O&&(es=await O.protect(N))}try{if($=es,O?.skipEncryption!==!0){({conn:$,remotePeer:Y,protocol:J}=await this._encryptOutbound(es,U));let N={...es,...$};await this.shouldBlockConnection(Y,N,"denyOutboundEncryptedConnection")}else{if(null==U)throw new n3("Encryption was skipped but no peer id was passed",eZ.ERR_INVALID_PEER);J="native",Y=U}if(X=$,O?.muxerFactory!=null)Z=O.muxerFactory;else if(this.muxers.size>0){let N=await this._multiplexOutbound({...es,...$},this.muxers);Z=N.muxerFactory,X=N.stream}}catch(O){throw wF.error("Failed to upgrade outbound connection",O),await N.close(O),O}return await this.shouldBlockConnection(Y,N,"denyOutboundUpgradedConnection"),wF("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:J,direction:"outbound",maConn:N,upgradedConn:X,muxerFactory:Z,remotePeer:Y})}_createConnection(N){let O,U,$;let{cryptoProtocol:Y,direction:X,maConn:J,upgradedConn:Z,remotePeer:en,muxerFactory:es}=N;null!=es&&(O=es.createStreamMuxer({direction:X,onIncomingStream:N=>{null!=$&&Promise.resolve().then(async()=>{let O=this.components.registrar.getProtocols(),{stream:U,protocol:Y}=await wP(N,O);if(wF("%s: incoming stream opened on %s",X,Y),null==$)return;let J=wV(Y,this.components.registrar),Z=w$(Y,"inbound",$);if(Z===J){let O=new n3(`Too many inbound protocol streams for protocol "${Y}" - limit ${J}`,eZ.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS);throw N.abort(O),O}N.source=U.source,N.sink=U.sink,N.stat.protocol=Y,await this.components.peerStore.merge(en,{protocols:[Y]}),$.addStream(N),this.components.metrics?.trackProtocolStream(N,$),this._onStream({connection:$,stream:N,protocol:Y})}).catch(O=>{wF.error(O),null==N.stat.timeline.close&&N.close()})},onStreamEnd:N=>{$?.removeStream(N.id)}}),U=async(N,U={})=>{if(null==O)throw new n3("Stream is not multiplexed",eZ.ERR_MUXER_UNAVAILABLE);wF("%s: starting new stream on %s",X,N);let Y=await O.newStream();try{if(null==U.signal){wF("No abort signal was passed while trying to negotiate protocols %s falling back to default timeout",N),U.signal=AbortSignal.timeout(3e4);try{oW.setMaxListeners?.(1/0,U.signal)}catch{}}let{stream:O,protocol:X}=await wT(Y,N,U),J=wz(X,this.components.registrar,U),Z=w$(X,"outbound",$);if(Z>=J){let N=new n3(`Too many outbound protocol streams for protocol "${X}" - limit ${J}`,eZ.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw Y.abort(N),N}return await this.components.peerStore.merge(en,{protocols:[X]}),Y.source=O.source,Y.sink=O.sink,Y.stat.protocol=X,this.components.metrics?.trackProtocolStream(Y,$),Y}catch(N){if(wF.error("could not create new stream",N),null==Y.stat.timeline.close&&Y.close(),null!=N.code)throw N;throw new n3(String(N),eZ.ERR_UNSUPPORTED_PROTOCOL)}},Promise.all([O.sink(Z.source),Z.sink(O.source)]).catch(N=>{wF.error(N)}));let eo=J.timeline;J.timeline=new Proxy(eo,{set:(...N)=>(null!=$&&"close"===N[1]&&null!=N[2]&&null==eo.close&&(async()=>{try{"OPEN"===$.stat.status&&await $.close()}catch(N){wF.error(N)}finally{this.events.safeDispatchEvent("connection:close",{detail:$})}})().catch(N=>{wF.error(N)}),Reflect.set(...N))}),J.timeline.upgraded=Date.now();let ea=()=>{throw new n3("connection is not multiplexed",eZ.ERR_CONNECTION_NOT_MULTIPLEXED)};return $=wU({remoteAddr:J.remoteAddr,remotePeer:en,stat:{status:"OPEN",direction:X,timeline:J.timeline,multiplexer:O?.protocol,encryption:Y},newStream:U??ea,getStreams:()=>null!=O?O.streams:ea(),close:async()=>{await J.close(),null!=O&&O.close()}}),this.events.safeDispatchEvent("connection:open",{detail:$}),$}_onStream(N){let{connection:O,stream:U,protocol:$}=N,{handler:Y}=this.components.registrar.getHandler($);Y({connection:O,stream:U})}async _encryptInbound(N){let O=Array.from(this.connectionEncryption.keys());wF("handling inbound crypto protocol selection",O);try{let{stream:U,protocol:$}=await wP(N,O,{writeBytes:!0}),Y=this.connectionEncryption.get($);if(null==Y)throw Error(`no crypto module found for ${$}`);return wF("encrypting inbound connection..."),{...await Y.secureInbound(this.components.peerId,U),protocol:$}}catch(N){throw new n3(String(N),eZ.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(N,O){let U=Array.from(this.connectionEncryption.keys());wF("selecting outbound crypto protocol",U);try{let{stream:$,protocol:Y}=await wT(N,U,{writeBytes:!0}),X=this.connectionEncryption.get(Y);if(null==X)throw Error(`no crypto module found for ${Y}`);return wF("encrypting outbound connection to %p",O),{...await X.secureOutbound(this.components.peerId,$,O),protocol:Y}}catch(N){throw new n3(String(N),eZ.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(N,O){let U=Array.from(O.keys());wF("outbound selecting muxer %s",U);try{let{stream:$,protocol:Y}=await wT(N,U,{writeBytes:!0});wF("%s selected as muxer protocol",Y);let X=O.get(Y);return{stream:$,muxerFactory:X}}catch(N){throw wF.error("error multiplexing outbound stream",N),new n3(String(N),eZ.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(N,O){let U=Array.from(O.keys());wF("inbound handling muxers %s",U);try{let{stream:$,protocol:Y}=await wP(N,U,{writeBytes:!0}),X=O.get(Y);return{stream:$,muxerFactory:X}}catch(N){throw wF.error("error multiplexing inbound stream",N),new n3(String(N),eZ.ERR_MUXER_UNAVAILABLE)}}}let wq=rF("libp2p");class wj extends gh{peerId;peerStore;contentRouting;peerRouting;keychain;metrics;services;components;#d;constructor(N){super();let O=new gh,U=O.dispatchEvent.bind(O);O.dispatchEvent=N=>{let O=U(N),$=this.dispatchEvent(new gp(N.type,{detail:N.detail}));return O||$};try{oW.setMaxListeners?.(1/0,O)}catch{}this.#d=!1,this.peerId=N.peerId,this.services={};let $=this.components=mT({peerId:N.peerId,events:O,datastore:N.datastore??new nQ,connectionGater:mY(N.connectionGater)});this.peerStore=this.configureComponent("peerStore",new mw($,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...N.peerStore})),null!=N.metrics&&(this.metrics=this.configureComponent("metrics",N.metrics(this.components))),$.events.addEventListener("peer:update",N=>{null==N.detail.previous&&this.safeDispatchEvent("peer:discovery",{detail:N.detail.peer})}),null!=N.connectionProtector&&this.configureComponent("connectionProtector",N.connectionProtector($)),this.components.upgrader=new wK(this.components,{connectionEncryption:(N.connectionEncryption??[]).map((N,O)=>this.configureComponent(`connection-encryption-${O}`,N(this.components))),muxers:(N.streamMuxers??[]).map((N,O)=>this.configureComponent(`stream-muxers-${O}`,N(this.components))),inboundUpgradeTimeout:N.connectionManager.inboundUpgradeTimeout}),this.configureComponent("transportManager",new wy(this.components,N.transportManager)),this.configureComponent("connectionManager",new bX(this.components,N.connectionManager)),this.configureComponent("registrar",new wf(this.components)),this.configureComponent("addressManager",new mI(this.components,N.addresses));let Y=gW.generateOptions();this.keychain=this.configureComponent("keyChain",new gW(this.components,{...Y,...N.keychain}));let X=(N.peerRouters??[]).map((N,O)=>this.configureComponent(`peer-router-${O}`,N(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new wc(this.components,{routers:X}));let J=(N.contentRouters??[]).map((N,O)=>this.configureComponent(`content-router-${O}`,N(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new wr(this.components,{routers:J})),(N.peerDiscovery??[]).forEach((N,O)=>{let U=this.configureComponent(`peer-discovery-${O}`,N(this.components));U.addEventListener("peer",N=>{this.#p(N)})}),N.transports.forEach((N,O)=>{this.components.transportManager.add(this.configureComponent(`transport-${O}`,N(this.components)))}),null!=N.services)for(let O of Object.keys(N.services)){let U=N.services[O],$=U(this.components);if(null==$){wq.error("service factory %s returned null or undefined instance",O);continue}this.services[O]=$,this.configureComponent(O,$),null!=$[gl]&&(wq("registering service %s for content routing",O),J.push($[gl])),null!=$[gu]&&(wq("registering service %s for peer routing",O),X.push($[gu])),null!=$[gc]&&(wq("registering service %s for peer discovery",O),$[gc].addEventListener("peer",N=>{this.#p(N)}))}}configureComponent(N,O){return null==O&&wq.error("component %s was null or undefined",N),this.components[N]=O,O}async start(){if(this.#d)return;this.#d=!0,wq("libp2p is starting");let N=await this.keychain.listKeys();null==N.find(N=>"self"===N.name)&&(wq("importing self key into keychain"),await this.keychain.importPeer("self",this.components.peerId));try{await this.components.beforeStart?.(),await this.components.start(),await this.components.afterStart?.(),this.safeDispatchEvent("start",{detail:this}),wq("libp2p has started")}catch(N){throw wq.error("An error occurred starting libp2p",N),await this.stop(),N}}async stop(){this.#d&&(wq("libp2p is stopping"),this.#d=!1,await this.components.beforeStop?.(),await this.components.stop(),await this.components.afterStop?.(),this.safeDispatchEvent("stop",{detail:this}),wq("libp2p has stopped"))}isStarted(){return this.#d}getConnections(N){return this.components.connectionManager.getConnections(N)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){let N=new gQ;for(let O of this.components.connectionManager.getConnections())N.add(O.remotePeer);return Array.from(N)}async dial(N,O={}){return this.components.connectionManager.openConnection(N,O)}async dialProtocol(N,O,U={}){if(null==O||0===(O=Array.isArray(O)?O:[O]).length)throw new n3("no protocols were provided to open a stream",eZ.ERR_INVALID_PROTOCOLS_FOR_STREAM);let $=await this.dial(N,U);return $.newStream(O,U)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(N){yJ(N)&&(N=gC(N.getPeerId()??"")),await this.components.connectionManager.closeConnections(N)}async getPublicKey(N,O={}){if(wq("getPublicKey %p",N),null!=N.publicKey)return N.publicKey;let U=await this.peerStore.get(N);if(null!=U.id.publicKey)return U.id.publicKey;let $=sQ([nD("/pk/"),N.multihash.digest]),Y=await this.contentRouting.get($,O);return gi(Y),await this.peerStore.patch(N,{publicKey:Y}),Y}async handle(N,O,U){Array.isArray(N)||(N=[N]),await Promise.all(N.map(async N=>{await this.components.registrar.handle(N,O,U)}))}async unhandle(N){Array.isArray(N)||(N=[N]),await Promise.all(N.map(async N=>{await this.components.registrar.unhandle(N)}))}async register(N,O){return this.components.registrar.register(N,O)}unregister(N){this.components.registrar.unregister(N)}#p(N){let{detail:O}=N;if(O.id.toString()===this.peerId.toString()){wq.error(Error(eZ.ERR_DISCOVERED_SELF));return}this.components.peerStore.merge(O.id,{multiaddrs:O.multiaddrs,protocols:O.protocols}).catch(N=>{wq.error(N)})}}async function wW(N){if(null==N.peerId){let O=N.datastore;if(null!=O)try{let U=new gW({datastore:O},gB(gW.generateOptions(),N.keychain));N.peerId=await U.exportPeerId("self")}catch(N){if("ERR_NOT_FOUND"!==N.code)throw N}}return null==N.peerId&&(N.peerId=await gX()),new wj(bc(N))}async function wH(N){let O=await wW(N);return!1!==N.start&&await O.start(),O}class wG{constructor(N,O,U){this.gossip=N,this.msgs=new Map,this.history=[],this.notValidatedCount=0,this.msgIdToStrFn=U;for(let N=0;N<O;N++)this.history[N]=[]}get size(){return this.msgs.size}put(N,O,U=!1){let{msgIdStr:$}=N;return!this.msgs.has($)&&(this.msgs.set($,{message:O,validated:U,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...N,topic:O.topic}),!U&&this.notValidatedCount++,!0)}observeDuplicate(N,O){let U=this.msgs.get(N);U&&!U.validated&&U.originatingPeers.add(O)}get(N){return this.msgs.get(this.msgIdToStrFn(N))?.message}getWithIWantCount(N,O){let U=this.msgs.get(N);if(!U)return null;let $=(U.iwantCounts.get(O)??0)+1;return U.iwantCounts.set(O,$),{msg:U.message,count:$}}getGossipIDs(N){let O=new Map;for(let U=0;U<this.gossip;U++)this.history[U].forEach(U=>{let $=this.msgs.get(U.msgIdStr);if($&&$.validated&&N.has(U.topic)){let N=O.get(U.topic);N||(N=[],O.set(U.topic,N)),N.push(U.msgId)}});return O}validate(N){let O=this.msgs.get(N);if(!O)return null;!O.validated&&this.notValidatedCount--;let{message:U,originatingPeers:$}=O;return O.validated=!0,O.originatingPeers=new Set,{message:U,originatingPeers:$}}shift(){let N=this.history[this.history.length-1];N.forEach(N=>{let O=this.msgs.get(N.msgIdStr);O&&(this.msgs.delete(N.msgIdStr),!O.validated&&this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(N){let O=this.msgs.get(N);return O?(this.msgs.delete(N),O):null}}var wQ=U(4482);let{RPC:wY}=wQ,wX=1e3,wJ=60*wX,wZ="/floodsub/1.0.0",w1="/meshsub/1.0.0",w0="/meshsub/1.1.0",w3=6,w4=4,w5=12,w6=4,w8=2,w9=5,ve=3,vt=6,vr=.25,vn=3,vs=100,vo=wX,va=wJ,vl=16,vc=wJ,vu=15,vh=300,vd=wX,vp=60,vf=2,vg=10*wX,vy=5e3,vm=10,vb=3*wX,vw=2*wJ,vE=12e4,v_="ERR_TOPIC_VALIDATOR_REJECT",vS="ERR_TOPIC_VALIDATOR_IGNORE",vI=0,vR=128,vk=1e3,vD=1e3;function vA(N){if(N.length<=1)return N;let O=()=>Math.floor(Math.random()*Math.floor(N.length));for(let U=0;U<N.length;U++){let $=O(),Y=N[U];N[U]=N[$],N[$]=Y}return N}function vT(N){return nA(N,"base64")}let vC="StrictSign",vP="StrictNoSign";function vx(N){switch(N){case e0.Ignore:return e6.Ignore;case e0.Reject:return e6.Reject}}async function vN(N,O){switch(N){case vC:{if(!O)throw Error("Must provide PeerId");if(null==O.privateKey)throw Error("Cannot sign message, no private key present");if(null==O.publicKey)throw Error("Cannot sign message, no public key present");let N=await gs(O.privateKey);return{type:e5.Signing,author:O,key:O.publicKey,privateKey:N}}case vP:return{type:e5.Anonymous};default:throw Error(`Unknown signature policy "${N}"`)}}!function(N){N.Accept="accept",N.Ignore="ignore",N.Reject="reject"}(e0||(e0={})),function(N){N.StrictSign="StrictSign",N.StrictNoSign="StrictNoSign"}(e3||(e3={})),function(N){N[N.Signing=0]="Signing",N[N.Anonymous=1]="Anonymous"}(e5||(e5={})),function(N){N.Error="error",N.Ignore="ignore",N.Reject="reject",N.Blacklisted="blacklisted"}(e6||(e6={})),function(N){N.InvalidSignature="invalid_signature",N.InvalidSeqno="invalid_seqno",N.InvalidPeerId="invalid_peerid",N.SignaturePresent="signature_present",N.SeqnoPresent="seqno_present",N.FromPresent="from_present",N.TransformFailed="transform_failed"}(e7||(e7={})),function(N){N.duplicate="duplicate",N.invalid="invalid",N.valid="valid"}(e9||(e9={}));let vB="ERR_INVALID_PEER_SCORE_PARAMS",vL={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:36e5},vO={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function vM(N={}){return{...vL,...N,topics:N.topics?Object.entries(N.topics).reduce((N,[O,U])=>(N[O]=vU(U),N),{}):{}}}function vU(N={}){return{...vO,...N}}function vF(N){for(let[O,U]of Object.entries(N.topics))try{vV(U)}catch(N){throw new n3(`invalid score parameters for topic ${O}: ${N.message}`,vB)}if(N.topicScoreCap<0)throw new n3("invalid topic score cap; must be positive (or 0 for no cap)",vB);if(null===N.appSpecificScore||void 0===N.appSpecificScore)throw new n3("missing application specific score function",vB);if(N.IPColocationFactorWeight>0)throw new n3("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",vB);if(0!==N.IPColocationFactorWeight&&N.IPColocationFactorThreshold<1)throw new n3("invalid IPColocationFactorThreshold; must be at least 1",vB);if(N.behaviourPenaltyWeight>0)throw new n3("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",vB);if(0!==N.behaviourPenaltyWeight&&(N.behaviourPenaltyDecay<=0||N.behaviourPenaltyDecay>=1))throw new n3("invalid BehaviourPenaltyDecay; must be between 0 and 1",vB);if(N.decayInterval<1e3)throw new n3("invalid DecayInterval; must be at least 1s",vB);if(N.decayToZero<=0||N.decayToZero>=1)throw new n3("invalid DecayToZero; must be between 0 and 1",vB)}function vV(N){if(N.topicWeight<0)throw new n3("invalid topic weight; must be >= 0",vB);if(0===N.timeInMeshQuantum)throw new n3("invalid TimeInMeshQuantum; must be non zero",vB);if(N.timeInMeshWeight<0)throw new n3("invalid TimeInMeshWeight; must be positive (or 0 to disable)",vB);if(0!==N.timeInMeshWeight&&N.timeInMeshQuantum<=0)throw new n3("invalid TimeInMeshQuantum; must be positive",vB);if(0!==N.timeInMeshWeight&&N.timeInMeshCap<=0)throw new n3("invalid TimeInMeshCap; must be positive",vB);if(N.firstMessageDeliveriesWeight<0)throw new n3("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",vB);if(0!==N.firstMessageDeliveriesWeight&&(N.firstMessageDeliveriesDecay<=0||N.firstMessageDeliveriesDecay>=1))throw new n3("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",vB);if(0!==N.firstMessageDeliveriesWeight&&N.firstMessageDeliveriesCap<=0)throw new n3("invalid FirstMessageDeliveriesCap; must be positive",vB);if(N.meshMessageDeliveriesWeight>0)throw new n3("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",vB);if(0!==N.meshMessageDeliveriesWeight&&(N.meshMessageDeliveriesDecay<=0||N.meshMessageDeliveriesDecay>=1))throw new n3("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",vB);if(0!==N.meshMessageDeliveriesWeight&&N.meshMessageDeliveriesCap<=0)throw new n3("invalid MeshMessageDeliveriesCap; must be positive",vB);if(0!==N.meshMessageDeliveriesWeight&&N.meshMessageDeliveriesThreshold<=0)throw new n3("invalid MeshMessageDeliveriesThreshold; must be positive",vB);if(N.meshMessageDeliveriesWindow<0)throw new n3("invalid MeshMessageDeliveriesWindow; must be non-negative",vB);if(0!==N.meshMessageDeliveriesWeight&&N.meshMessageDeliveriesActivation<1e3)throw new n3("invalid MeshMessageDeliveriesActivation; must be at least 1s",vB);if(N.meshFailurePenaltyWeight>0)throw new n3("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",vB);if(0!==N.meshFailurePenaltyWeight&&(N.meshFailurePenaltyDecay<=0||N.meshFailurePenaltyDecay>=1))throw new n3("invalid MeshFailurePenaltyDecay; must be between 0 and 1",vB);if(N.invalidMessageDeliveriesWeight>0)throw new n3("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",vB);if(N.invalidMessageDeliveriesDecay<=0||N.invalidMessageDeliveriesDecay>=1)throw new n3("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",vB)}let vz={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function v$(N={}){return{...vz,...N}}function vK(N,O,U,$){let Y=0;Object.entries(O.topics).forEach(([N,O])=>{let $=U.topics[N];if(void 0===$)return;let X=0;if(O.inMesh){let N=O.meshTime/$.timeInMeshQuantum;N>$.timeInMeshCap&&(N=$.timeInMeshCap),X+=N*$.timeInMeshWeight}let J=O.firstMessageDeliveries;if(J>$.firstMessageDeliveriesCap&&(J=$.firstMessageDeliveriesCap),X+=J*$.firstMessageDeliveriesWeight,O.meshMessageDeliveriesActive&&O.meshMessageDeliveries<$.meshMessageDeliveriesThreshold){let N=$.meshMessageDeliveriesThreshold-O.meshMessageDeliveries,U=N*N;X+=U*$.meshMessageDeliveriesWeight}let Z=O.meshFailurePenalty;X+=Z*$.meshFailurePenaltyWeight;let en=O.invalidMessageDeliveries*O.invalidMessageDeliveries;X+=en*$.invalidMessageDeliveriesWeight,Y+=X*$.topicWeight}),U.topicScoreCap>0&&Y>U.topicScoreCap&&(Y=U.topicScoreCap);let X=U.appSpecificScore(N);if(Y+=X*U.appSpecificWeight,O.knownIPs.forEach(N=>{if(U.IPColocationFactorWhitelist.has(N))return;let O=$.get(N),X=O?O.size:0;if(X>U.IPColocationFactorThreshold){let N=X-U.IPColocationFactorThreshold,O=N*N;Y+=O*U.IPColocationFactorWeight}}),O.behaviourPenalty>U.behaviourPenaltyThreshold){let N=O.behaviourPenalty-U.behaviourPenaltyThreshold,$=N*N;Y+=$*U.behaviourPenaltyWeight}return Y}var vq=U(5001);!function(N){N[N.unknown=0]="unknown",N[N.valid=1]="valid",N[N.invalid=2]="invalid",N[N.ignored=3]="ignored"}(te||(te={}));class vj{constructor(){this.records=new Map,this.queue=new vq}ensureRecord(N){let O=this.records.get(N);if(O)return O;O={status:te.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(N,O);let U={msgId:N,expire:Date.now()+vE};return this.queue.push(U),O}gc(){let N=Date.now(),O=this.queue.peekFront();for(;O&&O.expire<N;)this.records.delete(O.msgId),this.queue.shift(),O=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}function vW(N,O,U=()=>!0){let $=new Set;if(O<=0)return $;for(let Y of N){if($.size>=O)break;U(Y)&&($.add(Y),N.delete(Y))}return $}function vH(N,O){return vW(N,O,()=>!0)}class vG extends Map{constructor(N){super(),this.getDefault=N}getOrDefault(N){let O=super.get(N);return void 0===O&&(O=this.getDefault(),this.set(N,O)),O}}let vQ=rF("libp2p:gossipsub:score");class vY{constructor(N,O,U){this.params=N,this.metrics=O,this.peerStats=new Map,this.peerIPs=new vG(()=>new Set),this.scoreCache=new Map,this.deliveryRecords=new vj,vF(N),this.scoreCacheValidityMs=U.scoreCacheValidityMs,this.computeScore=U.computeScore??vK}get size(){return this.peerStats.size}start(){if(this._backgroundInterval){vQ("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),vQ("started")}stop(){if(!this._backgroundInterval){vQ("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),vQ("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([N,O])=>[N,O]))}refreshScores(){let N=Date.now(),O=this.params.decayToZero;this.peerStats.forEach((U,$)=>{if(!U.connected){N>U.expire&&(this.removeIPsForPeer($,U.knownIPs),this.peerStats.delete($),this.scoreCache.delete($));return}Object.entries(U.topics).forEach(([U,$])=>{let Y=this.params.topics[U];void 0!==Y&&($.firstMessageDeliveries*=Y.firstMessageDeliveriesDecay,$.firstMessageDeliveries<O&&($.firstMessageDeliveries=0),$.meshMessageDeliveries*=Y.meshMessageDeliveriesDecay,$.meshMessageDeliveries<O&&($.meshMessageDeliveries=0),$.meshFailurePenalty*=Y.meshFailurePenaltyDecay,$.meshFailurePenalty<O&&($.meshFailurePenalty=0),$.invalidMessageDeliveries*=Y.invalidMessageDeliveriesDecay,$.invalidMessageDeliveries<O&&($.invalidMessageDeliveries=0),$.inMesh&&($.meshTime=N-$.graftTime,$.meshTime>Y.meshMessageDeliveriesActivation&&($.meshMessageDeliveriesActive=!0)))}),U.behaviourPenalty*=this.params.behaviourPenaltyDecay,U.behaviourPenalty<O&&(U.behaviourPenalty=0)})}score(N){this.metrics?.scoreFnCalls.inc();let O=this.peerStats.get(N);if(!O)return 0;let U=Date.now(),$=this.scoreCache.get(N);if($&&$.cacheUntil>U)return $.score;this.metrics?.scoreFnRuns.inc();let Y=this.computeScore(N,O,this.params,this.peerIPs),X=U+this.scoreCacheValidityMs;return $?(this.metrics?.scoreCachedDelta.observe(Math.abs(Y-$.score)),$.score=Y,$.cacheUntil=X):this.scoreCache.set(N,{score:Y,cacheUntil:X}),Y}addPenalty(N,O,U){let $=this.peerStats.get(N);$&&($.behaviourPenalty+=O,this.metrics?.onScorePenalty(U))}addPeer(N){let O={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(N,O)}addIP(N,O){let U=this.peerStats.get(N);U&&U.knownIPs.add(O),this.peerIPs.getOrDefault(O).add(N)}removeIP(N,O){let U=this.peerStats.get(N);U&&U.knownIPs.delete(O);let $=this.peerIPs.get(O);$&&($.delete(N),0===$.size&&this.peerIPs.delete(O))}removePeer(N){let O=this.peerStats.get(N);if(O){if(this.score(N)>0){this.removeIPsForPeer(N,O.knownIPs),this.peerStats.delete(N);return}Object.entries(O.topics).forEach(([N,O])=>{O.firstMessageDeliveries=0;let U=this.params.topics[N].meshMessageDeliveriesThreshold;if(O.inMesh&&O.meshMessageDeliveriesActive&&O.meshMessageDeliveries<U){let N=U-O.meshMessageDeliveries;O.meshFailurePenalty+=N*N}O.inMesh=!1,O.meshMessageDeliveriesActive=!1}),O.connected=!1,O.expire=Date.now()+this.params.retainScore}}graft(N,O){let U=this.peerStats.get(N);if(U){let N=this.getPtopicStats(U,O);N&&(N.inMesh=!0,N.graftTime=Date.now(),N.meshTime=0,N.meshMessageDeliveriesActive=!1)}}prune(N,O){let U=this.peerStats.get(N);if(U){let N=this.getPtopicStats(U,O);if(N){let U=this.params.topics[O].meshMessageDeliveriesThreshold;if(N.meshMessageDeliveriesActive&&N.meshMessageDeliveries<U){let O=U-N.meshMessageDeliveries;N.meshFailurePenalty+=O*O}N.meshMessageDeliveriesActive=!1,N.inMesh=!1}}}validateMessage(N){this.deliveryRecords.ensureRecord(N)}deliverMessage(N,O,U){this.markFirstMessageDelivery(N,U);let $=this.deliveryRecords.ensureRecord(O),Y=Date.now();if($.status!==te.unknown){vQ("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",N,Y-$.firstSeen,te[$.status]);return}$.status=te.valid,$.validated=Y,$.peers.forEach(O=>{O!==N.toString()&&this.markDuplicateMessageDelivery(O,U)})}rejectInvalidMessage(N,O){this.markInvalidMessageDelivery(N,O)}rejectMessage(N,O,U,$){switch($){case e6.Error:this.markInvalidMessageDelivery(N,U);return;case e6.Blacklisted:return}let Y=this.deliveryRecords.ensureRecord(O);if(Y.status!==te.unknown){vQ("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",N,Date.now()-Y.firstSeen,te[Y.status]);return}if($===e6.Ignore){Y.status=te.ignored,Y.peers.clear();return}Y.status=te.invalid,this.markInvalidMessageDelivery(N,U),Y.peers.forEach(N=>{this.markInvalidMessageDelivery(N,U)}),Y.peers.clear()}duplicateMessage(N,O,U){let $=this.deliveryRecords.ensureRecord(O);if(!$.peers.has(N))switch($.status){case te.unknown:$.peers.add(N);break;case te.valid:$.peers.add(N),this.markDuplicateMessageDelivery(N,U,$.validated);break;case te.invalid:this.markInvalidMessageDelivery(N,U);case te.ignored:}}markInvalidMessageDelivery(N,O){let U=this.peerStats.get(N);if(U){let N=this.getPtopicStats(U,O);N&&(N.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(N,O){let U=this.peerStats.get(N);if(U){let N=this.getPtopicStats(U,O);if(N){let U=this.params.topics[O].firstMessageDeliveriesCap;N.firstMessageDeliveries=Math.min(U,N.firstMessageDeliveries+1),N.inMesh&&(U=this.params.topics[O].meshMessageDeliveriesCap,N.meshMessageDeliveries=Math.min(U,N.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(N,O,U){let $=this.peerStats.get(N);if($){let N=void 0!==U?Date.now():0,Y=this.getPtopicStats($,O);if(Y&&Y.inMesh){let $=this.params.topics[O];if(void 0!==U){let Y=N-U,X=Y>$.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(O,Y,X),X)return}let X=$.meshMessageDeliveriesCap;Y.meshMessageDeliveries=Math.min(X,Y.meshMessageDeliveries+1)}}}removeIPsForPeer(N,O){for(let U of O){let O=this.peerIPs.get(U);O&&(O.delete(N),0===O.size&&this.peerIPs.delete(U))}}getPtopicStats(N,O){let U=N.topics[O];return void 0!==U?U:void 0!==this.params.topics[O]?(U={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},N.topics[O]=U,U):null}}class vX{constructor(N,O,U){this.gossipsubIWantFollowupMs=N,this.msgIdToStrFn=O,this.metrics=U,this.promises=new Map,this.requestMsByMsg=new Map,this.requestMsByMsgExpire=10*N}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(N,O){let U=Math.floor(Math.random()*O.length),$=O[U],Y=this.msgIdToStrFn($),X=this.promises.get(Y);X||(X=new Map,this.promises.set(Y,X));let J=Date.now();X.has(N)||(X.set(N,J+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(Y)||this.requestMsByMsg.set(Y,J)))}getBrokenPromises(){let N=Date.now(),O=new Map,U=0;return this.promises.forEach(($,Y)=>{$.forEach((Y,X)=>{Y<N&&(O.set(X,(O.get(X)??0)+1),$.delete(X),U++)}),$.size||this.promises.delete(Y)}),this.metrics?.iwantPromiseBroken.inc(U),O}deliverMessage(N,O=!1){this.trackMessage(N);let U=this.promises.get(N);U&&(this.promises.delete(N),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),O&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(U.size)))}rejectMessage(N,O){this.trackMessage(N),O!==e6.Error&&this.promises.delete(N)}clear(){this.promises.clear()}prune(){let N=Date.now()-this.requestMsByMsgExpire,O=0;for(let[U,$]of this.requestMsByMsg.entries())if($<N)this.requestMsByMsg.delete(U),O++;else break;this.metrics?.iwantMessagePruned.inc(O)}trackMessage(N){if(this.metrics){let O=this.requestMsByMsg.get(N);void 0!==O&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-O)/1e3),this.requestMsByMsg.delete(N))}}}class vJ{constructor(N){this.entries=new Map,this.validityMs=N.validityMs}get size(){return this.entries.size}put(N,O){return!!this.entries.has(N)||(this.entries.set(N,{value:O,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){let N=Date.now();for(let[O,U]of this.entries.entries())if(U.validUntilMs<N)this.entries.delete(O);else break}has(N){return this.entries.has(N)}get(N){let O=this.entries.get(N);return O&&O.validUntilMs>=Date.now()?O.value:void 0}clear(){this.entries.clear()}}function vZ(N,O,U){return{protocolsEnabled:N.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:N.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:N.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:N.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEvents:N.gauge({name:"gossipsub_mesh_peer_inclusion_events_total",help:"Number of times we include peers in a topic mesh for different reasons",labelNames:["reason"]}),meshPeerInclusionEventsByTopic:N.gauge({name:"gossipsub_mesh_peer_inclusion_events_by_topic_total",help:"Number of times we include peers in a topic",labelNames:["topic"]}),meshPeerChurnEvents:N.gauge({name:"gossipsub_peer_churn_events_total",help:"Number of times we remove peers in a topic mesh for different reasons",labelNames:["reason"]}),meshPeerChurnEventsByTopic:N.gauge({name:"gossipsub_peer_churn_events_by_topic_total",help:"Number of times we remove peers in a topic",labelNames:["topic"]}),peersPerProtocol:N.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:N.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:N.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),asyncValidationResult:N.gauge({name:"gossipsub_async_validation_result_total",help:"Message validation result",labelNames:["acceptance"]}),asyncValidationResultByTopic:N.gauge({name:"gossipsub_async_validation_result_by_topic_total",help:"Message validation result for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:N.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),peerReadStreamError:N.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:N.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:N.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:N.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:N.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:N.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:N.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:N.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:N.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:N.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:N.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:N.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:N.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:N.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:N.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:N.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:N.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:N.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:N.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:N.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:N.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:N.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:N.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:N.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),msgPublishPeersByGroup:N.gauge({name:"gossipsub_msg_publish_peers_by_group",help:"Total count of peers (by group) that we publish a msg to",labelNames:["peerGroup"]}),msgPublishBytes:N.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgForwardCount:N.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:N.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:N.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:N.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),msgReceivedStatus:N.gauge({name:"gossipsub_msg_received_status_total",help:"Tracks distribution of recv msgs by duplicate, invalid, valid",labelNames:["status"]}),msgReceivedTopic:N.gauge({name:"gossipsub_msg_received_topic_total",help:"Tracks distribution of recv msgs by topic label",labelNames:["topic"]}),msgReceivedInvalid:N.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:N.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:N.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*U.maxMeshMessageDeliveriesWindowSec,.5*U.maxMeshMessageDeliveriesWindowSec,1*U.maxMeshMessageDeliveriesWindowSec,2*U.maxMeshMessageDeliveriesWindowSec,4*U.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:N.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:N.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:N.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:N.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:N.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:N.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:N.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:N.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:N.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:N.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:N.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*U.behaviourPenaltyThreshold,.5*U.behaviourPenaltyThreshold,1*U.behaviourPenaltyThreshold,2*U.behaviourPenaltyThreshold,4*U.behaviourPenaltyThreshold]}),ihaveRcvIgnored:N.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:N.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:N.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:N.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:N.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:N.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:N.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:N.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:N.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:N.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:N.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:N.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*U.gossipPromiseExpireSec,1*U.gossipPromiseExpireSec,2*U.gossipPromiseExpireSec,4*U.gossipPromiseExpireSec]}),iwantPromiseUntracked:N.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),cacheSize:N.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:N.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:N.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:N.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:N.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:O,toTopic(N){return this.topicStrToLabel.get(N)??N},onJoin(N){this.topicSubscriptionStatus.set({topicStr:N},1),this.meshPeerCounts.set({topicStr:N},0)},onLeave(N){this.topicSubscriptionStatus.set({topicStr:N},0),this.meshPeerCounts.set({topicStr:N},0)},onAddToMesh(N,O,U){let $=this.toTopic(N);this.meshPeerInclusionEvents.inc({reason:O},U),this.meshPeerInclusionEventsByTopic.inc({topic:$},U)},onRemoveFromMesh(N,O,U){let $=this.toTopic(N);this.meshPeerChurnEvents.inc({reason:O},U),this.meshPeerChurnEventsByTopic.inc({topic:$},U)},onReportValidationMcacheHit(N){this.asyncValidationMcacheHit.inc({hit:N?"hit":"miss"})},onReportValidation(N,O){let U=this.toTopic(N);this.asyncValidationResult.inc({acceptance:O}),this.asyncValidationResultByTopic.inc({topic:U})},onScorePenalty(N){this.scoringPenalties.inc({penalty:N},1)},onIhaveRcv(N,O,U){let $=this.toTopic(N);this.ihaveRcvMsgids.inc({topic:$},O),this.ihaveRcvNotSeenMsgids.inc({topic:$},U)},onIwantRcv(N,O){for(let[O,U]of N){let N=this.toTopic(O);this.iwantRcvMsgids.inc({topic:N},U)}this.iwantRcvDonthaveMsgids.inc(O)},onForwardMsg(N,O){let U=this.toTopic(N);this.msgForwardCount.inc({topic:U},1),this.msgForwardPeers.inc({topic:U},O)},onPublishMsg(N,O,U,$){let Y=this.toTopic(N);this.msgPublishCount.inc({topic:Y},1),this.msgPublishBytes.inc({topic:Y},U*$),this.msgPublishPeersByTopic.inc({topic:Y},U),this.msgPublishPeersByGroup.inc({peerGroup:"direct"},O.direct),this.msgPublishPeersByGroup.inc({peerGroup:"floodsub"},O.floodsub),this.msgPublishPeersByGroup.inc({peerGroup:"mesh"},O.mesh),this.msgPublishPeersByGroup.inc({peerGroup:"fanout"},O.fanout)},onMsgRecvPreValidation(N){let O=this.toTopic(N);this.msgReceivedPreValidation.inc({topic:O},1)},onMsgRecvError(N){let O=this.toTopic(N);this.msgReceivedError.inc({topic:O},1)},onMsgRecvResult(N,O){let U=this.toTopic(N);this.msgReceivedTopic.inc({topic:U}),this.msgReceivedStatus.inc({status:O})},onMsgRecvInvalid(N,O){let U=this.toTopic(N),$=O.reason===e6.Error?O.error:O.reason;this.msgReceivedInvalid.inc({error:$},1),this.msgReceivedInvalidByTopic.inc({topic:U},1)},onDuplicateMsgDelivery(N,O,U){if(this.duplicateMsgDeliveryDelay.observe(O/1e3),U){let O=this.toTopic(N);this.duplicateMsgLateDelivery.inc({topic:O},1)}},onPublishDuplicateMsg(N){let O=this.toTopic(N);this.duplicateMsgIgnored.inc({topic:O},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(N,O){this.rpcRecvBytes.inc(O),this.rpcRecvCount.inc(1),N.subscriptions&&this.rpcRecvSubscription.inc(N.subscriptions.length),N.messages&&this.rpcRecvMessage.inc(N.messages.length),N.control&&(this.rpcRecvControl.inc(1),N.control.ihave&&this.rpcRecvIHave.inc(N.control.ihave.length),N.control.iwant&&this.rpcRecvIWant.inc(N.control.iwant.length),N.control.graft&&this.rpcRecvGraft.inc(N.control.graft.length),N.control.prune&&this.rpcRecvPrune.inc(N.control.prune.length))},onRpcSent(N,O){if(this.rpcSentBytes.inc(O),this.rpcSentCount.inc(1),N.subscriptions&&this.rpcSentSubscription.inc(N.subscriptions.length),N.messages&&this.rpcSentMessage.inc(N.messages.length),N.control){let O=N.control.ihave?.length??0,U=N.control.iwant?.length??0,$=N.control.graft?.length??0,Y=N.control.prune?.length??0;O>0&&this.rpcSentIHave.inc(O),U>0&&this.rpcSentIWant.inc(U),$>0&&this.rpcSentGraft.inc($),Y>0&&this.rpcSentPrune.inc(Y),(O>0||U>0||$>0||Y>0)&&this.rpcSentControl.inc(1)}},registerScores(N,O){let U=0,$=0,Y=0,X=0;for(let J of N)J>=O.graylistThreshold&&U++,J>=O.publishThreshold&&$++,J>=O.gossipThreshold&&Y++,J>=0&&X++;this.peersByScoreThreshold.set({threshold:tl.graylist},U),this.peersByScoreThreshold.set({threshold:tl.publish},$),this.peersByScoreThreshold.set({threshold:tl.gossip},Y),this.peersByScoreThreshold.set({threshold:tl.mesh},X),this.score.set(N)},registerScoreWeights(N){for(let[O,U]of N.byTopic)this.scoreWeights.set({topic:O,p:"p1"},U.p1w),this.scoreWeights.set({topic:O,p:"p2"},U.p2w),this.scoreWeights.set({topic:O,p:"p3"},U.p3w),this.scoreWeights.set({topic:O,p:"p3b"},U.p3bw),this.scoreWeights.set({topic:O,p:"p4"},U.p4w);this.scoreWeights.set({p:"p5"},N.p5w),this.scoreWeights.set({p:"p6"},N.p6w),this.scoreWeights.set({p:"p7"},N.p7w)},registerScorePerMesh(N,O){let U=new Map;for(let[$,Y]of(N.forEach((N,O)=>{let $=this.topicStrToLabel.get(O)??"unknown",Y=U.get($);Y||(Y=new Set,U.set($,Y)),N.forEach(N=>Y?.add(N))}),U)){let N=[];Y.forEach(U=>{N.push(O.get(U)??0)}),this.scorePerMesh.set({topic:$},N)}}}}!function(N){N.forward="forward",N.publish="publish"}(tt||(tt={})),function(N){N.Fanout="fanout",N.Random="random",N.Subscribed="subscribed",N.Outbound="outbound",N.NotEnough="not_enough",N.Opportunistic="opportunistic"}(tr||(tr={})),function(N){N.Dc="disconnected",N.BadScore="bad_score",N.Prune="prune",N.Unsub="unsubscribed",N.Excess="excess"}(ti||(ti={})),function(N){N.GraftBackoff="graft_backoff",N.BrokenPromise="broken_promise",N.MessageDeficit="message_deficit",N.IPColocation="IP_colocation"}(tn||(tn={})),function(N){N.LowScore="low_score",N.MaxIhave="max_ihave",N.MaxIasked="max_iasked"}(ta||(ta={})),function(N){N.graylist="graylist",N.publish="publish",N.gossip="gossip",N.mesh="mesh"}(tl||(tl={}));let v1=nD("libp2p-pubsub:");async function v2(N,O,U,$){switch(N.type){case e5.Signing:{let Y={from:N.author.toBytes(),data:$,seqno:fA(8),topic:O,signature:void 0,key:void 0},X=sQ([v1,wY.Message.encode(Y).finish()]);Y.signature=await N.privateKey.sign(X),Y.key=N.key;let J={type:"signed",from:N.author,data:U,sequenceNumber:BigInt(`0x${nA(Y.seqno,"base16")}`),topic:O,signature:Y.signature,key:Y.key};return{raw:Y,msg:J}}case e5.Anonymous:return{raw:{from:void 0,data:$,seqno:void 0,topic:O,signature:void 0,key:void 0},msg:{type:"unsigned",data:U,topic:O}}}}async function v0(N,O){switch(N){case vP:if(null!=O.signature)return{valid:!1,error:e7.SignaturePresent};if(null!=O.seqno)return{valid:!1,error:e7.SeqnoPresent};if(null!=O.key)return{valid:!1,error:e7.FromPresent};return{valid:!0,message:{type:"unsigned",topic:O.topic,data:O.data??new Uint8Array(0)}};case vC:{let N,U;if(null==O.seqno||8!==O.seqno.length)return{valid:!1,error:e7.InvalidSeqno};if(null==O.signature)return{valid:!1,error:e7.InvalidSignature};if(null==O.from)return{valid:!1,error:e7.InvalidPeerId};try{N=gP(O.from)}catch(N){return{valid:!1,error:e7.InvalidPeerId}}if(O.key){if(U=gi(O.key),void 0!==N.publicKey&&!n5(U.bytes,N.publicKey))return{valid:!1,error:e7.InvalidPeerId}}else{if(null==N.publicKey)return{valid:!1,error:e7.InvalidPeerId};U=gi(N.publicKey)}let $={from:O.from,data:O.data,seqno:O.seqno,topic:O.topic,signature:void 0,key:void 0},Y=sQ([v1,wY.Message.encode($).finish()]);if(!await U.verify(Y,O.signature))return{valid:!1,error:e7.InvalidSignature};return{valid:!0,message:{type:"signed",from:N,data:O.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${nA(O.seqno,"base16")}`),topic:O.topic,signature:O.signature,key:O.key??gn(U)}}}}}let v5=(N,O)=>{let U=nD(O.toString(16).padStart(16,"0"),"base16"),$=new Uint8Array(N.length+U.length);return $.set(N,0),$.set(U,N.length),$};function v8(N){if("signed"!==N.type)throw Error("expected signed message type");if(null==N.sequenceNumber)throw Error("missing seqno field");return v5(N.from.toBytes(),N.sequenceNumber)}async function v9(N){return await nr.encode(N.data)}function Ee(N,O,U,$,Y){let X=0,J=new Map;if(Object.entries(O.topics).forEach(([N,O])=>{let $=Y.get(N)??"unknown",Z=U.topics[N];if(void 0===Z)return;let en=J.get($);en||(en={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},J.set($,en));let es=0,eo=0,ea=0,ec=0,eu=0;if(O.inMesh){let N=Math.max(O.meshTime/Z.timeInMeshQuantum,Z.timeInMeshCap);es+=N*Z.timeInMeshWeight}let eh=O.firstMessageDeliveries;if(eh>Z.firstMessageDeliveriesCap&&(eh=Z.firstMessageDeliveriesCap),eo+=eh*Z.firstMessageDeliveriesWeight,O.meshMessageDeliveriesActive&&O.meshMessageDeliveries<Z.meshMessageDeliveriesThreshold){let N=Z.meshMessageDeliveriesThreshold-O.meshMessageDeliveries,U=N*N;ea+=U*Z.meshMessageDeliveriesWeight}let ef=O.meshFailurePenalty;ec+=ef*Z.meshFailurePenaltyWeight;let eg=O.invalidMessageDeliveries*O.invalidMessageDeliveries;eu+=eg*Z.invalidMessageDeliveriesWeight,X+=(es+eo+ea+ec+eu)*Z.topicWeight,en.p1w+=es,en.p2w+=eo,en.p3w+=ea,en.p3bw+=ec,en.p4w+=eu}),U.topicScoreCap>0&&X>U.topicScoreCap){X=U.topicScoreCap;let N=U.topicScoreCap/X;for(let O of J.values())O.p1w*=N,O.p2w*=N,O.p3w*=N,O.p3bw*=N,O.p4w*=N}let Z=0,en=0,es=0,eo=U.appSpecificScore(N);Z+=eo*U.appSpecificWeight,O.knownIPs.forEach(N=>{if(U.IPColocationFactorWhitelist.has(N))return;let O=$.get(N),Y=O?O.size:0;if(Y>U.IPColocationFactorThreshold){let N=Y-U.IPColocationFactorThreshold,O=N*N;en+=O*U.IPColocationFactorWeight}});let ea=O.behaviourPenalty*O.behaviourPenalty;return{byTopic:J,p5w:Z,p6w:en,p7w:es+=ea*U.behaviourPenaltyWeight,score:X+=Z+en+es}}function Et(N,O,U,$,Y){let X={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(let J of N){let N=O.get(J);if(N){let O=Ee(J,N,U,$,Y);for(let[N,U]of O.byTopic){let O=X.byTopic.get(N);O||(O={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},X.byTopic.set(N,O)),O.p1w.push(U.p1w),O.p2w.push(U.p2w),O.p3w.push(U.p3w),O.p3bw.push(U.p3bw),O.p4w.push(U.p4w)}X.p5w.push(O.p5w),X.p6w.push(O.p6w),X.p7w.push(O.p7w),X.score.push(O.score)}else X.p5w.push(0),X.p6w.push(0),X.p7w.push(0),X.score.push(0)}return X}class Er{constructor(N,O,U){this.rawStream=N,this.pushable=o_({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=U.maxBufferSize??1/0,oD(sW(this.pushable,this.closeController.signal,{returnOnAbort:!0}),N=>od(N),this.rawStream).catch(O)}get protocol(){return this.rawStream.stat.protocol}push(N){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(N)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}}class Ei{constructor(N,O={}){this.rawStream=N,this.closeController=new AbortController,this.source=sW(oD(this.rawStream,N=>om(N,O)),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}}var En=U(2100);let Es={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};function Eo(N,O){O={...O};let U=En.Reader.create(N),$=N.length,Y=void 0===$?U.len:U.pos+$,X={};for(;U.pos<Y;){let N=U.uint32();switch(N>>>3){case 1:X.subscriptions&&X.subscriptions.length||(X.subscriptions=[]),X.subscriptions.length<O.maxSubscriptions?X.subscriptions.push(Ea(U,U.uint32())):U.skipType(7&N);break;case 2:X.messages&&X.messages.length||(X.messages=[]),X.messages.length<O.maxMessages?X.messages.push(El(U,U.uint32())):U.skipType(7&N);break;case 3:X.control=Ec(U,U.uint32(),O);break;default:U.skipType(7&N)}}return X}function Ea(N,O){let U=void 0===O?N.len:N.pos+O,$={};for(;N.pos<U;){let O=N.uint32();switch(O>>>3){case 1:$.subscribe=N.bool();break;case 2:$.topic=N.string();break;default:N.skipType(7&O)}}return $}function El(N,O){let U=void 0===O?N.len:N.pos+O,$={};for(;N.pos<U;){let O=N.uint32();switch(O>>>3){case 1:$.from=N.bytes();break;case 2:$.data=N.bytes();break;case 3:$.seqno=N.bytes();break;case 4:$.topic=N.string();break;case 5:$.signature=N.bytes();break;case 6:$.key=N.bytes();break;default:N.skipType(7&O)}}if(!$.topic)throw Error("missing required 'topic'");return $}function Ec(N,O,U){let $=void 0===O?N.len:N.pos+O,Y={};for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:Y.ihave&&Y.ihave.length||(Y.ihave=[]),Y.ihave.length<U.maxControlMessages?Y.ihave.push(Eu(N,N.uint32(),U)):N.skipType(7&O);break;case 2:Y.iwant&&Y.iwant.length||(Y.iwant=[]),Y.iwant.length<U.maxControlMessages?Y.iwant.push(Eh(N,N.uint32(),U)):N.skipType(7&O);break;case 3:Y.graft&&Y.graft.length||(Y.graft=[]),Y.graft.length<U.maxControlMessages?Y.graft.push(Ed(N,N.uint32())):N.skipType(7&O);break;case 4:Y.prune&&Y.prune.length||(Y.prune=[]),Y.prune.length<U.maxControlMessages?Y.prune.push(Ep(N,N.uint32(),U)):N.skipType(7&O);break;default:N.skipType(7&O)}}return Y}function Eu(N,O,U){let $=void 0===O?N.len:N.pos+O,Y={};for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:Y.topicID=N.string();break;case 2:Y.messageIDs&&Y.messageIDs.length||(Y.messageIDs=[]),U.maxIhaveMessageIDs-- >0?Y.messageIDs.push(N.bytes()):N.skipType(7&O);break;default:N.skipType(7&O)}}return Y}function Eh(N,O,U){let $=void 0===O?N.len:N.pos+O,Y={};for(;N.pos<$;){let O=N.uint32();O>>>3==1?(Y.messageIDs&&Y.messageIDs.length||(Y.messageIDs=[]),U.maxIwantMessageIDs-- >0?Y.messageIDs.push(N.bytes()):N.skipType(7&O)):N.skipType(7&O)}return Y}function Ed(N,O){let U=void 0===O?N.len:N.pos+O,$={};for(;N.pos<U;){let O=N.uint32();O>>>3==1?$.topicID=N.string():N.skipType(7&O)}return $}function Ep(N,O,U){let $=void 0===O?N.len:N.pos+O,Y={};for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:Y.topicID=N.string();break;case 2:Y.peers&&Y.peers.length||(Y.peers=[]),U.maxPeerInfos-- >0?Y.peers.push(Ef(N,N.uint32())):N.skipType(7&O);break;case 3:Y.backoff=N.uint64();break;default:N.skipType(7&O)}}return Y}function Ef(N,O){let U=void 0===O?N.len:N.pos+O,$={};for(;N.pos<U;){let O=N.uint32();switch(O>>>3){case 1:$.peerID=N.bytes();break;case 2:$.signedPeerRecord=N.bytes();break;default:N.skipType(7&O)}}return $}function Eg(N){for(let O of N.tuples())switch(O[0]){case tu.ip4:case tu.ip6:return yy(O[0],O[1])}return null}!function(N){N[N.ip4=4]="ip4",N[N.ip6=41]="ip6"}(tu||(tu={})),function(N){N[N.started=0]="started",N[N.stopped=1]="stopped"}(th||(th={}));class Ey extends gh{constructor(N,O={}){super(),this.multicodecs=[w0,w1],this.peers=new Set,this.streamsInbound=new Map,this.streamsOutbound=new Map,this.outboundInflightQueue=o_({objectMode:!0}),this.direct=new Set,this.floodsubPeers=new Set,this.acceptFromWhitelist=new Map,this.topics=new Map,this.subscriptions=new Set,this.mesh=new Map,this.fanout=new Map,this.fanoutLastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.topicValidators=new Map,this.heartbeatTicks=0,this.directPeerInitial=null,this.status={code:th.stopped},this.heartbeatTimer=null,this.runHeartbeat=()=>{let N=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch(N=>{this.log("Error running heartbeat",N)}).finally(()=>{if(null!=N&&N(),this.status.code===th.started){clearTimeout(this.status.heartbeatTimeout);let N=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;N<.25*this.opts.heartbeatInterval&&(N+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,N)}})};let U={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:w3,Dlo:w4,Dhi:w5,Dscore:w6,Dout:w8,Dlazy:vt,heartbeatInterval:vo,fanoutTTL:va,mcacheLength:w9,mcacheGossip:ve,seenTTL:vw,gossipsubIWantFollowupMs:vb,prunePeers:vl,pruneBackoff:vc,graftFloodThreshold:vg,opportunisticGraftPeers:vf,opportunisticGraftTicks:vp,directConnectTicks:vh,...O,scoreParams:vM(O.scoreParams),scoreThresholds:v$(O.scoreThresholds)};if(this.components=N,this.decodeRpcLimits=U.decodeRpcLimits??Es,this.globalSignaturePolicy=U.globalSignaturePolicy??vC,U.fallbackToFloodsub&&this.multicodecs.push(wZ),this.log=rF(U.debugName??"libp2p:gossipsub"),this.opts=U,this.direct=new Set(U.directPeers.map(N=>N.id.toString())),this.seenCache=new vJ({validityMs:U.seenTTL}),this.publishedMessageIds=new vJ({validityMs:U.seenTTL}),O.msgIdFn)this.msgIdFn=O.msgIdFn;else switch(this.globalSignaturePolicy){case vC:this.msgIdFn=v8;break;case vP:this.msgIdFn=v9}if(O.fastMsgIdFn&&(this.fastMsgIdFn=O.fastMsgIdFn,this.fastMsgIdCache=new vJ({validityMs:U.seenTTL})),this.msgIdToStrFn=O.msgIdToStrFn??vT,this.mcache=O.messageCache||new wG(U.mcacheGossip,U.mcacheLength,this.msgIdToStrFn),O.dataTransform&&(this.dataTransform=O.dataTransform),O.metricsRegister){if(!O.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");let N=Math.max(...Object.values(U.scoreParams.topics).map(N=>N.meshMessageDeliveriesWindow),vD),$=vZ(O.metricsRegister,O.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:U.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:N/1e3});for(let N of($.mcacheSize.addCollect(()=>this.onScrapeMetrics($)),this.multicodecs))$.protocolsEnabled.set({protocol:N},1);this.metrics=$}else this.metrics=null;this.gossipTracer=new vX(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new vY(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:U.heartbeatInterval}),this.maxInboundStreams=O.maxInboundStreams,this.maxOutboundStreams=O.maxOutboundStreams,this.allowedTopics=U.allowedTopics?new Set(U.allowedTopics):null}getPeers(){return[...this.peers.keys()].map(N=>gC(N))}isStarted(){return this.status.code===th.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await vN(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=o_({objectMode:!0}),oD(this.outboundInflightQueue,async N=>{for await(let{peerId:O,connection:U}of N)await this.createOutboundStream(O,U)}).catch(N=>this.log.error("outbound inflight queue error",N)),await Promise.all(this.opts.directPeers.map(async N=>{await this.components.peerStore.merge(N.id,{multiaddrs:N.addrs})}));let N=this.components.registrar;await Promise.all(this.multicodecs.map(O=>N.handle(O,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams})));let O=sK({onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)}),U=await Promise.all(this.multicodecs.map(U=>N.register(U,O))),$=setTimeout(this.runHeartbeat,vs);this.status={code:th.started,registrarTopologyIds:U,heartbeatTimeout:$,hearbeatStartMs:Date.now()+vs},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async N=>await this.connect(N)))}).catch(N=>{this.log(N)})},vd),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==th.started)return;let{registrarTopologyIds:N}=this.status;this.status={code:th.stopped};let O=this.components.registrar;for(let U of(await Promise.all(this.multicodecs.map(N=>O.unhandle(N))),N.forEach(N=>O.unregister(N)),this.outboundInflightQueue.end(),this.streamsOutbound.values()))U.close();for(let N of(this.streamsOutbound.clear(),this.streamsInbound.values()))N.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:N,connection:O}){if(!this.isStarted())return;let U=O.remotePeer;this.addPeer(U,O.stat.direction,O.remoteAddr),this.createInboundStream(U,N),this.outboundInflightQueue.push({peerId:U,connection:O})}onPeerConnected(N,O){this.metrics?.newConnectionCount.inc({status:O.stat.status}),this.isStarted()&&"OPEN"===O.stat.status&&(this.addPeer(N,O.stat.direction,O.remoteAddr),this.outboundInflightQueue.push({peerId:N,connection:O}))}onPeerDisconnected(N){this.log("connection ended %p",N),this.removePeer(N)}async createOutboundStream(N,O){if(!this.isStarted())return;let U=N.toString();if(!(!this.peers.has(U)||this.streamsOutbound.has(U)))try{let $=new Er(await O.newStream(this.multicodecs),N=>this.log.error("outbound pipe error",N),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",N),this.streamsOutbound.set(U,$);let Y=$.protocol;Y===wZ&&this.floodsubPeers.add(U),this.metrics?.peersPerProtocol.inc({protocol:Y},1),this.subscriptions.size>0&&(this.log("send subscriptions to",U),this.sendSubscriptions(U,Array.from(this.subscriptions),!0))}catch(N){this.log.error("createOutboundStream error",N)}}async createInboundStream(N,O){if(!this.isStarted())return;let U=N.toString();if(!this.peers.has(U))return;let $=this.streamsInbound.get(U);void 0!==$&&(this.log("replacing existing inbound steam %s",U),$.close()),this.log("create inbound stream %s",U);let Y=new Ei(O,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(U,Y),this.pipePeerReadStream(N,Y.source).catch(N=>this.log(N))}addPeer(N,O,U){let $=N.toString();if(!this.peers.has($)){this.log("new peer %p",N),this.peers.add($),this.score.addPeer($);let Y=Eg(U);null!==Y?this.score.addIP($,Y):this.log("Added peer has no IP in current address %s %s",$,U.toString()),this.outbound.has($)||this.outbound.set($,"outbound"===O)}}removePeer(N){let O=N.toString();if(!this.peers.has(O))return;this.log("delete peer %p",N),this.peers.delete(O);let U=this.streamsOutbound.get(O),$=this.streamsInbound.get(O);for(let N of(U&&this.metrics?.peersPerProtocol.inc({protocol:U.protocol},-1),U?.close(),$?.close(),this.streamsOutbound.delete(O),this.streamsInbound.delete(O),this.topics.values()))N.delete(O);for(let[N,U]of this.mesh)!0===U.delete(O)&&this.metrics?.onRemoveFromMesh(N,ti.Dc,1);for(let N of this.fanout.values())N.delete(O);this.floodsubPeers.delete(O),this.gossip.delete(O),this.control.delete(O),this.outbound.delete(O),this.score.removePeer(O),this.acceptFromWhitelist.delete(O)}get started(){return this.status.code===th.started}getMeshPeers(N){let O=this.mesh.get(N);return O?Array.from(O):[]}getSubscribers(N){let O=this.topics.get(N);return(O?Array.from(O):[]).map(N=>gC(N))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(N,O){try{await oD(O,async O=>{for await(let U of O)try{let O=U.subarray(),$=Eo(O,this.decodeRpcLimits);if(this.metrics?.onRpcRecv($,O.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(N,$)}catch(N){this.metrics?.onRpcRecvError(),this.log(N)}else this.handleReceivedRpc(N,$).catch(N=>{this.metrics?.onRpcRecvError(),this.log(N)})}catch(N){this.metrics?.onRpcDataError(),this.log(N)}})}catch(O){this.metrics?.onPeerReadStreamError(),this.handlePeerReadStreamError(O,N)}}handlePeerReadStreamError(N,O){this.log.error(N),this.onPeerDisconnected(O)}async handleReceivedRpc(N,O){if(!this.acceptFrom(N.toString())){this.log("received message from unacceptable peer %p",N),this.metrics?.rpcRecvNotAccepted.inc();return}let U=O.subscriptions?O.subscriptions.length:0,$=O.messages?O.messages.length:0,Y=0,X=0,J=0,Z=0;if(O.control&&(O.control.ihave&&(Y=O.control.ihave.length),O.control.iwant&&(X=O.control.iwant.length),O.control.graft&&(J=O.control.graft.length),O.control.prune&&(Z=O.control.prune.length)),this.log(`rpc.from ${N.toString()} subscriptions ${U} messages ${$} ihave ${Y} iwant ${X} graft ${J} prune ${Z}`),O.subscriptions&&O.subscriptions.length>0){let U=[];O.subscriptions.forEach(O=>{let $=O.topic,Y=!0===O.subscribe;if(null!=$){if(this.allowedTopics&&!this.allowedTopics.has($))return;this.handleReceivedSubscription(N,$,Y),U.push({topic:$,subscribe:Y})}}),this.dispatchEvent(new gp("subscription-change",{detail:{peerId:N,subscriptions:U}}))}if(O.messages)for(let U of O.messages){if(this.allowedTopics&&!this.allowedTopics.has(U.topic))continue;let O=this.handleReceivedMessage(N,U).catch(N=>{this.metrics?.onMsgRecvError(U.topic),this.log(N)});this.opts.awaitRpcMessageHandler&&await O}O.control&&await this.handleControlMessage(N.toString(),O.control)}handleReceivedSubscription(N,O,U){this.log("subscription update from %p topic %s",N,O);let $=this.topics.get(O);null==$&&($=new Set,this.topics.set(O,$)),U?$.add(N.toString()):$.delete(N.toString())}async handleReceivedMessage(N,O){this.metrics?.onMsgRecvPreValidation(O.topic);let U=await this.validateReceivedMessage(N,O);switch(this.metrics?.onMsgRecvResult(O.topic,U.code),U.code){case e9.duplicate:this.score.duplicateMessage(N.toString(),U.msgIdStr,O.topic),this.gossipTracer.deliverMessage(U.msgIdStr,!0),this.mcache.observeDuplicate(U.msgIdStr,N.toString());return;case e9.invalid:if(U.msgIdStr){let $=U.msgIdStr;this.score.rejectMessage(N.toString(),$,O.topic,U.reason),this.gossipTracer.rejectMessage($,U.reason)}else this.score.rejectInvalidMessage(N.toString(),O.topic);this.metrics?.onMsgRecvInvalid(O.topic,U);return;case e9.valid:if(this.score.validateMessage(U.messageId.msgIdStr),this.gossipTracer.deliverMessage(U.messageId.msgIdStr),this.mcache.put(U.messageId,O,!this.opts.asyncValidation),this.subscriptions.has(O.topic)){let O=this.components.peerId.equals(N);(!O||this.opts.emitSelf)&&(super.dispatchEvent(new gp("gossipsub:message",{detail:{propagationSource:N,msgId:U.messageId.msgIdStr,msg:U.msg}})),super.dispatchEvent(new gp("message",{detail:U.msg})))}this.opts.asyncValidation||this.forwardMessage(U.messageId.msgIdStr,O,N.toString())}}async validateReceivedMessage(N,O){let U=this.fastMsgIdFn?.(O),$=void 0!==U?this.fastMsgIdCache?.get(U):void 0;if($)return{code:e9.duplicate,msgIdStr:$};let Y=await v0(this.globalSignaturePolicy,O);if(!Y.valid)return{code:e9.invalid,reason:e6.Error,error:Y.error};let X=Y.message;try{this.dataTransform&&(X.data=this.dataTransform.inboundTransform(O.topic,X.data))}catch(N){return this.log("Invalid message, transform failed",N),{code:e9.invalid,reason:e6.Error,error:e7.TransformFailed}}let J=await this.msgIdFn(X),Z=this.msgIdToStrFn(J),en={msgId:J,msgIdStr:Z};if(void 0!==U&&this.fastMsgIdCache){let N=this.fastMsgIdCache.put(U,Z);N&&this.metrics?.fastMsgIdCacheCollision.inc()}if(this.seenCache.has(Z))return{code:e9.duplicate,msgIdStr:Z};this.seenCache.put(Z);let es=this.topicValidators.get(O.topic);if(null!=es){let O;try{O=await es(N,X)}catch(U){let N=U.code;N===vS&&(O=e0.Ignore),O=N===v_?e0.Reject:e0.Ignore}if(O!==e0.Accept)return{code:e9.invalid,reason:vx(O),msgIdStr:Z}}return{code:e9.valid,messageId:en,msg:X}}getScore(N){return this.score.score(N)}sendSubscriptions(N,O,U){this.sendRpc(N,{subscriptions:O.map(N=>({topic:N,subscribe:U}))})}async handleControlMessage(N,O){if(void 0===O)return;let U=O.ihave?this.handleIHave(N,O.ihave):[],$=O.iwant?this.handleIWant(N,O.iwant):[],Y=O.graft?await this.handleGraft(N,O.graft):[];if(O.prune&&await this.handlePrune(N,O.prune),!U.length&&!$.length&&!Y.length)return;let X=this.sendRpc(N,{messages:$,control:{iwant:U,prune:Y}}),J=U[0]?.messageIDs;J&&(X?this.gossipTracer.addPromise(N,J):this.metrics?.iwantPromiseUntracked.inc(1))}acceptFrom(N){if(this.direct.has(N))return!0;let O=Date.now(),U=this.acceptFromWhitelist.get(N);if(U&&U.messagesAccepted<vR&&U.acceptUntil>=O)return U.messagesAccepted+=1,!0;let $=this.score.score(N);return $>=vI?this.acceptFromWhitelist.set(N,{messagesAccepted:0,acceptUntil:O+vk}):this.acceptFromWhitelist.delete(N),$>=this.opts.scoreThresholds.graylistThreshold}handleIHave(N,O){if(!O.length)return[];let U=this.score.score(N);if(U<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",N,U),this.metrics?.ihaveRcvIgnored.inc({reason:ta.LowScore}),[];let $=(this.peerhave.get(N)??0)+1;if(this.peerhave.set(N,$),$>vm)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",N,$),this.metrics?.ihaveRcvIgnored.inc({reason:ta.MaxIhave}),[];let Y=this.iasked.get(N)??0;if(Y>=vy)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",N,Y),this.metrics?.ihaveRcvIgnored.inc({reason:ta.MaxIasked}),[];let X=new Map;if(O.forEach(({topicID:N,messageIDs:O})=>{if(!N||!O||!this.mesh.has(N))return;let U=0;O.forEach(N=>{let O=this.msgIdToStrFn(N);!this.seenCache.has(O)&&(X.set(O,N),U++)}),this.metrics?.onIhaveRcv(N,O.length,U)}),!X.size)return[];let J=X.size;J+Y>vy&&(J=vy-Y),this.log("IHAVE: Asking for %d out of %d messages from %s",J,X.size,N);let Z=Array.from(X.values());return vA(Z),Z=Z.slice(0,J),this.iasked.set(N,Y+J),[{messageIDs:Z}]}handleIWant(N,O){if(!O.length)return[];let U=this.score.score(N);if(U<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",N,U),[];let $=new Map,Y=new Map,X=0;return(O.forEach(({messageIDs:O})=>{O&&O.forEach(O=>{let U=this.msgIdToStrFn(O),J=this.mcache.getWithIWantCount(U,N);if(null==J){X++;return}if(Y.set(J.msg.topic,1+(Y.get(J.msg.topic)??0)),J.count>vn){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",N,O);return}$.set(U,J.msg)})}),this.metrics?.onIwantRcv(Y,X),$.size)?(this.log("IWANT: Sending %d messages to %s",$.size,N),Array.from($.values())):(this.log("IWANT: Could not provide any wanted messages to %s",N),[])}async handleGraft(N,O){let U=[],$=this.score.score(N),Y=Date.now(),X=this.opts.doPX;return(O.forEach(({topicID:O})=>{if(!O)return;let J=this.mesh.get(O);if(!J){X=!1;return}if(J.has(N))return;if(this.direct.has(N)){this.log("GRAFT: ignoring request from direct peer %s",N),U.push(O),X=!1;return}let Z=this.backoff.get(O)?.get(N);if("number"==typeof Z&&Y<Z){this.log("GRAFT: ignoring backed off peer %s",N),this.score.addPenalty(N,1,tn.GraftBackoff),X=!1;let $=Z+this.opts.graftFloodThreshold-this.opts.pruneBackoff;Y<$&&this.score.addPenalty(N,1,tn.GraftBackoff),this.addBackoff(N,O),U.push(O);return}if($<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",N,$,O),U.push(O),X=!1,this.addBackoff(N,O);return}if(J.size>=this.opts.Dhi&&!this.outbound.get(N)){U.push(O),this.addBackoff(N,O);return}this.log("GRAFT: Add mesh link from %s in %s",N,O),this.score.graft(N,O),J.add(N),this.metrics?.onAddToMesh(O,tr.Subscribed,1)}),U.length)?await Promise.all(U.map(O=>this.makePrune(N,O,X))):[]}async handlePrune(N,O){let U=this.score.score(N);for(let{topicID:$,backoff:Y,peers:X}of O){if(null==$)continue;let O=this.mesh.get($);if(!O)return;if(this.log("PRUNE: Remove mesh link to %s in %s",N,$),this.score.prune(N,$),O.has(N)&&(O.delete(N),this.metrics?.onRemoveFromMesh($,ti.Unsub,1)),"number"==typeof Y&&Y>0?this.doAddBackoff(N,$,1e3*Y):this.addBackoff(N,$),X&&X.length){if(U<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",N,U,$);continue}await this.pxConnect(X)}}}addBackoff(N,O){this.doAddBackoff(N,O,this.opts.pruneBackoff)}doAddBackoff(N,O,U){let $=this.backoff.get(O);$||($=new Map,this.backoff.set(O,$));let Y=Date.now()+U,X=$.get(N)??0;X<Y&&$.set(N,Y)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((N,O)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",O,N),this.score.addPenalty(O,N,tn.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%vu!=0)return;let N=Date.now();this.backoff.forEach((O,U)=>{O.forEach((U,$)=>{U<N&&O.delete($)}),0===O.size&&this.backoff.delete(U)})}async directConnect(){let N=[];this.direct.forEach(O=>{this.streamsOutbound.has(O)||N.push(O)}),await Promise.all(N.map(async N=>await this.connect(N)))}async pxConnect(N){N.length>this.opts.prunePeers&&(vA(N),N=N.slice(0,this.opts.prunePeers));let O=[];await Promise.all(N.map(async N=>{if(!N.peerID)return;let U=gP(N.peerID),$=U.toString();if(!this.peers.has($)){if(!N.signedPeerRecord){O.push($);return}try{if(!await this.components.peerStore.consumePeerRecord(N.signedPeerRecord,U)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}O.push($)}catch(N){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),O.length&&await Promise.all(O.map(async N=>await this.connect(N)))}async connect(N){this.log("Initiating connection with %s",N);let O=gC(N),U=await this.components.connectionManager.openConnection(O);for(let N of this.multicodecs)for(let $ of this.components.registrar.getTopologies(N))$.onConnect(O,U)}subscribe(N){if(this.status.code!==th.started)throw Error("Pubsub has not started");if(!this.subscriptions.has(N))for(let O of(this.subscriptions.add(N),this.peers.keys()))this.sendSubscriptions(O,[N],!0);this.join(N)}unsubscribe(N){if(this.status.code!==th.started)throw Error("Pubsub is not started");let O=this.subscriptions.delete(N);if(this.log("unsubscribe from %s - am subscribed %s",N,O),O)for(let O of this.peers.keys())this.sendSubscriptions(O,[N],!1);this.leave(N)}join(N){if(this.status.code!==th.started)throw Error("Gossipsub has not started");if(this.mesh.has(N))return;this.log("JOIN %s",N),this.metrics?.onJoin(N);let O=new Set,U=this.fanout.get(N);if(U&&(this.fanout.delete(N),this.fanoutLastpub.delete(N),U.forEach(N=>{!this.direct.has(N)&&this.score.score(N)>=0&&O.add(N)}),this.metrics?.onAddToMesh(N,tr.Fanout,O.size)),O.size<this.opts.D){let U=O.size,$=this.getRandomGossipPeers(N,this.opts.D,N=>!O.has(N)&&!this.direct.has(N)&&this.score.score(N)>=0);$.forEach(N=>{O.add(N)}),this.metrics?.onAddToMesh(N,tr.Random,O.size-U)}this.mesh.set(N,O),O.forEach(O=>{this.log("JOIN: Add mesh link to %s in %s",O,N),this.sendGraft(O,N)})}leave(N){if(this.status.code!==th.started)throw Error("Gossipsub has not started");this.log("LEAVE %s",N),this.metrics?.onLeave(N);let O=this.mesh.get(N);O&&(Promise.all(Array.from(O).map(async O=>(this.log("LEAVE: Remove mesh link to %s in %s",O,N),await this.sendPrune(O,N)))).catch(N=>{this.log("Error sending prunes to mesh peers",N)}),this.mesh.delete(N))}selectPeersToForward(N,O,U){let $=new Set,Y=this.topics.get(N);Y&&(this.direct.forEach(N=>{Y.has(N)&&O!==N&&!U?.has(N)&&$.add(N)}),this.floodsubPeers.forEach(N=>{Y.has(N)&&O!==N&&!U?.has(N)&&this.score.score(N)>=this.opts.scoreThresholds.publishThreshold&&$.add(N)}));let X=this.mesh.get(N);return X&&X.size>0&&X.forEach(N=>{O===N||U?.has(N)||$.add(N)}),$}selectPeersToPublish(N){let O=new Set,U={direct:0,floodsub:0,mesh:0,fanout:0},$=this.topics.get(N);if($){if(this.opts.floodPublish)$.forEach(N=>{this.direct.has(N)?(O.add(N),U.direct++):this.score.score(N)>=this.opts.scoreThresholds.publishThreshold&&(O.add(N),U.floodsub++)});else{this.direct.forEach(N=>{$.has(N)&&(O.add(N),U.direct++)}),this.floodsubPeers.forEach(N=>{$.has(N)&&this.score.score(N)>=this.opts.scoreThresholds.publishThreshold&&(O.add(N),U.floodsub++)});let Y=this.mesh.get(N);if(Y&&Y.size>0)Y.forEach(N=>{O.add(N),U.mesh++});else{let $=this.fanout.get(N);if($&&$.size>0)$.forEach(N=>{O.add(N),U.fanout++});else{let $=this.getRandomGossipPeers(N,this.opts.D,N=>this.score.score(N)>=this.opts.scoreThresholds.publishThreshold);$.size>0&&(this.fanout.set(N,$),$.forEach(N=>{O.add(N),U.fanout++}))}this.fanoutLastpub.set(N,Date.now())}}}return{tosend:O,tosendCount:U}}forwardMessage(N,O,U,$){U&&this.score.deliverMessage(U,N,O.topic);let Y=this.selectPeersToForward(O.topic,U,$);Y.forEach(N=>{this.sendRpc(N,{messages:[O]})}),this.metrics?.onForwardMsg(O.topic,Y.size)}async publish(N,O,U){let $=this.dataTransform?this.dataTransform.outboundTransform(N,O):O;if(null==this.publishConfig)throw Error("PublishError.Uninitialized");let{raw:Y,msg:X}=await v2(this.publishConfig,N,O,$),J=await this.msgIdFn(X),Z=this.msgIdToStrFn(J),en=U?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(Z)){if(en)return this.metrics?.onPublishDuplicateMsg(N),{recipients:[]};throw Error("PublishError.Duplicate")}let{tosend:es,tosendCount:eo}=this.selectPeersToPublish(N),ea=!0===this.opts.emitSelf&&this.subscriptions.has(N),ec=U?.allowPublishToZeroPeers??this.opts.allowPublishToZeroPeers;if(0===es.size&&!ec&&!ea)throw Error("PublishError.InsufficientPeers");for(let N of(this.seenCache.put(Z),this.mcache.put({msgId:J,msgIdStr:Z},Y,!0),this.publishedMessageIds.put(Z),es)){let O=this.sendRpc(N,{messages:[Y]});O||es.delete(N)}return this.metrics?.onPublishMsg(N,eo,es.size,null!=Y.data?Y.data.length:0),ea&&(es.add(this.components.peerId.toString()),super.dispatchEvent(new gp("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:Z,msg:X}})),super.dispatchEvent(new gp("message",{detail:X}))),{recipients:Array.from(es.values()).map(N=>gC(N))}}reportMessageValidationResult(N,O,U){if(U===e0.Accept){let $=this.mcache.validate(N);if(this.metrics?.onReportValidationMcacheHit(null!==$),null!=$){let{message:Y,originatingPeers:X}=$;this.score.deliverMessage(O.toString(),N,Y.topic),this.forwardMessage(N,$.message,O.toString(),X),this.metrics?.onReportValidation(Y.topic,U)}}else{let $=this.mcache.remove(N);if(this.metrics?.onReportValidationMcacheHit(null!==$),$){let Y=vx(U),{message:X,originatingPeers:J}=$;for(let U of(this.score.rejectMessage(O.toString(),N,X.topic,Y),J))this.score.rejectMessage(U,N,X.topic,Y);this.metrics?.onReportValidation(X.topic,U)}}}sendGraft(N,O){let U=[{topicID:O}];this.sendRpc(N,{control:{graft:U}})}async sendPrune(N,O){let U=[await this.makePrune(N,O,this.opts.doPX)];this.sendRpc(N,{control:{prune:U}})}sendRpc(N,O){let U=this.streamsOutbound.get(N);if(!U)return this.log(`Cannot send RPC to ${N} as there is no open stream to it available`),!1;let $=this.control.get(N);$&&(this.piggybackControl(N,O,$),this.control.delete(N));let Y=this.gossip.get(N);Y&&(this.piggybackGossip(N,O,Y),this.gossip.delete(N));let X=wY.encode(O).finish();try{U.push(X)}catch(O){return this.log.error(`Cannot send rpc to ${N}`,O),$&&this.control.set(N,$),Y&&this.gossip.set(N,Y),!1}return this.metrics?.onRpcSent(O,X.length),!0}piggybackControl(N,O,U){if(U.graft)for(let $ of(O.control||(O.control={}),O.control.graft||(O.control.graft=[]),U.graft))$.topicID&&this.mesh.get($.topicID)?.has(N)&&O.control.graft.push($);if(U.prune)for(let $ of(O.control||(O.control={}),O.control.prune||(O.control.prune=[]),U.prune))$.topicID&&!this.mesh.get($.topicID)?.has(N)&&O.control.prune.push($)}piggybackGossip(N,O,U){O.control||(O.control={}),O.control.ihave=U}async sendGraftPrune(N,O,U){let $=this.opts.doPX;for(let[Y,X]of N){let N=X.map(N=>({topicID:N})),J=[],Z=O.get(Y);Z&&(J=await Promise.all(Z.map(async N=>await this.makePrune(Y,N,$&&!U.get(Y)))),O.delete(Y)),this.sendRpc(Y,{control:{graft:N,prune:J}})}for(let[N,Y]of O){let O=await Promise.all(Y.map(async O=>await this.makePrune(N,O,$&&!U.get(N))));this.sendRpc(N,{control:{prune:O}})}}emitGossip(N){let O=this.mcache.getGossipIDs(new Set(N.keys()));for(let[U,$]of N)this.doEmitGossip(U,$,O.get(U)??[])}doEmitGossip(N,O,U){if(!U.length||(vA(U),U.length>vy&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",U.length),!O.size))return;let $=this.opts.Dlazy,Y=vr*O.size,X=O;Y>$&&($=Y),$>X.size?$=X.size:X=vA(Array.from(X)).slice(0,$),X.forEach(O=>{let $=U;U.length>vy&&($=vA($.slice()).slice(0,vy)),this.pushGossip(O,{topicID:N,messageIDs:$})})}flush(){for(let[N,O]of this.gossip.entries())this.gossip.delete(N),this.sendRpc(N,{control:{ihave:O}});for(let[N,O]of this.control.entries())this.control.delete(N),this.sendRpc(N,{control:{graft:O.graft,prune:O.prune}})}pushGossip(N,O){this.log("Add gossip to %s",N);let U=this.gossip.get(N)||[];this.gossip.set(N,U.concat(O))}async makePrune(N,O,U){if(this.score.prune(N,O),this.streamsOutbound.get(N).protocol===w1)return{topicID:O,peers:[]};let $=this.opts.pruneBackoff/1e3;if(!U)return{topicID:O,peers:[],backoff:$};let Y=this.getRandomGossipPeers(O,this.opts.prunePeers,O=>O!==N&&this.score.score(O)>=0),X=await Promise.all(Array.from(Y).map(async N=>{let O;let U=gC(N);try{O=await this.components.peerStore.get(U)}catch(N){if("ERR_NOT_FOUND"!==N.code)throw N}return{peerID:U.toBytes(),signedPeerRecord:O?.peerRecordEnvelope}}));return{topicID:O,peers:X,backoff:$}}async heartbeat(){let{D:N,Dlo:O,Dhi:U,Dscore:$,Dout:Y,fanoutTTL:X}=this.opts;this.heartbeatTicks++;let J=new Map,Z=N=>{let O=J.get(N);return void 0===O&&(O=this.score.score(N),J.set(N,O)),O},en=new Map,es=new Map,eo=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks==0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();let ea=new Map;this.mesh.forEach((X,J)=>{let ec=this.topics.get(J),eu=new Set,eh=new Set;if(ea.set(J,eh),ec){let N=vA(Array.from(ec)),O=this.backoff.get(J);for(let U of N){let N=this.streamsOutbound.get(U);if(N&&this.multicodecs.includes(N.protocol)&&!X.has(U)&&!this.direct.has(U)){let N=Z(U);O&&O.has(U)||!(N>=0)||eu.add(U),N>=this.opts.scoreThresholds.gossipThreshold&&eh.add(U)}}}let ef=(N,O)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",N,J),this.addBackoff(N,J),X.delete(N),Z(N)>=this.opts.scoreThresholds.gossipThreshold&&eh.add(N),this.metrics?.onRemoveFromMesh(J,O,1);let U=es.get(N);U?U.push(J):es.set(N,[J])},eg=(N,O)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",N,J),this.score.graft(N,J),X.add(N),eh.delete(N),this.metrics?.onAddToMesh(J,O,1);let U=en.get(N);U?U.push(J):en.set(N,[J])};if(X.forEach(N=>{let O=Z(N);O<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",N,O,J),ef(N,ti.BadScore),eo.set(N,!0))}),X.size<O){let O=N-X.size,U=vH(eu,O);U.forEach(N=>{eg(N,tr.NotEnough)})}if(X.size>U){let O=Array.from(X);O.sort((N,O)=>Z(O)-Z(N));let U=0;if((O=O.slice(0,$).concat(vA(O.slice($)))).slice(0,N).forEach(N=>{this.outbound.get(N)&&U++}),U<Y){let $=N=>{let U=O[N];for(let U=N;U>0;U--)O[U]=O[U-1];O[0]=U};if(U>0){let Y=U;for(let U=1;U<N&&Y>0;U++)this.outbound.get(O[U])&&($(U),Y--)}let Y=N-U;for(let U=N;U<O.length&&Y>0;U++)this.outbound.get(O[U])&&($(U),Y--)}O.slice(N).forEach(N=>{ef(N,ti.Excess)})}if(X.size>=O){let N=0;if(X.forEach(O=>{this.outbound.get(O)&&N++}),N<Y){let O=Y-N,U=vW(eu,O,N=>!0===this.outbound.get(N));U.forEach(N=>{eg(N,tr.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks==0&&X.size>1){let N=Array.from(X).sort((N,O)=>Z(N)-Z(O)),O=Math.floor(X.size/2),U=Z(N[O]);if(U<this.opts.scoreThresholds.opportunisticGraftThreshold){let N=this.opts.opportunisticGraftPeers,O=vW(eu,N,N=>Z(N)>U);for(let N of O)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",N,J),eg(N,tr.Opportunistic)}}});let ec=Date.now();this.fanoutLastpub.forEach((N,O)=>{N+X<ec&&(this.fanout.delete(O),this.fanoutLastpub.delete(O))}),this.fanout.forEach((O,U)=>{let $=this.topics.get(U);O.forEach(N=>{(!$.has(N)||Z(N)<this.opts.scoreThresholds.publishThreshold)&&O.delete(N)});let Y=this.topics.get(U),X=[],J=new Set;if(ea.set(U,J),Y){let N=vA(Array.from(Y));for(let U of N){let N=this.streamsOutbound.get(U);if(N&&this.multicodecs.includes(N.protocol)&&!O.has(U)&&!this.direct.has(U)){let N=Z(U);N>=this.opts.scoreThresholds.publishThreshold&&X.push(U),N>=this.opts.scoreThresholds.gossipThreshold&&J.add(U)}}}if(O.size<N){let U=N-O.size;X.slice(0,U).forEach(N=>{O.add(N),J?.delete(N)})}}),this.emitGossip(ea),await this.sendGraftPrune(en,es,eo),this.flush(),this.mcache.shift(),this.dispatchEvent(new gp("gossipsub:heartbeat"))}getRandomGossipPeers(N,O,U=()=>!0){let $=this.topics.get(N);if(!$)return new Set;let Y=[];return $.forEach(N=>{let O=this.streamsOutbound.get(N);O&&this.multicodecs.includes(O.protocol)&&U(N)&&Y.push(N)}),Y=vA(Y),O>0&&Y.length>O&&(Y=Y.slice(0,O)),new Set(Y)}onScrapeMetrics(N){N.mcacheSize.set(this.mcache.size),N.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),N.cacheSize.set({cache:"direct"},this.direct.size),N.cacheSize.set({cache:"seenCache"},this.seenCache.size),N.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),N.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),N.cacheSize.set({cache:"mcache"},this.mcache.size),N.cacheSize.set({cache:"score"},this.score.size),N.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),N.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),N.cacheSize.set({cache:"topics"},this.topics.size),N.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),N.cacheSize.set({cache:"mesh"},this.mesh.size),N.cacheSize.set({cache:"fanout"},this.fanout.size),N.cacheSize.set({cache:"peers"},this.peers.size),N.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),N.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),N.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),N.cacheSize.set({cache:"gossip"},this.gossip.size),N.cacheSize.set({cache:"control"},this.control.size),N.cacheSize.set({cache:"peerhave"},this.peerhave.size),N.cacheSize.set({cache:"outbound"},this.outbound.size);let O=0;for(let N of this.backoff.values())O+=N.size;for(let[U,$]of(N.cacheSize.set({cache:"backoff"},O),this.topics))N.topicPeersCount.set({topicStr:U},$.size);for(let[O,U]of this.mesh)N.meshPeerCounts.set({topicStr:O},U.size);let U=[],$=new Map;for(let O of(N.behaviourPenalty.reset(),this.peers.keys())){let Y=this.score.score(O);U.push(Y),$.set(O,Y),N.behaviourPenalty.observe(this.score.peerStats.get(O)?.behaviourPenalty??0)}N.registerScores(U,this.opts.scoreThresholds),N.registerScorePerMesh(this.mesh,$);let Y=Et(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,N.topicStrToLabel);N.registerScoreWeights(Y)}}function Em(N={}){return O=>new Ey(O,N)}function Eb(){let N=c_(),O=!1;return{sink:async U=>{if(O)throw Error("already piped");O=!0,N.resolve(U)},source:async function*(){let O=await N.promise;yield*O}()}}function Ew(){let N=Eb(),O=Eb();return[{source:N.source,sink:O.sink},{source:O.source,sink:N.sink}]}Ey.multicodec=w0;let Ev=N=>ol.decode(N);function E_(N,O){let U=o_();N.sink(U).catch(N=>{U.end(N)}),N.sink=async N=>{for await(let O of N)U.push(O);U.end()};let $=N.source;null!=N.source[Symbol.iterator]?$=N.source[Symbol.iterator]():null!=N.source[Symbol.asyncIterator]&&($=N.source[Symbol.asyncIterator]());let Y=new sZ,X={read:async N=>{if(null==N){let{done:N,value:O}=await $.next();return!0===N?new sZ:O}for(;Y.byteLength<N;){let{value:N,done:O}=await $.next();if(!0===O)throw rV(Error("unexpected end of input"),"ERR_UNEXPECTED_EOF");Y.append(N)}let O=Y.sublist(0,N);return Y.consume(N),O},readLP:async()=>{let N=-1,U=new sZ,$=O?.lengthDecoder??Ev;for(;;){U.append(await X.read(1));try{N=$(U)}catch(N){if(N instanceof RangeError)continue;throw N}if(N>-1)break;if(O?.maxLengthLength!=null&&U.byteLength>O.maxLengthLength)throw rV(Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG")}if(O?.maxDataLength!=null&&N>O.maxDataLength)throw rV(Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");return await X.read(N)},readPB:async N=>{let O=await X.readLP();if(null==O)throw Error("Value is null");let U=O instanceof Uint8Array?O:O.subarray();return N.decode(U)},write:N=>{N instanceof Uint8Array?U.push(N):U.push(N.subarray())},writeLP:N=>{X.write(od.single(N,O))},writePB:(N,O)=>{X.writeLP(O.encode(N))},pb:N=>({read:async()=>await X.readPB(N),write:O=>{X.writePB(O,N)},unwrap:()=>X}),unwrap:()=>{let O=N.source;return N.source=async function*(){yield*Y,yield*O}(),N}};return X}Ev.bytes=0;let ES=65535,EI=ES-16,ER=!!globalThis.process?.env?.DUMP_SESSION_KEYS;function Ek(N){if(!Number.isSafeInteger(N)||N<0)throw Error(`Wrong positive integer: ${N}`)}function ED(N){if("boolean"!=typeof N)throw Error(`Expected boolean, not ${N}`)}function EA(N,...O){if(!(N instanceof Uint8Array))throw Error("Expected Uint8Array");if(O.length>0&&!O.includes(N.length))throw Error(`Expected Uint8Array of length ${O}, not of length=${N.length}`)}function ET(N){if("function"!=typeof N||"function"!=typeof N.create)throw Error("Hash should be wrapped by utils.wrapConstructor");Ek(N.outputLen),Ek(N.blockLen)}function EC(N,O=!0){if(N.destroyed)throw Error("Hash instance has been destroyed");if(O&&N.finished)throw Error("Hash#digest() has already been called")}function EP(N,O){EA(N);let U=O.outputLen;if(N.length<U)throw Error(`digestInto() expects output buffer of length at least ${U}`)}let Ex={number:Ek,bool:ED,bytes:EA,hash:ET,exists:EC,output:EP};var EN=Ex;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */let EB=N=>N instanceof Uint8Array,EL=N=>new DataView(N.buffer,N.byteOffset,N.byteLength),EO=(N,O)=>N<<32-O|N>>>O,EM=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];if(!EM)throw Error("Non little-endian hardware is not supported");function EU(N){if("string"!=typeof N)throw Error(`utf8ToBytes expected string, got ${typeof N}`);return new Uint8Array(new TextEncoder().encode(N))}function EF(N){if("string"==typeof N&&(N=EU(N)),!EB(N))throw Error(`expected Uint8Array, got ${typeof N}`);return N}Array.from({length:256},(N,O)=>O.toString(16).padStart(2,"0"));class EV{clone(){return this._cloneInto()}}function Ez(N){let O=O=>N().update(EF(O)).digest(),U=N();return O.outputLen=U.outputLen,O.blockLen=U.blockLen,O.create=()=>N(),O}class E$ extends EV{constructor(N,O){super(),this.finished=!1,this.destroyed=!1,EN.hash(N);let U=EF(O);if(this.iHash=N.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let $=this.blockLen,Y=new Uint8Array($);Y.set(U.length>$?N.create().update(U).digest():U);for(let N=0;N<Y.length;N++)Y[N]^=54;this.iHash.update(Y),this.oHash=N.create();for(let N=0;N<Y.length;N++)Y[N]^=106;this.oHash.update(Y),Y.fill(0)}update(N){return EN.exists(this),this.iHash.update(N),this}digestInto(N){EN.exists(this),EN.bytes(N,this.outputLen),this.finished=!0,this.iHash.digestInto(N),this.oHash.update(N),this.oHash.digestInto(N),this.destroy()}digest(){let N=new Uint8Array(this.oHash.outputLen);return this.digestInto(N),N}_cloneInto(N){N||(N=Object.create(Object.getPrototypeOf(this),{}));let{oHash:O,iHash:U,finished:$,destroyed:Y,blockLen:X,outputLen:J}=this;return N.finished=$,N.destroyed=Y,N.blockLen=X,N.outputLen=J,N.oHash=O._cloneInto(N.oHash),N.iHash=U._cloneInto(N.iHash),N}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let EK=(N,O,U)=>new E$(N,O).update(U).digest();function Eq(N,O,U){return EN.hash(N),void 0===U&&(U=new Uint8Array(N.outputLen)),EK(N,EF(U),EF(O))}EK.create=(N,O)=>new E$(N,O);let Ej=new Uint8Array([0]),EW=new Uint8Array;function EH(N,O,U,$=32){if(EN.hash(N),EN.number($),$>255*N.outputLen)throw Error("Length should be <= 255*HashLen");let Y=Math.ceil($/N.outputLen);void 0===U&&(U=EW);let X=new Uint8Array(Y*N.outputLen),J=EK.create(N,O),Z=J._cloneInto(),en=new Uint8Array(J.outputLen);for(let O=0;O<Y;O++)Ej[0]=O+1,Z.update(0===O?EW:en).update(U).update(Ej).digestInto(en),X.set(en,N.outputLen*O),J._cloneInto(Z);return J.destroy(),Z.destroy(),en.fill(0),Ej.fill(0),X.slice(0,$)}let EG=(N,O,U,$,Y)=>EH(N,Eq(N,O,U),$,Y);function EQ(N,O,U,$){if("function"==typeof N.setBigUint64)return N.setBigUint64(O,U,$);let Y=BigInt(32),X=BigInt(4294967295),J=Number(U>>Y&X),Z=Number(U&X),en=$?4:0,es=$?0:4;N.setUint32(O+en,J,$),N.setUint32(O+es,Z,$)}class EY extends EV{constructor(N,O,U,$){super(),this.blockLen=N,this.outputLen=O,this.padOffset=U,this.isLE=$,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(N),this.view=EL(this.buffer)}update(N){EN.exists(this);let{view:O,buffer:U,blockLen:$}=this;N=EF(N);let Y=N.length;for(let X=0;X<Y;){let J=Math.min($-this.pos,Y-X);if(J===$){let O=EL(N);for(;$<=Y-X;X+=$)this.process(O,X);continue}U.set(N.subarray(X,X+J),this.pos),this.pos+=J,X+=J,this.pos===$&&(this.process(O,0),this.pos=0)}return this.length+=N.length,this.roundClean(),this}digestInto(N){EN.exists(this),EN.output(N,this),this.finished=!0;let{buffer:O,view:U,blockLen:$,isLE:Y}=this,{pos:X}=this;O[X++]=128,this.buffer.subarray(X).fill(0),this.padOffset>$-X&&(this.process(U,0),X=0);for(let N=X;N<$;N++)O[N]=0;EQ(U,$-8,BigInt(8*this.length),Y),this.process(U,0);let J=EL(N),Z=this.outputLen;if(Z%4)throw Error("_sha2: outputLen should be aligned to 32bit");let en=Z/4,es=this.get();if(en>es.length)throw Error("_sha2: outputLen bigger than state");for(let N=0;N<en;N++)J.setUint32(4*N,es[N],Y)}digest(){let{buffer:N,outputLen:O}=this;this.digestInto(N);let U=N.slice(0,O);return this.destroy(),U}_cloneInto(N){N||(N=new this.constructor),N.set(...this.get());let{blockLen:O,buffer:U,length:$,finished:Y,destroyed:X,pos:J}=this;return N.length=$,N.pos=J,N.finished=Y,N.destroyed=X,$%O&&N.buffer.set(U),N}}let EX=(N,O,U)=>N&O^~N&U,EJ=(N,O,U)=>N&O^N&U^O&U,EZ=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),E1=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),E2=new Uint32Array(64);class E0 extends EY{constructor(){super(64,32,8,!1),this.A=0|E1[0],this.B=0|E1[1],this.C=0|E1[2],this.D=0|E1[3],this.E=0|E1[4],this.F=0|E1[5],this.G=0|E1[6],this.H=0|E1[7]}get(){let{A:N,B:O,C:U,D:$,E:Y,F:X,G:J,H:Z}=this;return[N,O,U,$,Y,X,J,Z]}set(N,O,U,$,Y,X,J,Z){this.A=0|N,this.B=0|O,this.C=0|U,this.D=0|$,this.E=0|Y,this.F=0|X,this.G=0|J,this.H=0|Z}process(N,O){for(let U=0;U<16;U++,O+=4)E2[U]=N.getUint32(O,!1);for(let N=16;N<64;N++){let O=E2[N-15],U=E2[N-2],$=EO(O,7)^EO(O,18)^O>>>3,Y=EO(U,17)^EO(U,19)^U>>>10;E2[N]=Y+E2[N-7]+$+E2[N-16]|0}let{A:U,B:$,C:Y,D:X,E:J,F:Z,G:en,H:es}=this;for(let N=0;N<64;N++){let O=EO(J,6)^EO(J,11)^EO(J,25),eo=es+O+EX(J,Z,en)+EZ[N]+E2[N]|0,ea=EO(U,2)^EO(U,13)^EO(U,22),ec=ea+EJ(U,$,Y)|0;es=en,en=Z,Z=J,J=X+eo|0,X=Y,Y=$,$=U,U=eo+ec|0}U=U+this.A|0,$=$+this.B|0,Y=Y+this.C|0,X=X+this.D|0,J=J+this.E|0,Z=Z+this.F|0,en=en+this.G|0,es=es+this.H|0,this.set(U,$,Y,X,J,Z,en,es)}roundClean(){E2.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class E3 extends E0{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}let E4=Ez(()=>new E0);Ez(()=>new E3);var E5=U(5501),E6=U(7664);let E8={hashSHA256:N=>E4(N),getHKDF(N,O){let U=EG(E4,O,N,void 0,96),$=U.subarray(0,32),Y=U.subarray(32,64),X=U.subarray(64,96);return[$,Y,X]},generateX25519KeyPair(){let N=E6.Au();return{publicKey:N.publicKey,privateKey:N.secretKey}},generateX25519KeyPairFromSeed(N){let O=E6._w(N);return{publicKey:O.publicKey,privateKey:O.secretKey}},generateX25519SharedKey:(N,O)=>E6.gi(N,O),chaCha20Poly1305Encrypt(N,O,U,$){let Y=new E5.OK($);return Y.seal(O,N,U)},chaCha20Poly1305Decrypt(N,O,U,$,Y){let X=new E5.OK($);return X.open(O,N,U,Y)}},E7=N=>globalThis.Buffer?globalThis.Buffer.allocUnsafe(N):new Uint8Array(N),E9=N=>{let O=E7(2);return new DataView(O.buffer,O.byteOffset,O.byteLength).setUint16(0,N,!1),O};E9.bytes=2;let _e=N=>{if(N.length<2)throw RangeError("Could not decode int16BE");return N instanceof Uint8Array?new DataView(N.buffer,N.byteOffset,N.byteLength).getUint16(0,!1):N.getUint16(0)};function _t(N){return sQ([N.ne,N.ciphertext],N.ne.length+N.ciphertext.length)}function _r(N){return sQ([N.ne,N.ns,N.ciphertext],N.ne.length+N.ns.length+N.ciphertext.length)}function _i(N){return sQ([N.ns,N.ciphertext],N.ns.length+N.ciphertext.length)}function _n(N){if(N.length<32)throw Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:N.subarray(0,32),ciphertext:N.subarray(32,N.length),ns:new Uint8Array(0)}}function _s(N){if(N.length<80)throw Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:N.subarray(0,32),ns:N.subarray(32,80),ciphertext:N.subarray(80,N.length)}}function _o(N){if(N.length<48)throw Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:new Uint8Array(0),ns:N.subarray(0,48),ciphertext:N.subarray(48,N.length)}}function _l(N,O){return async function*(U){for await(let $ of U)for(let U=0;U<$.length;U+=EI){let Y=U+EI;Y>$.length&&(Y=$.length);let X=N.encrypt($.subarray(U,Y),N.session);O?.encryptedPackets.increment(),yield E9(X.byteLength),yield X}}}function _u(N,O){return async function*(U){for await(let $ of U)for(let U=0;U<$.length;U+=ES){let Y=U+ES;if(Y>$.length&&(Y=$.length),Y-E5.pg<U)throw Error("Invalid chunk");let X=$.subarray(U,Y),J=$.subarray(U,Y-E5.pg),{plaintext:Z,valid:en}=N.decrypt(X,N.session,J);if(!en)throw O?.decryptErrors.increment(),Error("Failed to validate decrypted chunk");O?.decryptedPackets.increment(),yield Z}}}_e.bytes=2;class _p extends Error{code;constructor(N="Unexpected Peer"){super(N),this.code=_p.code}static code="ERR_UNEXPECTED_PEER"}class _f extends Error{code;constructor(N="Invalid crypto exchange"){super(N),this.code=_f.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"}async function _g(N,O,U){let $=await _E(N,_I(O));if(null==N.publicKey)throw Error("PublicKey was missing from local PeerId");return _m(N.publicKey,$,U)}function _m(N,O,U){return tp.encode({identityKey:N,identitySig:O,extensions:U??{webtransportCerthashes:[]}}).subarray()}async function _E(N,O){if(null==N.privateKey)throw Error("PrivateKey was missing from PeerId");let U=await gs(N.privateKey);return U.sign(O)}async function __(N){return gN(N.identityKey)}function _S(N){return tp.decode(N)}function _I(N){let O=nD("noise-libp2p-static-key:");return sQ([O,N],O.length+N.length)}async function _R(N,O,U){let $=await gN(O.identityKey);if(!$.equals(U))throw Error(`Payload identity key ${$.toString()} does not match expected remote peer ${U.toString()}`);let Y=_I(N);if(null==$.publicKey)throw Error("PublicKey was missing from PeerId");if(null==O.identitySig)throw Error("Signature was missing from message");let X=gi($.publicKey),J=await X.verify(Y,O.identitySig);if(!J)throw Error("Static key doesn't match to peer that signed payload!");return $}function _D(N){return N instanceof Uint8Array&&32===N.length}!function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{if(!1!==U.lengthDelimited&&O.fork(),null!=N.webtransportCerthashes)for(let U of N.webtransportCerthashes)O.uint32(10),O.bytes(U);!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={webtransportCerthashes:[]},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();O>>>3==1?U.webtransportCerthashes.push(N.bytes()):N.skipType(7&O)}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(td||(td={})),function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),(!0===U.writeDefaults||null!=N.identityKey&&N.identityKey.byteLength>0)&&(O.uint32(10),O.bytes(N.identityKey??new Uint8Array(0))),(!0===U.writeDefaults||null!=N.identitySig&&N.identitySig.byteLength>0)&&(O.uint32(18),O.bytes(N.identitySig??new Uint8Array(0))),null!=N.extensions&&(O.uint32(34),td.codec().encode(N.extensions,O,{writeDefaults:!1})),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={identityKey:new Uint8Array(0),identitySig:new Uint8Array(0)},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.identityKey=N.bytes();break;case 2:U.identitySig=N.bytes();break;case 4:U.extensions=td.codec().decode(N,N.uint32());break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tp||(tp={}));let _A=rF("libp2p:noise");function _T(N){Z(`LOCAL_STATIC_PUBLIC_KEY ${nA(N.publicKey,"hex")}`),Z(`LOCAL_STATIC_PRIVATE_KEY ${nA(N.privateKey,"hex")}`)}function _C(N){N?(Z(`LOCAL_PUBLIC_EPHEMERAL_KEY ${nA(N.publicKey,"hex")}`),Z(`LOCAL_PRIVATE_EPHEMERAL_KEY ${nA(N.privateKey,"hex")}`)):Z("Missing local ephemeral keys.")}function _P(N){Z(`REMOTE_STATIC_PUBLIC_KEY ${nA(N,"hex")}`)}function _N(N){Z(`REMOTE_EPHEMERAL_PUBLIC_KEY ${nA(N,"hex")}`)}function _B(N){N.cs1&&N.cs2?(Z(`CIPHER_STATE_1 ${N.cs1.n.getUint64()} ${nA(N.cs1.k,"hex")}`),Z(`CIPHER_STATE_2 ${N.cs2.n.getUint64()} ${nA(N.cs2.k,"hex")}`)):Z("Missing cipher state.")}Z=ER?_A:Object.assign(()=>{},{enabled:!1,trace:()=>{},error:()=>{}});let _L=0,_O=4294967295,_M="Cipherstate has reached maximum n, a new handshake must be performed";class _U{n;bytes;view;constructor(N=_L){this.n=N,this.bytes=new Uint8Array(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,N,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>_O)throw Error(_M)}}class _F{crypto;constructor(N){this.crypto=N}encryptWithAd(N,O,U){let $=this.encrypt(N.k,N.n,O,U);return N.n.increment(),$}decryptWithAd(N,O,U,$){let{plaintext:Y,valid:X}=this.decrypt(N.k,N.n,O,U,$);return X&&N.n.increment(),{plaintext:Y,valid:X}}hasKey(N){return!this.isEmptyKey(N.k)}createEmptyKey(){return new Uint8Array(32)}isEmptyKey(N){let O=this.createEmptyKey();return n5(O,N)}encrypt(N,O,U,$){return O.assertValue(),this.crypto.chaCha20Poly1305Encrypt($,O.getBytes(),U,N)}encryptAndHash(N,O){let U;return U=this.hasKey(N.cs)?this.encryptWithAd(N.cs,N.h,O):O,this.mixHash(N,U),U}decrypt(N,O,U,$,Y){O.assertValue();let X=this.crypto.chaCha20Poly1305Decrypt($,O.getBytes(),U,N,Y);return X?{plaintext:X,valid:!0}:{plaintext:new Uint8Array(0),valid:!1}}decryptAndHash(N,O){let U;let $=!0;return this.hasKey(N.cs)?{plaintext:U,valid:$}=this.decryptWithAd(N.cs,N.h,O):U=O,this.mixHash(N,O),{plaintext:U,valid:$}}dh(N,O){try{let U=this.crypto.generateX25519SharedKey(N,O);if(32===U.length)return U;return U.subarray(0,32)}catch(O){let N=O;return _A.error(N),new Uint8Array(32)}}mixHash(N,O){N.h=this.getHash(N.h,O)}getHash(N,O){let U=this.crypto.hashSHA256(sQ([N,O],N.length+O.length));return U}mixKey(N,O){let[U,$]=this.crypto.getHKDF(N.ck,O);N.cs=this.initializeKey($),N.ck=U}initializeKey(N){return{k:N,n:new _U}}initializeSymmetric(N){let O=nD(N,"utf-8"),U=this.hashProtocolName(O),$=U,Y=this.createEmptyKey(),X=this.initializeKey(Y);return{cs:X,ck:$,h:U}}hashProtocolName(N){if(!(N.length<=32))return this.getHash(N,new Uint8Array(0));{let O=new Uint8Array(32);return O.set(N),O}}split(N){let[O,U]=this.crypto.getHKDF(N.ck,new Uint8Array(0)),$=this.initializeKey(O),Y=this.initializeKey(U);return{cs1:$,cs2:Y}}writeMessageRegular(N,O){let U=this.encryptWithAd(N,new Uint8Array(0),O),$=this.createEmptyKey(),Y=new Uint8Array(0);return{ne:$,ns:Y,ciphertext:U}}readMessageRegular(N,O){return this.decryptWithAd(N,new Uint8Array(0),O.ciphertext)}}class _V extends _F{initializeInitiator(N,O,U,$){let Y="Noise_XX_25519_ChaChaPoly_SHA256",X=this.initializeSymmetric(Y);this.mixHash(X,N);let J=new Uint8Array(32);return{ss:X,s:O,rs:U,psk:$,re:J}}initializeResponder(N,O,U,$){let Y="Noise_XX_25519_ChaChaPoly_SHA256",X=this.initializeSymmetric(Y);this.mixHash(X,N);let J=new Uint8Array(32);return{ss:X,s:O,rs:U,psk:$,re:J}}writeMessageA(N,O,U){let $=new Uint8Array(0);void 0!==U?N.e=U:N.e=this.crypto.generateX25519KeyPair();let Y=N.e.publicKey;this.mixHash(N.ss,Y);let X=this.encryptAndHash(N.ss,O);return{ne:Y,ns:$,ciphertext:X}}writeMessageB(N,O){N.e=this.crypto.generateX25519KeyPair();let U=N.e.publicKey;this.mixHash(N.ss,U),this.mixKey(N.ss,this.dh(N.e.privateKey,N.re));let $=N.s.publicKey,Y=this.encryptAndHash(N.ss,$);this.mixKey(N.ss,this.dh(N.s.privateKey,N.re));let X=this.encryptAndHash(N.ss,O);return{ne:U,ns:Y,ciphertext:X}}writeMessageC(N,O){let U=N.s.publicKey,$=this.encryptAndHash(N.ss,U);this.mixKey(N.ss,this.dh(N.s.privateKey,N.re));let Y=this.encryptAndHash(N.ss,O),X=this.createEmptyKey(),J={ne:X,ns:$,ciphertext:Y},{cs1:Z,cs2:en}=this.split(N.ss);return{h:N.ss.h,messageBuffer:J,cs1:Z,cs2:en}}readMessageA(N,O){return _D(O.ne)&&(N.re=O.ne),this.mixHash(N.ss,N.re),this.decryptAndHash(N.ss,O.ciphertext)}readMessageB(N,O){if(_D(O.ne)&&(N.re=O.ne),this.mixHash(N.ss,N.re),!N.e)throw Error("Handshake state `e` param is missing.");this.mixKey(N.ss,this.dh(N.e.privateKey,N.re));let{plaintext:U,valid:$}=this.decryptAndHash(N.ss,O.ns);$&&_D(U)&&(N.rs=U),this.mixKey(N.ss,this.dh(N.e.privateKey,N.rs));let{plaintext:Y,valid:X}=this.decryptAndHash(N.ss,O.ciphertext);return{plaintext:Y,valid:$&&X}}readMessageC(N,O){let{plaintext:U,valid:$}=this.decryptAndHash(N.ss,O.ns);if($&&_D(U)&&(N.rs=U),!N.e)throw Error("Handshake state `e` param is missing.");this.mixKey(N.ss,this.dh(N.e.privateKey,N.rs));let{plaintext:Y,valid:X}=this.decryptAndHash(N.ss,O.ciphertext),{cs1:J,cs2:Z}=this.split(N.ss);return{h:N.ss.h,plaintext:Y,valid:$&&X,cs1:J,cs2:Z}}initSession(N,O,U){let $;let Y=this.createEmptyKey(),X=new Uint8Array(32);return{hs:$=N?this.initializeInitiator(O,U,X,Y):this.initializeResponder(O,U,X,Y),i:N,mc:0}}sendMessage(N,O,U){let $;if(0===N.mc)$=this.writeMessageA(N.hs,O,U);else if(1===N.mc)$=this.writeMessageB(N.hs,O);else if(2===N.mc){let{h:U,messageBuffer:Y,cs1:X,cs2:J}=this.writeMessageC(N.hs,O);$=Y,N.h=U,N.cs1=X,N.cs2=J}else if(N.mc>2){if(N.i){if(!N.cs1)throw Error("CS1 (cipher state) is not defined");$=this.writeMessageRegular(N.cs1,O)}else{if(!N.cs2)throw Error("CS2 (cipher state) is not defined");$=this.writeMessageRegular(N.cs2,O)}}else throw Error("Session invalid.");return N.mc++,$}recvMessage(N,O){let U=new Uint8Array(0),$=!1;if(0===N.mc)({plaintext:U,valid:$}=this.readMessageA(N.hs,O));else if(1===N.mc)({plaintext:U,valid:$}=this.readMessageB(N.hs,O));else if(2===N.mc){let{h:Y,plaintext:X,valid:J,cs1:Z,cs2:en}=this.readMessageC(N.hs,O);U=X,$=J,N.h=Y,N.cs1=Z,N.cs2=en}return N.mc++,{plaintext:U,valid:$}}}class _z{isInitiator;session;remotePeer;remoteExtensions={webtransportCerthashes:[]};payload;connection;xx;staticKeypair;prologue;constructor(N,O,U,$,Y,X,J,Z){this.isInitiator=N,this.payload=O,this.prologue=U,this.staticKeypair=Y,this.connection=X,J&&(this.remotePeer=J),this.xx=Z??new _V($),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){if(_T(this.session.hs.s),this.isInitiator){_A.trace("Stage 0 - Initiator starting to send first message.");let N=this.xx.sendMessage(this.session,new Uint8Array(0));this.connection.writeLP(_t(N)),_A.trace("Stage 0 - Initiator finished sending first message."),_C(this.session.hs.e)}else{_A.trace("Stage 0 - Responder waiting to receive first message...");let N=_n((await this.connection.readLP()).subarray()),{valid:O}=this.xx.recvMessage(this.session,N);if(!O)throw new _f("xx handshake stage 0 validation fail");_A.trace("Stage 0 - Responder received first message."),_N(this.session.hs.re)}}async exchange(){if(this.isInitiator){_A.trace("Stage 1 - Initiator waiting to receive first message from responder...");let N=_s((await this.connection.readLP()).subarray()),{plaintext:O,valid:U}=this.xx.recvMessage(this.session,N);if(!U)throw new _f("xx handshake stage 1 validation fail");_A.trace("Stage 1 - Initiator received the message."),_N(this.session.hs.re),_P(this.session.hs.rs),_A.trace("Initiator going to check remote's signature...");try{let N=_S(O);this.remotePeer=this.remotePeer||await __(N),await _R(this.session.hs.rs,N,this.remotePeer),this.setRemoteNoiseExtension(N.extensions)}catch(O){let N=O;throw new _p(`Error occurred while verifying signed payload: ${N.message}`)}_A.trace("All good with the signature!")}else{_A.trace("Stage 1 - Responder sending out first message with signed payload and static key.");let N=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(_r(N)),_A.trace("Stage 1 - Responder sent the second handshake message with signed payload."),_C(this.session.hs.e)}}async finish(){if(this.isInitiator){_A.trace("Stage 2 - Initiator sending third handshake message.");let N=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(_i(N)),_A.trace("Stage 2 - Initiator sent message with signed payload.")}else{_A.trace("Stage 2 - Responder waiting for third handshake message...");let N=_o((await this.connection.readLP()).subarray()),{plaintext:O,valid:U}=this.xx.recvMessage(this.session,N);if(!U)throw new _f("xx handshake stage 2 validation fail");_A.trace("Stage 2 - Responder received the message, finished handshake.");try{let N=_S(O);this.remotePeer=this.remotePeer||await __(N),await _R(this.session.hs.rs,N,this.remotePeer),this.setRemoteNoiseExtension(N.extensions)}catch(O){let N=O;throw new _p(`Error occurred while verifying signed payload: ${N.message}`)}}_B(this.session)}encrypt(N,O){let U=this.getCS(O);return this.xx.encryptWithAd(U,new Uint8Array(0),N)}decrypt(N,O,U){let $=this.getCS(O,!1);return this.xx.decryptWithAd($,new Uint8Array(0),N,U)}getRemoteStaticKey(){return this.session.hs.rs}getCS(N,O=!0){if(!N.cs1||!N.cs2)throw new _f("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?O?N.cs1:N.cs2:O?N.cs2:N.cs1}setRemoteNoiseExtension(N){N&&(this.remoteExtensions=N)}}function _$(N){return{xxHandshakeSuccesses:N.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:N.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:N.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:N.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:N.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}class _K{protocol="/noise";crypto;prologue;staticKeys;extensions;metrics;constructor(N={}){let{staticNoiseKey:O,extensions:U,crypto:$,prologueBytes:Y,metrics:X}=N;this.crypto=$??E8,this.extensions=U,this.metrics=X?_$(X):void 0,O?this.staticKeys=this.crypto.generateX25519KeyPairFromSeed(O):this.staticKeys=this.crypto.generateX25519KeyPair(),this.prologue=Y??new Uint8Array(0)}async secureOutbound(N,O,U){let $=E_(O,{lengthEncoder:E9,lengthDecoder:_e,maxDataLength:ES}),Y=await this.performHandshake({connection:$,isInitiator:!0,localPeer:N,remotePeer:U}),X=await this.createSecureConnection($,Y);return{conn:X,remoteExtensions:Y.remoteExtensions,remotePeer:Y.remotePeer}}async secureInbound(N,O,U){let $=E_(O,{lengthEncoder:E9,lengthDecoder:_e,maxDataLength:ES}),Y=await this.performHandshake({connection:$,isInitiator:!1,localPeer:N,remotePeer:U}),X=await this.createSecureConnection($,Y);return{conn:X,remotePeer:Y.remotePeer,remoteExtensions:Y.remoteExtensions}}async performHandshake(N){let O=await _g(N.localPeer,this.staticKeys.publicKey,this.extensions);return this.performXXHandshake(N,O)}async performXXHandshake(N,O){let{isInitiator:U,remotePeer:$,connection:Y}=N,X=new _z(U,O,this.prologue,this.crypto,this.staticKeys,Y,$);try{await X.propose(),await X.exchange(),await X.finish(),this.metrics?.xxHandshakeSuccesses.increment()}catch(N){if(this.metrics?.xxHandshakeErrors.increment(),N instanceof Error)throw N.message=`Error occurred during XX handshake: ${N.message}`,N}return X}async createSecureConnection(N,O){let[U,$]=Ew(),Y=N.unwrap();return await oD(U,_l(O,this.metrics),Y,N=>om(N,{lengthDecoder:_e}),_u(O,this.metrics),U),$}}function _q(N={}){return()=>new _K(N)}let _j="ERR_INVALID_FRAME",_W="ERR_UNREQUESTED_PING",_H="ERR_NOT_MATCHING_PING",_G="ERR_STREAM_ALREADY_EXISTS",_Q="ERR_DECODE_INVALID_VERSION",_Y="ERR_BOTH_CLIENTS",_X="ERR_RECV_WINDOW_EXCEEDED",_J=new Set([_j,_W,_H,_G,_Q,_Y,_X]),_Z="ERR_INVALID_CONFIG",_1="ERR_MUXER_LOCAL_CLOSED",_2="ERR_MUXER_REMOTE_CLOSED",_0="ERR_STREAM_RESET",_3="ERR_STREAM_ABORT",_4="ERROR_MAX_OUTBOUND_STREAMS_EXCEEDED",_5="ERR_DECODE_IN_PROGRESS",_6=262144,_8=16777216,_7={log:rF("libp2p:yamux"),enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:_6,maxStreamWindowSize:_8,maxMessageSize:65536};function Se(N){if(N.keepAliveInterval<=0)throw new n3("keep-alive interval must be positive",_Z);if(N.maxInboundStreams<0)throw new n3("max inbound streams must be larger or equal 0",_Z);if(N.maxOutboundStreams<0)throw new n3("max outbound streams must be larger or equal 0",_Z);if(N.initialStreamWindowSize<_6)throw new n3("InitialStreamWindowSize must be larger or equal 256 kB",_Z);if(N.maxStreamWindowSize<N.initialStreamWindowSize)throw new n3("MaxStreamWindowSize must be larger than the InitialStreamWindowSize",_Z);if(N.maxStreamWindowSize>4294967296-1)throw new n3("MaxStreamWindowSize must be less than equal MAX_UINT32",_Z);if(N.maxMessageSize<1024)throw new n3("MaxMessageSize must be greater than a kilobyte",_Z)}!function(N){N[N.Data=0]="Data",N[N.WindowUpdate=1]="WindowUpdate",N[N.Ping=2]="Ping",N[N.GoAway=3]="GoAway"}(tf||(tf={})),function(N){N[N.SYN=1]="SYN",N[N.ACK=2]="ACK",N[N.FIN=4]="FIN",N[N.RST=8]="RST"}(tg||(tg={}));let St=Object.values(tg).filter(N=>"string"!=typeof N),Sr=0;!function(N){N[N.NormalTermination=0]="NormalTermination",N[N.ProtocolError=1]="ProtocolError",N[N.InternalError=2]="InternalError"}(ty||(ty={}));let Si=12;function Sn(N){let O=St.filter(O=>(N.flag&O)===O).map(N=>tg[N]).join("|");return`streamID=${N.streamID} type=${tf[N.type]} flag=${O} length=${N.length}`}let Ss=16777216;function So(N){if(N[0]!==Sr)throw new n3("Invalid frame version",_Q);return{type:N[1],flag:(N[2]<<8)+N[3],streamID:N[4]*Ss+(N[5]<<16)+(N[6]<<8)+N[7],length:N[8]*Ss+(N[9]<<16)+(N[10]<<8)+N[11]}}class Sa{source;buffer;frameInProgress;constructor(N){this.source=Sl(N),this.buffer=new sZ,this.frameInProgress=!1}async *emitFrames(){for await(let N of this.source)for(this.buffer.append(N);;){let N=this.readHeader();if(void 0===N)break;let{type:O,length:U}=N;O===tf.Data?(this.frameInProgress=!0,yield{header:N,readData:this.readBytes.bind(this,U)}):yield{header:N}}}readHeader(){if(this.frameInProgress)throw new n3("decoding frame already in progress",_5);if(this.buffer.length<Si)return;let N=So(this.buffer.subarray(0,Si));return this.buffer.consume(Si),N}async readBytes(N){if(this.buffer.length<N){for await(let O of this.source)if(this.buffer.append(O),this.buffer.length>=N)break}let O=this.buffer.sublist(0,N);return this.buffer.consume(N),this.frameInProgress=!1,O}}function Sl(N){if(void 0!==N[Symbol.iterator]){let O=N[Symbol.iterator]();return O.return=void 0,{[Symbol.iterator]:()=>O}}if(void 0!==N[Symbol.asyncIterator]){let O=N[Symbol.asyncIterator]();return O.return=void 0,{[Symbol.asyncIterator]:()=>O}}throw Error("a source must be either an iterable or an async iterable")}function Sc(N){let O=new Uint8Array(Si);return O[1]=N.type,O[2]=N.flag>>>8,O[3]=N.flag,O[4]=N.streamID>>>24,O[5]=N.streamID>>>16,O[6]=N.streamID>>>8,O[7]=N.streamID,O[8]=N.length>>>24,O[9]=N.length>>>16,O[10]=N.length>>>8,O[11]=N.length,O}!function(N){N[N.Init=0]="Init",N[N.SYNSent=1]="SYNSent",N[N.SYNReceived=2]="SYNReceived",N[N.Established=3]="Established",N[N.Finished=4]="Finished"}(tm||(tm={})),function(N){N[N.Open=0]="Open",N[N.Closed=1]="Closed",N[N.Reset=2]="Reset"}(tb||(tb={}));class Su{id;name;stat;metadata;state;readState;writeState;sourceInput;source;sink;config;log;_id;sendWindowCapacity;sendWindowCapacityUpdate;recvWindow;recvWindowCapacity;epochStart;getRTT;abortController;sendFrame;onStreamEnd;constructor(N){this.config=N.config,this.log=N.log,this._id=N.id,this.id=String(N.id),this.name=N.name,this.stat={direction:N.direction,timeline:{open:Date.now()}},this.metadata={},this.state=N.state,this.readState=tb.Open,this.writeState=tb.Open,this.sendWindowCapacity=_6,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=N.getRTT,this.abortController=new AbortController,this.sendFrame=N.sendFrame,this.onStreamEnd=N.onStreamEnd,this.sourceInput=o_({onEnd:N=>{null!=N?this.log?.error("stream source ended id=%s",this._id,N):this.log?.trace("stream source ended id=%s",this._id),this.closeRead()}}),this.source=this.createSource(),this.sink=async N=>{if(this.writeState!==tb.Open)throw Error("stream closed for writing");N=sW(N,this.abortController.signal,{returnOnAbort:!0});try{for await(let O of N)for(;0!==O.length;){0===this.sendWindowCapacity&&await this.waitForSendWindowCapacity();let N=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-Si,O.length);this.sendData(O.subarray(0,N)),this.sendWindowCapacity-=N,O=O.subarray(N)}}catch(N){this.log?.error("stream sink error id=%s",this._id,N)}finally{this.log?.trace("stream sink ended id=%s",this._id),this.closeWrite()}}}async *createSource(){try{for await(let N of this.sourceInput)this.sendWindowUpdate(),yield N}catch(O){let N=O.code;if(N!==_3)throw this.log?.error("stream source error id=%s",this._id,O),O}}close(){this.log?.trace("stream close id=%s",this._id),this.closeRead(),this.closeWrite()}closeRead(){this.state!==tm.Finished&&this.readState===tb.Open&&(this.log?.trace("stream close read id=%s",this._id),this.readState=tb.Closed,this.sourceInput.end(),this.writeState!==tb.Open&&this.finish())}closeWrite(){this.state!==tm.Finished&&this.writeState===tb.Open&&(this.log?.trace("stream close write id=%s",this._id),this.writeState=tb.Closed,this.sendClose(),this.abortController.abort(),this.readState!==tb.Open&&this.finish())}abort(N){switch(this.state){case tm.Finished:return;case tm.Init:break;case tm.SYNSent:case tm.SYNReceived:case tm.Established:this.sendReset();break;default:throw Error("unreachable")}null!=N?this.log?.error("stream abort id=%s error=%s",this._id,N):this.log?.trace("stream abort id=%s",this._id),this.onReset(new n3(String(N)??"stream aborted",_3))}reset(){this.state!==tm.Finished&&(this.log?.trace("stream reset id=%s",this._id),this.onReset(new n3("stream reset",_0)))}onReset(N){this.writeState===tb.Open&&(this.writeState=tb.Reset),this.readState===tb.Open&&(this.readState=tb.Reset),this.state=tm.Finished,this.sourceInput.end(N),this.abortController.abort(),this.finish()}async waitForSendWindowCapacity(){let N;if(this.abortController.signal.aborted)throw new n3("stream aborted",_3);if(this.sendWindowCapacity>0)return;let O=()=>{N(new n3("stream aborted",_3))};this.abortController.signal.addEventListener("abort",O),await new Promise((U,$)=>{this.sendWindowCapacityUpdate=()=>{this.abortController.signal.removeEventListener("abort",O),U(void 0)},N=$})}handleWindowUpdate(N){this.log?.trace("stream received window update id=%s",this._id),this.processFlags(N.flag);let O=this.sendWindowCapacity;this.sendWindowCapacity+=N.length,0===O&&N.length>0&&this.sendWindowCapacityUpdate?.()}async handleData(N,O){if(this.log?.trace("stream received data id=%s",this._id),this.processFlags(N.flag),this.recvWindowCapacity<N.length)throw new n3("receive window exceeded",_X,{available:this.recvWindowCapacity,recv:N.length});let U=await O();this.recvWindowCapacity-=N.length,this.sourceInput.push(U)}processFlags(N){(N&tg.ACK)===tg.ACK&&this.state===tm.SYNSent&&(this.state=tm.Established),(N&tg.FIN)===tg.FIN&&this.closeRead(),(N&tg.RST)===tg.RST&&this.reset()}finish(){this.log?.trace("stream finished id=%s",this._id),this.state=tm.Finished,this.stat.timeline.close=Date.now(),this.onStreamEnd()}getSendFlags(){switch(this.state){case tm.Init:return this.state=tm.SYNSent,tg.SYN;case tm.SYNReceived:return this.state=tm.Established,tg.ACK;default:return 0}}sendWindowUpdate(){let N=this.getSendFlags(),O=Date.now(),U=this.getRTT();if(0===N&&U>0&&O-this.epochStart<4*U&&(this.recvWindow=Math.min(2*this.recvWindow,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&0===N)return;let $=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=O,this.sendFrame({type:tf.WindowUpdate,flag:N,streamID:this._id,length:$})}sendData(N){let O=this.getSendFlags();this.sendFrame({type:tf.Data,flag:O,streamID:this._id,length:N.length},N)}sendClose(){let N=this.getSendFlags()|tg.FIN;this.sendFrame({type:tf.WindowUpdate,flag:N,streamID:this._id,length:0})}sendReset(){this.sendFrame({type:tf.WindowUpdate,flag:tg.RST,streamID:this._id,length:0})}}let Sh="/yamux/1.0.0";class Sd{protocol=Sh;_init;constructor(N={}){this._init=N}createStreamMuxer(N){return new Sp({...this._init,...N})}}class Sp{protocol=Sh;source;sink;_init;config;log;closeController;nextStreamID;_streams;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;onIncomingStream;onStreamEnd;constructor(N){this._init=N,this.client="outbound"===N.direction,this.config={..._7,...N},this.log=this.config.log,Se(this.config),this.closeController=new AbortController,this.onIncomingStream=N.onIncomingStream,this.onStreamEnd=N.onStreamEnd,this._streams=new Map,this.source=o_({onEnd:N=>{this.log?.trace("muxer source ended"),this.close(N)}}),this.sink=async N=>{let O,U,$;null!=this._init.signal&&(O=nY([this.closeController.signal,this._init.signal])),N=sW(N,O??this.closeController.signal,{returnOnAbort:!0});try{let O=new Sa(N);await oD(O.emitFrames.bind(O),async N=>{for await(let{header:O,readData:U}of N)await this.handleFrame(O,U)}),U=ty.NormalTermination}catch(O){let N=O.code;_J.has(N)?(this.log?.error("protocol error in sink",O),U=ty.ProtocolError):(this.log?.error("internal error in sink",O),U=ty.InternalError),$=O}finally{null!=O&&O.clear()}this.log?.trace("muxer sink ended"),this.close($,U)},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=0,this.log?.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(N=>this.log?.error("keepalive error: %s",N))}get streams(){return Array.from(this._streams.values())}newStream(N){if(void 0!==this.remoteGoAway)throw new n3("muxer closed remotely",_2);if(void 0!==this.localGoAway)throw new n3("muxer closed locally",_1);let O=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new n3("max outbound streams exceeded",_4);this.log?.trace("new outgoing stream id=%s",O);let U=this._newStream(O,N,tm.Init,"outbound");return this._streams.set(O,U),this.numOutboundStreams++,U.sendWindowUpdate(),U}async ping(){if(void 0!==this.remoteGoAway)throw new n3("muxer closed remotely",_2);if(void 0!==this.localGoAway)throw new n3("muxer closed locally",_1);if(void 0===this.activePing){let N=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((O,U)=>{let $=()=>{U(new n3("muxer closed locally",_1))};this.closeController.signal.addEventListener("abort",$,{once:!0}),N=()=>{this.closeController.signal.removeEventListener("abort",$),O()}}),resolve:N};let O=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}let U=Date.now();this.rtt=U-O}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}close(N,O){if(!this.closeController.signal.aborted){if(O=O??(void 0===N?ty.InternalError:ty.NormalTermination),null!=N?this.log?.error("muxer close reason=%s error=%s",ty[O],N):this.log?.trace("muxer close reason=%s",ty[O]),void 0===N)for(let N of this._streams.values())N.close();else for(let O of this._streams.values())O.abort(N);this.sendGoAway(O),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(N,O,U,$){if(null!=this._streams.get(N))throw new n3("Stream already exists",_G,{id:N});let Y=new Su({id:N,name:O,state:U,direction:$,sendFrame:this.sendFrame.bind(this),onStreamEnd:()=>{this.closeStream(N),this.onStreamEnd?.(Y)},log:this.log,config:this.config,getRTT:this.getRTT.bind(this)});return Y}closeStream(N){this.client===(N%2==0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(N)}async keepAliveLoop(){let N=new Promise((N,O)=>{this.closeController.signal.addEventListener("abort",O,{once:!0})});for(this.log?.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let O;try{await Promise.race([N,new Promise(N=>{O=setTimeout(N,this.config.keepAliveInterval)})]),this.ping().catch(N=>this.log?.error("ping error: %s",N))}catch(N){clearInterval(O);return}}}async handleFrame(N,O){let{streamID:U,type:$,length:Y}=N;if(this.log?.trace("received frame %s",Sn(N)),0===U)switch($){case tf.Ping:this.handlePing(N);return;case tf.GoAway:this.handleGoAway(Y);return;default:throw new n3("Invalid frame type",_j,{header:N})}else switch(N.type){case tf.Data:case tf.WindowUpdate:await this.handleStreamMessage(N,O);return;default:throw new n3("Invalid frame type",_j,{header:N})}}handlePing(N){if(N.flag===tg.SYN)this.log?.trace("received ping request pingId=%s",N.length),this.sendPing(N.length,tg.ACK);else if(N.flag===tg.ACK)this.log?.trace("received ping response pingId=%s",N.length),this.handlePingResponse(N.length);else throw new n3("Invalid frame flag",_j,{header:N})}handlePingResponse(N){if(void 0===this.activePing)throw new n3("ping not requested",_W);if(this.activePing.id!==N)throw new n3("ping doesn't match our id",_H);this.activePing.resolve()}handleGoAway(N){for(let O of(this.log?.trace("received GoAway reason=%s",ty[N]??"unknown"),this.remoteGoAway=N,this._streams.values()))O.reset();this._closeMuxer()}async handleStreamMessage(N,O){let{streamID:U,flag:$,type:Y}=N;($&tg.SYN)===tg.SYN&&this.incomingStream(U);let X=this._streams.get(U);if(void 0===X){if(Y===tf.Data){if(this.log?.("discarding data for stream id=%s",U),void 0===O)throw Error("unreachable");await O()}else this.log?.("frame for missing stream id=%s",U);return}switch(Y){case tf.WindowUpdate:X.handleWindowUpdate(N);return;case tf.Data:if(void 0===O)throw Error("unreachable");await X.handleData(N,O);return;default:throw Error("unreachable")}}incomingStream(N){if(this.client!==(N%2==0))throw new n3("both endpoints are clients",_Y);if(this._streams.has(N))return;if(this.log?.trace("new incoming stream id=%s",N),void 0!==this.localGoAway){this.sendFrame({type:tf.WindowUpdate,flag:tg.RST,streamID:N,length:0});return}if(this.numInboundStreams>=this.config.maxInboundStreams){this.log?.("maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:tf.WindowUpdate,flag:tg.RST,streamID:N,length:0});return}let O=this._newStream(N,void 0,tm.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(N,O),this.onIncomingStream?.(O)}sendFrame(N,O){if(this.log?.trace("sending frame %s",Sn(N)),N.type===tf.Data){if(void 0===O)throw new n3("invalid frame",_j);this.source.push(Sc(N)),this.source.push(O)}else this.source.push(Sc(N))}sendPing(N,O=tg.SYN){O===tg.SYN?this.log?.trace("sending ping request pingId=%s",N):this.log?.trace("sending ping response pingId=%s",N),this.sendFrame({type:tf.Ping,flag:O,streamID:0,length:N})}sendGoAway(N=ty.NormalTermination){this.log?.("sending GoAway reason=%s",ty[N]),this.localGoAway=N,this.sendFrame({type:tf.GoAway,flag:0,streamID:0,length:N})}}function Sf(N={}){return()=>new Sd(N)}let Sg=SH("dns4"),Sy=SH("dns6"),Sm=SH("dnsaddr"),Sb=SW(SH("dns"),Sm,Sg,Sy),Sw=SW(SH("ip4"),SH("ip6")),Sv=SW(Sj(Sw,SH("tcp")),Sj(Sb,SH("tcp"))),SE=Sj(Sw,SH("udp")),S_=Sj(SE,SH("utp")),SS=Sj(SE,SH("quic")),SI=Sj(SE,SH("quic-v1")),SR=SW(Sj(Sv,SH("ws")),Sj(Sb,SH("ws"))),Sk=SW(Sj(SR,SH("p2p")),SR),SD=SW(Sj(Sv,SH("wss")),Sj(Sb,SH("wss")),Sj(Sv,SH("tls"),SH("ws")),Sj(Sb,SH("tls"),SH("ws"))),SA=SW(Sj(SD,SH("p2p")),SD),ST=SW(Sj(Sv,SH("http")),Sj(Sw,SH("http")),Sj(Sb,SH("http"))),SC=SW(Sj(Sv,SH("https")),Sj(Sw,SH("https")),Sj(Sb,SH("https"))),SP=Sj(SE,SH("webrtc-direct"),SH("certhash")),Sx=SW(Sj(SP,SH("p2p")),SP),SN=Sj(SI,SH("webtransport"),SH("certhash"),SH("certhash")),SL=SW(Sj(SN,SH("p2p")),SN),SO=SW(Sj(Sk,SH("p2p-webrtc-star"),SH("p2p")),Sj(SA,SH("p2p-webrtc-star"),SH("p2p")),Sj(Sk,SH("p2p-webrtc-star")),Sj(SA,SH("p2p-webrtc-star")));SW(Sj(Sk,SH("p2p-websocket-star"),SH("p2p")),Sj(SA,SH("p2p-websocket-star"),SH("p2p")),Sj(Sk,SH("p2p-websocket-star")),Sj(SA,SH("p2p-websocket-star")));let SM=SW(Sj(ST,SH("p2p-webrtc-direct"),SH("p2p")),Sj(SC,SH("p2p-webrtc-direct"),SH("p2p")),Sj(ST,SH("p2p-webrtc-direct")),Sj(SC,SH("p2p-webrtc-direct"))),SU=SW(SR,SD,ST,SC,SO,SM,Sv,S_,SS,Sb,Sx,SL);SW(Sj(SU,SH("p2p-stardust"),SH("p2p")),Sj(SU,SH("p2p-stardust")));let SF=SW(Sj(SU,SH("p2p")),SO,SM,Sx,SL,SH("p2p")),SV=SW(Sj(SF,SH("p2p-circuit"),SF),Sj(SF,SH("p2p-circuit")),Sj(SH("p2p-circuit"),SF),Sj(SU,SH("p2p-circuit")),Sj(SH("p2p-circuit"),SU),SH("p2p-circuit")),Sz=()=>SW(Sj(SV,Sz),SV),S$=Sz(),SK=SW(Sj(S$,SF,S$),Sj(SF,S$),Sj(S$,SF),S$,SF);function Sq(N){return function(O){let U;try{U=y1(O)}catch(N){return!1}let $=N(U.protoNames());return null!==$&&(!0===$||!1===$?$:0===$.length)}}function Sj(...N){function O(O){if(O.length<N.length)return null;let U=O;return N.some(N=>(Array.isArray(U="function"==typeof N?N().partialMatch(O):N.partialMatch(O))&&(O=U),null===U)),U}return{toString:function(){return"{ "+N.join(" ")+" }"},input:N,matches:Sq(O),partialMatch:O}}function SW(...N){function O(O){let U=null;return N.some(N=>{let $="function"==typeof N?N().partialMatch(O):N.partialMatch(O);return null!=$&&(U=$,!0)}),U}let U={toString:function(){return"{ "+N.join(" ")+" }"},input:N,matches:Sq(O),partialMatch:O};return U}function SH(N){let O=N;return{toString:function(){return O},matches:function(N){let U;try{U=y1(N)}catch(N){return!1}let $=U.protoNames();return 1===$.length&&$[0]===O},partialMatch:function(N){return 0===N.length?null:N[0]===O?N.slice(1):null}}}SW(Sj(S$,SH("webrtc"),SH("p2p")),Sj(S$,SH("webrtc")),Sj(SU,SH("webrtc"),SH("p2p")),Sj(SU,SH("webrtc")),SH("webrtc"));let SG=rF("libp2p:bootstrap"),SQ="bootstrap",SY=50,SX=12e4,SJ=1e3;class SZ extends gh{static tag="bootstrap";timer;list;timeout;components;_init;constructor(N,O={list:[]}){if(null==O.list||0===O.list.length)throw Error("Bootstrap requires a list of peer addresses");for(let U of(super(),this.components=N,this.timeout=O.timeout??SJ,this.list=[],O.list)){if(!SK.matches(U)){SG.error("Invalid multiaddr");continue}let N=y1(U),O=N.getPeerId();if(null==O){SG.error("Invalid bootstrap multiaddr without peer id");continue}let $={id:gC(O),multiaddrs:[N],protocols:[]};this.list.push($)}this._init=O}[gc]=this;[Symbol.toStringTag]="@libp2p/bootstrap";isStarted(){return!!this.timer}start(){this.isStarted()||(SG("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(N=>{SG.error(N)})},this.timeout))}async _discoverBootstrapPeers(){if(null!=this.timer)for(let N of this.list){if(await this.components.peerStore.merge(N.id,{tags:{[this._init.tagName??SQ]:{value:this._init.tagValue??SY,ttl:this._init.tagTTL??SX}}}),null==this.timer)return;this.safeDispatchEvent("peer",{detail:N})}}stop(){null!=this.timer&&clearTimeout(this.timer),this.timer=void 0}}function S0(N){return O=>new SZ(O,N)}async function*S3(N,O={}){let U=N.getReader();try{for(;;){let N=await U.read();if(N.done)return;yield N.value}}finally{!0!==O.preventCancel&&await U.cancel(),U.releaseLock()}}var S4=U(4094);let S5=rF("ipni-content-routing"),S6={concurrentRequests:4,timeout:3e4};class S8{started;httpQueue;shutDownController;clientUrl;timeout;constructor(N,O={}){S5("enabled IPNI routing via",N),this.started=!1,this.shutDownController=new AbortController,this.httpQueue=new cO({concurrency:O.concurrentRequests??S6.concurrentRequests}),this.clientUrl=N instanceof URL?N:new URL(N),this.timeout=O.timeout??S6.timeout}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.shutDownController.abort(),this.started=!1}async *findProviders(N,O={}){S5("findProviders starts: %c",N);let U=nY([this.shutDownController.signal,O.signal,AbortSignal.timeout(this.timeout)]),$=c_(),Y=c_();this.httpQueue.add(async()=>($.resolve(),Y.promise));try{await $.promise;let O=`${this.clientUrl}cid/${N.toString()}?cascade=ipfs-dht`,Y={headers:{Accept:"application/x-ndjson"},signal:U},X=await fetch(O,Y);if(null==X.body)throw new n3("IPNI response had no body","ERR_BAD_RESPONSE");for await(let N of S4(S3(X.body)))"gBI="===N.Metadata&&(yield this.mapEvent(N))}catch(N){S5.error("findProviders errored:",N)}finally{U.clear(),Y.resolve(),S5("findProviders finished: %c",N)}}mapEvent(N){let O=gC(N.Provider.ID),U=[];for(let O of N.Provider.Addrs){let N=y1(O);U.push(N)}let $={id:O,multiaddrs:U,protocols:[]};return $}async provide(){}async put(){}async get(){throw new n3("Not found","ERR_NOT_FOUND")}}function S7(N,O={}){return()=>new S8(N,O)}function S9(N,O,U){if(0===U.length){let N="No records given";throw new n3(N,"ERR_NO_RECORDS_RECEIVED")}let $=nA(O),Y=$.split("/");if(Y.length<3){let N="Record key does not have a selector function";throw new n3(N,"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")}let X=N[Y[1].toString()];if(null==X){let N=`Unrecognized key prefix: ${Y[1]}`;throw new n3(N,"ERR_UNRECOGNIZED_KEY_PREFIX")}return 1===U.length?0:X(O,U)}function Ie(N,O){return 0}let It={pk:Ie};async function Ir(N,O){let U=O.key,$=nA(U),Y=$.split("/");if(Y.length<3)return;let X=N[Y[1].toString()];if(null==X){let N="Invalid record keytype";throw new n3(N,"ERR_INVALID_RECORD_KEY_TYPE")}await X(U,O.value)}let Ii=async(N,O)=>{if(!(N instanceof Uint8Array))throw new n3('"key" must be a Uint8Array',"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(N.byteLength<5)throw new n3("invalid public key record","ERR_INVALID_RECORD_KEY_TOO_SHORT");let U=nA(N.subarray(0,4));if("/pk/"!==U)throw new n3("key was not prefixed with /pk/","ERR_INVALID_RECORD_KEY_BAD_PREFIX");let $=N.slice(4),Y=await nr.digest(O);if(!n5($,Y.bytes))throw new n3("public key does not match passed in key","ERR_INVALID_RECORD_HASH_MISMATCH")},In={pk:Ii},Is=1e3,Io=60*Is,Ia=60*Io,Il=36*Ia,Ic="/lan",Iu="/ipfs",Ih="/kad/1.0.0",Id="/dht/record",Ip="/dht/provider",If=256,Ig=24*Ia,Iy=Ia,Im=20,Ib=3,Iw=Number(5*Io),Iv=Number(Number(Is)),IE=Number(5*Is),I_=Number(5*Io),IS=Number(30*Is),II=Number(30*Is);function IR(N){let O=N.getUTCFullYear(),U=String(N.getUTCMonth()+1).padStart(2,"0"),$=String(N.getUTCDate()).padStart(2,"0"),Y=String(N.getUTCHours()).padStart(2,"0"),X=String(N.getUTCMinutes()).padStart(2,"0"),J=String(N.getUTCSeconds()).padStart(2,"0"),Z=N.getUTCMilliseconds(),en=String(1e6*Z).padStart(9,"0");return`${O}-${U}-${$}T${Y}:${X}:${J}.${en}Z`}function Ik(N){let O=RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),U=String(N).trim().match(O);if(null==U)throw Error("Invalid format");let $=parseInt(U[1],10),Y=parseInt(U[2],10)-1,X=parseInt(U[3],10),J=parseInt(U[4],10),Z=parseInt(U[5],10),en=parseInt(U[6],10),es=parseInt(U[7].slice(0,-6),10);return new Date(Date.UTC($,Y,X,J,Z,en,es))}!function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),null!=N.key&&N.key.byteLength>0&&(O.uint32(10),O.bytes(N.key)),null!=N.value&&N.value.byteLength>0&&(O.uint32(18),O.bytes(N.value)),null!=N.timeReceived&&""!==N.timeReceived&&(O.uint32(42),O.string(N.timeReceived)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={key:new Uint8Array(0),value:new Uint8Array(0),timeReceived:""},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.key=N.bytes();break;case 2:U.value=N.bytes();break;case 5:U.timeReceived=N.string();break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tw||(tw={}));class ID{key;value;timeReceived;constructor(N,O,U){if(!(N instanceof Uint8Array))throw Error("key must be a Uint8Array");if(!(O instanceof Uint8Array))throw Error("value must be a Uint8Array");this.key=N,this.value=O,this.timeReceived=U}serialize(){return tw.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:IR(this.timeReceived)}}static deserialize(N){let O=tw.decode(N);return new ID(O.key,O.value,new Date(O.timeReceived))}static fromDeserialized(N){let O=Ik(N.timeReceived);if(null==N.key)throw Error("key missing from deserialized object");if(null==N.value)throw Error("value missing from deserialized object");let U=new ID(N.key,N.value,O);return U}}let IA=globalThis.CustomEvent??Event;async function*IT(N,O={}){let U,$=O.concurrency??1/0;$<1&&($=1/0);let Y=null!=O.ordered&&O.ordered,X=new EventTarget,J=[],Z=c_(),en=c_(),es=!1,eo=!1;function ea(){return Y?J[0]?.done:!!J.find(N=>N.done)}function*ec(){for(;J.length>0&&J[0].done;){let N=J[0];if(J.shift(),N.ok)yield N.value;else throw eo=!0,Z.resolve(),N.err;Z.resolve()}}function*eu(){for(;ea();)for(let N=0;N<J.length;N++)if(J[N].done){let O=J[N];if(J.splice(N,1),N--,O.ok)yield O.value;else throw eo=!0,Z.resolve(),O.err;Z.resolve()}}for(X.addEventListener("task-complete",()=>{en.resolve()}),Promise.resolve().then(async()=>{try{for await(let O of N){if(J.length===$&&(Z=c_(),await Z.promise),eo)break;let N={done:!1};J.push(N),O().then(O=>{N.done=!0,N.ok=!0,N.value=O,X.dispatchEvent(new IA("task-complete"))},O=>{N.done=!0,N.err=O,X.dispatchEvent(new IA("task-complete"))})}es=!0,X.dispatchEvent(new IA("task-complete"))}catch(N){U=N,X.dispatchEvent(new IA("task-complete"))}});;){if(ea()||(en=c_(),await en.promise),null!=U)throw U;if(Y?yield*ec():yield*eu(),es&&0===J.length)break}}!function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),null!=N.key&&(O.uint32(10),O.bytes(N.key)),null!=N.value&&(O.uint32(18),O.bytes(N.value)),null!=N.author&&(O.uint32(26),O.bytes(N.author)),null!=N.signature&&(O.uint32(34),O.bytes(N.signature)),null!=N.timeReceived&&(O.uint32(42),O.string(N.timeReceived)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.key=N.bytes();break;case 2:U.value=N.bytes();break;case 3:U.author=N.bytes();break;case 4:U.signature=N.bytes();break;case 5:U.timeReceived=N.string();break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tv||(tv={})),function(N){let O,U,$,Y,X,J;(function(N){N.PUT_VALUE="PUT_VALUE",N.GET_VALUE="GET_VALUE",N.ADD_PROVIDER="ADD_PROVIDER",N.GET_PROVIDERS="GET_PROVIDERS",N.FIND_NODE="FIND_NODE",N.PING="PING"})(O=N.MessageType||(N.MessageType={})),function(N){N[N.PUT_VALUE=0]="PUT_VALUE",N[N.GET_VALUE=1]="GET_VALUE",N[N.ADD_PROVIDER=2]="ADD_PROVIDER",N[N.GET_PROVIDERS=3]="GET_PROVIDERS",N[N.FIND_NODE=4]="FIND_NODE",N[N.PING=5]="PING"}(U||(U={})),function(N){N.codec=()=>sv(U)}(O=N.MessageType||(N.MessageType={})),function(N){N.NOT_CONNECTED="NOT_CONNECTED",N.CONNECTED="CONNECTED",N.CAN_CONNECT="CAN_CONNECT",N.CANNOT_CONNECT="CANNOT_CONNECT"}($=N.ConnectionType||(N.ConnectionType={})),function(N){N[N.NOT_CONNECTED=0]="NOT_CONNECTED",N[N.CONNECTED=1]="CONNECTED",N[N.CAN_CONNECT=2]="CAN_CONNECT",N[N.CANNOT_CONNECT=3]="CANNOT_CONNECT"}(Y||(Y={})),function(N){N.codec=()=>sv(Y)}($=N.ConnectionType||(N.ConnectionType={})),function(O){let U;O.codec=()=>(null==U&&(U=sE((O,U,$={})=>{if(!1!==$.lengthDelimited&&U.fork(),null!=O.id&&(U.uint32(10),U.bytes(O.id)),null!=O.addrs)for(let N of O.addrs)U.uint32(18),U.bytes(N);null!=O.connection&&(U.uint32(24),N.ConnectionType.codec().encode(O.connection,U)),!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let $={addrs:[]},Y=null==U?O.len:O.pos+U;for(;O.pos<Y;){let U=O.uint32();switch(U>>>3){case 1:$.id=O.bytes();break;case 2:$.addrs.push(O.bytes());break;case 3:$.connection=N.ConnectionType.codec().decode(O);break;default:O.skipType(7&U)}}return $})),U),O.encode=N=>sm(N,O.codec()),O.decode=N=>sy(N,O.codec())}(X=N.Peer||(N.Peer={})),N.codec=()=>(null==J&&(J=sE((O,U,$={})=>{if(!1!==$.lengthDelimited&&U.fork(),null!=O.type&&(U.uint32(8),N.MessageType.codec().encode(O.type,U)),null!=O.clusterLevelRaw&&(U.uint32(80),U.int32(O.clusterLevelRaw)),null!=O.key&&(U.uint32(18),U.bytes(O.key)),null!=O.record&&(U.uint32(26),U.bytes(O.record)),null!=O.closerPeers)for(let $ of O.closerPeers)U.uint32(66),N.Peer.codec().encode($,U);if(null!=O.providerPeers)for(let $ of O.providerPeers)U.uint32(74),N.Peer.codec().encode($,U);!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let $={closerPeers:[],providerPeers:[]},Y=null==U?O.len:O.pos+U;for(;O.pos<Y;){let U=O.uint32();switch(U>>>3){case 1:$.type=N.MessageType.codec().decode(O);break;case 10:$.clusterLevelRaw=O.int32();break;case 2:$.key=O.bytes();break;case 3:$.record=O.bytes();break;case 8:$.closerPeers.push(N.Peer.codec().decode(O,O.uint32()));break;case 9:$.providerPeers.push(N.Peer.codec().decode(O,O.uint32()));break;default:O.skipType(7&U)}}return $})),J),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tE||(tE={}));let IC=tE.MessageType,Ix=tE.ConnectionType,IN=Object.keys(IC);class IB{type;key;clusterLevelRaw;closerPeers;providerPeers;record;constructor(N,O,U){if(!(O instanceof Uint8Array))throw Error("Key must be a Uint8Array");this.type=N,this.key=O,this.clusterLevelRaw=U,this.closerPeers=[],this.providerPeers=[],this.record=void 0}get clusterLevel(){let N=this.clusterLevelRaw-1;return N<0?0:N}set clusterLevel(N){this.clusterLevelRaw=N}serialize(){return tE.encode({key:this.key,type:this.type,clusterLevelRaw:this.clusterLevelRaw,closerPeers:this.closerPeers.map(IL),providerPeers:this.providerPeers.map(IL),record:null==this.record?void 0:this.record.serialize().subarray()})}static deserialize(N){let O=tE.decode(N),U=new IB(O.type??tE.MessageType.PUT_VALUE,O.key??Uint8Array.from([]),O.clusterLevelRaw??0);return U.closerPeers=O.closerPeers.map(IO),U.providerPeers=O.providerPeers.map(IO),O.record?.length!=null&&(U.record=ID.deserialize(O.record)),U}}function IL(N){let O={id:N.id.toBytes(),addrs:(N.multiaddrs??[]).map(N=>N.bytes),connection:Ix.CONNECTED};return O}function IO(N){if(null==N.id)throw Error("Invalid peer in message");return{id:gP(N.id),multiaddrs:(N.addrs??[]).map(N=>y1(N)),protocols:[]}}function IM(N,O={}){let U={...N,name:"SEND_QUERY",type:0,messageName:N.type,messageType:IN.indexOf(N.type.toString())};return O.onProgress?.(new gp("kad-dht:query:send-query",{detail:U})),U}function IU(N,O={}){let U={...N,name:"PEER_RESPONSE",type:1,messageName:N.messageType,closer:null!=N.closer?N.closer:[],providers:null!=N.providers?N.providers:[]};return O.onProgress?.(new gp("kad-dht:query:peer-response",{detail:U})),U}function IF(N,O={}){let U={...N,name:"FINAL_PEER",type:2};return O.onProgress?.(new gp("kad-dht:query:final-peer",{detail:U})),U}function Iz(N,O={}){let U={...N,name:"QUERY_ERROR",type:3};return O.onProgress?.(new gp("kad-dht:query:query-error",{detail:U})),U}function I$(N,O={}){let U={...N,name:"PROVIDER",type:4};return O.onProgress?.(new gp("kad-dht:query:provider",{detail:U})),U}function IK(N,O={}){let U={...N,name:"VALUE",type:5};return O.onProgress?.(new gp("kad-dht:query:value",{detail:U})),U}function Iq(N,O={}){let U={...N,name:"DIAL_PEER",type:7};return O.onProgress?.(new gp("kad-dht:query:dial-peer",{detail:U})),U}new Uint8Array(0);let Ij=(N,O)=>{if(N===O)return!0;if(N.byteLength!==O.byteLength)return!1;for(let U=0;U<N.byteLength;U++)if(N[U]!==O[U])return!1;return!0},IW=N=>{if(N instanceof Uint8Array&&"Uint8Array"===N.constructor.name)return N;if(N instanceof ArrayBuffer)return new Uint8Array(N);if(ArrayBuffer.isView(N))return new Uint8Array(N.buffer,N.byteOffset,N.byteLength);throw Error("Unknown type, must be binary type")};var IH=128,IG=-128,IQ=2147483648;function IY(N,O,U){O=O||[];for(var $=U=U||0;N>=IQ;)O[U++]=255&N|IH,N/=128;for(;N&IG;)O[U++]=255&N|IH,N>>>=7;return O[U]=0|N,IY.bytes=U-$+1,O}var IX=128,IJ=127;function IZ(N,O){var U,$=0,O=O||0,Y=0,X=O,J=N.length;do{if(X>=J)throw IZ.bytes=0,RangeError("Could not decode varint");U=N[X++],$+=Y<28?(U&IJ)<<Y:(U&IJ)*Math.pow(2,Y),Y+=7}while(U>=IX);return IZ.bytes=X-O,$}var I1=128,I2=16384,I0=2097152,I3=268435456,I4=34359738368,I5=4398046511104,I6=562949953421312,I8=72057594037927940,I7=0x7fffffffffffffff,I9={encode:IY,decode:IZ,encodingLength:function(N){return N<I1?1:N<I2?2:N<I0?3:N<I3?4:N<I4?5:N<I5?6:N<I6?7:N<I8?8:N<I7?9:10}};let Re=(N,O=0)=>{let U=I9.decode(N,O);return[U,I9.decode.bytes]},Rt=(N,O,U=0)=>(I9.encode(N,O,U),O),Rr=N=>I9.encodingLength(N),Ri=(N,O)=>{let U=O.byteLength,$=Rr(N),Y=$+Rr(U),X=new Uint8Array(Y+U);return Rt(N,X,0),Rt(U,X,$),X.set(O,Y),new Ro(N,U,O,X)},Rn=N=>{let O=IW(N),[U,$]=Re(O),[Y,X]=Re(O.subarray($)),J=O.subarray($+X);if(J.byteLength!==Y)throw Error("Incorrect length");return new Ro(U,Y,J,O)},Rs=(N,O)=>{if(N===O)return!0;{let U=O;return N.code===U.code&&N.size===U.size&&U.bytes instanceof Uint8Array&&Ij(N.bytes,U.bytes)}};class Ro{constructor(N,O,U,$){this.code=N,this.size=O,this.digest=U,this.bytes=$}}let Ra=({name:N,code:O,encode:U})=>new Rl(N,O,U);class Rl{constructor(N,O,U){this.name=N,this.code=O,this.encode=U}digest(N){if(N instanceof Uint8Array){let O=this.encode(N);return O instanceof Uint8Array?Ri(this.code,O):O.then(N=>Ri(this.code,N))}throw Error("Unknown type, must be binary type")}}let Rc=N=>async O=>new Uint8Array(await crypto.subtle.digest(N,O)),Ru=Ra({name:"sha2-256",code:18,encode:Rc("SHA-256")});Ra({name:"sha2-512",code:19,encode:Rc("SHA-512")});let Rh=nD("/pk/");function Rd(N){return{...N,multiaddrs:N.multiaddrs.filter(N=>{let[[O,U]]=N.stringTuples();if(53===O||54===O||55===O)return"localhost"!==U;if(4!==O&&6!==O||null==U)return!1;let $=mQ(U);return null==$||!$})}}function Rp(N){return{...N,multiaddrs:N.multiaddrs.filter(N=>{let[[O,U]]=N.stringTuples();if("localhost"===U)return!0;if(4!==O&&6!==O||null==U)return!1;let $=mQ(U);return null!=$&&$})}}async function Rf(N){let O=await Ru.digest(N);return O.digest}async function Rg(N){return Rf(N.toBytes())}function Ry(N){return new nx(`${Id}/${nA(N,"base32")}`,!1)}function Rm(N){return sQ([Rh,N.toBytes()])}function Rb(N){return"/pk/"===nA(N.subarray(0,4))}function Rw(N){return gP(N.subarray(4))}function Rv(N,O){let U=new Date,$=new ID(N,O,U);return $.serialize()}function RE(N,O=100){let U;return()=>{clearTimeout(U),U=setTimeout(()=>{N()},O)}}class R_{log;components;validators;selectors;peerRouting;queryManager;network;constructor(N,O){let{validators:U,selectors:$,peerRouting:Y,queryManager:X,network:J,lan:Z}=O;this.components=N,this.log=rF(`libp2p:kad-dht:${Z?"lan":"wan"}:content-fetching`),this.validators=U,this.selectors=$,this.peerRouting=Y,this.queryManager=X,this.network=J}async putLocal(N,O){let U=Ry(N);await this.components.datastore.put(U,O)}async getLocal(N){this.log("getLocal %b",N);let O=Ry(N);this.log("fetching record for key %k",O);let U=await this.components.datastore.get(O);this.log("found %k in local datastore",O);let $=ID.deserialize(U);return await Ir(this.validators,$),$}async *sendCorrectionRecord(N,O,U,$={}){this.log("sendCorrection for %b",N);let Y=Rv(N,U);for(let{value:X,from:J}of O){if(n5(X,U)){this.log("record was ok");continue}if(this.components.peerId.equals(J)){try{let O=Ry(N);this.log(`Storing corrected record for key ${O.toString()}`),await this.components.datastore.put(O,Y.subarray())}catch(N){this.log.error("Failed error correcting self",N)}continue}let O=!1,Z=new IB(IC.PUT_VALUE,N,0);for await(let N of(Z.record=ID.deserialize(Y),this.network.sendRequest(J,Z,$)))"PEER_RESPONSE"===N.name&&null!=N.record&&n5(N.record.value,ID.deserialize(Y).value)&&(O=!0),yield N;O||(yield Iz({from:J,error:new n3("value not put correctly","ERR_PUT_VALUE_INVALID")},$)),this.log.error("Failed error correcting entry")}}async *put(N,O,U={}){this.log("put key %b value %b",N,O);let $=Rv(N,O),Y=Ry(N);this.log(`storing record for key ${Y.toString()}`),await this.components.datastore.put(Y,$.subarray()),yield*oD(this.peerRouting.getClosestPeers(N,{signal:U.signal}),O=>ow(O,O=>async()=>{if("FINAL_PEER"!==O.name)return[O];let Y=[],X=new IB(IC.PUT_VALUE,N,0);for await(let N of(X.record=ID.deserialize($),this.log("send put to %p",O.peer.id),this.network.sendRequest(O.peer.id,X,U)))Y.push(N),"PEER_RESPONSE"===N.name&&(null!=N.record&&n5(N.record.value,ID.deserialize($).value)||Y.push(Iz({from:O.peer.id,error:new n3("value not put correctly","ERR_PUT_VALUE_INVALID")},U)));return Y}),N=>IT(N,{ordered:!1,concurrency:Ib}),async function*(N){for await(let O of N)yield*O})}async *get(N,O={}){this.log("get %b",N);let U=[];for await(let $ of this.getMany(N,O))"VALUE"===$.name&&U.push($),yield $;if(0===U.length)return;let $=U.map(N=>N.value),Y=0;try{Y=S9(this.selectors,N,$)}catch(N){if("ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY"!==N.code)throw N}let X=$[Y];if(this.log("GetValue %b %b",N,X),null==X)throw new n3("best value was not found","ERR_NOT_FOUND");yield*this.sendCorrectionRecord(N,U,X,O),yield U[Y]}async *getMany(N,O={}){this.log("getMany values for %b",N);try{let U=await this.getLocal(N);yield IK({value:U.value,from:this.components.peerId},O)}catch(O){this.log("error getting local value for %b",N,O)}let U=this,$=async function*({peer:$,signal:Y}){for await(let X of U.peerRouting.getValueOrPeers($,N,{signal:Y}))yield X,"PEER_RESPONSE"===X.name&&null!=X.record&&(yield IK({from:$,value:X.record.value},O))};yield*this.queryManager.run(N,$,O)}}class RS{log;components;network;peerRouting;queryManager;routingTable;providers;constructor(N,O){let{network:U,peerRouting:$,queryManager:Y,routingTable:X,providers:J,lan:Z}=O;this.components=N,this.log=rF(`libp2p:kad-dht:${Z?"lan":"wan"}:content-routing`),this.network=U,this.peerRouting=$,this.queryManager=Y,this.routingTable=X,this.providers=J}async *provide(N,O,U={}){this.log("provide %s",N),await this.providers.addProvider(N,this.components.peerId);let $=new IB(IC.ADD_PROVIDER,N.multihash.bytes,0);$.providerPeers=[{id:this.components.peerId,multiaddrs:O,protocols:[]}];let Y=0,X=O=>async()=>{if("FINAL_PEER"!==O.name)return[O];let X=[];this.log("putProvider %s to %p",N,O.peer.id);try{for await(let J of(this.log("sending provider record for %s to %p",N,O.peer.id),this.network.sendMessage(O.peer.id,$,U)))"PEER_RESPONSE"===J.name&&(this.log("sent provider record for %s to %p",N,O.peer.id),Y++),X.push(J)}catch(N){this.log.error("error sending provide record to peer %p",O.peer.id,N),X.push(Iz({from:O.peer.id,error:N},U))}return X};yield*oD(this.peerRouting.getClosestPeers(N.multihash.bytes,U),N=>ow(N,N=>X(N)),N=>IT(N,{ordered:!1,concurrency:Ib}),async function*(N){for await(let O of N)yield*O}),this.log("sent provider records to %d peers",Y)}async *findProviders(N,O){let U=this.routingTable.kBucketSize,$=N.multihash.bytes,Y=this;this.log("findProviders %c",N);let X=await this.providers.getProviders(N);if(X.length>0){let N=[];for(let O of X.slice(0,U))try{let U=await this.components.peerStore.get(O);N.push({id:O,multiaddrs:U.addresses.map(({multiaddr:N})=>N),protocols:U.protocols})}catch(N){if("ERR_NOT_FOUND"!==N.code)throw N;this.log("no peer store entry for %p",O)}yield IU({from:this.components.peerId,messageType:IC.GET_PROVIDERS,providers:N},O),yield I$({from:this.components.peerId,providers:N},O)}if(X.length>=U)return;let J=async function*({peer:N,signal:U}){let X=new IB(IC.GET_PROVIDERS,$,0);yield*Y.network.sendRequest(N,X,{...O,signal:U})},Z=new Set(X.map(N=>N.toString()));for await(let Y of this.queryManager.run($,J,O))if(yield Y,"PEER_RESPONSE"===Y.name){this.log("Found %d provider entries for %c and %d closer peers",Y.providers.length,N,Y.closer.length);let $=[];for(let N of Y.providers)Z.has(N.id.toString())||(Z.add(N.id.toString()),$.push(N));if($.length>0&&(yield I$({from:Y.from,providers:$},O)),Z.size===U)return}}}class RI extends gh{log;protocol;running;components;constructor(N,O){super();let{protocol:U,lan:$}=O;this.components=N,this.log=rF(`libp2p:kad-dht:${$?"lan":"wan"}:network`),this.running=!1,this.protocol=U}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async *sendRequest(N,O,U={}){let $;if(this.running){this.log("sending %s to %p",O.type,N),yield Iq({peer:N},U),yield IM({to:N,type:O.type},U);try{let $=await this.components.connectionManager.openConnection(N,U),Y=await $.newStream(this.protocol,U),X=await this._writeReadMessage(Y,O.serialize(),U);yield IU({from:N,messageType:X.type,closer:X.closerPeers,providers:X.providerPeers,record:X.record},U)}catch(O){yield Iz({from:N,error:O},U)}finally{null!=$&&$.close()}}}async *sendMessage(N,O,U={}){let $;if(this.running){this.log("sending %s to %p",O.type,N),yield Iq({peer:N},U),yield IM({to:N,type:O.type},U);try{let $=await this.components.connectionManager.openConnection(N,U),Y=await $.newStream(this.protocol,U);await this._writeMessage(Y,O.serialize(),U),yield IU({from:N,messageType:O.type},U)}catch(O){yield Iz({from:N,error:O},U)}finally{null!=$&&$.close()}}}async _writeMessage(N,O,U){null!=U.signal&&(N=sG(N,U.signal)),await oD([O],N=>od(N),N,nU)}async _writeReadMessage(N,O,U){null!=U.signal&&(N=sG(N,U.signal));let $=await oD([O],N=>od(N),N,N=>om(N),async N=>{let O=await wo(N);if(null!=O)return O;throw new n3("No message received","ERR_NO_MESSAGE_RECEIVED")}),Y=IB.deserialize($);return Y.closerPeers.forEach(N=>{this.dispatchEvent(new gp("peer",{detail:N}))}),Y.providerPeers.forEach(N=>{this.dispatchEvent(new gp("peer",{detail:N}))}),Y}}function RR(N,O){for(let U=0;U<N.byteLength;U++){if(N[U]<O[U])return -1;if(N[U]>O[U])return 1}return N.byteLength>O.byteLength?1:N.byteLength<O.byteLength?-1:0}function Rk(N,O){if(N.length!==O.length)throw Error("Inputs should have the same length");let U=nE(N.length);for(let $=0;$<N.length;$++)U[$]=N[$]^O[$];return iH(U)}class RD{originDhtKey;capacity;peerDistances;constructor(N,O){this.originDhtKey=N,this.capacity=O,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(N=>N.peerId)}async add(N){if(null!=this.peerDistances.find(O=>O.peerId.equals(N)))return;let O=await Rg(N),U={peerId:N,distance:Rk(this.originDhtKey,O)};this.peerDistances.push(U),this.peerDistances.sort((N,O)=>RR(N.distance,O.distance)),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async anyCloser(N){if(0===N.length)return!1;if(0===this.length)return!0;let O=await Promise.all(N.map(Rg)),U=this.peerDistances[this.peerDistances.length-1].distance;for(let N of O){let O=Rk(this.originDhtKey,N);if(0>RR(O,U))return!0}return!1}}class RA{components;log;routingTable;network;validators;queryManager;constructor(N,O){let{routingTable:U,network:$,validators:Y,queryManager:X,lan:J}=O;this.components=N,this.routingTable=U,this.network=$,this.validators=Y,this.queryManager=X,this.log=rF(`libp2p:kad-dht:${J?"lan":"wan"}:peer-routing`)}async findPeerLocal(N){let O;let U=await this.routingTable.find(N);if(null!=U){this.log("findPeerLocal found %p in routing table",N);try{O=await this.components.peerStore.get(U)}catch(N){if("ERR_NOT_FOUND"!==N.code)throw N}}if(null==O)try{O=await this.components.peerStore.get(N)}catch(N){if("ERR_NOT_FOUND"!==N.code)throw N}if(null!=O)return this.log("findPeerLocal found %p in peer store",N),{id:O.id,multiaddrs:O.addresses.map(N=>N.multiaddr),protocols:[]}}async *_getValueSingle(N,O,U={}){let $=new IB(IC.GET_VALUE,O,0);yield*this.network.sendRequest(N,$,U)}async *getPublicKeyFromNode(N,O={}){let U=Rm(N);for await(let $ of this._getValueSingle(N,U,O))if(yield $,"PEER_RESPONSE"===$.name&&null!=$.record){let U=await gN(gn({bytes:$.record.value}));if(!U.equals(N))throw new n3("public key does not match id","ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");if(null==U.publicKey)throw new n3("public key missing","ERR_PUBLIC_KEY_MISSING");yield IK({from:N,value:U.publicKey},O)}throw new n3(`Node not responding with its public key: ${N.toString()}`,"ERR_INVALID_RECORD")}async *findPeer(N,O={}){this.log("findPeer %p",N);let U=await this.findPeerLocal(N);if(null!=U){this.log("found local"),yield IF({from:this.components.peerId,peer:U},O);return}let $=this,Y=async function*({peer:U,signal:Y}){let X=new IB(IC.FIND_NODE,N.toBytes(),0);for await(let J of $.network.sendRequest(U,X,{...O,signal:Y}))if(yield J,"PEER_RESPONSE"===J.name){let U=J.closer.find(O=>O.id.equals(N));null!=U&&(yield IF({from:J.from,peer:U},O))}},X=!1;for await(let U of this.queryManager.run(N.toBytes(),Y,O))"FINAL_PEER"===U.name&&(X=!0),yield U;X||(yield Iz({from:this.components.peerId,error:new n3("Not found","ERR_NOT_FOUND")},O))}async *getClosestPeers(N,O={}){this.log("getClosestPeers to %b",N);let U=await Rf(N),$=this.routingTable.closestPeers(U),Y=this,X=new RD(U,this.routingTable.kBucketSize);await Promise.all($.map(async N=>{await X.add(N)}));let J=async function*({peer:U,signal:$}){Y.log("closerPeersSingle %s from %p",nA(N,"base32"),U);let X=new IB(IC.FIND_NODE,N,0);yield*Y.network.sendRequest(U,X,{...O,signal:$})};for await(let U of this.queryManager.run(N,J,O))yield U,"PEER_RESPONSE"===U.name&&await Promise.all(U.closer.map(async N=>{await X.add(N.id)}));for(let U of(this.log("found %d peers close to %b",X.length,N),X.peers))try{let N=await this.components.peerStore.get(U);yield IF({from:this.components.peerId,peer:{id:U,multiaddrs:N.addresses.map(({multiaddr:N})=>N),protocols:N.protocols}},O)}catch(N){if("ERR_NOT_FOUND"!==N.code)throw N}}async *getValueOrPeers(N,O,U={}){for await(let $ of this._getValueSingle(N,O,U)){if("PEER_RESPONSE"===$.name&&null!=$.record)try{await this._verifyRecordOnline($.record)}catch(O){let N="invalid record received, discarded";this.log(N),yield Iz({from:$.from,error:new n3(N,"ERR_INVALID_RECORD")},U);continue}yield $}}async _verifyRecordOnline(N){if(null==N.timeReceived)throw new n3("invalid record received","ERR_INVALID_RECORD");await Ir(this.validators,new ID(N.key,N.value,N.timeReceived))}async getCloserPeersOffline(N,O){let U=await Rf(N),$=this.routingTable.closestPeers(U),Y=[];for(let N of $)if(!N.equals(O))try{let O=await this.components.peerStore.get(N);Y.push({id:N,multiaddrs:O.addresses.map(({multiaddr:N})=>N),protocols:O.protocols})}catch(N){if("ERR_NOT_FOUND"!==N.code)throw N}return Y.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",Y.length,N,O):this.log("getCloserPeersOffline could not find peer closer to %b than %p",N,O),Y}}var RT=U(248);let RC=rF("libp2p:kad-dht:providers");class RP{components;cache;cleanupInterval;provideValidity;syncQueue;started;cleaner;constructor(N,O={}){let{cacheSize:U,cleanupInterval:$,provideValidity:Y}=O;this.components=N,this.cleanupInterval=$??Iy,this.provideValidity=Y??Ig,this.cache=RT(U??If),this.syncQueue=new cO({concurrency:1}),this.started=!1}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cleaner=setInterval(()=>{this._cleanup().catch(N=>{RC.error(N)})},this.cleanupInterval))}async stop(){this.started=!1,null!=this.cleaner&&(clearInterval(this.cleaner),this.cleaner=void 0)}async _cleanup(){await this.syncQueue.add(async()=>{let N=Date.now(),O=0,U=0,$=new Map,Y=this.components.datastore.batch(),X=this.components.datastore.query({prefix:Ip});for await(let N of X)try{let{cid:X,peerId:J}=RB(N.key),Z=RO(N.value).getTime(),en=Date.now(),es=en-Z,eo=es>this.provideValidity;if(RC("comparing: %d - %d = %d > %d %s",en,Z,es,this.provideValidity,eo?"(expired)":""),eo){U++,Y.delete(N.key);let O=$.get(X)??new Set;O.add(J),$.set(X,O)}O++}catch(N){RC.error(N.message)}for(let[N,X]of($.size>0?(RC("deleting %d / %d entries",U,O),await Y.commit()):RC("nothing to delete"),$)){let O=Rx(N),U=this.cache.get(O);if(null!=U){for(let N of X)U.delete(N);0===U.size?this.cache.remove(O):this.cache.set(O,U)}}RC("Cleanup successful (%dms)",Date.now()-N)})}async _getProvidersMap(N){let O=Rx(N),U=this.cache.get(O);return null==U&&(U=await RL(this.components.datastore,N),this.cache.set(O,U)),U}async addProvider(N,O){await this.syncQueue.add(async()=>{RC("%p provides %s",O,N);let U=await this._getProvidersMap(N);RC("loaded %s provs",U.size);let $=new Date;U.set(O.toString(),$);let Y=Rx(N);this.cache.set(Y,U),await RN(this.components.datastore,N,O,$)})}async getProviders(N){return this.syncQueue.add(async()=>{RC("get providers for %s",N);let O=await this._getProvidersMap(N);return[...O.keys()].map(N=>gC(N))},{throwOnTimeout:!0})}}function Rx(N){let O="string"==typeof N?N:nA(N.multihash.bytes,"base32");return`${Ip}/${O}`}async function RN(N,O,U,$){let Y=[Rx(O),"/",U.toString()].join(""),X=new nx(Y),J=Uint8Array.from(se.encode($.getTime()));await N.put(X,J)}function RB(N){let O=N.toString().split("/");if(5!==O.length)throw Error(`incorrectly formatted provider entry key in datastore: ${N.toString()}`);return{cid:O[3],peerId:O[4]}}async function RL(N,O){let U=new Map,$=N.query({prefix:Rx(O)});for await(let N of $){let{peerId:O}=RB(N.key);U.set(O,RO(N.value))}return U}function RO(N){return new Date(se.decode(N))}let RM=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");async function*RU(N){let{key:O,startingPeer:U,ourPeerId:$,signal:Y,query:X,alpha:J,pathIndex:Z,numPaths:en,cleanUp:es,queryFuncTimeout:eo,log:ea,peersSeen:ec}=N,eu=new cO({concurrency:J}),eh=await Rf(O);function ef(U,J){if(null==U)return;ec.add(U);let es=BigInt("0x"+nA(Rk(J,eh),"base16"));eu.add(async()=>{let J=[Y];null!=eo&&J.push(AbortSignal.timeout(eo));let eg=nY(J);try{for await(let N of X({key:O,peer:U,signal:eg,pathIndex:Z,numPaths:en})){if(eg.aborted)return;if("PEER_RESPONSE"===N.name)for(let Y of N.closer){if(ec.has(Y.id)){ea("already seen %p in query",Y.id);continue}if($.equals(Y.id)){ea("not querying ourselves");continue}let N=await Rg(Y.id),X=BigInt("0x"+nA(Rk(N,eh),"base16"));if(X>es){ea("skipping %p as they are not closer to %b than %p",Y.id,O,U);continue}ea("querying closer peer %p",Y.id),ef(Y.id,N)}eu.emit("completed",N)}}catch(O){if(!Y.aborted)return Iz({from:U,error:O},N)}finally{eg.clear()}},{priority:RM-es}).catch(N=>{ea.error(N)})}ef(U,await Rg(U)),yield*RF(eu,Y,es,ea)}async function*RF(N,O,U,$){let Y=c_(),X=!0,J=[],Z=()=>{X&&($("clean up queue, results %d, queue size %d, pending tasks %d",J.length,N.size,N.pending),X=!1,N.clear(),J.splice(0,J.length))};for(N.on("completed",N=>{J.push(N),Y.resolve()}),N.on("error",N=>{$("queue error",N),Z(),Y.reject(N)}),N.on("idle",()=>{$("queue idle"),X=!1,Y.resolve()}),O.addEventListener("abort",()=>{$("abort queue");let N=X;Z(),N&&Y.reject(new n3("Query aborted","ERR_QUERY_ABORTED"))}),U.addEventListener("cleanup",()=>{Z(),Y.resolve()});X;)for(await Y.promise,Y=c_();J.length>0;){let N=J.shift();null!=N&&(yield N)}yield*J}class RV{components;lan;disjointPaths;alpha;shutDownController;running;queries;metrics;routingTable;initialQuerySelfHasRun;constructor(N,O){let{lan:U=!1,disjointPaths:$=Im,alpha:Y=Ib}=O;this.components=N,this.disjointPaths=$??Im,this.running=!1,this.alpha=Y??Ib,this.lan=U,this.queries=0,this.initialQuerySelfHasRun=O.initialQuerySelfHasRun,this.routingTable=O.routingTable,this.shutDownController=new AbortController;try{null!=oW.setMaxListeners&&(0,oW.setMaxListeners)(1/0,this.shutDownController.signal)}catch{}}isStarted(){return this.running}async start(){this.running=!0,null!=this.components.metrics&&null==this.metrics&&(this.metrics={runningQueries:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_running_queries`),queryTime:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_query_time_seconds`)})}async stop(){this.running=!1,this.shutDownController.abort()}async *run(N,O,U={}){if(!this.running)throw Error("QueryManager not started");let $=this.metrics?.queryTime.timer();if(null==U.signal){U.signal=AbortSignal.timeout(II);try{null!=oW.setMaxListeners&&(0,oW.setMaxListeners)(1/0,U.signal)}catch{}}let Y=nY([this.shutDownController.signal,U.signal]);try{null!=oW.setMaxListeners&&(0,oW.setMaxListeners)(1/0,Y)}catch{}let X=rF(`libp2p:kad-dht:${this.lan?"lan":"wan"}:query:`+nA(N,"base58btc")),J=Date.now(),Z=new gh;try{!0!==U.isSelfQuery&&null!=this.initialQuerySelfHasRun&&(X("waiting for initial query-self query before continuing"),await Promise.race([new Promise((N,O)=>{Y.addEventListener("abort",()=>{O(new n0("Query was aborted before self-query ran"))})}),this.initialQuerySelfHasRun.promise]),this.initialQuerySelfHasRun=void 0),X("query:start"),this.queries++,this.metrics?.runningQueries.update(this.queries);let $=await Rf(N),J=this.routingTable.closestPeers($),en=J.slice(0,Math.min(this.disjointPaths,J.length));if(0===J.length){X.error("Running query with no peers");return}let es=new gQ,eo=en.map(($,J)=>RU({key:N,startingPeer:$,ourPeerId:this.components.peerId,signal:Y,query:O,pathIndex:J,numPaths:en.length,alpha:this.alpha,cleanUp:Z,queryFuncTimeout:U.queryFuncTimeout,log:X,peersSeen:es,onProgress:U.onProgress}));for await(let N of ok(...eo))yield N,"QUERY_ERROR"===N.name&&X("error",N.error)}catch(N){if(this.running||"ERR_QUERY_ABORTED"!==N.code)throw N}finally{Y.clear(),this.queries--,this.metrics?.runningQueries.update(this.queries),null!=$&&$(),Z.dispatchEvent(new gp("cleanup")),X("query:done in %dms",Date.now()-J)}}}function Rz(N){return null!=N[Symbol.asyncIterator]}var R$=function(N){if(Rz(N))return(async()=>{let O=0;for await(let U of N)O++;return O})();{let O=0;for(let U of N)O++;return O}};let RK=N=>{let O=N.on||N.addListener||N.addEventListener,U=N.off||N.removeListener||N.removeEventListener;if(!O||!U)throw TypeError("Emitter is not compatible");return{addListener:O.bind(N),removeListener:U.bind(N)}};function Rq(N,O,U){let $;let Y=new Promise((Y,X)=>{if(!((U={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...U}).count>=0&&(U.count===Number.POSITIVE_INFINITY||Number.isInteger(U.count))))throw TypeError("The `count` option should be at least 0 or more");U.signal?.throwIfAborted();let J=[O].flat(),Z=[],{addListener:en,removeListener:es}=RK(N),eo=(...N)=>{let O=U.multiArgs?N:N[0];(!U.filter||U.filter(O))&&(Z.push(O),U.count===Z.length&&($(),Y(Z)))},ea=N=>{$(),X(N)};for(let N of($=()=>{for(let N of J)es(N,eo);for(let N of U.rejectionEvents)es(N,ea)},J))en(N,eo);for(let N of U.rejectionEvents)en(N,ea);U.signal&&U.signal.addEventListener("abort",()=>{ea(U.signal.reason)},{once:!0}),U.resolveImmediately&&Y(Z)});if(Y.cancel=$,"number"==typeof U.timeout){let N=uZ(Y,{milliseconds:U.timeout});return N.cancel=$,N}return Y}function Rj(N,O,U){"function"==typeof U&&(U={filter:U}),U={...U,count:1,resolveImmediately:!1};let $=Rq(N,O,U),Y=$.then(N=>N[0]);return Y.cancel=$.cancel,Y}class RW{log;components;peerRouting;routingTable;count;interval;initialInterval;queryTimeout;started;timeoutId;controller;initialQuerySelfHasRun;querySelfPromise;constructor(N,O){let{peerRouting:U,lan:$,count:Y,interval:X,queryTimeout:J,routingTable:Z}=O;this.components=N,this.log=rF(`libp2p:kad-dht:${$?"lan":"wan"}:query-self`),this.started=!1,this.peerRouting=U,this.routingTable=Z,this.count=Y??Im,this.interval=X??Iw,this.initialInterval=O.initialInterval??Iv,this.queryTimeout=J??IE,this.initialQuerySelfHasRun=O.initialQuerySelfHasRun}isStarted(){return this.started}start(){this.started||(this.started=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(N=>{this.log.error("error running self-query",N)})},this.initialInterval))}stop(){this.started=!1,null!=this.timeoutId&&clearTimeout(this.timeoutId),null!=this.controller&&this.controller.abort()}async querySelf(){if(!this.started){this.log("skip self-query because we are not started");return}if(null!=this.querySelfPromise)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=c_(),0===this.routingTable.size&&await Rj(this.routingTable,"peer:add"),this.started){this.controller=new AbortController;let N=nY([this.controller.signal,AbortSignal.timeout(this.queryTimeout)]);try{null!=oW.setMaxListeners&&(0,oW.setMaxListeners)(1/0,N)}catch{}try{this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);let O=await oD(this.peerRouting.getClosestPeers(this.components.peerId.toBytes(),{signal:N,isSelfQuery:!0}),N=>nH(N,this.count),async N=>R$(N));this.log("self-query ran successfully - found %d peers",O),null!=this.initialQuerySelfHasRun&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}catch(N){this.log.error("self-query error",N)}finally{N.clear()}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.started&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(N=>{this.log.error("error running self-query",N)})},this.interval))}}function RH(N,O){if(N===O)return!0;if(N.length!==O.length)return!1;for(let U=0,$=N.length;U<$;++U)if(N[U]!==O[U])return!1;return!0}function RG(){return{contacts:[],dontSplit:!1,left:null,right:null}}function RQ(N,O){if(!(O instanceof Uint8Array))throw TypeError(N+" is not a Uint8Array")}class RY extends gh{localNodeId;root;numberOfNodesPerKBucket;numberOfNodesToPing;distance;arbiter;constructor(N){super(),this.localNodeId=N.localNodeId,this.numberOfNodesPerKBucket=N.numberOfNodesPerKBucket??20,this.numberOfNodesToPing=N.numberOfNodesToPing??3,this.distance=N.distance??RY.distance,this.arbiter=N.arbiter??RY.arbiter,RQ("option.localNodeId as parameter 1",this.localNodeId),this.root=RG()}static arbiter(N,O){return(N.vectorClock??0)>(O.vectorClock??0)?N:O}static distance(N,O){let U=0,$=0,Y=Math.min(N.length,O.length),X=Math.max(N.length,O.length);for(;$<Y;++$)U=256*U+(N[$]^O[$]);for(;$<X;++$)U=256*U+255;return U}add(N){RQ("contact.id",N?.id);let O=0,U=this.root;for(;null===U.contacts;)U=this._determineNode(U,N.id,O++);let $=this._indexOf(U,N.id);return $>=0?(this._update(U,$,N),this):U.contacts.length<this.numberOfNodesPerKBucket?(U.contacts.push(N),this.safeDispatchEvent("added",{detail:N}),this):U.dontSplit?(this.safeDispatchEvent("ping",{detail:{oldContacts:U.contacts.slice(0,this.numberOfNodesToPing),newContact:N}}),this):(this._split(U,O),this.add(N))}closest(N,O=1/0){if(RQ("id",N),!Number.isInteger(O)&&O!==1/0||O<=0)throw TypeError("n is not positive number");let U=[];for(let $=[this.root],Y=0;$.length>0&&U.length<O;){let O=$.pop();if(null!=O){if(null===O.contacts){let U=this._determineNode(O,N,Y++);$.push(O.left===U?O.right:O.left),$.push(U)}else U=U.concat(O.contacts)}}return U.map(O=>({distance:this.distance(O.id,N),contact:O})).sort((N,O)=>N.distance-O.distance).slice(0,O).map(N=>N.contact)}count(){let N=0;for(let O=[this.root];O.length>0;){let U=O.pop();null!=U&&(null===U.contacts?O.push(U.right,U.left):N+=U.contacts.length)}return N}_determineNode(N,O,U){let $=U>>3,Y=U%8;if(O.length<=$&&0!==Y)return N.left;let X=O[$];return(X&1<<7-Y)!=0?N.right:N.left}get(N){RQ("id",N);let O=0,U=this.root;for(;null===U.contacts;)U=this._determineNode(U,N,O++);let $=this._indexOf(U,N);return $>=0?U.contacts[$]:void 0}_indexOf(N,O){for(let U=0;U<N.contacts.length;++U)if(RH(N.contacts[U].id,O))return U;return -1}remove(N){RQ("the id as parameter 1",N);let O=0,U=this.root;for(;null===U.contacts;)U=this._determineNode(U,N,O++);let $=this._indexOf(U,N);if($>=0){let N=U.contacts.splice($,1)[0];this.safeDispatchEvent("removed",{detail:N})}return this}_split(N,O){for(let U of(N.left=RG(),N.right=RG(),N.contacts))this._determineNode(N,U.id,O).contacts.push(U);N.contacts=null;let U=this._determineNode(N,this.localNodeId,O),$=N.left===U?N.right:N.left;$.dontSplit=!0}toArray(){let N=[];for(let O=[this.root];O.length>0;){let U=O.pop();null!=U&&(null===U.contacts?O.push(U.right,U.left):N=N.concat(U.contacts))}return N}*toIterable(){for(let N=[this.root];N.length>0;){let O=N.pop();null!=O&&(null===O.contacts?N.push(O.right,O.left):yield*O.contacts)}}_update(N,O,U){if(!RH(N.contacts[O].id,U.id))throw Error("wrong index for _update");let $=N.contacts[O],Y=this.arbiter($,U);(Y!==$||$===U)&&(N.contacts.splice(O,1),N.contacts.push(Y),this.safeDispatchEvent("updated",{detail:{incumbent:$,selection:Y}}))}}let RX="kad-close",RJ=50,RZ=20,R0=1e4,R3=10;class R4 extends gh{kBucketSize;kb;pingQueue;log;components;lan;pingTimeout;pingConcurrency;running;protocol;tagName;tagValue;metrics;constructor(N,O){super();let{kBucketSize:U,pingTimeout:$,lan:Y,pingConcurrency:X,protocol:J,tagName:Z,tagValue:en}=O;this.components=N,this.log=rF(`libp2p:kad-dht:${Y?"lan":"wan"}:routing-table`),this.kBucketSize=U??RZ,this.pingTimeout=$??R0,this.pingConcurrency=X??R3,this.lan=Y,this.running=!1,this.protocol=J,this.tagName=Z??RX,this.tagValue=en??RJ;let es=()=>{this.metrics?.pingQueueSize.update(this.pingQueue.size),this.metrics?.pingRunning.update(this.pingQueue.pending)};this.pingQueue=new cO({concurrency:this.pingConcurrency}),this.pingQueue.addListener("add",es),this.pingQueue.addListener("next",es),this._onPing=this._onPing.bind(this)}isStarted(){return this.running}async start(){this.running=!0,null!=this.components.metrics&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_routing_table_size`),pingQueueSize:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_ping_queue_size`),pingRunning:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_ping_running`)});let N=new RY({localNodeId:await Rg(this.components.peerId),numberOfNodesPerKBucket:this.kBucketSize,numberOfNodesToPing:1});this.kb=N,N.addEventListener("ping",this._onPing),this._tagPeers(N)}async stop(){this.running=!1,this.pingQueue.clear(),this.kb=void 0}_tagPeers(N){let O=new gQ,U=RE(()=>{let U=new gQ(N.closest(N.localNodeId,RZ).map(N=>N.peer)),$=U.difference(O),Y=O.difference(U);Promise.resolve().then(async()=>{for(let N of $)await this.components.peerStore.merge(N,{tags:{[this.tagName]:{value:this.tagValue}}});for(let N of Y)await this.components.peerStore.merge(N,{tags:{[this.tagName]:void 0}})}).catch(N=>{this.log.error("Could not update peer tags",N)}),O=U});N.addEventListener("added",N=>{U(),this.safeDispatchEvent("peer:add",{detail:N.detail.peer})}),N.addEventListener("removed",N=>{U(),this.safeDispatchEvent("peer:remove",{detail:N.detail.peer})})}_onPing(N){let{oldContacts:O,newContact:U}=N.detail;this.pingQueue.add(async()=>{if(!this.running)return;let N=0;try{await Promise.all(O.map(async O=>{try{let U={signal:AbortSignal.timeout(this.pingTimeout)};this.log("pinging old contact %p",O.peer);let $=await this.components.connectionManager.openConnection(O.peer,U),Y=await $.newStream(this.protocol,U);Y.close(),N++}catch(N){this.running&&null!=this.kb&&(this.log.error("could not ping peer %p",O.peer,N),this.log("evicting old contact after ping failed %p",O.peer),this.kb.remove(O.id))}finally{this.metrics?.routingTableSize.update(this.size)}})),this.running&&N<O.length&&null!=this.kb&&(this.log("adding new contact %p",U.peer),this.kb.add(U))}catch(N){this.log.error("could not process k-bucket ping event",N)}}).catch(N=>{this.log.error("could not process k-bucket ping event",N)})}get size(){return null==this.kb?0:this.kb.count()}async find(N){let O=await Rg(N),U=this.closestPeer(O);if(null!=U&&N.equals(U))return U}closestPeer(N){let O=this.closestPeers(N,1);if(O.length>0)return O[0]}closestPeers(N,O=this.kBucketSize){if(null==this.kb)return[];let U=this.kb.closest(N,O);return U.map(N=>N.peer)}async add(N){if(null==this.kb)throw Error("RoutingTable is not started");let O=await Rg(N);this.kb.add({id:O,peer:N}),this.log("added %p with kad id %b",N,O),this.metrics?.routingTableSize.update(this.size)}async remove(N){if(null==this.kb)throw Error("RoutingTable is not started");let O=await Rg(N);this.kb.remove(O),this.metrics?.routingTableSize.update(this.size)}}var R5=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782];let R6=15;class R8{log;peerRouting;routingTable;refreshInterval;refreshQueryTimeout;commonPrefixLengthRefreshedAt;refreshTimeoutId;constructor(N){let{peerRouting:O,routingTable:U,refreshInterval:$,refreshQueryTimeout:Y,lan:X}=N;this.log=rF(`libp2p:kad-dht:${X?"lan":"wan"}:routing-table:refresh`),this.peerRouting=O,this.routingTable=U,this.refreshInterval=$??I_,this.refreshQueryTimeout=Y??IS,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async start(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){null!=this.refreshTimeoutId&&clearTimeout(this.refreshTimeoutId)}refreshTable(N=!1){this.log("refreshing routing table");let O=this._maxCommonPrefix(),U=this._getTrackedCommonPrefixLengthsForRefresh(O);this.log(`max common prefix length ${O}`),this.log(`tracked CPLs [ ${U.map(N=>N.toISOString()).join(", ")} ]`),Promise.all(U.map(async($,Y)=>{try{if(await this._refreshCommonPrefixLength(Y,$,N),0===this._numPeersForCpl(O)){let O=Math.min(2*(Y+1),U.length-1);for(let U=Y+1;U<O+1;U++)try{await this._refreshCommonPrefixLength(U,$,N)}catch(N){this.log.error(N)}}}catch(N){this.log.error(N)}})).catch(N=>{this.log.error(N)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),null!=this.refreshTimeoutId.unref&&this.refreshTimeoutId.unref()}).catch(N=>{this.log.error(N)})}async _refreshCommonPrefixLength(N,O,U){if(!U&&O.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",N);return}let $=await this._generateRandomPeerId(N);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",N,$,this.routingTable.size);let Y=await R$(this.peerRouting.getClosestPeers($.toBytes(),{signal:AbortSignal.timeout(this.refreshQueryTimeout)}));this.log(`found ${Y} peers that were close to imaginary peer %p`,$),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",N,$,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(N){N>R6&&(N=R6);let O=[];for(let U=0;U<=N;U++)O[U]=this.commonPrefixLengthRefreshedAt[U]??new Date;return O}async _generateRandomPeerId(N){if(null==this.routingTable.kb)throw Error("Routing table not started");let O=fA(2),U=(O[1]<<8)+O[0],$=await this._makePeerId(this.routingTable.kb.localNodeId,U,N);return gP($)}async _makePeerId(N,O,U){if(U>R6)throw Error(`Cannot generate peer ID for common prefix length greater than ${R6}`);let $=new DataView(N.buffer,N.byteOffset,N.byteLength),Y=$.getUint16(0,!1),X=Y^32768>>U,J=65535<<16-(U+1),Z=X&J|O&~J,en=R5[Z],es=new ArrayBuffer(34),eo=new DataView(es,0,es.byteLength);return eo.setUint8(0,Ru.code),eo.setUint8(1,32),eo.setUint32(2,en,!1),new Uint8Array(eo.buffer,eo.byteOffset,eo.byteLength)}_maxCommonPrefix(){let N=0;for(let O of this._prefixLengths())O>N&&(N=O);return N}_numPeersForCpl(N){let O=0;for(let U of this._prefixLengths())U===N&&O++;return O}*_prefixLengths(){if(null!=this.routingTable.kb)for(let{id:N}of this.routingTable.kb.toIterable()){let O=Rk(this.routingTable.kb.localNodeId,N),U=0;for(let N of O)if(0===N)U++;else break;yield U}}}var R7=function(N,O){if(N.length>=255)throw TypeError("Alphabet too long");for(var U=new Uint8Array(256),$=0;$<U.length;$++)U[$]=255;for(var Y=0;Y<N.length;Y++){var X=N.charAt(Y),J=X.charCodeAt(0);if(255!==U[J])throw TypeError(X+" is ambiguous");U[J]=Y}var Z=N.length,en=N.charAt(0),es=Math.log(Z)/Math.log(256),eo=Math.log(256)/Math.log(Z);function ea(N){if("string"!=typeof N)throw TypeError("Expected String");if(0===N.length)return new Uint8Array;var O=0;if(" "!==N[0]){for(var $=0,Y=0;N[O]===en;)$++,O++;for(var X=(N.length-O)*es+1>>>0,J=new Uint8Array(X);N[O];){var eo=U[N.charCodeAt(O)];if(255===eo)return;for(var ea=0,ec=X-1;(0!==eo||ea<Y)&&-1!==ec;ec--,ea++)eo+=Z*J[ec]>>>0,J[ec]=eo%256>>>0,eo=eo/256>>>0;if(0!==eo)throw Error("Non-zero carry");Y=ea,O++}if(" "!==N[O]){for(var eu=X-Y;eu!==X&&0===J[eu];)eu++;for(var eh=new Uint8Array($+(X-eu)),ef=$;eu!==X;)eh[ef++]=J[eu++];return eh}}}function ec(N){var U=ea(N);if(U)return U;throw Error(`Non-${O} character`)}return{encode:function(O){if(O instanceof Uint8Array||(ArrayBuffer.isView(O)?O=new Uint8Array(O.buffer,O.byteOffset,O.byteLength):Array.isArray(O)&&(O=Uint8Array.from(O))),!(O instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===O.length)return"";for(var U=0,$=0,Y=0,X=O.length;Y!==X&&0===O[Y];)Y++,U++;for(var J=(X-Y)*eo+1>>>0,es=new Uint8Array(J);Y!==X;){for(var ea=O[Y],ec=0,eu=J-1;(0!==ea||ec<$)&&-1!==eu;eu--,ec++)ea+=256*es[eu]>>>0,es[eu]=ea%Z>>>0,ea=ea/Z>>>0;if(0!==ea)throw Error("Non-zero carry");$=ec,Y++}for(var eh=J-$;eh!==J&&0===es[eh];)eh++;for(var ef=en.repeat(U);eh<J;++eh)ef+=N.charAt(es[eh]);return ef},decodeUnsafe:ea,decode:ec}};class R9{constructor(N,O,U){this.name=N,this.prefix=O,this.baseEncode=U}encode(N){if(N instanceof Uint8Array)return`${this.prefix}${this.baseEncode(N)}`;throw Error("Unknown type, must be binary type")}}class ke{constructor(N,O,U){if(this.name=N,this.prefix=O,void 0===O.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=O.codePointAt(0),this.baseDecode=U}decode(N){if("string"==typeof N){if(N.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(N)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(N.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(N){return kr(this,N)}}class kt{constructor(N){this.decoders=N}or(N){return kr(this,N)}decode(N){let O=N[0],U=this.decoders[O];if(U)return U.decode(N);throw RangeError(`Unable to decode multibase string ${JSON.stringify(N)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let kr=(N,O)=>new kt({...N.decoders||{[N.prefix]:N},...O.decoders||{[O.prefix]:O}});class ki{constructor(N,O,U,$){this.name=N,this.prefix=O,this.baseEncode=U,this.baseDecode=$,this.encoder=new R9(N,O,U),this.decoder=new ke(N,O,$)}encode(N){return this.encoder.encode(N)}decode(N){return this.decoder.decode(N)}}let kn=({name:N,prefix:O,encode:U,decode:$})=>new ki(N,O,U,$),ko=({prefix:N,name:O,alphabet:U})=>{let{encode:$,decode:Y}=R7(U,O);return kn({prefix:N,name:O,encode:$,decode:N=>IW(Y(N))})},ka=(N,O,U,$)=>{let Y={};for(let N=0;N<O.length;++N)Y[O[N]]=N;let X=N.length;for(;"="===N[X-1];)--X;let J=new Uint8Array(X*U/8|0),Z=0,en=0,es=0;for(let O=0;O<X;++O){let X=Y[N[O]];if(void 0===X)throw SyntaxError(`Non-${$} character`);en=en<<U|X,(Z+=U)>=8&&(Z-=8,J[es++]=255&en>>Z)}if(Z>=U||255&en<<8-Z)throw SyntaxError("Unexpected end of data");return J},kl=(N,O,U)=>{let $="="===O[O.length-1],Y=(1<<U)-1,X="",J=0,Z=0;for(let $=0;$<N.length;++$)for(Z=Z<<8|N[$],J+=8;J>U;)J-=U,X+=O[Y&Z>>J];if(J&&(X+=O[Y&Z<<U-J]),$)for(;X.length*U&7;)X+="=";return X},kc=({name:N,prefix:O,bitsPerChar:U,alphabet:$})=>kn({prefix:O,name:N,encode:N=>kl(N,$,U),decode:O=>ka(O,$,U,N)}),ku=ko({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});ko({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});let kh=kc({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});kc({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),kc({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),kc({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),kc({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),kc({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),kc({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),kc({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),kc({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});let kd=(N,O)=>{let{bytes:U,version:$}=N;return 0===$?kb(U,kf(N),O||ku.encoder):kw(U,kf(N),O||kh.encoder)},kp=new WeakMap,kf=N=>{let O=kp.get(N);if(null==O){let O=new Map;return kp.set(N,O),O}return O};class kg{constructor(N,O,U,$){this.code=O,this.version=N,this.multihash=U,this.bytes=$,this["/"]=$}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:N,multihash:O}=this;if(N!==kv)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(O.code!==kE)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return kg.createV0(O)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:N,digest:O}=this.multihash,U=Ri(N,O);return kg.createV1(this.code,U)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(N){return kg.equals(this,N)}static equals(N,O){let U=O;return U&&N.code===U.code&&N.version===U.version&&Rs(N.multihash,U.multihash)}toString(N){return kd(this,N)}toJSON(){return{"/":kd(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(N){if(null==N)return null;let O=N;if(O instanceof kg)return O;if(null!=O["/"]&&O["/"]===O.bytes||O.asCID===O){let{version:N,code:U,multihash:$,bytes:Y}=O;return new kg(N,U,$,Y||k_(N,U,$.bytes))}if(!0!==O[kS])return null;{let{version:N,multihash:U,code:$}=O,Y=Rn(U);return kg.create(N,$,Y)}}static create(N,O,U){if("number"!=typeof O)throw Error("String codecs are no longer supported");if(!(U.bytes instanceof Uint8Array))throw Error("Invalid digest");switch(N){case 0:if(O===kv)return new kg(N,O,U,U.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${kv}) block encoding`);case 1:{let $=k_(N,O,U.bytes);return new kg(N,O,U,$)}default:throw Error("Invalid version")}}static createV0(N){return kg.create(0,kv,N)}static createV1(N,O){return kg.create(1,N,O)}static decode(N){let[O,U]=kg.decodeFirst(N);if(U.length)throw Error("Incorrect length");return O}static decodeFirst(N){let O=kg.inspectBytes(N),U=O.size-O.multihashSize,$=IW(N.subarray(U,U+O.multihashSize));if($.byteLength!==O.multihashSize)throw Error("Incorrect length");let Y=$.subarray(O.multihashSize-O.digestSize),X=new Ro(O.multihashCode,O.digestSize,Y,$),J=0===O.version?kg.createV0(X):kg.createV1(O.codec,X);return[J,N.subarray(O.size)]}static inspectBytes(N){let O=0,U=()=>{let[U,$]=Re(N.subarray(O));return O+=$,U},$=U(),Y=kv;if(18===$?($=0,O=0):Y=U(),0!==$&&1!==$)throw RangeError(`Invalid CID version ${$}`);let X=O,J=U(),Z=U(),en=O+Z,es=en-X;return{version:$,codec:Y,multihashCode:J,digestSize:Z,multihashSize:es,size:en}}static parse(N,O){let[U,$]=ky(N,O),Y=kg.decode($);if(0===Y.version&&"Q"!==N[0])throw Error("Version 0 CID string must not include multibase prefix");return kf(Y).set(U,N),Y}}let ky=(N,O)=>{switch(N[0]){case"Q":{let U=O||ku;return[ku.prefix,U.decode(`${ku.prefix}${N}`)]}case ku.prefix:{let U=O||ku;return[ku.prefix,U.decode(N)]}case kh.prefix:{let U=O||kh;return[kh.prefix,U.decode(N)]}default:if(null==O)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[N[0],O.decode(N)]}},kb=(N,O,U)=>{let{prefix:$}=U;if($!==ku.prefix)throw Error(`Cannot string encode V0 in ${U.name} encoding`);let Y=O.get($);if(null!=Y)return Y;{let Y=U.encode(N).slice(1);return O.set($,Y),Y}},kw=(N,O,U)=>{let{prefix:$}=U,Y=O.get($);if(null!=Y)return Y;{let Y=U.encode(N);return O.set($,Y),Y}},kv=112,kE=18,k_=(N,O,U)=>{let $=Rr(N),Y=$+Rr(O),X=new Uint8Array(Y+U.byteLength);return Rt(N,X,0),Rt(O,X,$),X.set(U,Y),X},kS=Symbol.for("@ipld/js-cid/CID"),kI=rF("libp2p:kad-dht:rpc:handlers:add-provider");class kR{providers;constructor(N){let{providers:O}=N;this.providers=O}async handle(N,O){let U;if(kI("start"),null==O.key||0===O.key.length)throw new n3("Missing key","ERR_MISSING_KEY");try{U=kg.decode(O.key)}catch(N){throw new n3("Invalid CID","ERR_INVALID_CID")}(null==O.providerPeers||0===O.providerPeers.length)&&kI.error("no providers found in message"),await Promise.all(O.providerPeers.map(async O=>{if(!O.id.equals(N)){kI("invalid provider peer %p from %p",O.id,N);return}if(O.multiaddrs.length<1){kI("no valid addresses for provider %p. Ignore",N);return}kI("received provider %p for %s (addrs %s)",N,U,O.multiaddrs.map(N=>N.toString())),await this.providers.addProvider(U,O.id)}))}}let kk=rF("libp2p:kad-dht:rpc:handlers:find-node");class kD{peerRouting;lan;components;constructor(N,O){let{peerRouting:U,lan:$}=O;this.components=N,this.peerRouting=U,this.lan=!!$}async handle(N,O){kk("incoming request from %p for peers closer to %b",N,O.key);let U=[];U=(U=n5(this.components.peerId.toBytes(),O.key)?[{id:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map(N=>N.decapsulateCode(yg("p2p").code)),protocols:[]}]:await this.peerRouting.getCloserPeersOffline(O.key,N)).map(this.lan?Rp:Rd).filter(({multiaddrs:N})=>N.length);let $=new IB(O.type,new Uint8Array(0),O.clusterLevel);return U.length>0?$.closerPeers=U:kk("could not find any peers closer to %b than %p",O.key,N),$}}let kT=rF("libp2p:kad-dht:rpc:handlers:get-providers");class kC{components;peerRouting;providers;lan;constructor(N,O){let{peerRouting:U,providers:$,lan:Y}=O;this.components=N,this.peerRouting=U,this.providers=$,this.lan=!!Y}async handle(N,O){let U;try{U=kg.decode(O.key)}catch(N){throw new n3("Invalid CID","ERR_INVALID_CID")}kT("%p asking for providers for %s",N,U);let[$,Y]=await Promise.all([this.providers.getProviders(U),this.peerRouting.getCloserPeersOffline(O.key,N)]),X=await this._getPeers($),J=await this._getPeers(Y.map(({id:N})=>N)),Z=new IB(O.type,O.key,O.clusterLevel);return X.length>0&&(Z.providerPeers=X),J.length>0&&(Z.closerPeers=J),kT("got %s providers %s closerPeers",X.length,J.length),Z}async _getAddresses(N){return[]}async _getPeers(N){let O=[],U=this.lan?Rp:Rd;for(let $ of N)try{let N=await this.components.peerStore.get($),Y=U({id:$,multiaddrs:N.addresses.map(({multiaddr:N})=>N),protocols:N.protocols});Y.multiaddrs.length>0&&O.push(Y)}catch(N){if("ERR_NOT_FOUND"!==N.code)throw N}return O}}let kP=rF("libp2p:kad-dht:rpc:handlers:get-value");class kx{components;peerRouting;constructor(N,O){let{peerRouting:U}=O;this.components=N,this.peerRouting=U}async handle(N,O){let U=O.key;if(kP("%p asked for key %b",N,U),null==U||0===U.length)throw new n3("Invalid key","ERR_INVALID_KEY");let $=new IB(IC.GET_VALUE,U,O.clusterLevel);if(Rb(U)){let N;kP("is public key");let O=Rw(U);try{let U=await this.components.peerStore.get(O);if(null==U.id.publicKey)throw new n3("No public key found in key book","ERR_NOT_FOUND");N=U.id.publicKey}catch(N){if("ERR_NOT_FOUND"!==N.code)throw N}if(null!=N)return kP("returning found public key"),$.record=new ID(U,N,new Date),$}let[Y,X]=await Promise.all([this._checkLocalDatastore(U),this.peerRouting.getCloserPeersOffline(O.key,N)]);return null!=Y&&(kP("had record for %b in local datastore",U),$.record=Y),X.length>0&&(kP("had %s closer peers in routing table",X.length),$.closerPeers=X),$}async _checkLocalDatastore(N){let O;kP("checkLocalDatastore looking for %b",N);let U=Ry(N);try{O=await this.components.datastore.get(U)}catch(N){if("ERR_NOT_FOUND"===N.code)return;throw N}let $=ID.deserialize(O);if(null==$)throw new n3("Invalid record","ERR_INVALID_RECORD");if(null==$.timeReceived||Date.now()-$.timeReceived.getTime()>Il){await this.components.datastore.delete(U);return}return $}}let kN=rF("libp2p:kad-dht:rpc:handlers:ping");class kB{async handle(N,O){return kN("ping from %p",N),O}}class kL{log;components;validators;constructor(N,O){let{validators:U}=O;this.components=N,this.log=rF("libp2p:kad-dht:rpc:handlers:put-value"),this.validators=U}async handle(N,O){let U=O.key;this.log("%p asked us to store value for key %b",N,U);let $=O.record;if(null==$){let O=`Empty record from: ${N.toString()}`;throw this.log.error(O),new n3(O,"ERR_EMPTY_RECORD")}try{await Ir(this.validators,$),$.timeReceived=new Date;let N=Ry($.key);await this.components.datastore.put(N,$.serialize().subarray()),this.log("put record for %b into datastore under key %k",U,N)}catch(N){this.log("did not put record for key %b into datastore %o",U,N)}return O}}class kO{handlers;routingTable;log;constructor(N,O){let{providers:U,peerRouting:$,validators:Y,lan:X}=O;this.log=rF("libp2p:kad-dht:rpc"),this.routingTable=O.routingTable,this.handlers={[IC.GET_VALUE]:new kx(N,{peerRouting:$}),[IC.PUT_VALUE]:new kL(N,{validators:Y}),[IC.FIND_NODE]:new kD(N,{peerRouting:$,lan:X}),[IC.ADD_PROVIDER]:new kR({providers:U}),[IC.GET_PROVIDERS]:new kC(N,{peerRouting:$,providers:U,lan:X}),[IC.PING]:new kB}}async handleMessage(N,O){try{await this.routingTable.add(N)}catch(N){this.log.error("Failed to update the kbucket store",N)}let U=this.handlers[O.type];if(null==U){this.log.error(`no handler found for message type: ${O.type}`);return}return U.handle(N,O)}onIncomingStream(N){Promise.resolve().then(async()=>{let{stream:O,connection:U}=N,$=U.remotePeer;try{await this.routingTable.add($)}catch(N){this.log.error(N)}let Y=this;await oD(O,N=>om(N),async function*(N){for await(let O of N){let N=IB.deserialize(O);Y.log("incoming %s from %p",N.type,$);let U=await Y.handleMessage($,N);null!=U&&(yield U.serialize())}},N=>od(N),O)}).catch(N=>{this.log.error(N)})}}class kM extends gh{log;components;protocol;running;registrarId;constructor(N,O){super();let{protocol:U,lan:$}=O;this.components=N,this.log=rF(`libp2p:kad-dht:topology-listener:${$?"lan":"wan"}`),this.running=!1,this.protocol=U}isStarted(){return this.running}async start(){if(this.running)return;this.running=!0;let N=sK({onConnect:N=>{this.log("observed peer %p with protocol %s",N,this.protocol),this.dispatchEvent(new gp("peer",{detail:N}))}});this.registrarId=await this.components.registrar.register(this.protocol,N)}async stop(){this.running=!1,null!=this.registrarId&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}let kU=32,kF=64;class kV extends gh{protocol;routingTable;providers;network;peerRouting;components;log;running;kBucketSize;clientMode;lan;validators;selectors;queryManager;contentFetching;contentRouting;routingTableRefresh;rpc;topologyListener;querySelf;maxInboundStreams;maxOutboundStreams;constructor(N,O){super();let{kBucketSize:U,clientMode:$,validators:Y,selectors:X,querySelfInterval:J,lan:Z,protocolPrefix:en,pingTimeout:es,pingConcurrency:eo,maxInboundStreams:ea,maxOutboundStreams:ec,providers:eu}=O;this.running=!1,this.components=N,this.lan=!!Z,this.log=rF(`libp2p:kad-dht:${!0===Z?"lan":"wan"}`),this.protocol=`${en??Iu}${!0===Z?Ic:""}${Ih}`,this.kBucketSize=U??20,this.clientMode=$??!0,this.maxInboundStreams=ea??kU,this.maxOutboundStreams=ec??kF,this.routingTable=new R4(N,{kBucketSize:U,lan:this.lan,pingTimeout:es,pingConcurrency:eo,protocol:this.protocol}),this.providers=new RP(N,eu??{}),this.validators={...In,...Y},this.selectors={...It,...X},this.network=new RI(N,{protocol:this.protocol,lan:this.lan});let eh=c_();!0===O.allowQueryWithZeroPeers&&eh.resolve(),this.queryManager=new RV(N,{disjointPaths:Math.ceil(this.kBucketSize/2),lan:Z,initialQuerySelfHasRun:eh,routingTable:this.routingTable}),this.peerRouting=new RA(N,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,lan:this.lan}),this.contentFetching=new R_(N,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,lan:this.lan}),this.contentRouting=new RS(N,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,lan:this.lan}),this.routingTableRefresh=new R8({peerRouting:this.peerRouting,routingTable:this.routingTable,lan:this.lan}),this.rpc=new kO(N,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,lan:this.lan}),this.topologyListener=new kM(N,{protocol:this.protocol,lan:this.lan}),this.querySelf=new RW(N,{peerRouting:this.peerRouting,interval:J,initialInterval:O.initialQuerySelfInterval,lan:this.lan,initialQuerySelfHasRun:eh,routingTable:this.routingTable}),this.network.addEventListener("peer",N=>{let O=N.detail;this.onPeerConnect(O).catch(N=>{this.log.error("could not add %p to routing table",O.id,N)}),this.dispatchEvent(new gp("peer",{detail:O}))}),this.topologyListener.addEventListener("peer",N=>{let O=N.detail;Promise.resolve().then(async()=>{let N=await this.components.peerStore.get(O),U={id:O,multiaddrs:N.addresses.map(({multiaddr:N})=>N),protocols:N.protocols};await this.onPeerConnect(U)}).catch(N=>{this.log.error("could not add %p to routing table",O,N)})})}async onPeerConnect(N){if(this.log("peer %p connected with protocols",N.id,N.protocols),0===(N=this.lan?Rp(N):Rd(N)).multiaddrs.length){this.log("ignoring %p as they do not have any %s addresses in %s",N.id,this.lan?"private":"public",N.multiaddrs.map(N=>N.toString()));return}try{await this.routingTable.add(N.id)}catch(O){this.log.error("could not add %p to routing table",N.id,O)}}isStarted(){return this.running}async getMode(){return this.clientMode?"client":"server"}async setMode(N){await this.components.registrar.unhandle(this.protocol),"client"===N?(this.log("enabling client mode"),this.clientMode=!0):(this.log("enabling server mode"),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running=!0,await this.setMode(this.clientMode?"client":"server"),await Promise.all([this.providers.start(),this.queryManager.start(),this.network.start(),this.routingTable.start(),this.topologyListener.start()]),this.querySelf.start(),await this.routingTableRefresh.start()}async stop(){this.running=!1,this.querySelf.stop(),await Promise.all([this.providers.stop(),this.queryManager.stop(),this.network.stop(),this.routingTable.stop(),this.routingTableRefresh.stop(),this.topologyListener.stop()])}async *put(N,O,U={}){yield*this.contentFetching.put(N,O,U)}async *get(N,O={}){yield*this.contentFetching.get(N,O)}async *provide(N,O={}){yield*this.contentRouting.provide(N,this.components.addressManager.getAddresses(),O)}async *findProviders(N,O={}){yield*this.contentRouting.findProviders(N,O)}async *findPeer(N,O={}){yield*this.peerRouting.findPeer(N,O)}async *getClosestPeers(N,O={}){yield*this.peerRouting.getClosestPeers(N,O)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}let kz=rF("libp2p:kad-dht");class k${dht;constructor(N){this.dht=N}async provide(N,O={}){await nU(this.dht.provide(N,O))}async *findProviders(N,O={}){for await(let U of this.dht.findProviders(N,O))"PROVIDER"===U.name&&(yield*U.providers)}async put(N,O,U){await nU(this.dht.put(N,O,U))}async get(N,O){for await(let U of this.dht.get(N,O))if("VALUE"===U.name)return U.value;throw new n3("Not found","ERR_NOT_FOUND")}}class kK{dht;constructor(N){this.dht=N}async findPeer(N,O={}){for await(let U of this.dht.findPeer(N,O))if("FINAL_PEER"===U.name)return U.peer;throw new n3("Not found","ERR_NOT_FOUND")}async *getClosestPeers(N,O={}){for await(let U of this.dht.getClosestPeers(N,O))"FINAL_PEER"===U.name&&(yield U.peer)}}let kq=290,kj=54,kW=55,kH=56,kG=4,kQ=41;function kY(N){let O=N.stringTuples();for(let N of O)if(N[0]===kq)return!1;if(O[0][0]===kj||O[0][0]===kW||O[0][0]===kH)return kz("%m is public %s",N,!0),!0;if(O[0][0]===kG||O[0][0]===kQ){let U=mQ(`${O[0][1]}`),$=null==U||!U;return kz("%m is public %s",N,$),$}return!1}class kX extends gh{wan;lan;components;contentRouting;peerRouting;constructor(N,O={}){super(),this.components=N,this.wan=new kV(N,{protocolPrefix:"/ipfs",...O,lan:!1}),this.lan=new kV(N,{protocolPrefix:"/ipfs",...O,clientMode:!1,lan:!0}),this.contentRouting=new k$(this),this.peerRouting=new kK(this),this.wan.addEventListener("peer",N=>{this.dispatchEvent(new gp("peer",{detail:N.detail}))}),this.lan.addEventListener("peer",N=>{this.dispatchEvent(new gp("peer",{detail:N.detail}))}),null==O.clientMode&&N.events.addEventListener("self:peer:update",N=>{kz("received update of self-peer info");let O=N.detail.peer.addresses.some(({multiaddr:N})=>{let O=kY(N);return kz("%m is public %s",N,O),O});this.getMode().then(async N=>{O&&"client"===N?await this.setMode("server"):"server"!==N||O||await this.setMode("client")}).catch(N=>{kz.error("error setting dht server mode",N)})})}[Symbol.toStringTag]="@libp2p/dual-kad-dht";get[gl](){return this.contentRouting}get[gu](){return this.peerRouting}get[gc](){return this}isStarted(){return this.wan.isStarted()&&this.lan.isStarted()}async getMode(){return this.wan.getMode()}async setMode(N){await this.wan.setMode(N)}async start(){await Promise.all([this.lan.start(),this.wan.start()])}async stop(){await Promise.all([this.lan.stop(),this.wan.stop()])}async *put(N,O,U={}){for await(let $ of ok(this.lan.put(N,O,U),this.wan.put(N,O,U)))yield $}async *get(N,O={}){let U=!1,$=!1;for await(let Y of ok(this.lan.get(N,O),this.wan.get(N,O)))yield Y,"DIAL_PEER"===Y.name&&(U=!0),"VALUE"===Y.name&&(U=!0,null!=Y.value&&($=!0)),"SEND_QUERY"===Y.name&&(U=!0);if(!U)throw new n3("No peers found in routing table!","ERR_NO_PEERS_IN_ROUTING_TABLE");$||(yield Iz({from:this.components.peerId,error:new n3("Not found","ERR_NOT_FOUND")},O))}async *provide(N,O={}){let U=0,$=0,Y=[],X=[this.lan];for await(let J of(await this.wan.getMode()==="server"&&X.push(this.wan),ok(...X.map(U=>U.provide(N,O)))))yield J,"SEND_QUERY"===J.name&&U++,"QUERY_ERROR"===J.name&&Y.push(J.error),"PEER_RESPONSE"===J.name&&"ADD_PROVIDER"===J.messageName&&(kz("sent provider record for %s to %p",N,J.from),$++);if(0===$){if(Y.length>0)throw new n3(`Failed to provide to ${Y.length} of ${U} peers`,"ERR_PROVIDES_FAILED",{errors:Y});throw new n3("Failed to provide - no peers found","ERR_PROVIDES_FAILED")}}async *findProviders(N,O={}){yield*ok(this.lan.findProviders(N,O),this.wan.findProviders(N,O))}async *findPeer(N,O={}){let U=!1;for await(let $ of ok(this.lan.findPeer(N,O),this.wan.findPeer(N,O)))yield $,("SEND_QUERY"===$.name||"FINAL_PEER"===$.name)&&(U=!0);if(!U)throw new n3("Peer lookup failed","ERR_LOOKUP_FAILED")}async *getClosestPeers(N,O={}){yield*ok(this.lan.getClosestPeers(N,O),this.wan.getClosestPeers(N,O))}async refreshRoutingTable(){await Promise.all([this.lan.refreshRoutingTable(),this.wan.refreshRoutingTable()])}}function kJ(N){return O=>new kX(O,N)}!function(N){N[N.SEND_QUERY=0]="SEND_QUERY",N[N.PEER_RESPONSE=1]="PEER_RESPONSE",N[N.FINAL_PEER=2]="FINAL_PEER",N[N.QUERY_ERROR=3]="QUERY_ERROR",N[N.PROVIDER=4]="PROVIDER",N[N.VALUE=5]="VALUE",N[N.ADD_PEER=6]="ADD_PEER",N[N.DIAL_PEER=7]="DIAL_PEER"}(t_||(t_={})),function(N){N[N.PUT_VALUE=0]="PUT_VALUE",N[N.GET_VALUE=1]="GET_VALUE",N[N.ADD_PROVIDER=2]="ADD_PROVIDER",N[N.GET_PROVIDERS=3]="GET_PROVIDERS",N[N.FIND_NODE=4]="FIND_NODE",N[N.PING=5]="PING"}(tS||(tS={})),function(N){N[N.NEW_STREAM=0]="NEW_STREAM",N[N.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",N[N.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",N[N.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",N[N.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",N[N.RESET_RECEIVER=5]="RESET_RECEIVER",N[N.RESET_INITIATOR=6]="RESET_INITIATOR"}(tI||(tI={}));let kZ=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),k0=Object.freeze({NEW_STREAM:tI.NEW_STREAM,MESSAGE:tI.MESSAGE_INITIATOR,CLOSE:tI.CLOSE_INITIATOR,RESET:tI.RESET_INITIATOR}),k4=Object.freeze({MESSAGE:tI.MESSAGE_RECEIVER,CLOSE:tI.CLOSE_RECEIVER,RESET:tI.RESET_RECEIVER}),k5=1048576,k6=4194304;class k8{_buffer;_headerInfo;_maxMessageSize;_maxUnprocessedMessageQueueSize;constructor(N=k5,O=k6){this._buffer=new sZ,this._headerInfo=null,this._maxMessageSize=N,this._maxUnprocessedMessageQueueSize=O}write(N){if(null==N||0===N.length)return[];if(this._buffer.append(N),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});let O=[];for(;0!==this._buffer.length;){if(null==this._headerInfo)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(N){if("ERR_MSG_TOO_BIG"===N.code)throw N;break}let{id:N,type:U,length:$,offset:Y}=this._headerInfo,X=this._buffer.length-Y;if(X<$)break;let J={id:N,type:U};(U===tI.NEW_STREAM||U===tI.MESSAGE_INITIATOR||U===tI.MESSAGE_RECEIVER)&&(J.data=this._buffer.sublist(Y,Y+$)),O.push(J),this._buffer.consume(Y+$),this._headerInfo=null}return O}_decodeHeader(N){let{value:O,offset:U}=De(N),{value:$,offset:Y}=De(N,U),X=7&O;if(null==kZ[X])throw Error(`Invalid type received: ${X}`);if($>this._maxMessageSize)throw Object.assign(Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:O>>3,type:X,offset:U+Y,length:$}}}let k7=128,k9=127;function De(N,O=0){let U,$=0,Y=0,X=O,J=N.length;do{if(X>=J||Y>49)throw O=0,RangeError("Could not decode varint");U=N.get(X++),$+=Y<28?(U&k9)<<Y:(U&k9)*Math.pow(2,Y),Y+=7}while(U>=k7);return{value:$,offset:O=X-O}}function Dt(N){return null!=N[Symbol.asyncIterator]}let Dr=1048576,Di=(N,O)=>{O.append(N)};var Dn=function(N,O){return Dt(N)?async function*(){let U=new sZ,$=!1,Y=c_(),X=Number(O?.size??Dr);if((isNaN(X)||0===X||X<0)&&(X=Dr),X!==Math.round(X))throw Error("Batch size must be an integer");let J=O?.yieldAfter??0,Z=O?.serialize??Di;for(Promise.resolve().then(async()=>{try{let O;for await(let $ of N){if(Z($,U),U.byteLength>=X){clearTimeout(O),Y.resolve();continue}O=setTimeout(()=>{Y.resolve()},J)}clearTimeout(O),Y.resolve()}catch(N){Y.reject(N)}finally{$=!0}});!$;)if(await Y.promise,Y=c_(),U.byteLength>0){let N=U;U=new sZ,yield N.subarray()}}():function*(){let U=new sZ,$=Number(O?.size??Dr);if((isNaN($)||0===$||$<0)&&($=Dr),$!==Math.round($))throw Error("Batch size must be an integer");let Y=O?.serialize??Di;for(let O of N)Y(O,U),U.byteLength>=$&&(yield U.subarray(0,$),U.consume($));U.byteLength>0&&(yield U.subarray())}()};function Ds(N){return new Uint8Array(N)}let Do=10240;class Da{_pool;_poolOffset;constructor(){this._pool=Ds(Do),this._poolOffset=0}write(N,O){let U=this._pool,$=this._poolOffset;se.encode(N.id<<3|N.type,U,$),$+=se.encode.bytes??0,(N.type===tI.NEW_STREAM||N.type===tI.MESSAGE_INITIATOR||N.type===tI.MESSAGE_RECEIVER)&&null!=N.data?se.encode(N.data.length,U,$):se.encode(0,U,$),$+=se.encode.bytes??0;let Y=U.subarray(this._poolOffset,$);Do-$<100?(this._pool=Ds(Do),this._poolOffset=0):this._poolOffset=$,O.append(Y),(N.type===tI.NEW_STREAM||N.type===tI.MESSAGE_INITIATOR||N.type===tI.MESSAGE_RECEIVER)&&null!=N.data&&O.append(N.data)}}let Dl=new Da;async function*Dc(N,O=0){if(null==O||0===O){for await(let O of N){let N=new sZ;for(let U of O)Dl.write(U,N);yield N.subarray()}return}yield*Dn(N,{size:O,serialize:(N,O)=>{for(let U of N)Dl.write(U,O)}})}let Du=rF("libp2p:stream"),Dh="ERR_STREAM_RESET",Dd="ERR_STREAM_ABORT",Dp="ERR_SINK_ENDED",Df="ERR_DOUBLE_SINK";function Dg(N){return null!=N&&"function"==typeof N.then}class Dm{id;stat;metadata;source;abortController;resetController;closeController;sourceEnded;sinkEnded;sinkSunk;endErr;streamSource;onEnd;maxDataSize;constructor(N){this.abortController=new AbortController,this.resetController=new AbortController,this.closeController=new AbortController,this.sourceEnded=!1,this.sinkEnded=!1,this.sinkSunk=!1,this.id=N.id,this.metadata=N.metadata??{},this.stat={direction:N.direction,timeline:{open:Date.now()}},this.maxDataSize=N.maxDataSize,this.onEnd=N.onEnd,this.source=this.streamSource=o_({onEnd:()=>{if(null!==this.stat.timeline.reset){let N=this.sendCloseRead();Dg(N)&&N.catch(N=>{Du.error("error while sending close read",N)})}this.onSourceEnd()}}),this.sink=this.sink.bind(this)}onSourceEnd(N){!this.sourceEnded&&(this.stat.timeline.closeRead=Date.now(),this.sourceEnded=!0,Du.trace("%s stream %s source end - err: %o",this.stat.direction,this.id,N),null!=N&&null==this.endErr&&(this.endErr=N),this.sinkEnded&&(this.stat.timeline.close=Date.now(),null!=this.onEnd&&this.onEnd(this.endErr)))}onSinkEnd(N){!this.sinkEnded&&(this.stat.timeline.closeWrite=Date.now(),this.sinkEnded=!0,Du.trace("%s stream %s sink end - err: %o",this.stat.direction,this.id,N),null!=N&&null==this.endErr&&(this.endErr=N),this.sourceEnded&&(this.stat.timeline.close=Date.now(),null!=this.onEnd&&this.onEnd(this.endErr)))}close(){Du.trace("%s stream %s close",this.stat.direction,this.id),this.closeRead(),this.closeWrite()}closeRead(){Du.trace("%s stream %s closeRead",this.stat.direction,this.id),this.sourceEnded||this.streamSource.end()}closeWrite(){if(Du.trace("%s stream %s closeWrite",this.stat.direction,this.id),!this.sinkEnded){this.closeController.abort();try{let N=this.sendCloseWrite();Dg(N)&&N.catch(N=>{Du.error("error while sending close write",N)})}catch(N){Du.trace("%s stream %s error sending close",this.stat.direction,this.id,N)}this.onSinkEnd()}}abort(N){Du.trace("%s stream %s abort",this.stat.direction,this.id,N),this.streamSource.end(N),this.abortController.abort(),this.onSinkEnd(N)}reset(){let N=new n3("stream reset",Dh);this.resetController.abort(),this.streamSource.end(N),this.onSinkEnd(N)}async sink(N){if(this.sinkSunk)throw new n3("sink already called on stream",Df);if(this.sinkSunk=!0,this.sinkEnded)throw new n3("stream closed for writing",Dp);let O=nY([this.abortController.signal,this.resetController.signal,this.closeController.signal]);try{if(N=sW(N,O),"outbound"===this.stat.direction){let N=this.sendNewStream();Dg(N)&&await N}for await(let O of N)for(;O.length>0;){if(O.length<=this.maxDataSize){let N=this.sendData(O instanceof Uint8Array?new sZ(O):O);Dg(N)&&await N;break}O=O instanceof Uint8Array?new sZ(O):O;let N=this.sendData(O.sublist(0,this.maxDataSize));Dg(N)&&await N,O.consume(this.maxDataSize)}}catch(N){if("aborted"===N.type&&"The operation was aborted"===N.message){if(this.closeController.signal.aborted)return;this.resetController.signal.aborted&&(N.message="stream reset",N.code=Dh),this.abortController.signal.aborted&&(N.message="stream aborted",N.code=Dd)}if(N.code===Dh)Du.trace("%s stream %s reset",this.stat.direction,this.id);else{Du.trace("%s stream %s error",this.stat.direction,this.id,N);try{let N=this.sendReset();Dg(N)&&await N,this.stat.timeline.reset=Date.now()}catch(N){Du.trace("%s stream %s error sending reset",this.stat.direction,this.id,N)}}throw this.streamSource.end(N),this.onSinkEnd(N),N}finally{O.clear()}try{let N=this.sendCloseWrite();Dg(N)&&await N}catch(N){Du.trace("%s stream %s error sending close",this.stat.direction,this.id,N)}this.onSinkEnd()}sourcePush(N){this.streamSource.push(N)}sourceReadableLength(){return this.streamSource.readableLength}}class Db extends Dm{name;streamId;send;types;constructor(N){super(N),this.types="outbound"===N.direction?k0:k4,this.send=N.send,this.name=N.name,this.streamId=N.streamId}sendNewStream(){this.send({id:this.streamId,type:k0.NEW_STREAM,data:new sZ(nD(this.name))})}sendData(N){this.send({id:this.streamId,type:this.types.MESSAGE,data:N})}sendReset(){this.send({id:this.streamId,type:this.types.RESET})}sendCloseWrite(){this.send({id:this.streamId,type:this.types.CLOSE})}sendCloseRead(){}}function Dw(N){let{id:O,name:U,send:$,onEnd:Y,type:X="initiator",maxMsgSize:J=k5}=N;return new Db({id:"initiator"===X?`i${O}`:`r${O}`,streamId:O,name:`${null==U?O:U}`,direction:"initiator"===X?"outbound":"inbound",maxDataSize:J,onEnd:Y,send:$})}let Dv=rF("libp2p:mplex"),DE=1024,D_=1024,DS=4194304,DI=5;function DR(N){let O={...N,type:`${kZ[N.type]} (${N.type})`};return N.type===tI.NEW_STREAM&&(O.data=nA(N.data instanceof Uint8Array?N.data:N.data.subarray())),(N.type===tI.MESSAGE_INITIATOR||N.type===tI.MESSAGE_RECEIVER)&&(O.data=nA(N.data instanceof Uint8Array?N.data:N.data.subarray(),"base16")),O}class Dk{protocol="/mplex/6.7.0";sink;source;_streamId;_streams;_init;_source;closeController;rateLimiter;constructor(N){N=N??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=N,this.sink=this._createSink();let O=this._createSource();this._source=O,this.source=O,this.closeController=new AbortController,this.rateLimiter=new bd.RateLimiterMemory({points:N.disconnectThreshold??DI,duration:1})}get streams(){let N=[];for(let O of this._streams.initiators.values())N.push(O);for(let O of this._streams.receivers.values())N.push(O);return N}newStream(N){if(this.closeController.signal.aborted)throw Error("Muxer already closed");let O=this._streamId++;N=null==N?O.toString():N.toString();let U=this._streams.initiators;return this._newStream({id:O,name:N,type:"initiator",registry:U})}close(N){this.closeController.signal.aborted||(null!=N?this.streams.forEach(O=>{O.abort(N)}):this.streams.forEach(N=>{N.close()}),this.closeController.abort())}_newReceiverStream(N){let{id:O,name:U}=N,$=this._streams.receivers;return this._newStream({id:O,name:U,type:"receiver",registry:$})}_newStream(N){let{id:O,name:U,type:$,registry:Y}=N;if(Dv("new %s stream %s",$,O),"initiator"===$&&this._streams.initiators.size===(this._init.maxOutboundStreams??D_))throw new n3("Too many outbound streams open","ERR_TOO_MANY_OUTBOUND_STREAMS");if(Y.has(O))throw Error(`${$} stream ${O} already exists!`);let X=N=>{Dv.enabled&&Dv.trace("%s stream %s send",$,O,DR(N)),this._source.push(N)},J=()=>{Dv("%s stream with id %s and protocol %s ended",$,O,Z.stat.protocol),Y.delete(O),null!=this._init.onStreamEnd&&this._init.onStreamEnd(Z)},Z=Dw({id:O,name:U,send:X,type:$,onEnd:J,maxMsgSize:this._init.maxMsgSize});return Y.set(O,Z),Z}_createSink(){let N=async N=>{let O=nY([this.closeController.signal,this._init.signal]);try{N=sW(N,O);let U=new k8(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(let O of N)for(let N of U.write(O))await this._handleIncoming(N);this._source.end()}catch(N){Dv("error in sink",N),this._source.end(N)}finally{O.clear()}};return N}_createSource(){let N=N=>{this.close(N)},O=oS({objectMode:!0,onEnd:N});return Object.assign(Dc(O,this._init.minSendBytes),{push:O.push,end:O.end,return:O.return})}async _handleIncoming(N){let{id:O,type:U}=N;if(Dv.enabled&&Dv.trace("incoming message",DR(N)),N.type===tI.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??DE)){Dv("too many inbound streams open"),this._source.push({id:O,type:tI.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{Dv("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this._source.end(Error("Too many open streams"))}return}let U=this._newReceiverStream({id:O,name:nA(N.data instanceof Uint8Array?N.data:N.data.subarray())});null!=this._init.onIncomingStream&&this._init.onIncomingStream(U);return}let $=(1&U)==1?this._streams.initiators:this._streams.receivers,Y=$.get(O);if(null==Y){Dv("missing stream %s for message type %s",O,kZ[U]);return}let X=this._init.maxStreamBufferSize??DS;switch(U){case tI.MESSAGE_INITIATOR:case tI.MESSAGE_RECEIVER:if(Y.sourceReadableLength()>X){this._source.push({id:N.id,type:U===tI.MESSAGE_INITIATOR?tI.RESET_RECEIVER:tI.RESET_INITIATOR});let O=new n3("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers","ERR_STREAM_INPUT_BUFFER_FULL");Y.abort(O);return}Y.sourcePush(N.data);break;case tI.CLOSE_INITIATOR:case tI.CLOSE_RECEIVER:Y.closeRead();break;case tI.RESET_INITIATOR:case tI.RESET_RECEIVER:Y.reset();break;default:Dv("unknown message type %s",U)}}}class DT{protocol="/mplex/6.7.0";_init;constructor(N={}){this._init=N}createStreamMuxer(N={}){return new Dk({...N,...this._init})}}function DC(N={}){return()=>new DT(N)}!function(N){N.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",N.ERR_DATA_CHANNEL="ERR_DATA_CHANNEL",N.ERR_CONNECTION_CLOSED="ERR_CONNECTION_CLOSED",N.ERR_HASH_NOT_SUPPORTED="ERR_HASH_NOT_SUPPORTED",N.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",N.ERR_INVALID_FINGERPRINT="ERR_INVALID_FINGERPRINT",N.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",N.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",N.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",N.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS"}(tR||(tR={}));class DP extends n3{constructor(N,O){super(`WebRTC transport error: ${N}`,O??""),this.name="WebRTCTransportError"}}class DN extends DP{constructor(N,O){super(`[stream: ${N}] data channel error: ${O}`,tR.ERR_DATA_CHANNEL),this.name="WebRTC/DataChannelError"}}function DL(N,O){return new DN(N,O)}class DO extends DP{constructor(N){super(`There was a problem with the Multiaddr which was passed in: ${N}`,tR.ERR_INVALID_MULTIADDR),this.name="WebRTC/InappropriateMultiaddrError"}}function DM(N){return new DO(N)}class DU extends DP{constructor(N){super(`There was a problem with a provided argument: ${N}`,tR.ERR_INVALID_PARAMETERS),this.name="WebRTC/InvalidArgumentError"}}function DF(N){return new DU(N)}class DV extends DP{constructor(N,O){super(`Invalid fingerprint "${N}" within ${O}`,tR.ERR_INVALID_FINGERPRINT),this.name="WebRTC/InvalidFingerprintError"}}function Dz(N,O){return new DV(N,O)}class D$ extends DP{constructor(N){super(`A method (${N}) was called though it has been intentionally left unimplemented.`,tR.ERR_NOT_IMPLEMENTED),this.name="WebRTC/UnimplementedError"}}function DK(N){return new D$(N)}class Dq extends DP{constructor(N){super(`unsupported hash algorithm: ${N}`,tR.ERR_HASH_NOT_SUPPORTED),this.name="WebRTC/UnsupportedHashAlgorithmError"}}function Dj(N){return new Dq(N)}var DW=U(3454),DH=function(N,O,U){if(U||2==arguments.length)for(var $,Y=0,X=O.length;Y<X;Y++)!$&&Y in O||($||($=Array.prototype.slice.call(O,0,Y)),$[Y]=O[Y]);return N.concat($||Array.prototype.slice.call(O))},DG=function(){return function(N,O,U){this.name=N,this.version=O,this.os=U,this.type="browser"}}(),DQ=function(){return function(N){this.version=N,this.type="node",this.name="node",this.os=DW.platform}}(),DY=function(){return function(N,O,U,$){this.name=N,this.version=O,this.os=U,this.bot=$,this.type="bot-device"}}(),DX=function(){return function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}}(),DJ=function(){return function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}}(),DZ=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,D0=3,D3=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],D4=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function D5(N){return N?D8(N):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new DJ:"undefined"!=typeof navigator?D8(navigator.userAgent):D9()}function D6(N){return""!==N&&D3.reduce(function(O,U){var $=U[0],Y=U[1];if(O)return O;var X=Y.exec(N);return!!X&&[$,X]},!1)}function D8(N){var O=D6(N);if(!O)return null;var U=O[0],$=O[1];if("searchbot"===U)return new DX;var Y=$[1]&&$[1].split(".").join("_").split("_").slice(0,3);Y?Y.length<D0&&(Y=DH(DH([],Y,!0),Ae(D0-Y.length),!0)):Y=[];var X=Y.join("."),J=D7(N),Z=DZ.exec(N);return Z&&Z[1]?new DY(U,X,J,Z[1]):new DG(U,X,J)}function D7(N){for(var O=0,U=D4.length;O<U;O++){var $=D4[O],Y=$[0];if($[1].exec(N))return Y}return null}function D9(){return void 0!==DW&&DW.version?new DQ(DW.version.slice(1)):null}function Ae(N){for(var O=[],U=0;U<N;U++)O.push("0");return O}let At=D5(),Ar=null!=At&&"firefox"===At.name,Ai=async function*(){},An=async N=>{},As=rF("libp2p:webrtc:connection");class Ao{peerConnection;remoteAddr;timeline;metrics;source=Ai();sink=An;constructor(N){this.remoteAddr=N.remoteAddr,this.timeline=N.timeline,this.peerConnection=N.peerConnection,this.peerConnection.onconnectionstatechange=()=>{("closed"===this.peerConnection.connectionState||"disconnected"===this.peerConnection.connectionState||"failed"===this.peerConnection.connectionState)&&(this.timeline.close=Date.now())}}async close(N){void 0!==N&&As.error("error closing connection",N),As.trace("closing connection"),this.timeline.close=Date.now(),this.peerConnection.close(),this.metrics?.increment({close:!0})}}!function(N){let O,U,$;!function(N){N.FIN="FIN",N.STOP_SENDING="STOP_SENDING",N.RESET="RESET"}(O=N.Flag||(N.Flag={})),function(N){N[N.FIN=0]="FIN",N[N.STOP_SENDING=1]="STOP_SENDING",N[N.RESET=2]="RESET"}(U||(U={})),function(N){N.codec=()=>sv(U)}(O=N.Flag||(N.Flag={})),N.codec=()=>(null==$&&($=sE((O,U,$={})=>{!1!==$.lengthDelimited&&U.fork(),null!=O.flag&&(U.uint32(8),N.Flag.codec().encode(O.flag,U)),null!=O.message&&(U.uint32(18),U.bytes(O.message)),!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let $={},Y=null==U?O.len:O.pos+U;for(;O.pos<Y;){let U=O.uint32();switch(U>>>3){case 1:$.flag=N.Flag.codec().decode(O);break;case 2:$.message=O.bytes();break;default:O.skipType(7&U)}}return $})),$),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tk||(tk={}));let Aa=rF("libp2p:webrtc:stream"),Al=16384,Ac=16777216,Au=3e4,Ah=3;class Ad extends Dm{channel;dataChannelOptions;incomingData;messageQueue;constructor(N){switch(super(N),this.channel=N.channel,this.channel.binaryType="arraybuffer",this.incomingData=o_(),this.messageQueue=new sZ,this.dataChannelOptions={bufferedAmountLowEventTimeout:N.dataChannelOptions?.bufferedAmountLowEventTimeout??Au,maxBufferedAmount:N.dataChannelOptions?.maxBufferedAmount??Ac,maxMessageSize:N.dataChannelOptions?.maxMessageSize??Al},this.channel.readyState){case"open":case"connecting":break;case"closed":case"closing":(void 0===this.stat.timeline.close||0===this.stat.timeline.close)&&(this.stat.timeline.close=Date.now());break;default:throw Aa.error("unknown datachannel state %s",this.channel.readyState),new n3("Unknown datachannel state","ERR_INVALID_STATE")}this.channel.onopen=N=>{this.stat.timeline.open=new Date().getTime(),null!=this.messageQueue&&(this._sendMessage(this.messageQueue).catch(N=>{this.abort(N)}),this.messageQueue=void 0)},this.channel.onclose=N=>{this.close()},this.channel.onerror=N=>{let O=N.error;this.abort(O)};let O=this;this.channel.onmessage=async N=>{let{data:O}=N;null!==O&&0!==O.byteLength&&this.incomingData.push(new Uint8Array(O,0,O.byteLength))},Promise.resolve().then(async()=>{for await(let N of om(this.incomingData)){let U=O.processIncomingProtobuf(N.subarray());null!=U&&O.sourcePush(new sZ(U))}}).catch(N=>{Aa.error("error processing incoming data channel messages",N)})}sendNewStream(){}async _sendMessage(N,O=!0){if(O&&this.channel.bufferedAmount>this.dataChannelOptions.maxBufferedAmount)try{await Rj(this.channel,"bufferedamountlow",{timeout:this.dataChannelOptions.bufferedAmountLowEventTimeout})}catch(N){if(N instanceof uQ)throw this.abort(N),Error("Timed out waiting for DataChannel buffer to clear");throw N}if("closed"===this.channel.readyState||"closing"===this.channel.readyState)throw new n3("Invalid datachannel state - closed or closing","ERR_INVALID_STATE");if("open"===this.channel.readyState)for(let O of N)this.channel.send(O);else if("connecting"===this.channel.readyState)null==this.messageQueue&&(this.messageQueue=new sZ),this.messageQueue.append(N);else throw Aa.error("unknown datachannel state %s",this.channel.readyState),new n3("Unknown datachannel state","ERR_INVALID_STATE")}async sendData(N){let O=tk.encode({message:N.subarray()}),U=od.single(O);await this._sendMessage(U)}async sendReset(){await this._sendFlag(tk.Flag.RESET)}async sendCloseWrite(){await this._sendFlag(tk.Flag.FIN)}async sendCloseRead(){await this._sendFlag(tk.Flag.STOP_SENDING)}processIncomingProtobuf(N){let O=tk.decode(N);return void 0!==O.flag&&(O.flag===tk.Flag.FIN&&(this.incomingData.end(),this.closeRead()),O.flag===tk.Flag.RESET&&this.reset(),O.flag===tk.Flag.STOP_SENDING&&this.closeWrite()),O.message}async _sendFlag(N){Aa.trace("Sending flag: %s",N.toString());let O=tk.encode({flag:N}),U=od.single(O);await this._sendMessage(U,!1)}}function Ap(N){let{channel:O,direction:U,onEnd:$,dataChannelOptions:Y}=N;return new Ad({id:"inbound"===U?`i${O.id}`:`r${O.id}`,direction:U,maxDataSize:(Y?.maxMessageSize??Al)-Ah,dataChannelOptions:Y,onEnd:$,channel:O})}let Af="/webrtc";class Ag{protocol;peerConnection;streamBuffer=[];metrics;dataChannelOptions;constructor(N){this.peerConnection=N.peerConnection,this.metrics=N.metrics,this.protocol=N.protocol??Af,this.dataChannelOptions=N.dataChannelOptions,this.peerConnection.ondatachannel=({channel:O})=>{let U=Ap({channel:O,direction:"inbound",dataChannelOptions:N.dataChannelOptions,onEnd:()=>{this.streamBuffer=this.streamBuffer.filter(N=>N.id!==U.id)}});this.streamBuffer.push(U)}}createStreamMuxer(N){return new Ay({...N,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.streamBuffer,protocol:this.protocol})}}class Ay{init;streams;protocol;peerConnection;dataChannelOptions;metrics;close=()=>{};source=Ai();sink=An;constructor(N){this.init=N,this.streams=N.streams,this.peerConnection=N.peerConnection,this.protocol=N.protocol??Af,this.metrics=N.metrics,this.peerConnection.ondatachannel=({channel:O})=>{let U=Ap({channel:O,direction:"inbound",dataChannelOptions:this.dataChannelOptions,onEnd:()=>{this.streams=this.streams.filter(N=>N.id!==U.id),this.metrics?.increment({stream_end:!0}),N?.onStreamEnd?.(U)}});this.streams.push(U),N?.onIncomingStream!=null&&(this.metrics?.increment({incoming_stream:!0}),N.onIncomingStream(U))};let O=N?.onIncomingStream;null!=O&&this.streams.forEach(N=>{O(N)})}newStream(){let N=this.peerConnection.createDataChannel(""),O=Ap({channel:N,direction:"outbound",dataChannelOptions:this.dataChannelOptions,onEnd:()=>{this.streams=this.streams.filter(N=>N.id!==O.id),this.metrics?.increment({stream_end:!0}),this.init?.onStreamEnd?.(O)}});return this.streams.push(O),this.metrics?.increment({outgoing_stream:!0}),O}}!function(N){let O,U,$;!function(N){N.SDP_OFFER="SDP_OFFER",N.SDP_ANSWER="SDP_ANSWER",N.ICE_CANDIDATE="ICE_CANDIDATE"}(O=N.Type||(N.Type={})),function(N){N[N.SDP_OFFER=0]="SDP_OFFER",N[N.SDP_ANSWER=1]="SDP_ANSWER",N[N.ICE_CANDIDATE=2]="ICE_CANDIDATE"}(U||(U={})),function(N){N.codec=()=>sv(U)}(O=N.Type||(N.Type={})),N.codec=()=>(null==$&&($=sE((O,U,$={})=>{!1!==$.lengthDelimited&&U.fork(),null!=O.type&&(U.uint32(8),N.Type.codec().encode(O.type,U)),null!=O.data&&(U.uint32(18),U.string(O.data)),!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let $={},Y=null==U?O.len:O.pos+U;for(;O.pos<Y;){let U=O.uint32();switch(U>>>3){case 1:$.type=N.Type.codec().decode(O);break;case 2:$.data=O.string();break;default:O.skipType(7&U)}}return $})),$),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tD||(tD={}));let Am=rF("libp2p:webrtc:peer:util"),Ab=async(N,O,U)=>{for(;;){let $=await Promise.race([N.promise,U.read()]);if($ instanceof Object){let N=$;if(N.type!==tD.Type.ICE_CANDIDATE)throw Error("expected only ice candidates");if(null==N.data||""===N.data){Am.trace("end-of-candidates received");break}Am.trace("received new ICE candidate: %s",N.data);try{await O.addIceCandidate(new RTCIceCandidate(JSON.parse(N.data)))}catch(N){throw Am.error("bad candidate received: ",N),Error("bad candidate received")}}else break}await N.promise};function Aw(N,O){N[Ar?"oniceconnectionstatechange":"onconnectionstatechange"]=U=>{switch(Am.trace("receiver peerConnectionState state: ",N.connectionState),Ar?N.iceConnectionState:N.connectionState){case"connected":O.resolve();break;case"failed":case"disconnected":case"closed":O.reject(Error("RTCPeerConnection was closed"))}}}let Av=3e4,AE=rF("libp2p:webrtc:peer");async function A_({rtcConfiguration:N,dataChannelOptions:O,stream:U}){let $=AbortSignal.timeout(Av),Y=E_(sG(U,$)).pb(tD),X=new RTCPeerConnection(N),J=new Ag({peerConnection:X,dataChannelOptions:O}),Z=c_(),en=c_();$.onabort=()=>{Z.reject()},X.onicecandidate=({candidate:N})=>{en.promise.then(()=>{Y.write({type:tD.Type.ICE_CANDIDATE,data:null!=N?JSON.stringify(N.toJSON()):""})},N=>{AE.error("cannot set candidate since sending answer failed",N)})},Aw(X,Z);let es=await Y.read();if(es.type!==tD.Type.SDP_OFFER)throw Error(`expected message type SDP_OFFER, received: ${es.type??"undefined"} `);let eo=new RTCSessionDescription({type:"offer",sdp:es.data});await X.setRemoteDescription(eo).catch(N=>{throw AE.error("could not execute setRemoteDescription",N),Error("Failed to set remoteDescription")});let ea=await X.createAnswer().catch(N=>{throw AE.error("could not execute createAnswer",N),en.reject(N),Error("Failed to create answer")});Y.write({type:tD.Type.SDP_ANSWER,data:ea.sdp}),await X.setLocalDescription(ea).catch(N=>{throw AE.error("could not execute setLocalDescription",N),en.reject(N),Error("Failed to set localDescription")}),en.resolve(),await Ab(Z,X,Y);let ec=AI(X.currentRemoteDescription?.sdp??"");return{pc:X,muxerFactory:J,remoteAddress:ec}}async function AS({rtcConfiguration:N,dataChannelOptions:O,signal:U,stream:$}){let Y=E_(sG($,U)).pb(tD),X=new RTCPeerConnection(N),J=new Ag({peerConnection:X,dataChannelOptions:O}),Z=c_();Aw(X,Z),U.onabort=Z.reject;let en=X.createDataChannel("init");X.onicecandidate=({candidate:N})=>{Y.write({type:tD.Type.ICE_CANDIDATE,data:null!=N?JSON.stringify(N.toJSON()):""})};let es=await X.createOffer();Y.write({type:tD.Type.SDP_OFFER,data:es.sdp}),await X.setLocalDescription(es).catch(N=>{throw AE.error("could not execute setLocalDescription",N),Error("Failed to set localDescription")});let eo=await Y.read();if(eo.type!==tD.Type.SDP_ANSWER)throw Error("remote should send an SDP answer");let ea=new RTCSessionDescription({type:"answer",sdp:eo.data});await X.setRemoteDescription(ea).catch(N=>{throw AE.error("could not execute setRemoteDescription",N),Error("Failed to set remoteDescription")}),await Ab(Z,X,Y),en.close();let ec=AI(X.currentRemoteDescription?.sdp??"");return{pc:X,muxerFactory:J,remoteAddress:ec}}function AI(N){let O=N.split("\r\n").filter(N=>N.startsWith("a=candidate")).pop(),U=O?.split(" ");return null==O||null==U||U.length<5?(AE("could not parse remote address from",O),"/webrtc"):`/dnsaddr/${U[4]}/${U[2].toLowerCase()}/${U[3]}/webrtc`}class AR extends gh{peerId;transportManager;constructor(N){super(),this.peerId=N.peerId,this.transportManager=N.transportManager}async listen(){this.safeDispatchEvent("listening",{})}getAddrs(){return this.transportManager.getListeners().filter(N=>N!==this).map(N=>N.getAddrs().filter(N=>S$.matches(N)).map(N=>N.encapsulate(`/webrtc/p2p/${this.peerId}`))).flat()}async close(){this.safeDispatchEvent("close",{})}}let Ak=rF("libp2p:webrtc:peer"),AD="/webrtc",AT="/p2p-circuit",AC="/webrtc-signaling/0.0.1",AP=yg("webrtc").code;class Ax{components;init;_started=!1;constructor(N,O={}){this.components=N,this.init=O}isStarted(){return this._started}async start(){await this.components.registrar.handle(AC,N=>{this._onProtocol(N).catch(O=>{Ak.error("failed to handle incoming connect from %p",N.connection.remotePeer,O)})}),this._started=!0}async stop(){await this.components.registrar.unhandle(AC),this._started=!1}createListener(N){return new AR(this.components)}[Symbol.toStringTag]="@libp2p/webrtc";[mX]=!0;filter(N){return N.filter(N=>{let O=N.protoCodes();return O.includes(AP)})}async dial(N,O){Ak.trace("dialing address: ",N);let{baseAddr:U,peerId:$}=AN(N);if(null==O.signal){let N=new AbortController;O.signal=N.signal}let Y=await this.components.transportManager.dial(U,O),X=await Y.newStream([AC],O);try{let{pc:N,muxerFactory:U,remoteAddress:Y}=await AS({stream:X,rtcConfiguration:this.init.rtcConfiguration,dataChannelOptions:this.init.dataChannel,signal:O.signal}),J=await O.upgrader.upgradeOutbound(new Ao({peerConnection:N,timeline:{open:Date.now()},remoteAddr:y1(Y).encapsulate(`/p2p/${$.toString()}`)}),{skipProtection:!0,skipEncryption:!0,muxerFactory:U});return X.close(),J}catch(N){throw X.reset(),N}finally{await Y.close()}}async _onProtocol({connection:N,stream:O}){try{let{pc:U,muxerFactory:$,remoteAddress:Y}=await A_({rtcConfiguration:this.init.rtcConfiguration,connection:N,stream:O,dataChannelOptions:this.init.dataChannel});await this.components.upgrader.upgradeInbound(new Ao({peerConnection:U,timeline:{open:new Date().getTime()},remoteAddr:y1(Y).encapsulate(`/p2p/${N.remotePeer.toString()}`)}),{skipEncryption:!0,skipProtection:!0,muxerFactory:$})}catch(N){throw O.reset(),N}finally{await N.close()}}}function AN(N){let O=N.toString().split(AD+"/");if(2!==O.length)throw new n3("webrtc protocol was not present in multiaddr",tR.ERR_INVALID_MULTIADDR);if(!O[0].includes(AT))throw new n3("p2p-circuit protocol was not present in multiaddr",tR.ERR_INVALID_MULTIADDR);let U=y1(O[0]),$=y1("/"+O[1]),Y=$.getPeerId();if(null==Y)throw new n3("destination peer id was missing",tR.ERR_INVALID_MULTIADDR);let X=U.protos().pop();if(void 0===X)throw new n3("invalid multiaddr",tR.ERR_INVALID_MULTIADDR);return"p2p"!==X.name&&(U=U.encapsulate(`/p2p/${Y}`)),{baseAddr:U,peerId:gC(Y)}}var AB=U(8370);let AL=rF("libp2p:webrtc:sdp"),AO=Object.values(nw).map(N=>N.decoder).reduce((N,O)=>N.or(O));function AM(N){let O=N.getConfiguration().certificates?.at(0);if(null==O||null==O.getFingerprints){AL.trace("fetching fingerprint from local SDP");let O=N.localDescription;if(null==O)return;return AF(O.sdp)}if(AL.trace("fetching fingerprint from local certificate"),0===O.getFingerprints().length)return;let U=O.getFingerprints()[0].value;if(null==U)throw Dz("","no fingerprint on local certificate");return U}let AU=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function AF(N){let O=N.match(AU);return O?.groups?.fingerprint}function AV(N){for(let O of N.protoNames())if(O.startsWith("ip"))return O.toUpperCase();return AL("Warning: multiaddr does not appear to contain IP4 or IP6, defaulting to IP6",N),"IP6"}function Az(N){let O=N.stringTuples(),U=O.filter(N=>N[0]===AZ).map(N=>N[1])[0];if(void 0===U||""===U)throw DM(`Couldn't find a certhash component of multiaddr: ${N.toString()}`);return U}function A$(N){let O=AO.decode(N);return AB.decode(O)}function AK(N){let O=A$(Az(N)),U=Aq(O.name),$=O.digest.reduce((N,O)=>N+O.toString(16).padStart(2,"0"),""),Y=$.match(/.{1,2}/g);if(null==Y)throw Dz($,N.toString());return[`${U.toUpperCase()} ${Y.join(":").toUpperCase()}`,$]}function Aq(N){switch(N){case"sha1":return"sha-1";case"sha2-256":return"sha-256";case"sha2-512":return"sha-512";default:throw Dj(N)}}function Aj(N,O){let{host:U,port:$}=N.toOptions(),Y=AV(N),[X]=AK(N);return`v=0
o=- 0 0 IN ${Y} ${U}
s=-
c=IN ${Y} ${U}
t=0 0
a=ice-lite
m=application ${$} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:passive
a=ice-ufrag:${O}
a=ice-pwd:${O}
a=fingerprint:${X}
a=sctp-port:5000
a=max-message-size:100000
a=candidate:1467250027 1 UDP 1467250027 ${U} ${$} typ host\r
`}function AW(N,O){return{type:"answer",sdp:Aj(N,O)}}function AH(N,O){if(void 0===N.sdp)throw DF("Can't munge a missing SDP");return N.sdp=N.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,"\na=ice-ufrag:"+O+"\n").replace(/\na=ice-pwd:[^\n]*\n/,"\na=ice-pwd:"+O+"\n"),N}let AG=Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),AQ=N=>[...Array(N)].map(()=>AG.at(Math.floor(Math.random()*AG.length))).join(""),AY=rF("libp2p:webrtc:transport"),AX=1e4,AJ=yg("webrtc-direct").code,AZ=yg("certhash").code;class A1{metrics;components;init;constructor(N,O={}){this.components=N,this.init=O,null!=N.metrics&&(this.metrics={dialerEvents:N.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dial events by type"})})}async dial(N,O){let U=await this._connect(N,O);return AY(`dialing address - ${N.toString()}`),U}createListener(N){throw DK("WebRTCTransport.createListener")}filter(N){return N.filter(A2)}[Symbol.toStringTag]="@libp2p/webrtc-direct";[mX]=!0;async _connect(N,O){let U=new AbortController,$=U.signal,Y=N.getPeerId();if(null===Y)throw DM("we need to have the remote's PeerId");let X=gC(Y),J=A$(Az(N)),Z=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256",hash:Aq(J.name)}),en=new RTCPeerConnection({certificates:[Z]}),es=new Promise((N,O)=>{let U=en.createDataChannel("",{negotiated:!0,id:0}),$=setTimeout(()=>{let N=`Data channel was never opened: state: ${U.readyState}`;AY.error(N),this.metrics?.dialerEvents.increment({open_error:!0}),O(DL("data",N))},AX);U.onopen=O=>{clearTimeout($),N(U)},U.onerror=N=>{clearTimeout($);let U=N.target?.toString()??"not specified",Y=`Error opening a data channel for handshaking: ${U}`;AY.error(Y),this.metrics?.dialerEvents.increment({unknown_error:!0}),O(DL("data",Y))}}),eo="libp2p+webrtc+v1/"+AQ(32),ea=await en.createOffer(),ec=AH(ea,eo);await en.setLocalDescription(ec);let eu=AW(N,eo);await en.setRemoteDescription(eu);let eh=await es,ef=this.components.peerId,eg=this.generateNoisePrologue(en,J.code,N),ey=_q({prologueBytes:eg})(),ew=Ap({channel:eh,direction:"inbound",dataChannelOptions:this.init.dataChannel}),ev={...ew,sink:ew.sink.bind(ew),source:async function*(){for await(let N of ew.source)for(let O of N)yield O}()},eE=new Ao({peerConnection:en,remoteAddr:N,timeline:{open:Date.now()},metrics:this.metrics?.dialerEvents}),e_=Ar?"iceconnectionstatechange":"connectionstatechange";en.addEventListener(e_,()=>{switch(en.connectionState){case"failed":case"disconnected":case"closed":eE.close().catch(N=>{AY.error("error closing connection",N)}).finally(()=>{U.abort()})}},{signal:$}),this.metrics?.dialerEvents.increment({peer_connection:!0});let eS=new Ag({peerConnection:en,metrics:this.metrics?.dialerEvents,dataChannelOptions:this.init.dataChannel});return await ey.secureInbound(ef,ev,X),O.upgrader.upgradeOutbound(eE,{skipProtection:!0,skipEncryption:!0,muxerFactory:eS})}generateNoisePrologue(N,O,U){if(N.getConfiguration().certificates?.length===0)throw DF("no local certificate");let $=AM(N);if(null==$)throw DF("no local fingerprint found");let Y=$.trim().toLowerCase().replaceAll(":",""),X=nD(Y,"hex"),J=AB.encode(X,O),Z=AO.decode(Az(U)),en=nD("libp2p-webrtc-noise:");return sQ([en,J,Z])}}function A2(N){let O=N.protoCodes();return O.includes(AJ)&&O.includes(AZ)&&null!=N.getPeerId()&&!O.includes(yg("p2p-circuit").code)}function A0(N){return O=>new A1(O,N)}function A3(N){return O=>new Ax(O,N)}function A4(N){let O;try{O=yg("sni").code}catch(N){return null}for(let[U,$]of N)if(U===O&&void 0!==$)return $;return null}function A5(N){return N.some(([N,O])=>N===yg("tls").code)}function A6(N,O,U){let $=A8[yg(N).name];if(void 0===$)throw Error(`Can't interpret protocol ${yg(N).name}`);let Y=$(O,U);return N===yg("ip6").code?`[${Y}]`:Y}let A8={ip4:(N,O)=>N,ip6:(N,O)=>0===O.length?N:`[${N}]`,tcp:(N,O)=>{let U=O.pop();if(void 0===U)throw Error("Unexpected end of multiaddr");return`tcp://${A6(U[0],U[1]??"",O)}:${N}`},udp:(N,O)=>{let U=O.pop();if(void 0===U)throw Error("Unexpected end of multiaddr");return`udp://${A6(U[0],U[1]??"",O)}:${N}`},dnsaddr:(N,O)=>N,dns4:(N,O)=>N,dns6:(N,O)=>N,dns:(N,O)=>N,ipfs:(N,O)=>{let U=O.pop();if(void 0===U)throw Error("Unexpected end of multiaddr");return`${A6(U[0],U[1]??"",O)}/ipfs/${N}`},p2p:(N,O)=>{let U=O.pop();if(void 0===U)throw Error("Unexpected end of multiaddr");return`${A6(U[0],U[1]??"",O)}/p2p/${N}`},http:(N,O)=>{let U=A5(O),$=A4(O);if(U&&null!==$)return`https://${$}`;let Y=U?"https://":"http://",X=O.pop();if(void 0===X)throw Error("Unexpected end of multiaddr");let J=A6(X[0],X[1]??"",O);return`${Y}${J=J.replace("tcp://","")}`},tls:(N,O)=>{let U=O.pop();if(void 0===U)throw Error("Unexpected end of multiaddr");return A6(U[0],U[1]??"",O)},sni:(N,O)=>{let U=O.pop();if(void 0===U)throw Error("Unexpected end of multiaddr");return A6(U[0],U[1]??"",O)},https:(N,O)=>{let U=O.pop();if(void 0===U)throw Error("Unexpected end of multiaddr");let $=A6(U[0],U[1]??"",O);return`https://${$=$.replace("tcp://","")}`},ws:(N,O)=>{let U=A5(O),$=A4(O);if(U&&null!==$)return`wss://${$}`;let Y=U?"wss://":"ws://",X=O.pop();if(void 0===X)throw Error("Unexpected end of multiaddr");let J=A6(X[0],X[1]??"",O);return`${Y}${J=J.replace("tcp://","")}`},wss:(N,O)=>{let U=O.pop();if(void 0===U)throw Error("Unexpected end of multiaddr");let $=A6(U[0],U[1]??"",O);return`wss://${$=$.replace("tcp://","")}`},"p2p-websocket-star":(N,O)=>{let U=O.pop();if(void 0===U)throw Error("Unexpected end of multiaddr");return`${A6(U[0],U[1]??"",O)}/p2p-websocket-star`},"p2p-webrtc-star":(N,O)=>{let U=O.pop();if(void 0===U)throw Error("Unexpected end of multiaddr");return`${A6(U[0],U[1]??"",O)}/p2p-webrtc-star`},"p2p-webrtc-direct":(N,O)=>{let U=O.pop();if(void 0===U)throw Error("Unexpected end of multiaddr");return`${A6(U[0],U[1]??"",O)}/p2p-webrtc-direct`}};function A7(N,O){let U=y1(N),$=U.stringTuples(),Y=$.pop();if(void 0===Y)throw Error("Unexpected end of multiaddr");let X=yg(Y[0]),J=A8[X.name];if(null==J)throw Error(`No interpreter found for ${X.name}`);let Z=J(Y[1]??"",$);return O?.assumeHttp!==!1&&Y[0]===yg("tcp").code&&(Z=Z.replace("tcp://","http://"),("443"===Y[1]||"80"===Y[1])&&("443"===Y[1]&&(Z=Z.replace("http://","https://")),Z=Z.substring(0,Z.lastIndexOf(":")))),Z}var A9=WebSocket,Te=U(507);function Tt(N){return N instanceof ArrayBuffer||N?.constructor?.name==="ArrayBuffer"&&"number"==typeof N?.byteLength}var Tr=N=>{let O;N.binaryType="arraybuffer";let U=async()=>{await new Promise((U,$)=>{if(Y){U();return}if(null!=O){$(O);return}let X=O=>{N.removeEventListener("open",J),N.removeEventListener("error",Z),O()},J=()=>{X(U)},Z=O=>{X(()=>{$(O.error??Error(`connect ECONNREFUSED ${N.url}`))})};N.addEventListener("open",J),N.addEventListener("error",Z)})},$=async function*(){let O=new Te.zN(({push:O,stop:U,fail:$})=>{let Y=N=>{let U=null;"string"==typeof N.data&&(U=nD(N.data)),Tt(N.data)&&(U=new Uint8Array(N.data)),N.data instanceof Uint8Array&&(U=N.data),null!=U&&O(U)},X=N=>{$(N.error??Error("Socket error"))};return N.addEventListener("message",Y),N.addEventListener("error",X),N.addEventListener("close",U),()=>{N.removeEventListener("message",Y),N.removeEventListener("error",X),N.removeEventListener("close",U)}},{highWaterMark:1/0});for await(let N of(await U(),O))yield Tt(N)?new Uint8Array(N):N}(),Y=1===N.readyState;return N.addEventListener("open",()=>{Y=!0,O=null}),N.addEventListener("close",()=>{Y=!1,O=null}),N.addEventListener("error",U=>{Y||(O=U.error??Error(`connect ECONNREFUSED ${N.url}`))}),Object.assign($,{connected:U})},Ti=async N=>{if(N.readyState>=2)throw Error("socket closed");1!==N.readyState&&await new Promise((O,U)=>{function $(){N.removeEventListener("open",Y),N.removeEventListener("error",X)}function Y(){$(),O()}function X(O){$(),U(O.error??Error(`connect ECONNREFUSED ${N.url}`))}N.addEventListener("open",Y),N.addEventListener("error",X)})},Tn=(N,O)=>{(O=O??{}).closeOnEnd=!1!==O.closeOnEnd;let U=async U=>{for await(let O of U){try{await Ti(N)}catch(N){if("socket closed"===N.message)break;throw N}N.send(O)}null!=O.closeOnEnd&&N.readyState<=1&&await new Promise((O,U)=>{N.addEventListener("close",N=>{if(N.wasClean||1006===N.code)O();else{let O=Object.assign(Error("ws error"),{event:N});U(O)}}),setTimeout(()=>{N.close()})})};return U},Ts=(N,O)=>{O=O??{};let U=Tr(N),$=O.remoteAddress,Y=O.remotePort;if(null!=N.url)try{let O=new URL(N.url);$=O.hostname,Y=parseInt(O.port,10)}catch{}if(null==$||null==Y)throw Error("Remote connection did not have address and/or port");let X={sink:Tn(N,O),source:U,connected:async()=>{await U.connected()},close:async()=>{(N.readyState===N.CONNECTING||N.readyState===N.OPEN)&&await new Promise(O=>{N.addEventListener("close",()=>{O()}),N.close()})},destroy:()=>{null!=N.terminate?N.terminate():N.close()},remoteAddress:$,remotePort:Y,socket:N};return X},To=U(7745);let Ta={http:"ws",https:"wss"},Tl="ws";var Tc=(N,O)=>(0,To.relative)(N,O,Ta,Tl);function Tu(N,O){let U="undefined"==typeof window?"":window.location;O=O??{};let $=Tc(N,U.toString()),Y=new A9($,O.websocket);return Ts(Y,O)}var Th=U(9134);let Td="object"==typeof window&&"object"==typeof document&&9===document.nodeType,Tp=Th(),Tf=Td&&!Tp,Tg=Tp&&!Td,Ty=Tp&&Td,Tm=void 0!==globalThis.process&&void 0!==globalThis.process.release&&"node"===globalThis.process.release.name&&!Tp,Tb="function"==typeof importScripts&&"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;void 0!==globalThis.process&&void 0!==globalThis.process.env&&globalThis.process.env.NODE_ENV;let Tw="undefined"!=typeof navigator&&"ReactNative"===navigator.product,Tv=421,TE=290,T_=2e3;function TS(N){return N.filter(N=>{if(N.protoCodes().includes(TE))return!1;let O=N.decapsulateCode(Tv);return Sk.matches(O)||SA.matches(O)})}function TI(N){return N.filter(N=>{if(N.protoCodes().includes(TE))return!1;let O=N.decapsulateCode(Tv);return SA.matches(O)})}function TR(){throw Error("WebSocket Servers can not be created in the browser!")}let Tk=rF("libp2p:websockets:socket");function TD(N,O,U){U=U??{};let $={async sink(O){U?.signal!=null&&(O=sW(O,U.signal));try{await N.sink(O)}catch(N){"aborted"!==N.type&&Tk.error(N)}},source:null!=U.signal?sW(N.source,U.signal):N.source,remoteAddr:O,timeline:{open:Date.now()},async close(){let O=Date.now();try{await uZ(N.close(),{milliseconds:T_})}catch(X){let{host:U,port:Y}=$.remoteAddr.toOptions();Tk("timeout closing stream to %s:%s after %dms, destroying it manually",U,Y,Date.now()-O),N.destroy()}finally{$.timeline.close=Date.now()}}};return N.socket.addEventListener("close",()=>{null==$.timeline.close&&($.timeline.close=Date.now())},{once:!0}),$}let TA=rF("libp2p:websockets");class TT{init;constructor(N){this.init=N}[Symbol.toStringTag]="@libp2p/websockets";[mX]=!0;async dial(N,O){TA("dialing %s",N),O=O??{};let U=await this._connect(N,O),$=TD(U,N);TA("new outbound connection %s",$.remoteAddr);let Y=await O.upgrader.upgradeOutbound($);return TA("outbound connection %s upgraded",$.remoteAddr),Y}async _connect(N,O){let U;if(O?.signal?.aborted===!0)throw new n0;let $=N.toOptions();TA("dialing %s:%s",$.host,$.port);let Y=c_(),X=N=>{TA.error("connection error:",N),Y.reject(N)},J=Tu(A7(N),this.init);if(null!=J.socket.on?J.socket.on("error",X):J.socket.onerror=X,null==O.signal)return await Promise.race([J.connected(),Y.promise]),TA("connected %s",N),J;let Z=new Promise((N,$)=>{if(U=()=>{$(new n0),J.close().catch(N=>{TA.error("error closing raw socket",N)})},O?.signal?.aborted===!0){U();return}O?.signal?.addEventListener("abort",U)});try{await Promise.race([Z,Y.promise,J.connected()])}finally{null!=U&&O?.signal?.removeEventListener("abort",U)}return TA("connected %s",N),J}createListener(N){return TR({...this.init,...N})}filter(N){return(N=Array.isArray(N)?N:[N],this.init?.filter!=null)?this.init?.filter(N):Tf||Tb?TI(N):TS(N)}}function TC(N={}){return()=>new TT(N)}let TP=rF("libp2p:webtransport"),Tx=Object.values(nw).map(N=>N.decoder).reduce((N,O)=>N.or(O));function TN(N){return iI(Tx.decode(N))}function TB(){return{source:{[Symbol.asyncIterator]:()=>({next:async()=>new Promise(()=>{})})},sink:async N=>new Promise(()=>{})}}async function TL(N,O,U,$,Y){let X=N.writable.getWriter(),J=N.readable.getReader();function Z(){let N=$.findIndex(N=>N===ea);-1!==N&&($.splice(N,1),ea.stat.timeline.close=Date.now(),Y?.(ea))}await X.ready;let en=!1,es=!1;(async function(){let N=await X.closed.catch(N=>N);if(null!=N){let U=N.message;U.includes("aborted by the remote server")||U.includes("STOP_SENDING")||TP.error(`WebTransport writer closed unexpectedly: streamId=${O} err=${N.message}`)}en=!0,es&&Z()})().catch(()=>{TP.error("WebTransport failed to cleanup closed stream")}),(async function(){let N=await J.closed.catch(N=>N);null!=N&&TP.error(`WebTransport reader closed unexpectedly: streamId=${O} err=${N.message}`),es=!0,en&&es&&Z()})().catch(()=>{TP.error("WebTransport failed to cleanup closed stream")});let eo=!1,ea={id:O,abort(N){en||(X.abort(),en=!0),ea.closeRead(),es=!0,Z()},close(){ea.closeRead(),ea.closeWrite(),Z()},closeRead(){es||(J.cancel().catch(N=>{!0===N.toString().includes("RESET_STREAM")&&(en=!0)}),es=!0),en&&Z()},closeWrite(){en||(en=!0,X.close().catch(N=>{!0===N.toString().includes("RESET_STREAM")&&(es=!0)})),es&&Z()},reset(){ea.close()},stat:{direction:U,timeline:{open:Date.now()}},metadata:{},source:async function*(){for(;;){let N=await J.read();if(!0===N.done){es=!0,en&&Z();return}yield new sZ(N.value)}}(),sink:async function(N){if(eo)throw Error("sink already called on stream");eo=!0;try{for await(let O of N)if(O instanceof Uint8Array)await X.write(O);else for(let N of O)await X.write(N)}finally{ea.closeWrite()}}};return ea}function TO(N){let O=N.stringTuples(),{url:U,certhashes:$,remotePeer:Y}=O.reduce((N,[O,U])=>{switch(O){case yg("ip6").code:case yg("dns6").code:!0===U?.includes(":")&&(U=`[${U}]`);case yg("ip4").code:case yg("dns4").code:if(N.seenHost||N.seenPort)throw Error("Invalid multiaddr, saw host and already saw the host or port");return{...N,url:`${N.url}${U??""}`,seenHost:!0};case yg("quic").code:case yg("quic-v1").code:case yg("webtransport").code:if(!N.seenHost||!N.seenPort)throw Error("Invalid multiaddr, Didn't see host and port, but saw quic/webtransport");return N;case yg("udp").code:if(N.seenPort)throw Error("Invalid multiaddr, saw port but already saw the port");return{...N,url:`${N.url}:${U??""}`,seenPort:!0};case yg("certhash").code:if(!N.seenHost||!N.seenPort)throw Error("Invalid multiaddr, saw the certhash before seeing the host and port");return{...N,certhashes:N.certhashes.concat([TN(U??"")])};case yg("p2p").code:return{...N,remotePeer:gC(U??"")};default:throw Error(`unexpected component in multiaddr: ${O} ${yg(O).name} ${U??""} `)}},{url:"https://",seenHost:!1,seenPort:!1,certhashes:[]});return{url:U,certhashes:$,remotePeer:Y}}function TU(N,O){let U=O.filter(O=>!!N.find(N=>{if(O.length!==N.length)return!1;for(let U=0;U<O.length;U++)if(N[U]!==O[U])return!1;return!0}));return U.length===O.length}class TF{components;config;constructor(N,O={}){this.components=N,this.config={maxInboundStreams:O.maxInboundStreams??1e3}}[Symbol.toStringTag]="@libp2p/webtransport";[mX]=!0;async dial(N,O){TP("dialing %s",N);let U=this.components.peerId;if(void 0===U)throw Error("Need a local peerid");O=O??{};let{url:$,certhashes:Y,remotePeer:X}=TO(N);if(0===Y.length)throw Error("Expected multiaddr to contain certhashes");let J=new WebTransport(`${$}/.well-known/libp2p-webtransport?type=noise`,{serverCertificateHashes:Y.map(N=>({algorithm:"sha-256",value:N.digest}))});if(J.closed.catch(N=>{TP.error("WebTransport transport closed due to:",N)}),await J.ready,null==X)throw Error("Need a target peerid");if(!await this.authenticateWebTransport(J,U,X,Y))throw Error("Failed to authenticate webtransport");let Z={close:async N=>{null!=N&&TP("Closing webtransport with err:",N),J.close()},remoteAddr:N,timeline:{open:Date.now()},...TB()};J.closed.catch(N=>{TP.error("WebTransport connection closed:",N),Z.timeline.close=Date.now()});try{O?.signal?.throwIfAborted()}catch(N){throw J.close(),N}return O.upgrader.upgradeOutbound(Z,{skipEncryption:!0,muxerFactory:this.webtransportMuxer(J),skipProtection:!0})}async authenticateWebTransport(N,O,U,$){let Y=await N.createBidirectionalStream(),X=Y.writable.getWriter(),J=Y.readable.getReader();await X.ready;let Z={source:async function*(){for(;;){let N=await J.read();if(null!=N.value&&(yield N.value),!0===N.done)break}}(),sink:async function(N){for await(let O of N)await X.write(O)}},en=_q()(),{remoteExtensions:es}=await en.secureOutbound(O,Z,U);if(X.close().catch(N=>{TP.error(`Failed to close authentication stream writer: ${N.message}`)}),J.cancel().catch(N=>{TP.error(`Failed to close authentication stream reader: ${N.message}`)}),!TU(es?.webtransportCerthashes??[],$.map(N=>N.bytes)))throw Error("Our certhashes are not a subset of the remote's reported certhashes");return!0}webtransportMuxer(N){let O=0,U=this.config;return{protocol:"webtransport",createStreamMuxer:$=>{"function"==typeof $&&($={onIncomingStream:$});let Y=[];(async function(){//! TODO unclear how to add backpressure here?
let X=N.incomingBidirectionalStreams.getReader();for(;;){let{done:N,value:J}=await X.read();if(!0===N)break;if(Y.length>=U.maxInboundStreams)J.writable.close().catch(N=>{TP.error(`Failed to close inbound stream that crossed our maxInboundStream limit: ${N.message}`)}),J.readable.cancel().catch(N=>{TP.error(`Failed to close inbound stream that crossed our maxInboundStream limit: ${N.message}`)});else{let N=await TL(J,String(O++),"inbound",Y,$?.onStreamEnd);Y.push(N),$?.onIncomingStream?.(N)}}})().catch(()=>{TP.error("WebTransport failed to receive incoming stream")});let X={protocol:"webtransport",streams:Y,newStream:async U=>{let X=await N.createBidirectionalStream(),J=await TL(X,String(O++),$?.direction??"outbound",Y,$?.onStreamEnd);return Y.push(J),J},close:O=>{null!=O&&TP("Closing webtransport muxer with err:",O),N.close()},...TB()};try{$?.signal?.throwIfAborted()}catch(O){throw N.close(),O}return X}}}createListener(N){throw Error("Webtransport servers are not supported in Node or the browser")}filter(N){return N.filter(N=>N.protoNames().includes("webtransport"))}}function TV(N={}){return O=>new TF(O,N)}!function(N){let O,U,$;!function(N){N.EOL="EOL"}(O=N.ValidityType||(N.ValidityType={})),function(N){N[N.EOL=0]="EOL"}(U||(U={})),function(N){N.codec=()=>sv(U)}(O=N.ValidityType||(N.ValidityType={})),N.codec=()=>(null==$&&($=sE((O,U,$={})=>{!1!==$.lengthDelimited&&U.fork(),null!=O.value&&(U.uint32(10),U.bytes(O.value)),null!=O.signature&&(U.uint32(18),U.bytes(O.signature)),null!=O.validityType&&(U.uint32(24),N.ValidityType.codec().encode(O.validityType,U)),null!=O.validity&&(U.uint32(34),U.bytes(O.validity)),null!=O.sequence&&(U.uint32(40),U.uint64(O.sequence)),null!=O.ttl&&(U.uint32(48),U.uint64(O.ttl)),null!=O.pubKey&&(U.uint32(58),U.bytes(O.pubKey)),null!=O.signatureV2&&(U.uint32(66),U.bytes(O.signatureV2)),null!=O.data&&(U.uint32(74),U.bytes(O.data)),!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let $={},Y=null==U?O.len:O.pos+U;for(;O.pos<Y;){let U=O.uint32();switch(U>>>3){case 1:$.value=O.bytes();break;case 2:$.signature=O.bytes();break;case 3:$.validityType=N.ValidityType.codec().decode(O);break;case 4:$.validity=O.bytes();break;case 5:$.sequence=O.uint64();break;case 6:$.ttl=O.uint64();break;case 7:$.pubKey=O.bytes();break;case 8:$.signatureV2=O.bytes();break;case 9:$.data=O.bytes();break;default:O.skipType(7&U)}}return $})),$),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tA||(tA={}));let Tz="ERR_IPNS_EXPIRED_RECORD",T$="ERR_UNRECOGNIZED_VALIDITY",TK="ERR_SIGNATURE_VERIFICATION",Tq="ERR_UNRECOGNIZED_FORMAT",Tj="ERR_UNDEFINED_PARAMETER",TW="ERR_INVALID_RECORD_DATA",TH="ERR_INVALID_EMBEDDED_KEY",TG="ERR_RECORD_TOO_LARGE",TQ=rF("ipns:utils"),TY=nD("/ipns/");function TX(N){let O=RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),U=String(N).trim().match(O);if(null==U)throw Error("Invalid format");let $=parseInt(U[1],10),Y=parseInt(U[2],10)-1,X=parseInt(U[3],10),J=parseInt(U[4],10),Z=parseInt(U[5],10),en=parseInt(U[6],10),es=parseInt(U[7].slice(0,-6),10);return new Date(Date.UTC($,Y,X,J,Z,en,es))}let TJ=async(N,O)=>{let U;if(null==O||null==N){let N=Error("one or more of the provided parameters are not defined");throw TQ.error(N),rV(N,Tj)}if(null!=O.pubKey){try{U=gi(O.pubKey)}catch(N){throw TQ.error(N),N}let $=await gN(O.pubKey);if(!$.equals(N))throw rV(Error("Embedded public key did not match PeerID"),TH)}else null!=N.publicKey&&(U=gi(N.publicKey));if(null!=U)return U;throw rV(Error("no public key is available"),Tj)},TZ=N=>{let O=nD("ipns-signature:");return sQ([O,N])},T0=N=>{let O=tA.decode(N);return null!=O.sequence&&(O.sequence=BigInt(O.sequence)),null!=O.ttl&&(O.ttl=BigInt(O.ttl)),{value:O.value??new Uint8Array(0),signature:O.signature??new Uint8Array(0),validityType:O.validityType??tA.ValidityType.EOL,validity:O.validity??new Uint8Array(0),sequence:O.sequence??0n,pubKey:O.pubKey,ttl:O.ttl??void 0,signatureV2:O.signatureV2,data:O.data}},T4=N=>gP(N.slice(TY.length)),T5=N=>{let O=cE(N);if(0===O.ValidityType)O.ValidityType=tA.ValidityType.EOL;else throw rV(Error("Unknown validity type"),T$);return Number.isInteger(O.Sequence)&&(O.Sequence=BigInt(O.Sequence)),Number.isInteger(O.TTL)&&(O.TTL=BigInt(O.TTL)),O},T6=(N,O)=>{let U=O.map((N,O)=>({entry:tA.decode(N),index:O}));return U.sort((N,O)=>{if(null!=N.entry.signatureV2&&null==O.entry.signatureV2)return -1;if(null==N.entry.signatureV2&&null!=O.entry.signatureV2)return 1;let U=N.entry.sequence??0n,$=O.entry.sequence??0n;if(U>$)return -1;if(U<$)return 1;let Y=N.entry.validity??new Uint8Array(0),X=O.entry.validity??new Uint8Array(0),J=TX(nA(Y)),Z=TX(nA(X));return J.getTime()>Z.getTime()?-1:J.getTime()<Z.getTime()?1:0}),U[0].index},T7=rF("ipns:validator"),T9=10240,Ce=async(N,O)=>{let U,$,Y;let{value:X,validityType:J,validity:Z}=O;if(null!=O.signatureV2&&null!=O.data)$=O.signatureV2,U=TZ(O.data),Ct(O);else throw rV(Error("missing data or signatureV2"),TK);try{Y=await N.verify(U,$)}catch(N){Y=!1}if(!Y)throw T7.error("record signature verification failed"),rV(Error("record signature verification failed"),TK);if(null!=Z&&J===tA.ValidityType.EOL){let N;try{N=TX(nA(Z))}catch(N){throw T7.error("unrecognized validity format (not an rfc3339 format)"),rV(Error("unrecognized validity format (not an rfc3339 format)"),Tq)}if(N.getTime()<Date.now())throw T7.error("record has expired"),rV(Error("record has expired"),Tz)}else if(null!=J)throw T7.error("unrecognized validity type"),rV(Error("unrecognized validity type"),T$);T7("ipns entry for %b is valid",X)},Ct=N=>{if(null==N.data)throw rV(Error("Record data is missing"),TW);let O=T5(N.data);if(!n5(O.Value,N.value))throw rV(Error('Field "value" did not match between protobuf and CBOR'),TK);if(!n5(O.Validity,N.validity))throw rV(Error('Field "validity" did not match between protobuf and CBOR'),TK);if(O.ValidityType!==N.validityType)throw rV(Error('Field "validityType" did not match between protobuf and CBOR'),TK);if(O.Sequence!==N.sequence)throw rV(Error('Field "sequence" did not match between protobuf and CBOR'),TK);if(O.TTL!==N.ttl)throw rV(Error('Field "ttl" did not match between protobuf and CBOR'),TK)},Cr=async(N,O)=>{if(O.byteLength>T9)throw rV(Error("record too large"),TG);let U=T4(N),$=T0(O),Y=await TJ(U,$);await Ce(Y,$)},Ci="libp2p",Cn="autonat",Cs="1.0.0",Co=3e4,Ca=5e3,Cl=6e4,Cc=1,Cu=1;!function(N){let O,U,$,Y,X,J,Z,en;!function(N){N.DIAL="DIAL",N.DIAL_RESPONSE="DIAL_RESPONSE"}(O=N.MessageType||(N.MessageType={})),function(N){N[N.DIAL=0]="DIAL",N[N.DIAL_RESPONSE=1]="DIAL_RESPONSE"}(U||(U={})),function(N){N.codec=()=>sv(U)}(O=N.MessageType||(N.MessageType={})),function(N){N.OK="OK",N.E_DIAL_ERROR="E_DIAL_ERROR",N.E_DIAL_REFUSED="E_DIAL_REFUSED",N.E_BAD_REQUEST="E_BAD_REQUEST",N.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}($=N.ResponseStatus||(N.ResponseStatus={})),function(N){N[N.OK=0]="OK",N[N.E_DIAL_ERROR=100]="E_DIAL_ERROR",N[N.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",N[N.E_BAD_REQUEST=200]="E_BAD_REQUEST",N[N.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"}(Y||(Y={})),function(N){N.codec=()=>sv(Y)}($=N.ResponseStatus||(N.ResponseStatus={})),function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{if(!1!==U.lengthDelimited&&O.fork(),null!=N.id&&(O.uint32(10),O.bytes(N.id)),null!=N.addrs)for(let U of N.addrs)O.uint32(18),O.bytes(U);!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={addrs:[]},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.id=N.bytes();break;case 2:U.addrs.push(N.bytes());break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(X=N.PeerInfo||(N.PeerInfo={})),function(O){let U;O.codec=()=>(null==U&&(U=sE((O,U,$={})=>{!1!==$.lengthDelimited&&U.fork(),null!=O.peer&&(U.uint32(10),N.PeerInfo.codec().encode(O.peer,U)),!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let $={},Y=null==U?O.len:O.pos+U;for(;O.pos<Y;){let U=O.uint32();U>>>3==1?$.peer=N.PeerInfo.codec().decode(O,O.uint32()):O.skipType(7&U)}return $})),U),O.encode=N=>sm(N,O.codec()),O.decode=N=>sy(N,O.codec())}(J=N.Dial||(N.Dial={})),function(O){let U;O.codec=()=>(null==U&&(U=sE((O,U,$={})=>{!1!==$.lengthDelimited&&U.fork(),null!=O.status&&(U.uint32(8),N.ResponseStatus.codec().encode(O.status,U)),null!=O.statusText&&(U.uint32(18),U.string(O.statusText)),null!=O.addr&&(U.uint32(26),U.bytes(O.addr)),!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let $={},Y=null==U?O.len:O.pos+U;for(;O.pos<Y;){let U=O.uint32();switch(U>>>3){case 1:$.status=N.ResponseStatus.codec().decode(O);break;case 2:$.statusText=O.string();break;case 3:$.addr=O.bytes();break;default:O.skipType(7&U)}}return $})),U),O.encode=N=>sm(N,O.codec()),O.decode=N=>sy(N,O.codec())}(Z=N.DialResponse||(N.DialResponse={})),N.codec=()=>(null==en&&(en=sE((O,U,$={})=>{!1!==$.lengthDelimited&&U.fork(),null!=O.type&&(U.uint32(8),N.MessageType.codec().encode(O.type,U)),null!=O.dial&&(U.uint32(18),N.Dial.codec().encode(O.dial,U)),null!=O.dialResponse&&(U.uint32(26),N.DialResponse.codec().encode(O.dialResponse,U)),!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let $={},Y=null==U?O.len:O.pos+U;for(;O.pos<Y;){let U=O.uint32();switch(U>>>3){case 1:$.type=N.MessageType.codec().decode(O);break;case 2:$.dial=N.Dial.codec().decode(O,O.uint32());break;case 3:$.dialResponse=N.DialResponse.codec().decode(O,O.uint32());break;default:O.skipType(7&U)}}return $})),en),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tT||(tT={}));let Ch=rF("libp2p:autonat"),Cd=4;class Cp{components;startupDelay;refreshInterval;protocol;timeout;maxInboundStreams;maxOutboundStreams;verifyAddressTimeout;started;constructor(N,O){this.components=N,this.started=!1,this.protocol=`/${O.protocolPrefix??Ci}/${Cn}/${Cs}`,this.timeout=O.timeout??Co,this.maxInboundStreams=O.maxInboundStreams??Cc,this.maxOutboundStreams=O.maxOutboundStreams??Cu,this.startupDelay=O.startupDelay??Ca,this.refreshInterval=O.refreshInterval??Cl,this._verifyExternalAddresses=this._verifyExternalAddresses.bind(this)}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,N=>{this.handleIncomingAutonatStream(N).catch(N=>{Ch.error("error handling incoming autonat stream",N)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.startupDelay),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),clearTimeout(this.verifyAddressTimeout),this.started=!1}async handleIncomingAutonatStream(N){let O=nY([AbortSignal.timeout(this.timeout)]);try{oW.setMaxListeners?.(1/0,O)}catch{}let U=this.components.addressManager.getAddresses().map(N=>N.toOptions().host);try{let $=sG(N.stream,O),Y=this;await oD($,N=>om(N),async function*($){let X,J;let Z=await wo($);if(null==Z){Ch("no message received"),yield tT.encode({type:tT.MessageType.DIAL_RESPONSE,dialResponse:{status:tT.ResponseStatus.E_BAD_REQUEST,statusText:"No message was sent"}});return}try{X=tT.decode(Z)}catch(N){Ch.error("could not decode message",N),yield tT.encode({type:tT.MessageType.DIAL_RESPONSE,dialResponse:{status:tT.ResponseStatus.E_BAD_REQUEST,statusText:"Could not decode message"}});return}let en=X.dial;if(null==en){Ch.error("dial was missing from message"),yield tT.encode({type:tT.MessageType.DIAL_RESPONSE,dialResponse:{status:tT.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}});return}let es=en.peer;if(null==es||null==es.id){Ch.error("PeerId missing from message"),yield tT.encode({type:tT.MessageType.DIAL_RESPONSE,dialResponse:{status:tT.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}});return}try{J=gP(es.id)}catch(N){Ch.error("invalid PeerId",N),yield tT.encode({type:tT.MessageType.DIAL_RESPONSE,dialResponse:{status:tT.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}});return}if(Ch("incoming request from %p",J),!N.connection.remotePeer.equals(J)){Ch("target peer %p did not equal sending peer %p",J,N.connection.remotePeer),yield tT.encode({type:tT.MessageType.DIAL_RESPONSE,dialResponse:{status:tT.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}});return}let eo=es.addrs.map(N=>y1(N)).filter(O=>{let U=O.toOptions().host===N.connection.remoteAddr.toOptions().host;return Ch.trace("request to dial %s was sent from %s is same host %s",O,N.connection.remoteAddr,U),U}).filter(N=>{let O=N.toOptions().host,U=!mQ(O);return Ch.trace("host %s was public %s",O,U),U}).filter(N=>{let O=N.toOptions().host,$=!U.includes(O);return Ch.trace("host %s was not our host %s",O,$),$}).filter(N=>{let O=!!Y.components.transportManager.transportForMultiaddr(N);return Ch.trace("transport for %s is supported %s",N,O),O}).map(N=>(null==N.getPeerId()&&(N=N.encapsulate(`/p2p/${J.toString()}`)),N));if(0===eo.length){Ch("no valid multiaddrs for %p in message",J),yield tT.encode({type:tT.MessageType.DIAL_RESPONSE,dialResponse:{status:tT.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}});return}Ch("dial multiaddrs %s for peer %p",eo.map(N=>N.toString()).join(", "),J);let ea="",ec=eo[0];for await(let N of eo){let U;ec=N;try{if(!(U=await Y.components.connectionManager.openConnection(N,{signal:O})).remoteAddr.equals(N))throw Ch.error("tried to dial %s but dialed %s",N,U.remoteAddr),Error("Unexpected remote address");Ch("Success %p",J),yield tT.encode({type:tT.MessageType.DIAL_RESPONSE,dialResponse:{status:tT.ResponseStatus.OK,addr:U.remoteAddr.decapsulateCode(yg("p2p").code).bytes}});return}catch(N){Ch("could not dial %p",J,N),ea=N.message}finally{null!=U&&await U.close()}}yield tT.encode({type:tT.MessageType.DIAL_RESPONSE,dialResponse:{status:tT.ResponseStatus.E_DIAL_ERROR,statusText:ea,addr:ec.bytes}})},N=>od(N),N.stream)}catch(N){Ch.error("error handling incoming autonat stream",N)}finally{O.clear()}}_verifyExternalAddresses(){this.verifyExternalAddresses().catch(N=>{Ch.error("error verifying external address",N)})}async verifyExternalAddresses(){if(clearTimeout(this.verifyAddressTimeout),!this.isStarted())return;let N=this.components.addressManager,O=N.getObservedAddrs().filter(N=>{let O=N.toOptions();return!mQ(O.host)});if(0===O.length){Ch("no public addresses found, not requesting verification"),this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.refreshInterval);return}let U=AbortSignal.timeout(this.timeout);try{oW.setMaxListeners?.(1/0,U)}catch{}let $=this;try{Ch("verify multiaddrs %s",O.map(N=>N.toString()).join(", "));let Y=tT.encode({type:tT.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toBytes(),addrs:O.map(N=>N.bytes)}}}),X=await gX(),J=X.toBytes(),Z={},en=[],es=async N=>{try{Ch("asking %p to verify multiaddr",N.id);let O=await $.components.connectionManager.openConnection(N.id,{signal:U}),X=await O.newStream(this.protocol,{signal:U}),J=sG(X,U),Z=await oD([Y],N=>od(N),J,N=>om(N),async N=>wo(N));if(null==Z){Ch("no response received from %p",O.remotePeer);return}let es=tT.decode(Z);if(es.type!==tT.MessageType.DIAL_RESPONSE||null==es.dialResponse){Ch("invalid autonat response from %p",O.remotePeer);return}if(es.dialResponse.status===tT.ResponseStatus.OK){let N;let U=O.remoteAddr.toOptions();if(4===U.family){let O=U.host.split(".");N=O[0]}else if(6===U.family){let O=U.host.split(":");N=O[0]}else{Ch('remote address "%s" was not IP4 or IP6?',U.host);return}if(en.includes(N)){Ch("already have response from network segment %d - %s",N,U.host);return}en.push(N)}return es.dialResponse}catch(N){Ch.error("error asking remote to verify multiaddr",N)}};for await(let $ of IT(ow(this.components.peerRouting.getClosestPeers(J,{signal:U}),N=>async()=>es(N)),{concurrency:Cd}))try{if(null==$)continue;let U=null==$.addr?O[0]:y1($.addr);if(Ch("autonat response for %a is %s",U,$.status),$.status===tT.ResponseStatus.E_BAD_REQUEST||$.status===tT.ResponseStatus.E_DIAL_REFUSED||null==$.addr&&O.length>1)continue;if(!O.some(N=>N.equals(U))){Ch("peer reported %a as %s but it was not in our observed address list",U,$.status);continue}let Y=U.toString();if(null==Z[Y]&&(Z[Y]={success:0,failure:0}),$.status===tT.ResponseStatus.OK?Z[Y].success++:$.status===tT.ResponseStatus.E_DIAL_ERROR&&Z[Y].failure++,Z[Y].success===Cd){Ch("%a is externally dialable",U),N.confirmObservedAddr(U);return}if(Z[Y].failure===Cd){Ch("%a is not externally dialable",U),N.removeObservedAddr(U);return}}catch(N){Ch.error("could not verify external address",N)}}finally{this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.refreshInterval)}}}function Cf(N={}){return O=>new Cp(O,N)}let Cg=290,Cy="/libp2p/relay",Cm=1,Cb="circuit-relay-relay";BigInt(131072);let Cw="/libp2p/circuit/relay/0.2.0/hop",Cv="/libp2p/circuit/relay/0.2.0/stop";async function CE(N){let O=new TextEncoder().encode(N),U=await nr.digest(O);return iC.createV0(U)}function C_(N){let O=N*BigInt(1e3),U=new Date().getTime();return Number(O-BigInt(U))}!function(N){let O,U,$;(function(N){N.RESERVE="RESERVE",N.CONNECT="CONNECT",N.STATUS="STATUS"})(O=N.Type||(N.Type={})),function(N){N[N.RESERVE=0]="RESERVE",N[N.CONNECT=1]="CONNECT",N[N.STATUS=2]="STATUS"}(U||(U={})),function(N){N.codec=()=>sv(U)}(O=N.Type||(N.Type={})),N.codec=()=>(null==$&&($=sE((O,U,$={})=>{!1!==$.lengthDelimited&&U.fork(),null!=O.type&&(U.uint32(8),N.Type.codec().encode(O.type,U)),null!=O.peer&&(U.uint32(18),tx.codec().encode(O.peer,U)),null!=O.reservation&&(U.uint32(26),tN.codec().encode(O.reservation,U)),null!=O.limit&&(U.uint32(34),tB.codec().encode(O.limit,U)),null!=O.status&&(U.uint32(40),tL.codec().encode(O.status,U)),!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let $={},Y=null==U?O.len:O.pos+U;for(;O.pos<Y;){let U=O.uint32();switch(U>>>3){case 1:$.type=N.Type.codec().decode(O);break;case 2:$.peer=tx.codec().decode(O,O.uint32());break;case 3:$.reservation=tN.codec().decode(O,O.uint32());break;case 4:$.limit=tB.codec().decode(O,O.uint32());break;case 5:$.status=tL.codec().decode(O);break;default:O.skipType(7&U)}}return $})),$),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tC||(tC={})),function(N){let O,U,$;(function(N){N.CONNECT="CONNECT",N.STATUS="STATUS"})(O=N.Type||(N.Type={})),function(N){N[N.CONNECT=0]="CONNECT",N[N.STATUS=1]="STATUS"}(U||(U={})),function(N){N.codec=()=>sv(U)}(O=N.Type||(N.Type={})),N.codec=()=>(null==$&&($=sE((O,U,$={})=>{!1!==$.lengthDelimited&&U.fork(),null!=O.type&&(U.uint32(8),N.Type.codec().encode(O.type,U)),null!=O.peer&&(U.uint32(18),tx.codec().encode(O.peer,U)),null!=O.limit&&(U.uint32(26),tB.codec().encode(O.limit,U)),null!=O.status&&(U.uint32(32),tL.codec().encode(O.status,U)),!1!==$.lengthDelimited&&U.ldelim()},(O,U)=>{let $={},Y=null==U?O.len:O.pos+U;for(;O.pos<Y;){let U=O.uint32();switch(U>>>3){case 1:$.type=N.Type.codec().decode(O);break;case 2:$.peer=tx.codec().decode(O,O.uint32());break;case 3:$.limit=tB.codec().decode(O,O.uint32());break;case 4:$.status=tL.codec().decode(O);break;default:O.skipType(7&U)}}return $})),$),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tP||(tP={})),function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{if(!1!==U.lengthDelimited&&O.fork(),null!=N.id&&N.id.byteLength>0&&(O.uint32(10),O.bytes(N.id)),null!=N.addrs)for(let U of N.addrs)O.uint32(18),O.bytes(U);!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={id:new Uint8Array(0),addrs:[]},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.id=N.bytes();break;case 2:U.addrs.push(N.bytes());break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tx||(tx={})),function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{if(!1!==U.lengthDelimited&&O.fork(),null!=N.expire&&0n!==N.expire&&(O.uint32(8),O.uint64(N.expire)),null!=N.addrs)for(let U of N.addrs)O.uint32(18),O.bytes(U);null!=N.voucher&&(O.uint32(26),O.bytes(N.voucher)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={expire:0n,addrs:[]},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.expire=N.uint64();break;case 2:U.addrs.push(N.bytes());break;case 3:U.voucher=N.bytes();break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tN||(tN={})),function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),null!=N.duration&&(O.uint32(8),O.uint32(N.duration)),null!=N.data&&(O.uint32(16),O.uint64(N.data)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.duration=N.uint32();break;case 2:U.data=N.uint64();break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tB||(tB={})),function(N){N.UNUSED="UNUSED",N.OK="OK",N.RESERVATION_REFUSED="RESERVATION_REFUSED",N.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",N.PERMISSION_DENIED="PERMISSION_DENIED",N.CONNECTION_FAILED="CONNECTION_FAILED",N.NO_RESERVATION="NO_RESERVATION",N.MALFORMED_MESSAGE="MALFORMED_MESSAGE",N.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"}(tL||(tL={})),function(N){N[N.UNUSED=0]="UNUSED",N[N.OK=100]="OK",N[N.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",N[N.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",N[N.PERMISSION_DENIED=202]="PERMISSION_DENIED",N[N.CONNECTION_FAILED=203]="CONNECTION_FAILED",N[N.NO_RESERVATION=204]="NO_RESERVATION",N[N.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",N[N.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"}(tO||(tO={})),function(N){N.codec=()=>sv(tO)}(tL||(tL={})),function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{!1!==U.lengthDelimited&&O.fork(),null!=N.relay&&N.relay.byteLength>0&&(O.uint32(10),O.bytes(N.relay)),null!=N.peer&&N.peer.byteLength>0&&(O.uint32(18),O.bytes(N.peer)),null!=N.expiration&&0n!==N.expiration&&(O.uint32(24),O.uint64(N.expiration)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={relay:new Uint8Array(0),peer:new Uint8Array(0),expiration:0n},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 1:U.relay=N.bytes();break;case 2:U.peer=N.bytes();break;case 3:U.expiration=N.uint64();break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tM||(tM={})),rF("libp2p:circuit-relay:utils"),U(9353),rF("libp2p:circuit-relay:advert-service");class CS{domain="libp2p-relay-rsvp";codec=new Uint8Array([3,2]);relay;peer;expiration;constructor({relay:N,peer:O,expiration:U}){this.relay=N,this.peer=O,this.expiration=U}marshal(){return ReservationVoucher.encode({relay:this.relay.toBytes(),peer:this.peer.toBytes(),expiration:BigInt(this.expiration)})}equals(N){return!!(N instanceof CS&&this.peer.equals(N.peer)&&this.relay.equals(N.relay))&&this.expiration===N.expiration}}rF("libp2p:circuit-relay:server");let CI=rF("libp2p:stream:converter");function CR(N,O={}){let{stream:U,remoteAddr:$}=N,{sink:Y,source:X}=U,J=async function*(){for await(let N of X)N instanceof Uint8Array?yield N:yield*N}(),Z={async sink(N){null!=O.signal&&(N=sW(N,O.signal));try{await Y(N),await en()}catch(N){"aborted"!==N.type&&CI(N)}},source:null!=O.signal?sW(J,O.signal):J,remoteAddr:$,timeline:{open:Date.now(),close:void 0},async close(){await Y(async function*(){yield new Uint8Array(0)}()),await en()}};async function en(){null==Z.timeline.close&&(Z.timeline.close=Date.now()),await Promise.resolve()}return Z}let Ck=rF("libp2p:circuit-relay:discover-relays");class CD extends gh{peerId;peerStore;contentRouting;registrar;started;topologyId;constructor(N){super(),this.started=!1,this.peerId=N.peerId,this.peerStore=N.peerStore,this.contentRouting=N.contentRouting,this.registrar=N.registrar}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(Cw,sK({onConnect:N=>{this.safeDispatchEvent("relay:discover",{detail:N})}})),this.discover().catch(N=>{Ck.error("error listening on relays",N)}),this.started=!0}stop(){null!=this.topologyId&&this.registrar.unregister(this.topologyId),this.started=!1}async discover(){Ck("searching peer store for relays");let N=await this.peerStore.all({filters:[N=>N.protocols.includes(Cw)],orders:[()=>.5>Math.random()?1:-1]});for(let O of N)Ck("found relay peer %p in content peer store",O.id),this.safeDispatchEvent("relay:discover",{detail:O.id});Ck("found %d relay peers in peer store",N.length);try{Ck("searching content routing for relays");let N=await CE(Cy),O=0;for await(let U of this.contentRouting.findProviders(N))if(U.multiaddrs.length>0&&!U.id.equals(this.peerId)){let N=U.id;O++,await this.peerStore.merge(N,{multiaddrs:U.multiaddrs}),Ck("found relay peer %p in content routing",N),this.safeDispatchEvent("relay:discover",{detail:N})}Ck("found %d relay peers in content routing",O)}catch(N){Ck.error("failed when finding relays on the network",N)}}}let CA=rF("libp2p:circuit-relay:transport:listener");class CT extends gh{connectionManager;relayStore;listeningAddrs;constructor(N){super(),this.connectionManager=N.connectionManager,this.relayStore=N.relayStore,this.listeningAddrs=new gG,this.relayStore.addEventListener("relay:removed",N=>{this.#f(N.detail)})}async listen(N){let O;CA("listen on %s",N);let U=N.getPeerId();if(null!=U){let N=gC(U),$=this.connectionManager.getConnectionsMap().get(N)??[];$.length>0&&(O=$[0])}if(null==O){let U=N.toString().split("/p2p-circuit").find(N=>""!==N),$=y1(U);O=await this.connectionManager.openConnection($)}if(!this.relayStore.hasReservation(O.remotePeer)){await this.relayStore.addRelay(O.remotePeer,"configured");return}let $=this.relayStore.getReservation(O.remotePeer);if(null==$)throw new n3("Did not have reservation after making reservation","ERR_NO_RESERVATION");if(this.listeningAddrs.has(O.remotePeer)){CA("already listening on relay %p",O.remotePeer);return}this.listeningAddrs.set(O.remotePeer,$.addrs.map(N=>y1(N).encapsulate("/p2p-circuit"))),this.safeDispatchEvent("listening",{})}getAddrs(){return[...this.listeningAddrs.values()].flat()}async close(){}#f(N){let O=this.listeningAddrs.has(N);this.listeningAddrs.delete(N),O&&this.safeDispatchEvent("close",{})}}function CC(N){return new CT(N)}let CP=rF("libp2p:circuit-relay:transport:reservation-store"),Cx=6e5,CN=3e5,CL=3e4;class CO extends gh{peerId;connectionManager;transportManager;peerStore;events;reserveQueue;reservations;maxDiscoveredRelays;maxReservationQueueLength;started;constructor(N,O){super(),this.peerId=N.peerId,this.connectionManager=N.connectionManager,this.transportManager=N.transportManager,this.peerStore=N.peerStore,this.events=N.events,this.reservations=new gG,this.maxDiscoveredRelays=O?.discoverRelays??0,this.maxReservationQueueLength=O?.maxReservationQueueLength??100,this.started=!1,this.reserveQueue=new bw({concurrency:O?.reservationConcurrency??Cm}),this.events.addEventListener("peer:disconnect",N=>{this.#g(N.detail)})}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.reservations.forEach(({timeout:N})=>{clearTimeout(N)}),this.reservations.clear(),this.started=!0}async addRelay(N,O){if(this.peerId.equals(N)){CP("not trying to use self as relay");return}if(this.reserveQueue.size>this.maxReservationQueueLength){CP("not adding relay as the queue is full");return}if(this.reserveQueue.hasJob(N)){CP("relay peer is already in the reservation queue");return}CP("add relay %p",N),await this.reserveQueue.add(async()=>{try{let U=this.reservations.get(N);if(null!=U){if(C_(U.reservation.expire)>Cx){CP("already have reservation on relay peer %p and it expires in more than 10 minutes",N);return}clearTimeout(U.timeout),this.reservations.delete(N)}if("discovered"===O&&[...this.reservations.values()].reduce((N,O)=>("discovered"===O.type&&N++,N),0)>=this.maxDiscoveredRelays){CP("already have enough discovered relays");return}let $=await this.connectionManager.openConnection(N);if($.remoteAddr.protoNames().includes("p2p-circuit")){CP("not creating reservation over relayed connection");return}let Y=await this.#y($);CP("created reservation on relay peer %p",N);let X=C_(Y.expire),J=Math.min(Math.max(X-CN,CL),2147483647),Z=setTimeout(()=>{this.addRelay(N,O).catch(O=>{CP.error("could not refresh reservation to relay %p",N,O)})},J);this.reservations.set(N,{timeout:Z,reservation:Y,type:O}),await this.peerStore.merge(N,{tags:{[Cb]:{value:1,ttl:X}}}),await this.transportManager.listen([y1(`/p2p/${N.toString()}/p2p-circuit`)])}catch(O){CP.error("could not reserve slot on %p",N,O),this.reservations.delete(N)}},{peerId:N})}hasReservation(N){return this.reservations.has(N)}getReservation(N){return this.reservations.get(N)?.reservation}async #y(N){let O;CP("requesting reservation from %s",N.remotePeer);let U=await N.newStream(Cw),$=E_(U),Y=$.pb(tC);Y.write({type:tC.Type.RESERVE});try{O=await Y.read()}catch(O){throw CP.error("error parsing reserve message response from %p because",N.remotePeer,O),O}finally{U.close()}if(O.status===tL.OK&&null!=O.reservation)return O.reservation;let X=`reservation failed with status ${O.status??"undefined"}`;throw CP.error(X),Error(X)}#g(N){let O=this.reservations.get(N);null!=O&&(CP("connection to relay %p closed, removing reservation from local store",N),clearTimeout(O.timeout),this.reservations.delete(N),this.safeDispatchEvent("relay:removed",{detail:N}),this.reservations.size<this.maxDiscoveredRelays&&(CP("not enough relays %d/%d",this.reservations.size,this.maxDiscoveredRelays),this.safeDispatchEvent("relay:not-enough-relays",{})))}}let CM=rF("libp2p:circuit-relay:transport"),CU=N=>{if(null==N.peer)return!1;try{N.peer.addrs.forEach(y1)}catch{return!1}return!0},CF={maxInboundStopStreams:bk,maxOutboundStopStreams:bk};class CV{discovery;registrar;peerStore;connectionManager;peerId;upgrader;addressManager;connectionGater;reservationStore;maxInboundStopStreams;maxOutboundStopStreams;started;constructor(N,O){this.registrar=N.registrar,this.peerStore=N.peerStore,this.connectionManager=N.connectionManager,this.peerId=N.peerId,this.upgrader=N.upgrader,this.addressManager=N.addressManager,this.connectionGater=N.connectionGater,this.maxInboundStopStreams=O.maxInboundStopStreams??CF.maxInboundStopStreams,this.maxOutboundStopStreams=O.maxOutboundStopStreams??CF.maxOutboundStopStreams,null!=O.discoverRelays&&O.discoverRelays>0&&(this.discovery=new CD(N),this.discovery.addEventListener("relay:discover",N=>{this.reservationStore.addRelay(N.detail,"discovered").catch(O=>{CM.error("could not add discovered relay %p",N.detail,O)})})),this.reservationStore=new CO(N,O),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{this.discovery?.discover().catch(N=>{CM.error("could not discover relays",N)})}),this.started=!1}isStarted(){return this.started}async start(){await this.reservationStore.start(),await this.discovery?.start(),await this.registrar.handle(Cv,N=>{this.onStop(N).catch(N=>{CM.error(N)})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams}),this.started=!0}async stop(){this.discovery?.stop(),await this.reservationStore.stop(),await this.registrar.unhandle(Cv),this.started=!1}[mX]=!0;[Symbol.toStringTag]="libp2p/circuit-relay-v2";async dial(N,O={}){let U;if(1!==N.protoCodes().filter(N=>N===Cg).length){let O="Invalid circuit relay address";throw CM.error(O,N),new n3(O,eZ.ERR_RELAYED_DIAL)}let $=N.toString().split("/p2p-circuit"),Y=y1($[0]),X=y1($[$.length-1]),J=Y.getPeerId(),Z=X.getPeerId();if(null==J||null==Z){let O=`Circuit relay dial to ${N.toString()} failed as address did not have peer ids`;throw CM.error(O),new n3(O,eZ.ERR_RELAYED_DIAL)}let en=gC(J),es=gC(Z),eo=!1,ea=this.connectionManager.getConnections(en),ec=ea[0];null==ec&&(await this.peerStore.merge(en,{multiaddrs:[Y]}),ec=await this.connectionManager.openConnection(en,O),eo=!0);try{return U=await ec.newStream([Cw]),await this.connectV2({stream:U,connection:ec,destinationPeer:es,destinationAddr:X,relayAddr:Y,ma:N,disconnectOnFailure:eo})}catch(N){throw CM.error(`Circuit relay dial to destination ${es.toString()} via relay ${en.toString()} failed`,N),null!=U&&U.abort(N),eo&&await ec.close(),N}}async connectV2({stream:N,connection:O,destinationPeer:U,destinationAddr:$,relayAddr:Y,ma:X,disconnectOnFailure:J}){try{let O=E_(N),J=O.pb(tC);J.write({type:tC.Type.CONNECT,peer:{id:U.toBytes(),addrs:[y1($).bytes]}});let Z=await J.read();if(Z.status!==tL.OK)throw new n3(`failed to connect via relay with status ${Z?.status?.toString()??"undefined"}`,eZ.ERR_HOP_REQUEST_FAILED);let en=CR({stream:O.unwrap(),remoteAddr:X,localAddr:Y.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`)});return CM("new outbound connection %s",en.remoteAddr),await this.upgrader.upgradeOutbound(en)}catch(N){throw CM.error(`Circuit relay dial to destination ${U.toString()} via relay ${O.remotePeer.toString()} failed`,N),J&&await O.close(),N}}createListener(N){return CC({connectionManager:this.connectionManager,relayStore:this.reservationStore})}filter(N){return(N=Array.isArray(N)?N:[N]).filter(N=>S$.matches(N))}async onStop({connection:N,stream:O}){let U=E_(O),$=await U.readPB(tP);if(CM("received circuit v2 stop protocol request from %s",N.remotePeer),$?.type===void 0)return;let Y=U.pb(tP);if(CM("new circuit relay v2 stop stream from %s",N.remotePeer),$.type!==tP.Type.CONNECT){CM.error("invalid stop connect request via peer %s",N.remotePeer),Y.write({type:tP.Type.STATUS,status:tL.UNEXPECTED_MESSAGE});return}if(!CU($)){CM.error("invalid stop connect request via peer %s",N.remotePeer),Y.write({type:tP.Type.STATUS,status:tL.MALFORMED_MESSAGE});return}let X=gP($.peer.id);if(await this.connectionGater.denyInboundRelayedConnection?.(N.remotePeer,X)===!0){Y.write({type:tP.Type.STATUS,status:tL.PERMISSION_DENIED});return}Y.write({type:tP.Type.STATUS,status:tL.OK});let J=N.remoteAddr.encapsulate(`/p2p-circuit/p2p/${X.toString()}`),Z=this.addressManager.getAddresses()[0],en=CR({stream:U.unwrap(),remoteAddr:J,localAddr:Z});CM("new inbound connection %s",en.remoteAddr),await this.upgrader.upgradeInbound(en),CM("%s connection %s upgraded","inbound",en.remoteAddr)}}function Cz(N={}){return O=>new CV(O,N)}let C$="0.45.9",CK=`js-libp2p/${C$}`,Cq="0.1.0",Cj="id",CW="id/push",CH="1.0.0",CG="1.0.0";!function(N){let O;N.codec=()=>(null==O&&(O=sE((N,O,U={})=>{if(!1!==U.lengthDelimited&&O.fork(),null!=N.protocolVersion&&(O.uint32(42),O.string(N.protocolVersion)),null!=N.agentVersion&&(O.uint32(50),O.string(N.agentVersion)),null!=N.publicKey&&(O.uint32(10),O.bytes(N.publicKey)),null!=N.listenAddrs)for(let U of N.listenAddrs)O.uint32(18),O.bytes(U);if(null!=N.observedAddr&&(O.uint32(34),O.bytes(N.observedAddr)),null!=N.protocols)for(let U of N.protocols)O.uint32(26),O.string(U);null!=N.signedPeerRecord&&(O.uint32(66),O.bytes(N.signedPeerRecord)),!1!==U.lengthDelimited&&O.ldelim()},(N,O)=>{let U={listenAddrs:[],protocols:[]},$=null==O?N.len:N.pos+O;for(;N.pos<$;){let O=N.uint32();switch(O>>>3){case 5:U.protocolVersion=N.string();break;case 6:U.agentVersion=N.string();break;case 1:U.publicKey=N.bytes();break;case 2:U.listenAddrs.push(N.bytes());break;case 4:U.observedAddr=N.bytes();break;case 3:U.protocols.push(N.string());break;case 8:U.signedPeerRecord=N.bytes();break;default:N.skipType(7&O)}}return U})),O),N.encode=O=>sm(O,N.codec()),N.decode=O=>sy(O,N.codec())}(tU||(tU={}));let CQ=rF("libp2p:identify"),CY=8192,CX={protocolPrefix:"ipfs",agentVersion:CK,timeout:6e4,maxInboundStreams:1,maxOutboundStreams:1,maxPushIncomingStreams:1,maxPushOutgoingStreams:1,maxObservedAddresses:10,maxIdentifyMessageSize:8192};class CJ{identifyProtocolStr;identifyPushProtocolStr;host;started;timeout;peerId;peerStore;registrar;connectionManager;addressManager;maxInboundStreams;maxOutboundStreams;maxPushIncomingStreams;maxPushOutgoingStreams;maxIdentifyMessageSize;maxObservedAddresses;events;constructor(N,O){this.started=!1,this.peerId=N.peerId,this.peerStore=N.peerStore,this.registrar=N.registrar,this.addressManager=N.addressManager,this.connectionManager=N.connectionManager,this.events=N.events,this.identifyProtocolStr=`/${O.protocolPrefix??CX.protocolPrefix}/${Cj}/${CH}`,this.identifyPushProtocolStr=`/${O.protocolPrefix??CX.protocolPrefix}/${CW}/${CG}`,this.timeout=O.timeout??CX.timeout,this.maxInboundStreams=O.maxInboundStreams??CX.maxInboundStreams,this.maxOutboundStreams=O.maxOutboundStreams??CX.maxOutboundStreams,this.maxPushIncomingStreams=O.maxPushIncomingStreams??CX.maxPushIncomingStreams,this.maxPushOutgoingStreams=O.maxPushOutgoingStreams??CX.maxPushOutgoingStreams,this.maxIdentifyMessageSize=O.maxIdentifyMessageSize??CX.maxIdentifyMessageSize,this.maxObservedAddresses=O.maxObservedAddresses??CX.maxObservedAddresses,this.host={protocolVersion:`${O.protocolPrefix??CX.protocolPrefix}/${Cq}`,agentVersion:O.agentVersion??CX.agentVersion},N.events.addEventListener("connection:open",N=>{let O=N.detail;this.identify(O).catch(N=>{CQ.error("error during identify trigged by connection:open",N)})}),N.events.addEventListener("self:peer:update",N=>{this.push().catch(N=>{CQ.error(N)})}),this.host.agentVersion===CK&&(Tm||Tg?this.host.agentVersion+=` UserAgent=${globalThis.process.version}`:(Tf||Tb||Ty||Tw)&&(this.host.agentVersion+=` UserAgent=${globalThis.navigator.userAgent}`))}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:nD(this.host.agentVersion),ProtocolVersion:nD(this.host.protocolVersion)}}),await this.registrar.handle(this.identifyProtocolStr,N=>{this._handleIdentify(N).catch(N=>{CQ.error(N)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),await this.registrar.handle(this.identifyPushProtocolStr,N=>{this._handlePush(N).catch(N=>{CQ.error(N)})},{maxInboundStreams:this.maxPushIncomingStreams,maxOutboundStreams:this.maxPushOutgoingStreams}),this.started=!0)}async stop(){await this.registrar.unhandle(this.identifyProtocolStr),await this.registrar.unhandle(this.identifyPushProtocolStr),this.started=!1}async pushToConnections(N){let O=this.addressManager.getAddresses().map(N=>N.decapsulateCode(yg("p2p").code)),U=new y5({peerId:this.peerId,multiaddrs:O}),$=await g1.seal(U,this.peerId),Y=this.registrar.getProtocols(),X=await this.peerStore.get(this.peerId),J=nA(X.metadata.get("AgentVersion")??nD(this.host.agentVersion)),Z=nA(X.metadata.get("ProtocolVersion")??nD(this.host.protocolVersion)),en=N.map(async N=>{let U;let X=AbortSignal.timeout(this.timeout);try{oW.setMaxListeners?.(1/0,X)}catch{}try{U=await N.newStream([this.identifyPushProtocolStr],{signal:X});let en=sG(U,X);await en.sink(oD([tU.encode({listenAddrs:O.map(N=>N.bytes),signedPeerRecord:$.marshal(),protocols:Y,agentVersion:J,protocolVersion:Z})],N=>od(N)))}catch(N){CQ.error("could not push identify update to peer",N)}finally{null!=U&&U.close()}});await Promise.all(en)}async push(){if(!this.isStarted())return;let N=[];await Promise.all(this.connectionManager.getConnections().map(async O=>{try{let U=await this.peerStore.get(O.remotePeer);if(!U.protocols.includes(this.identifyPushProtocolStr))return;N.push(O)}catch(N){if(N.code!==eZ.ERR_NOT_FOUND)throw N}})),await this.pushToConnections(N)}async _identify(N,O={}){let U;let $=nY([AbortSignal.timeout(this.timeout),O?.signal]);try{oW.setMaxListeners?.(1/0,$)}catch{}try{U=await N.newStream([this.identifyProtocolStr],{signal:$});let O=sG(U,$),Y=await oD([],O,N=>om(N,{maxDataLength:this.maxIdentifyMessageSize??CY}),async N=>wo(N));if(null==Y)throw new n3("No data could be retrieved",eZ.ERR_CONNECTION_ENDED);try{return tU.decode(Y)}catch(N){throw new n3(String(N),eZ.ERR_INVALID_MESSAGE)}}finally{null!=U&&U.close(),$.clear()}}async identify(N,O={}){let U=await this._identify(N,O),{publicKey:$,protocols:Y,observedAddr:X}=U;if(null==$)throw new n3("public key was missing from identify message",eZ.ERR_MISSING_PUBLIC_KEY);let J=await gN($);if(!N.remotePeer.equals(J))throw new n3("identified peer does not match the expected peer",eZ.ERR_INVALID_PEER);if(this.peerId.equals(J))throw new n3("identified peer is our own peer id?",eZ.ERR_INVALID_PEER);let Z=CZ(X);CQ("identify completed for peer %p and protocols %o",J,Y),CQ("our observed address is %s",Z),null!=Z&&this.addressManager.getObservedAddrs().length<(this.maxObservedAddresses??1/0)&&(CQ("storing our observed address %s",Z?.toString()),this.addressManager.addObservedAddr(Z));let en=await this.#m(N.remotePeer,U),es={peerId:J,protocolVersion:U.protocolVersion,agentVersion:U.agentVersion,publicKey:U.publicKey,listenAddrs:U.listenAddrs.map(N=>y1(N)),observedAddr:null==U.observedAddr?void 0:y1(U.observedAddr),protocols:U.protocols,signedPeerRecord:en};this.events.safeDispatchEvent("peer:identify",{detail:es})}async _handleIdentify(N){let{connection:O,stream:U}=N,$=AbortSignal.timeout(this.timeout);try{oW.setMaxListeners?.(1/0,$)}catch{}try{let N=this.peerId.publicKey??new Uint8Array(0),Y=await this.peerStore.get(this.peerId),X=this.addressManager.getAddresses().map(N=>N.decapsulateCode(yg("p2p").code)),J=Y.peerRecordEnvelope;if(X.length>0&&null==J){let N=new y5({peerId:this.peerId,multiaddrs:X}),O=await g1.seal(N,this.peerId);J=O.marshal().subarray()}let Z=tU.encode({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:N,listenAddrs:X.map(N=>N.bytes),signedPeerRecord:J,observedAddr:O.remoteAddr.bytes,protocols:Y.protocols}),en=sG(U,$),es=oD([Z],N=>od(N));await en.sink(es)}catch(N){CQ.error("could not respond to identify request",N)}finally{U.close()}}async _handlePush(N){let{connection:O,stream:U}=N;try{if(this.peerId.equals(O.remotePeer))throw Error("received push from ourselves?");let N=sG(U,AbortSignal.timeout(this.timeout)),$=E_(N,{maxDataLength:this.maxIdentifyMessageSize??CY}),Y=await $.readPB(tU);await this.#m(O.remotePeer,Y)}catch(N){CQ.error("received invalid message",N);return}finally{U.close()}CQ("handled push from %p",O.remotePeer)}async #m(N,O){let U;if(CQ("received identify from %p",N),null==O)throw Error("Message was null or undefined");let $={addresses:O.listenAddrs.map(N=>({isCertified:!1,multiaddr:y1(N)})),protocols:O.protocols,metadata:new Map,peerRecordEnvelope:O.signedPeerRecord};if(null!=O.signedPeerRecord){let Y;CQ("received signedPeerRecord in push from %p",N);let X=O.signedPeerRecord,J=await g1.openAndCertify(X,y5.DOMAIN),Z=y5.createFromProtobuf(J.payload);if(!Z.peerId.equals(J.peerId))throw Error("signing key does not match PeerId in the PeerRecord");if(!N.equals(Z.peerId))throw Error("signing key does not match remote PeerId");try{Y=await this.peerStore.get(Z.peerId)}catch(N){if("ERR_NOT_FOUND"!==N.code)throw N}if(null!=Y&&($.metadata=Y.metadata,null!=Y.peerRecordEnvelope)){let N=await g1.createFromProtobuf(Y.peerRecordEnvelope),O=y5.createFromProtobuf(N.payload);O.seqNumber>=Z.seqNumber&&(CQ("sequence number was lower or equal to existing sequence number - stored: %d received: %d",O.seqNumber,Z.seqNumber),Z=O,X=Y.peerRecordEnvelope)}$.peerRecordEnvelope=X,$.addresses=Z.multiaddrs.map(N=>({isCertified:!0,multiaddr:N})),U={seq:Z.seqNumber,addresses:Z.multiaddrs}}else CQ("%p did not send a signed peer record",N);return null!=O.agentVersion&&$.metadata.set("AgentVersion",nD(O.agentVersion)),null!=O.protocolVersion&&$.metadata.set("ProtocolVersion",nD(O.protocolVersion)),await this.peerStore.patch(N,$),U}}function CZ(N){if(null!=N&&N.length>0)try{return y1(N)}catch{}}function C1(N={}){return O=>new CJ(O,N)}let C2={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function C0(){return{addresses:{listen:["/webrtc"]},transports:[A3(),A0(),TV(),TC(),Cz({discoverRelays:1})],connectionEncryption:[_q()],streamMuxers:[Sf(),DC()],peerDiscovery:[S0(C2)],contentRouters:[S7("https://cid.contact")],services:{identify:C1(),autoNAT:Cf(),pubsub:Em(),dht:kJ({clientMode:!0,validators:{ipns:Cr},selectors:{ipns:T6}})}}}async function C3(N,O){let U=C0();return O=O??{},wH({datastore:N,...U,...O,start:!1})}let C4="1.3.3",C5="helia",C6=rF("helia");async function C8(N={}){let O;let U=N.datastore??new nQ,$=N.blockstore??new iq;O=C7(N.libp2p)?N.libp2p:await C3(U,N.libp2p);let Y=new h_({...N,datastore:U,blockstore:$,libp2p:O});return!1!==N.start&&await Y.start(),Y.libp2p.isStarted()?await C9(Y):Y.libp2p.addEventListener("start",()=>{C9(Y).catch(N=>{C6.error("could not add Helia to agent version",N)})}),Y}function C7(N){if(null==N)return!1;let O=["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"];return O.every(O=>"function"==typeof N[O])}async function C9(N){let O=await N.libp2p.peerStore.get(N.libp2p.peerId),U=O.metadata.get("AgentVersion");if(null==U)return;let $=new TextDecoder().decode(U);null!=$.match(/js-libp2p\/\d+\.\d+\.\d+\sUserAgent=/)&&($=$.includes(C5)?`${C5}/${C4} ${$.split(" ").slice(1).join(" ")}`:`${C5}/${C4} ${$}`,await N.libp2p.peerStore.merge(N.libp2p.peerId,{metadata:{AgentVersion:new TextEncoder().encode($)}}))}},8498:function(N,O,U){"use strict";U.d(O,{E:function(){return Y}});var $=U(1283);function Y(N=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?(0,$.P)(globalThis.Buffer.allocUnsafe(N)):new Uint8Array(N)}},9114:function(N,O,U){"use strict";U.r(O),U.d(O,{concat:function(){return X}});var $=U(8498),Y=U(1283);function X(N,O){O||(O=N.reduce((N,O)=>N+O.length,0));let U=(0,$.E)(O),X=0;for(let O of N)U.set(O,X),X+=O.length;return(0,Y.P)(U)}},7105:function(N,O,U){"use strict";U.r(O),U.d(O,{fromString:function(){return X}});var $=U(6185),Y=U(1283);function X(N,O="utf8"){let U=$.Z[O];if(!U)throw Error(`Unsupported encoding "${O}"`);return("utf8"===O||"utf-8"===O)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?(0,Y.P)(globalThis.Buffer.from(N,"utf-8")):U.decoder.decode(`${U.prefix}${N}`)}},864:function(N,O,U){"use strict";U.r(O),U.d(O,{toString:function(){return Y}});var $=U(6185);function Y(N,O="utf8"){let U=$.Z[O];if(!U)throw Error(`Unsupported encoding "${O}"`);return("utf8"===O||"utf-8"===O)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(N.buffer,N.byteOffset,N.byteLength).toString("utf8"):U.encoder.encode(N).substring(1)}},1283:function(N,O,U){"use strict";function $(N){return null!=globalThis.Buffer?new Uint8Array(N.buffer,N.byteOffset,N.byteLength):N}U.d(O,{P:function(){return $}})},6185:function(N,O,U){"use strict";U.d(O,{Z:function(){return rw}});var $={};U.r($),U.d($,{identity:function(){return eB}});var Y={};U.r(Y),U.d(Y,{base2:function(){return eL}});var X={};U.r(X),U.d(X,{base8:function(){return eO}});var J={};U.r(J),U.d(J,{base10:function(){return eM}});var Z={};U.r(Z),U.d(Z,{base16:function(){return eU},base16upper:function(){return eF}});var en={};U.r(en),U.d(en,{base32:function(){return eV},base32hex:function(){return eq},base32hexpad:function(){return eW},base32hexpadupper:function(){return eH},base32hexupper:function(){return ej},base32pad:function(){return e$},base32padupper:function(){return eK},base32upper:function(){return ez},base32z:function(){return eG}});var es={};U.r(es),U.d(es,{base36:function(){return eQ},base36upper:function(){return eY}});var eo={};U.r(eo),U.d(eo,{base58btc:function(){return eX},base58flickr:function(){return eJ}});var ea={};U.r(ea),U.d(ea,{base64:function(){return eZ},base64pad:function(){return e0},base64url:function(){return e3},base64urlpad:function(){return e5}});var ec={};U.r(ec),U.d(ec,{base256emoji:function(){return tr}});var eu={};U.r(eu),U.d(eu,{sha256:function(){return tN},sha512:function(){return tB}});var eh={};U.r(eh),U.d(eh,{identity:function(){return tF}});var ef={};U.r(ef),U.d(ef,{code:function(){return tz},decode:function(){return tK},encode:function(){return t$},name:function(){return tV}});var eg={};U.r(eg),U.d(eg,{code:function(){return tH},decode:function(){return tQ},encode:function(){return tG},name:function(){return tW}});var ey=function(N,O){if(N.length>=255)throw TypeError("Alphabet too long");for(var U=new Uint8Array(256),$=0;$<U.length;$++)U[$]=255;for(var Y=0;Y<N.length;Y++){var X=N.charAt(Y),J=X.charCodeAt(0);if(255!==U[J])throw TypeError(X+" is ambiguous");U[J]=Y}var Z=N.length,en=N.charAt(0),es=Math.log(Z)/Math.log(256),eo=Math.log(256)/Math.log(Z);function ea(N){if("string"!=typeof N)throw TypeError("Expected String");if(0===N.length)return new Uint8Array;var O=0;if(" "!==N[0]){for(var $=0,Y=0;N[O]===en;)$++,O++;for(var X=(N.length-O)*es+1>>>0,J=new Uint8Array(X);N[O];){var eo=U[N.charCodeAt(O)];if(255===eo)return;for(var ea=0,ec=X-1;(0!==eo||ea<Y)&&-1!==ec;ec--,ea++)eo+=Z*J[ec]>>>0,J[ec]=eo%256>>>0,eo=eo/256>>>0;if(0!==eo)throw Error("Non-zero carry");Y=ea,O++}if(" "!==N[O]){for(var eu=X-Y;eu!==X&&0===J[eu];)eu++;for(var eh=new Uint8Array($+(X-eu)),ef=$;eu!==X;)eh[ef++]=J[eu++];return eh}}}function ec(N){var U=ea(N);if(U)return U;throw Error(`Non-${O} character`)}return{encode:function(O){if(O instanceof Uint8Array||(ArrayBuffer.isView(O)?O=new Uint8Array(O.buffer,O.byteOffset,O.byteLength):Array.isArray(O)&&(O=Uint8Array.from(O))),!(O instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===O.length)return"";for(var U=0,$=0,Y=0,X=O.length;Y!==X&&0===O[Y];)Y++,U++;for(var J=(X-Y)*eo+1>>>0,es=new Uint8Array(J);Y!==X;){for(var ea=O[Y],ec=0,eu=J-1;(0!==ea||ec<$)&&-1!==eu;eu--,ec++)ea+=256*es[eu]>>>0,es[eu]=ea%Z>>>0,ea=ea/Z>>>0;if(0!==ea)throw Error("Non-zero carry");$=ec,Y++}for(var eh=J-$;eh!==J&&0===es[eh];)eh++;for(var ef=en.repeat(U);eh<J;++eh)ef+=N.charAt(es[eh]);return ef},decodeUnsafe:ea,decode:ec}};new Uint8Array(0);let ew=(N,O)=>{if(N===O)return!0;if(N.byteLength!==O.byteLength)return!1;for(let U=0;U<N.byteLength;U++)if(N[U]!==O[U])return!1;return!0},ev=N=>{if(N instanceof Uint8Array&&"Uint8Array"===N.constructor.name)return N;if(N instanceof ArrayBuffer)return new Uint8Array(N);if(ArrayBuffer.isView(N))return new Uint8Array(N.buffer,N.byteOffset,N.byteLength);throw Error("Unknown type, must be binary type")},eE=N=>new TextEncoder().encode(N),e_=N=>new TextDecoder().decode(N);class eS{constructor(N,O,U){this.name=N,this.prefix=O,this.baseEncode=U}encode(N){if(N instanceof Uint8Array)return`${this.prefix}${this.baseEncode(N)}`;throw Error("Unknown type, must be binary type")}}class eI{constructor(N,O,U){if(this.name=N,this.prefix=O,void 0===O.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=O.codePointAt(0),this.baseDecode=U}decode(N){if("string"==typeof N){if(N.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(N)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(N.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(N){return ek(this,N)}}class eR{constructor(N){this.decoders=N}or(N){return ek(this,N)}decode(N){let O=N[0],U=this.decoders[O];if(U)return U.decode(N);throw RangeError(`Unable to decode multibase string ${JSON.stringify(N)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let ek=(N,O)=>new eR({...N.decoders||{[N.prefix]:N},...O.decoders||{[O.prefix]:O}});class eD{constructor(N,O,U,$){this.name=N,this.prefix=O,this.baseEncode=U,this.baseDecode=$,this.encoder=new eS(N,O,U),this.decoder=new eI(N,O,$)}encode(N){return this.encoder.encode(N)}decode(N){return this.decoder.decode(N)}}let eA=({name:N,prefix:O,encode:U,decode:$})=>new eD(N,O,U,$),eT=({prefix:N,name:O,alphabet:U})=>{let{encode:$,decode:Y}=ey(U,O);return eA({prefix:N,name:O,encode:$,decode:N=>ev(Y(N))})},eC=(N,O,U,$)=>{let Y={};for(let N=0;N<O.length;++N)Y[O[N]]=N;let X=N.length;for(;"="===N[X-1];)--X;let J=new Uint8Array(X*U/8|0),Z=0,en=0,es=0;for(let O=0;O<X;++O){let X=Y[N[O]];if(void 0===X)throw SyntaxError(`Non-${$} character`);en=en<<U|X,(Z+=U)>=8&&(Z-=8,J[es++]=255&en>>Z)}if(Z>=U||255&en<<8-Z)throw SyntaxError("Unexpected end of data");return J},eP=(N,O,U)=>{let $="="===O[O.length-1],Y=(1<<U)-1,X="",J=0,Z=0;for(let $=0;$<N.length;++$)for(Z=Z<<8|N[$],J+=8;J>U;)J-=U,X+=O[Y&Z>>J];if(J&&(X+=O[Y&Z<<U-J]),$)for(;X.length*U&7;)X+="=";return X},eN=({name:N,prefix:O,bitsPerChar:U,alphabet:$})=>eA({prefix:O,name:N,encode:N=>eP(N,$,U),decode:O=>eC(O,$,U,N)}),eB=eA({prefix:"\x00",name:"identity",encode:N=>e_(N),decode:N=>eE(N)}),eL=eN({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),eO=eN({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),eM=eT({prefix:"9",name:"base10",alphabet:"0123456789"}),eU=eN({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),eF=eN({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),eV=eN({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ez=eN({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),e$=eN({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),eK=eN({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),eq=eN({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ej=eN({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),eW=eN({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),eH=eN({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),eG=eN({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),eQ=eT({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),eY=eT({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),eX=eT({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),eJ=eT({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),eZ=eN({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),e0=eN({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),e3=eN({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),e5=eN({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),e6=Array.from("\uD83D\uDE80\uD83E\uDE90☄\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09☀\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02❤\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09☺\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E✌✨\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D❣\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33✋\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13⭐✅\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6✔\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90☹\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20☝\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B⚽\uD83E\uDD19☕\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81⚡\uD83C\uDF1E\uD83C\uDF88❌✊\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C✈\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74▶➡❓\uD83D\uDC8E\uD83D\uDCB8⬇\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A⚠\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37☎\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51❄\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),e7=e6.reduce((N,O,U)=>(N[U]=O,N),[]),e9=e6.reduce((N,O,U)=>(N[O.codePointAt(0)]=U,N),[]);function te(N){return N.reduce((N,O)=>N+=e7[O],"")}function tt(N){let O=[];for(let U of N){let N=e9[U.codePointAt(0)];if(void 0===N)throw Error(`Non-base256emoji character: ${U}`);O.push(N)}return new Uint8Array(O)}let tr=eA({prefix:"\uD83D\uDE80",name:"base256emoji",encode:te,decode:tt});var ti=128,tn=-128,ta=2147483648;function tl(N,O,U){O=O||[];for(var $=U=U||0;N>=ta;)O[U++]=255&N|ti,N/=128;for(;N&tn;)O[U++]=255&N|ti,N>>>=7;return O[U]=0|N,tl.bytes=U-$+1,O}var tu=128,th=127;function td(N,O){var U,$=0,O=O||0,Y=0,X=O,J=N.length;do{if(X>=J)throw td.bytes=0,RangeError("Could not decode varint");U=N[X++],$+=Y<28?(U&th)<<Y:(U&th)*Math.pow(2,Y),Y+=7}while(U>=tu);return td.bytes=X-O,$}var tp=128,tf=16384,tg=2097152,ty=268435456,tm=34359738368,tb=4398046511104,tw=562949953421312,tv=72057594037927940,tE=0x7fffffffffffffff,t_={encode:tl,decode:td,encodingLength:function(N){return N<tp?1:N<tf?2:N<tg?3:N<ty?4:N<tm?5:N<tb?6:N<tw?7:N<tv?8:N<tE?9:10}};let tS=(N,O=0)=>{let U=t_.decode(N,O);return[U,t_.decode.bytes]},tI=(N,O,U=0)=>(t_.encode(N,O,U),O),tR=N=>t_.encodingLength(N),tk=(N,O)=>{let U=O.byteLength,$=tR(N),Y=$+tR(U),X=new Uint8Array(Y+U);return tI(N,X,0),tI(U,X,$),X.set(O,Y),new tT(N,U,O,X)},tD=N=>{let O=ev(N),[U,$]=tS(O),[Y,X]=tS(O.subarray($)),J=O.subarray($+X);if(J.byteLength!==Y)throw Error("Incorrect length");return new tT(U,Y,J,O)},tA=(N,O)=>N===O||N.code===O.code&&N.size===O.size&&ew(N.bytes,O.bytes);class tT{constructor(N,O,U,$){this.code=N,this.size=O,this.digest=U,this.bytes=$}}let tC=({name:N,code:O,encode:U})=>new tP(N,O,U);class tP{constructor(N,O,U){this.name=N,this.code=O,this.encode=U}digest(N){if(N instanceof Uint8Array){let O=this.encode(N);return O instanceof Uint8Array?tk(this.code,O):O.then(N=>tk(this.code,N))}throw Error("Unknown type, must be binary type")}}let tx=N=>async O=>new Uint8Array(await crypto.subtle.digest(N,O)),tN=tC({name:"sha2-256",code:18,encode:tx("SHA-256")}),tB=tC({name:"sha2-512",code:19,encode:tx("SHA-512")}),tL=0,tO="identity",tM=ev,tU=N=>tk(tL,tM(N)),tF={code:tL,name:tO,encode:tM,digest:tU},tV="raw",tz=85,t$=N=>ev(N),tK=N=>ev(N),tq=new TextEncoder,tj=new TextDecoder,tW="json",tH=512,tG=N=>tq.encode(JSON.stringify(N)),tQ=N=>JSON.parse(tj.decode(N));class tY{constructor(N,O,U,$){this.code=O,this.version=N,this.multihash=U,this.bytes=$,this.byteOffset=$.byteOffset,this.byteLength=$.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:rc,byteLength:rc,code:rl,version:rl,multihash:rl,bytes:rl,_baseCache:rc,asCID:rc})}toV0(){if(0===this.version)return this;{let{code:N,multihash:O}=this;if(N!==ri)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(O.code!==rn)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return tY.createV0(O)}}toV1(){switch(this.version){case 0:{let{code:N,digest:O}=this.multihash,U=tk(N,O);return tY.createV1(this.code,U)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(N){return N&&this.code===N.code&&this.version===N.version&&tA(this.multihash,N.multihash)}toString(N){let{bytes:O,version:U,_baseCache:$}=this;return 0===U?tJ(O,$,N||eX.encoder):tZ(O,$,N||eV.encoder)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(N){return rh(/^0\.0/,rd),!!(N&&(N[ra]||N.asCID===N))}get toBaseEncodedString(){throw Error("Deprecated, use .toString()")}get codec(){throw Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw Error('"multibaseName" property is deprecated')}get prefix(){throw Error('"prefix" property is deprecated')}static asCID(N){if(N instanceof tY)return N;if(null!=N&&N.asCID===N){let{version:O,code:U,multihash:$,bytes:Y}=N;return new tY(O,U,$,Y||ro(O,U,$.bytes))}if(null==N||!0!==N[ra])return null;{let{version:O,multihash:U,code:$}=N,Y=tD(U);return tY.create(O,$,Y)}}static create(N,O,U){if("number"!=typeof O)throw Error("String codecs are no longer supported");switch(N){case 0:if(O===ri)return new tY(N,O,U,U.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${ri}) block encoding`);case 1:{let $=ro(N,O,U.bytes);return new tY(N,O,U,$)}default:throw Error("Invalid version")}}static createV0(N){return tY.create(0,ri,N)}static createV1(N,O){return tY.create(1,N,O)}static decode(N){let[O,U]=tY.decodeFirst(N);if(U.length)throw Error("Incorrect length");return O}static decodeFirst(N){let O=tY.inspectBytes(N),U=O.size-O.multihashSize,$=ev(N.subarray(U,U+O.multihashSize));if($.byteLength!==O.multihashSize)throw Error("Incorrect length");let Y=$.subarray(O.multihashSize-O.digestSize),X=new tT(O.multihashCode,O.digestSize,Y,$),J=0===O.version?tY.createV0(X):tY.createV1(O.codec,X);return[J,N.subarray(O.size)]}static inspectBytes(N){let O=0,U=()=>{let[U,$]=tS(N.subarray(O));return O+=$,U},$=U(),Y=ri;if(18===$?($=0,O=0):1===$&&(Y=U()),0!==$&&1!==$)throw RangeError(`Invalid CID version ${$}`);let X=O,J=U(),Z=U(),en=O+Z,es=en-X;return{version:$,codec:Y,multihashCode:J,digestSize:Z,multihashSize:es,size:en}}static parse(N,O){let[U,$]=tX(N,O),Y=tY.decode($);return Y._baseCache.set(U,N),Y}}let tX=(N,O)=>{switch(N[0]){case"Q":{let U=O||eX;return[eX.prefix,U.decode(`${eX.prefix}${N}`)]}case eX.prefix:{let U=O||eX;return[eX.prefix,U.decode(N)]}case eV.prefix:{let U=O||eV;return[eV.prefix,U.decode(N)]}default:if(null==O)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[N[0],O.decode(N)]}},tJ=(N,O,U)=>{let{prefix:$}=U;if($!==eX.prefix)throw Error(`Cannot string encode V0 in ${U.name} encoding`);let Y=O.get($);if(null!=Y)return Y;{let Y=U.encode(N).slice(1);return O.set($,Y),Y}},tZ=(N,O,U)=>{let{prefix:$}=U,Y=O.get($);if(null!=Y)return Y;{let Y=U.encode(N);return O.set($,Y),Y}},ri=112,rn=18,ro=(N,O,U)=>{let $=tR(N),Y=$+tR(O),X=new Uint8Array(Y+U.byteLength);return tI(N,X,0),tI(O,X,$),X.set(U,Y),X},ra=Symbol.for("@ipld/js-cid/CID"),rl={writable:!1,configurable:!1,enumerable:!0},rc={writable:!1,enumerable:!1,configurable:!1},ru="0.0.0-dev",rh=(N,O)=>{if(N.test(ru))console.warn(O);else throw Error(O)},rd=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`,rp={...$,...Y,...X,...J,...Z,...en,...es,...eo,...ea,...ec};({...eu,...eh});var rf=U(8498);function rg(N,O,U,$){return{name:N,prefix:O,encoder:{name:N,prefix:O,encode:U},decoder:{decode:$}}}let ry=rg("utf8","u",N=>{let O=new TextDecoder("utf8");return"u"+O.decode(N)},N=>{let O=new TextEncoder;return O.encode(N.substring(1))}),rm=rg("ascii","a",N=>{let O="a";for(let U=0;U<N.length;U++)O+=String.fromCharCode(N[U]);return O},N=>{N=N.substring(1);let O=(0,rf.E)(N.length);for(let U=0;U<N.length;U++)O[U]=N.charCodeAt(U);return O}),rb={utf8:ry,"utf-8":ry,hex:rp.base16,latin1:rm,ascii:rm,binary:rm,...rp};var rw=rb}}]);